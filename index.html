<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Labubu TBB Game - –ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .notification-enter {
            animation: slideInRight 0.3s ease-out;
        }
        .notification-exit {
            animation: fadeOut 0.3s ease-out;
        }
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        .pet-bounce {
            animation: bounce 2s infinite;
        }
        .pet-sleep {
            animation: pulse 2s infinite;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-pink-100 via-purple-100 to-blue-100 min-h-screen">

<!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
<div id="notifications" class="fixed top-4 right-4 z-50 space-y-2"></div>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–≥—Ä—ã -->
<div class="max-w-lg mx-auto bg-gradient-to-b from-pink-100 to-purple-100 rounded-xl p-4 shadow-lg min-h-screen">
    
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –ø–æ–≥–æ–¥–æ–π –∏ –≤—Ä–µ–º–µ–Ω–µ–º -->
    <div class="text-center mb-4">
        <div class="flex justify-between items-center mb-2">
            <div class="text-sm" id="timeOfDay">‚òÄÔ∏è</div>
            <div class="text-center">
                <h1 class="text-xl font-bold text-purple-800">üê∞ <span id="petNameDisplay">Labubu</span> Care</h1>
                <div id="nameEditSection" class="hidden mt-2">
                    <input type="text" id="nameInput" class="text-sm px-2 py-1 border rounded" maxlength="15">
                    <div class="mt-1">
                        <button id="saveNameBtn" class="text-xs bg-blue-500 text-white px-2 py-1 rounded mr-1">‚úì</button>
                        <button id="cancelNameBtn" class="text-xs bg-gray-500 text-white px-2 py-1 rounded">‚úï</button>
                    </div>
                </div>
                <button id="editNameBtn" class="text-xs text-purple-600 hover:text-purple-800 mt-1">‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è</button>
            </div>
            <div class="text-sm" id="weather">‚òÄÔ∏è</div>
        </div>
        <div class="flex justify-between text-xs">
            <span id="levelDisplay">Lv.1</span>
            <span id="moneyDisplay">üí∞100</span>
            <span id="expDisplay">‚≠ê0/100</span>
            <span id="ageDisplay">üéÇ0–¥</span>
            <button id="soundToggle" class="text-xs">üîä</button>
        </div>
        <div id="collaboratorsInfo" class="text-xs text-purple-600 mt-1 hidden"></div>
    </div>

    <!-- –ü–µ—Ä—Å–æ–Ω–∞–∂ Labubu -->
    <div class="text-center mb-4 bg-white rounded-lg p-6 shadow">
        <div class="mb-4 relative inline-block">
            <img id="petImage" src="https://i.pinimg.com/474x/49/b9/bc/49b9bc9d7961d675e91a963b192c16a9.jpg" alt="Labubu" class="w-32 h-32 mx-auto object-contain">
            
            <!-- –û–¥–µ–∂–¥–∞ -->
            <div class="absolute inset-0" id="outfitContainer"></div>
            
            <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã -->
            <div id="sleepIndicator" class="absolute -top-2 -right-2 text-lg animate-pulse hidden">üí§</div>
            <div id="moodIndicator" class="absolute -top-1 -left-1 text-sm"></div>
            <div id="criticalIndicator" class="absolute inset-0 bg-red-500 bg-opacity-20 rounded-full animate-pulse hidden"></div>
        </div>
        
        <div class="text-2xl mb-2" id="moodEmoji">üòä</div>
        <div class="text-sm text-gray-600 font-medium" id="moodStatus">–°—á–∞—Å—Ç–ª–∏–≤</div>
        <div class="text-xs text-purple-600 mt-1" id="evolutionStage">–ú–∞–ª—ã—à</div>
        <div id="currentOutfit" class="text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded-full mt-2 inline-block hidden"></div>
        <div class="text-xs text-gray-500 mt-1">üéÇ –í–æ–∑—Ä–∞—Å—Ç: <span id="ageText">0</span> –¥–Ω–µ–π</div>
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
    <div id="gameMessage" class="bg-yellow-100 border border-yellow-400 text-yellow-700 px-3 py-2 rounded mb-3 text-center text-xs hidden"></div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
    <div class="mb-4 bg-white rounded-lg p-3 shadow">
        <div id="statsContainer"></div>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∏ -->
    <div class="flex mb-3 bg-white rounded-lg p-1 shadow text-xs">
        <button class="tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors bg-purple-500 text-white" data-tab="care">üîß –£—Ö–æ–¥</button>
        <button class="tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors text-purple-500 hover:bg-purple-50" data-tab="games">üéÆ –ò–≥—Ä—ã</button>
        <button class="tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors text-purple-500 hover:bg-purple-50" data-tab="shop">üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω</button>
        <button class="tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors text-purple-500 hover:bg-purple-50" data-tab="chests">üì¶ –°—É–Ω–¥—É–∫–∏</button>
        <button class="tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors text-purple-500 hover:bg-purple-50" data-tab="pets">üê∞ –ü–∏—Ç–æ–º—Ü—ã</button>
        <button class="tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors text-purple-500 hover:bg-purple-50" data-tab="info">‚ÑπÔ∏è –ò–Ω—Ñ–æ</button>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ -->
    <div id="tabContent"></div>
</div>

<!-- –ú–æ–¥–∞–ª –º–∏–Ω–∏-–∏–≥—Ä—ã -->
<div id="miniGameModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4 max-h-96 overflow-y-auto">
        <h3 id="gameTitle" class="text-lg font-bold mb-4"></h3>
        <div id="gameContent"></div>
        <button id="cancelGameBtn" class="mt-4 bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded w-full transition-colors">–û—Ç–º–µ–Ω–∞</button>
    </div>
</div>

<script>
class LabubuCareGame {
    constructor() {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
        this.initializeData();
        
        // –ó–≤—É–∫–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
        this.audioContext = null;
        this.soundEnabled = localStorage.getItem('sound_enabled') !== 'false';
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        this.activeTab = 'care';
        this.currentMiniGame = null;
        this.notifications = [];
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        this.init();
        this.startGameLoop();
        this.startNotificationTimer();
    }
    
    initializeData() {
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        this.stats = this.loadData('shared_labubu_stats', {
            hunger: 100, happiness: 100, cleanliness: 100,
            health: 100, energy: 100, sleep: 100
        });
        
        this.money = parseInt(localStorage.getItem('shared_labubu_money')) || 100;
        this.outfit = localStorage.getItem('shared_labubu_outfit') || 'default';
        this.level = parseInt(localStorage.getItem('shared_labubu_level')) || 1;
        this.experience = parseInt(localStorage.getItem('shared_labubu_experience')) || 0;
        this.age = parseInt(localStorage.getItem('shared_labubu_age')) || 0;
        this.evolutionStage = localStorage.getItem('shared_labubu_evolution') || 'baby';
        this.lastUpdate = parseInt(localStorage.getItem('shared_labubu_last_update')) || Date.now();
        this.lastNotification = parseInt(localStorage.getItem('shared_labubu_last_notification')) || Date.now();
        this.petName = localStorage.getItem('shared_pet_name') || 'Labubu';
        this.isSleeping = localStorage.getItem('shared_labubu_sleeping') === 'true';
        this.telegramConnected = localStorage.getItem('telegram_connected') === 'true';
        this.telegramChatId = localStorage.getItem('telegram_chat_id') || '';
        this.gameUserId = localStorage.getItem('game_user_id') || this.generateUserId();
        this.currentSkin = localStorage.getItem('shared_current_skin') || 'default';
        this.unlockedSkins = this.loadData('shared_unlocked_skins', ['default']);
        this.chestCount = parseInt(localStorage.getItem('shared_chest_count')) || 0;
        this.friendsInvited = parseInt(localStorage.getItem('shared_friends_invited')) || 0;
        this.lastChestLevel = parseInt(localStorage.getItem('shared_last_chest_level')) || 0;
        
        this.pets = this.loadData('shared_labubu_pets', [
            { id: 'pet1', name: 'Labubu', stats: this.stats, outfit: this.outfit, age: this.age, evolutionStage: this.evolutionStage }
        ]);
        this.activePetId = localStorage.getItem('shared_active_pet_id') || 'pet1';
        
        // –°–∫–∏–Ω—ã –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π —Å —Ä–µ–¥–∫–æ—Å—Ç—è–º–∏ –∏ —à–∞–Ω—Å–∞–º–∏
        this.skins = {
            default: { 
                name: '–ë–∞–∑–æ–≤—ã–π –õ–∞–±—É–±—É', 
                rarity: 'common', 
                chance: 50, 
                image: 'https://i.ebayimg.com/images/g/yVoAAOSwiqJnxCvP/s-l1600.jpg',
                color: '#DEB887'
            },
            pink: { 
                name: '–†–æ–∑–æ–≤—ã–π –õ–∞–±—É–±—É', 
                rarity: 'rare', 
                chance: 27, 
                image: 'https://i.postimg.cc/8s8qs9Sv/photo-2025-06-29-05-15-51.jpg',
                color: '#FFB6C1'
            },
            orange: { 
                name: '–û—Ä–∞–Ω–∂–µ–≤—ã–π –õ–∞–±—É–±—É', 
                rarity: 'rare', 
                chance: 26.5, 
                image: 'https://i.postimg.cc/C5n3hYWY/photo-2025-06-29-05-16-06.jpg',
                color: '#FFA500'
            },
            blue: { 
                name: '–ì–æ–ª—É–±–æ–π –õ–∞–±—É–±—É', 
                rarity: 'rare', 
                chance: 25, 
                image: 'https://i.postimg.cc/QNBC97DN/photo-2025-06-29-05-16-17.jpg',
                color: '#87CEEB'
            },
            rainbow: { 
                name: '–†–∞–¥—É–∂–Ω—ã–π –õ–∞–±—É–±—É', 
                rarity: 'legendary', 
                chance: 9, 
                image: 'https://i.postimg.cc/SQwsW-KQ6/photo-2025-06-29-05-16-29.jpg',
                color: '#FF69B4'
            },
            golden: { 
                name: '–ó–æ–ª–æ—Ç–æ–π –õ–∞–±—É–±—É', 
                rarity: 'mythic', 
                chance: 1, 
                image: 'https://i.postimg.cc/wTLBFd3S/photo-2025-06-29-05-16-38.jpg',
                color: '#FFD700'
            }
        };

        // –†–µ–¥–∫–æ—Å—Ç–∏
        this.rarities = {
            common: { name: '–û–±—ã—á–Ω–∞—è', color: '#888888', emoji: '‚ö™' },
            rare: { name: '–†–µ–¥–∫–∞—è', color: '#4A90E2', emoji: 'üîµ' },
            legendary: { name: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è', color: '#FF6B35', emoji: 'üü†' },
            mythic: { name: '–ú–∏—Ñ–∏—á–µ—Å–∫–∞—è', color: '#FFD700', emoji: 'üü°' }
        };

        // –≠–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–µ —Å—Ç–∞–¥–∏–∏
        this.evolutionStages = {
            baby: { name: '–ú–∞–ª—ã—à', minAge: 0 },
            child: { name: '–†–µ–±–µ–Ω–æ–∫', minAge: 7 },
            teen: { name: '–ü–æ–¥—Ä–æ—Å—Ç–æ–∫', minAge: 30 },
            adult: { name: '–í–∑—Ä–æ—Å–ª—ã–π', minAge: 60 },
            elder: { name: '–ú—É–¥—Ä–µ—Ü', minAge: 100 }
        };
        
        // –û–¥–µ–∂–¥–∞ —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ (–æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é —Ü–µ–Ω)
        this.outfits = {
            default: { name: '–û–±—ã—á–Ω–∞—è –æ–¥–µ–∂–¥–∞', price: 0, emoji: 'üëï', description: '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Å—Ç–∏–ª—å' },
            cool: { name: '–ö—Ä—É—Ç—ã–µ –æ—á–∫–∏', price: 250, emoji: 'üòé', description: '–°—Ç–∏–ª—å–Ω—ã–µ —Å–æ–ª–Ω—Ü–µ–∑–∞—â–∏—Ç–Ω—ã–µ –æ—á–∫–∏', image: 'https://via.placeholder.com/80x40/000000/ffffff?text=üï∂Ô∏è' },
            cute: { name: '–ú–∏–ª–∞—è —à–∞–ø–æ—á–∫–∞-–∑–∞–π—á–∏–∫', price: 300, emoji: 'üê∞', description: '–û—á–∞—Ä–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –±–µ–ª–∞—è —à–∞–ø–æ—á–∫–∞ —Å —Ä–æ–∑–æ–≤—ã–º–∏ —É—à–∫–∞–º–∏', image: 'https://via.placeholder.com/100x80/ffb6c1/ffffff?text=üëí' },
            artist: { name: '–•—É–¥–æ–∂–Ω–∏–∫', price: 380, emoji: 'üé®', description: '–ë–µ—Ä–µ—Ç –∏ –ø–∞–ª–∏—Ç—Ä–∞ —Ö—É–¥–æ–∂–Ω–∏–∫–∞' },
            summer: { name: '–õ–µ—Ç–Ω—è—è –ø–∞–Ω–∞–º–∞', price: 500, emoji: 'üëí', description: '–ó–∞—â–∏—Ç–∞ –æ—Ç —Å–æ–ª–Ω—Ü–∞ –≤ –∂–∞—Ä–∫–∏–µ –¥–Ω–∏', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KQgNY3oPaKq-vJXjqtKJhwoKBgt5rHdjiTq7FSl987ybzI3bnqyqEZliWC6n1k_YWtItJfQNjLu5ZcOheY9IUSTB5eoHuGKqoBu3HtCCn0pcimU1FsxfZKjdZ6dW-gMU6qVKPPAfeTa9-dgIn97icgGJyx5N3s-FwgRq5B525IWj_oNWw=s1024' },
            pirate: { name: '–ü–∏—Ä–∞—Ç—Å–∫–∏–π –∫–æ—Å—Ç—é–º', price: 500, emoji: 'üè¥‚Äç‚ò†Ô∏è', description: '–§–ª–∞–≥ –∏ –ø–æ–≤—è–∑–∫–∞ –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ –º–æ—Ä—Å–∫–æ–≥–æ —Ä–∞–∑–±–æ–π–Ω–∏–∫–∞', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KTqA1YhFzadswfIqFeTFATGNWcVmql50yfSGR14sxF3P_7fA51t61z9O_ElOyuBffWnyEP4uFz70PvgU0UFiXiYv83KqIeQr45k0r4FdFhb0yqWCa2ULVO0DPUanQNk8B4ROzTQGmHwO6-p5dkt8uD0yfrk6P7_DOd7jvVYx27V56CjLg=s1024' },
            formal: { name: '–î–µ–ª–æ–≤–æ–π –∫–æ—Å—Ç—é–º', price: 1500, emoji: 'ü§µ', description: '–≠–ª–µ–≥–∞–Ω—Ç–Ω—ã–π —á–µ—Ä–Ω—ã–π –∫–æ—Å—Ç—é–º —Å –≥–∞–ª—Å—Ç—É–∫–æ–º', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KSeqdykkIdnGZHfOH14tCALa06aMF9P6d9Sw0rm7WeTi1NR-nW-0C4x231qu8Zts6k-Jnxg16chpirg1zJFbt7wjgHf3Wo6DQYdth3uXsQeeM8B0bdfsfoxXMLCwUHjQ4JgzFxFqRApcbPf5MYgsGj5pORBo_pAj1K0LHVhXMX6xMSEQQ=s1024' },
            winter: { name: '–ó–∏–º–Ω—è—è –∫—É—Ä—Ç–∫–∞', price: 2000, emoji: 'üß•', description: '–¢–µ–ø–ª–∞—è –∫—É—Ä—Ç–∫–∞ –¥–ª—è —Ö–æ–ª–æ–¥–Ω–æ–π –ø–æ–≥–æ–¥—ã', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KTxCEBZrsAcaOt8mt4LjcLthFQZ2lhlrIZTcwekzMR3ODS-7V-y_m7c-_yFdPd-hCb9i08p3fW0vCajAEdJkip67TQJw0rsP09l5c49ZyG_rBEsv2io9mW2msQJsli2hr7kv2kRopjHwdbN8hVyDVCoX7yBTzkkXxygobNfvPx1uqTp=s1024' },
            school: { name: '–®–∫–æ–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞', price: 3000, emoji: 'üéí', description: '–ê–∫–∫—É—Ä–∞—Ç–Ω–∞—è —à–∫–æ–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞ —Å —Ä—é–∫–∑–∞—á–∫–æ–º', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KSzueH3-hMtM7lA2WveRFgZV9iCXa0D5N9Z8Vw9AAR_mLgCyE6zTrqu6BABMCTH80UkFmp-vmBh0Cr7ZlDw7Lq-UttAyk21eli4s9rRagGFYjxeQESpOyAQXL9CSCPtGawNsaBfta6Wa_g7pku3LgMzEv6SzWSYs1UzxoJ9tJcQV2pr=s1024' },
            knight: { name: '–†—ã—Ü–∞—Ä—å', price: 3000, emoji: '‚öîÔ∏è', description: '–î–æ—Å–ø–µ—Ö–∏ –∏ –º–µ—á —Ö—Ä–∞–±—Ä–æ–≥–æ —Ä—ã—Ü–∞—Ä—è', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KQEyf89ZUfFdb4fEyslGacR2ovpuyvcMZ-2bBZNsjz6M3GboPgvXfVYSnJAarf5-kmyKBphmBLdZL63T4JlUTb1-IdxnLTjNTC-vMkNoj4heCd7LVeQWQ-47m5g-cOgDo75-3eLrKC9roxWbeHbtAgRJl3tRgA2jd0FBOXi-GqZqV3J3w=s1024' },
            chef: { name: '–ö–æ—Å—Ç—é–º –ø–æ–≤–∞—Ä–∞', price: 4000, emoji: 'üë®‚Äçüç≥', description: '–ë–µ–ª—ã–π –∫–æ–ª–ø–∞–∫ –∏ —Ñ–∞—Ä—Ç—É–∫ —à–µ—Ñ-–ø–æ–≤–∞—Ä–∞', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KRAnLRL68CsnxJmlEhhul-fAzzg0wyNCnUd_IYARXgWj1m9mDqKeOVJy4e59Fwpz86mPm43o5IjyKxS7wEXPHVh626clvIWqEVAtrmmm7dgL-XopAKZ1YRujxo4ZBJbMjiSJ_sD2FwU1_nthVxma-b1Uut01G8839lnChFiagdPIsqjkQ=s1024' },
            superhero: { name: '–°—É–ø–µ—Ä–≥–µ—Ä–æ–π', price: 4500, emoji: 'ü¶∏', description: '–ü–ª–∞—â –∏ –º–∞—Å–∫–∞ –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ –≥–µ—Ä–æ—è', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KT-a_UoSupy-qHI_hWHRFiSG1i_9VeWgkZDicgclAVN_VHcGZy0oMTtQYzI_LivmJS7w_MM0PIslsYPPhSgwIZhQwdIq3eYkAhKxtNxtx0NKEjmucGdKxLetlYZZC6sZwoJxMBOhGyL49rjiF4ZKnSGBqavOq6EaxZUhYYBekqKFgZu=s1024' },
            doctor: { name: '–î–æ–∫—Ç–æ—Ä', price: 4800, emoji: 'üë®‚Äç‚öïÔ∏è', description: '–ë–µ–ª—ã–π —Ö–∞–ª–∞—Ç –∏ —Å—Ç–µ—Ç–æ—Å–∫–æ–ø', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KSVy9I1VlEurY9loVBGFCv5A7ydPo1u5iMtuyVSql4t4SATcmjUsn8deyd1wVd7B_Eb1RXkb0ig_Wok-qf6tE3RFjxrfzOSB8wYvL03UOJ4A6By6BQv0M6IEWZ0XOX9vL0VP_1kgkxg5iZhnR_GIxm38rrIJPTUHFnhrPrU-njScGl1dg=s1024' },
            ninja: { name: '–ö–æ—Å—Ç—é–º –Ω–∏–Ω–¥–∑—è', price: 5000, emoji: 'ü•∑', description: '–°–µ–∫—Ä–µ—Ç–Ω–∞—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –¥–ª—è —Å–∫—Ä—ã—Ç–Ω–æ—Å—Ç–∏', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KRshrrG8dFl75oR5qhzwIbpryxVJm5O8JyV17jwiybRyM2y5uotp52ANgD0AdevW_ZcWb1LrrMsdUeTHBUJ-tn8UZgA4BsRc7AI5CLstqTPYm9Ndb0eJRZhN1hfeUhRms8DP6LO2kKSPkZHSwEPYOFK2kBWm7-mmKALA7w8iWua8rTh=s1024' },
            detective: { name: '–î–µ—Ç–µ–∫—Ç–∏–≤', price: 5000, emoji: 'üïµÔ∏è', description: '–ü–ª–∞—â –∏ —à–ª—è–ø–∞ —Å—ã—â–∏–∫–∞', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KTue-dtDhus0c5YaMD8XV9cM5RoZE_vv8hpx0XE6td8Rnf2S-XcR8I2O3gX_I-cknpK80NXU6vJ14RUY-j9w6-w4o4OfGXKaALMV-YEKugOVlyi5nNrPTQB-YKgkzS2Rxv2P-Hqui9vuXZmQVxP9Qf2tlEbKI8Va7-B_bsRbJ11XcBBhw=s1024' },
            wizard: { name: '–ö–æ—Å—Ç—é–º –≤–æ–ª—à–µ–±–Ω–∏–∫–∞', price: 5500, emoji: 'üßô', description: '–ú–∞–≥–∏—á–µ—Å–∫–∞—è —à–ª—è–ø–∞ —Å–æ –∑–≤–µ–∑–¥–∞–º–∏', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KQPxv5r4tIYWRApKphxhkgxvnGKQM3xsq4M3aXc0geAPt-2vndpdQsdIj8NRVBWgKdMidAYute_I8JJm0ODHTBNQaJiocoUFom3YDGKQ8OVooO5DRr6FnrnXGQNeKxte5OkiBp0oSLIJJj5gLx4FSnqzIrX2gWgFz-4trg_FY9wwko_=s1024' },
            astronaut: { name: '–ö–æ—Å–º–æ–Ω–∞–≤—Ç', price: 6000, emoji: 'üë®‚ÄçüöÄ', description: '–°–∫–∞—Ñ–∞–Ω–¥—Ä –¥–ª—è –∫–æ—Å–º–∏—á–µ—Å–∫–∏—Ö –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KT324-72aIqf_NQFi9Tnsm9RzZ1AMnpOiazs-OFBLsEscgjEI9veiZtGCKxmQk3colgJi1PMqB_eMay5IMKIz6PNNMi7EQ0TBZpBo7wL8txaVuxYXUhXtKUsrw7tmyT_aO5RFDQJWqxCihIvzMxa64kcSOD6zzyFXFbZLZGCIvnRkggxQ=s1024' },
            dancer: { name: '–¢–∞–Ω—Ü–æ—Ä', price: 9000, emoji: 'üíÉ', description: '–Ø—Ä–∫–∏–π –∫–æ—Å—Ç—é–º –¥–ª—è —Ç–∞–Ω—Ü–µ–≤', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KQ1bWEIPopeYlRuCPeUOosampl8EutcqIbnPK8lFvkeqjxJW3_WJnqNouxj_V8rT8CpbIL1qquBwojfG7jXpGnpK6_gN881tPaFJVTaEeTbumY1RQI25STXm7xOo7aX_GplQe8czmFNvmmoyTIdUo8728z2C0fn09vYSiZnah0Z2zJb=s1024' },
            vampire: { name: '–í–∞–º–ø–∏—Ä', price: 9999, emoji: 'üßõ', description: '–ß–µ—Ä–Ω—ã–π –ø–ª–∞—â —Å –∫—Ä–∞—Å–Ω–æ–π –ø–æ–¥–∫–ª–∞–¥–∫–æ–π', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KSuo6SXblej9rDGQ8LILADG9BLIwAjJ4E2YLtjshoZUuodp0PuVPENbbyrkcpbzkZv3d7hvN1h8FBnqxoo1L-3X3ehM1TNmCv6REelZ5qgFQgwCczuogCjCvrO1RhZEY_QTA44gBkzOuU0DsRgsWALWmatt0SEkQSlW-gX1pCE28q7eTw=s1024' },
            princess: { name: '–ü—Ä–∏–Ω—Ü–µ—Å—Å–∞', price: 10000, emoji: 'üë∏', description: '–†–æ—Å–∫–æ—à–Ω–æ–µ –ø–ª–∞—Ç—å–µ —Å —Ç–∏–∞—Ä–æ–π', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KT4Tt1J4Ad-O_QldsJl73yIYw2kiZytty5vsBTyRFyvDwq97eF62z6tZX4btNnDdy7vC1OiD-yz6hyGf_D4zzkFUZIx8ztfjmAALzJwveorga1bVO2z6awSb7B6bHBcjA3ElV1VqtYwbH8XGP39uVttD2NGXRxmCAKbxNyqhwmGBttx=s1024' },
            angel: { name: '–ê–Ω–≥–µ–ª', price: 14000, emoji: 'üëº', description: '–ë–µ–ª—ã–µ –∫—Ä—ã–ª—å—è –∏ –Ω–∏–º–±', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KSVmpstfVgB8mEks0YIUTCbhnziSNQu2lnWaN_czBj4obZG1n1OcLstyYdCGRYIRqkZ73KQb780aNr-E-Ntn-QC-AD0wGE-q1nl-Qn2r59f4YmPNf6L-GqacgaCRLB-Y9rXuFfJaFIVRsKPYV2UW4zfDfAGzhwp9Vc59TukY2RF7If-_A=s1024' },
            robot: { name: '–†–æ–±–æ—Ç', price: 20000, emoji: 'ü§ñ', description: '–ú–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–π –∫–æ—Å—Ç—é–º –±—É–¥—É—â–µ–≥–æ', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KRydl7aa74Zq_cG1QWNF0soJHjskQIeTDTjzGT-Bktd9uAxlZmiQy-xEn2DmyeC_YdApcJhIhvq6-z4Mx6P-7if4kAjiMIn6kvNao3Yt59wCR6jjeZy4tnFTT2_GpJhhdNlG6GwlS9g1pn0_mrCs42iLOXH3GXHiH0BjFnlrvki7QZ_QA=s1024' }
        };
        
        // –ï–¥–∞ —Å –ø–æ–≤—ã—à–µ–Ω–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏
        this.food = [
            { name: '–ü–µ—á–µ–Ω—å–µ', hunger: 20, price: 20, emoji: 'üç™', happiness: 5 },
            { name: '–§—Ä—É–∫—Ç—ã', hunger: 30, price: 35, emoji: 'üçé', health: 5 },
            { name: '–°—É—à–∏', hunger: 50, price: 65, emoji: 'üç£', happiness: 10 },
            { name: '–¢–æ—Ä—Ç', hunger: 40, happiness: 15, price: 75, emoji: 'üç∞' },
            { name: '–ú–æ—Ä–æ–∂–µ–Ω–æ–µ', hunger: 25, happiness: 20, price: 45, emoji: 'üç¶' },
            { name: '–ü–∏—Ü—Ü–∞', hunger: 60, price: 80, emoji: 'üçï', happiness: 10 },
            { name: '–í–∏—Ç–∞–º–∏–Ω—ã', health: 30, price: 95, emoji: 'üíä' },
            { name: '–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫', energy: 40, price: 55, emoji: '‚ö°' },
            { name: '–ë—É—Ä–≥–µ—Ä', hunger: 45, price: 50, emoji: 'üçî', happiness: 8 },
            { name: '–†—ã–±–∞', hunger: 35, health: 10, price: 45, emoji: 'üêü' },
            { name: '–°–∞–ª–∞—Ç', health: 15, cleanliness: 10, price: 40, emoji: 'ü•ó' },
            { name: '–ú–æ–ª–æ–∫–æ', hunger: 15, health: 8, price: 25, emoji: 'ü•õ' }
        ];
        
        // 20 –º–∏–Ω–∏-–∏–≥—Ä
        this.miniGames = [
            { id: 'memory', name: '–ú–µ–º–æ—Ä–∏', emoji: 'üß†', description: '–ó–∞–ø–æ–º–Ω–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å', reward: { happiness: 25, experience: 20, money: 15 } },
            { id: 'reaction', name: '–†–µ–∞–∫—Ü–∏—è', emoji: '‚ö°', description: '–ù–∞–∂–º–∏ –∫–æ–≥–¥–∞ –ø–æ—è–≤–∏—Ç—Å—è —Å–∏–≥–Ω–∞–ª', reward: { happiness: 20, experience: 15, money: 10 } },
            { id: 'math', name: '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', emoji: 'üî¢', description: '–†–µ—à–∏ –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä', reward: { happiness: 30, experience: 25, money: 20 } },
            { id: 'puzzle', name: '–ü–∞–∑–ª', emoji: 'üß©', description: '–°–æ–±–µ—Ä–∏ —á–∏—Å–ª–∞ –ø–æ –ø–æ—Ä—è–¥–∫—É', reward: { happiness: 35, experience: 30, money: 25 } },
            { id: 'quiz', name: '–í–∏–∫—Ç–æ—Ä–∏–Ω–∞', emoji: 'ü§î', description: '–û—Ç–≤–µ—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å', reward: { happiness: 28, experience: 22, money: 18 } },
            { id: 'rhythm', name: '–†–∏—Ç–º', emoji: 'üéµ', description: '–ü–æ–≤—Ç–æ—Ä–∏ —Ä–∏—Ç–º', reward: { happiness: 40, experience: 25, money: 20 } },
            { id: 'treasure', name: '–ö–ª–∞–¥', emoji: 'üíé', description: '–ù–∞–π–¥–∏ —Å–æ–∫—Ä–æ–≤–∏—â–µ', reward: { happiness: 20, experience: 15, money: 35 } },
            { id: 'balance', name: '–ë–∞–ª–∞–Ω—Å', emoji: '‚öñÔ∏è', description: '–£–¥–µ—Ä–∂–∏ —Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ', reward: { happiness: 25, experience: 20, money: 15 } },
            { id: 'matching', name: '–ù–∞–π–¥–∏ –ø–∞—Ä—É', emoji: 'üÉè', description: '–ù–∞–π–¥–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏', reward: { happiness: 30, experience: 25, money: 22 } },
            { id: 'simon', name: '–°–∞–π–º–æ–Ω –≥–æ–≤–æ—Ä–∏—Ç', emoji: 'üéØ', description: '–ü–æ–≤—Ç–æ—Ä–∏ –∫–æ–º–∞–Ω–¥—ã –°–∞–π–º–æ–Ω–∞', reward: { happiness: 32, experience: 28, money: 25 } },
            { id: 'word', name: '–°–æ—Å—Ç–∞–≤—å —Å–ª–æ–≤–æ', emoji: 'üìù', description: '–°–æ—Å—Ç–∞–≤—å —Å–ª–æ–≤–æ –∏–∑ –±—É–∫–≤', reward: { happiness: 35, experience: 30, money: 28 } },
            { id: 'color', name: '–¶–≤–µ—Ç–Ω–∞—è –∏–≥—Ä–∞', emoji: 'üåà', description: '–£–≥–∞–¥–∞–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ü–≤–µ—Ç', reward: { happiness: 28, experience: 22, money: 18 } },
            { id: 'sequence', name: '–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å', emoji: 'üî§', description: '–ù–∞–π–¥–∏ —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç', reward: { happiness: 33, experience: 27, money: 24 } },
            { id: 'target', name: '–ü–æ–ø–∞–¥–∏ –≤ —Ü–µ–ª—å', emoji: 'üéØ', description: '–ü–æ–ø–∞–¥–∏ –≤ –¥–≤–∏–∂—É—â—É—é—Å—è –º–∏—à–µ–Ω—å', reward: { happiness: 30, experience: 25, money: 20 } },
            { id: 'catch', name: '–ü–æ–π–º–∞–π –ø—Ä–µ–¥–º–µ—Ç', emoji: 'ü™£', description: '–ü–æ–π–º–∞–π –ø–∞–¥–∞—é—â–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã', reward: { happiness: 35, experience: 28, money: 26 } },
            { id: 'maze', name: '–õ–∞–±–∏—Ä–∏–Ω—Ç', emoji: 'üåÄ', description: '–ù–∞–π–¥–∏ –≤—ã—Ö–æ–¥ –∏–∑ –ª–∞–±–∏—Ä–∏–Ω—Ç–∞', reward: { happiness: 40, experience: 35, money: 30 } },
            { id: 'code', name: '–í–∑–ª–æ–º–∞–π –∫–æ–¥', emoji: 'üîê', description: '–£–≥–∞–¥–∞–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥', reward: { happiness: 38, experience: 32, money: 28 } },
            { id: 'stack', name: '–°–æ–±–µ—Ä–∏ –±–∞—à–Ω—é', emoji: 'üèóÔ∏è', description: '–ü–æ—Å—Ç—Ä–æ–π –≤—ã—Å–æ–∫—É—é –±–∞—à–Ω—é', reward: { happiness: 36, experience: 30, money: 25 } },
            { id: 'speed', name: '–°–∫–æ—Ä–æ—Å—Ç—å', emoji: 'üí®', description: '–ù–∞–∂–º–∏ –∫–∞–∫ –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–µ–µ', reward: { happiness: 25, experience: 20, money: 15 } },
            { id: 'pattern', name: '–£–∑–æ—Ä', emoji: 'üé®', description: '–ü–æ–≤—Ç–æ—Ä–∏ —É–∑–æ—Ä', reward: { happiness: 34, experience: 28, money: 23 } }
        ];
    }
    
    loadData(key, defaultValue) {
        const saved = localStorage.getItem(key);
        return saved ? JSON.parse(saved) : defaultValue;
    }
    
    saveData() {
        localStorage.setItem('shared_labubu_stats', JSON.stringify(this.stats));
        localStorage.setItem('shared_labubu_money', this.money.toString());
        localStorage.setItem('shared_labubu_outfit', this.outfit);
        localStorage.setItem('shared_labubu_level', this.level.toString());
        localStorage.setItem('shared_labubu_experience', this.experience.toString());
        localStorage.setItem('shared_labubu_age', this.age.toString());
        localStorage.setItem('shared_labubu_evolution', this.evolutionStage);
        localStorage.setItem('shared_labubu_last_update', Date.now().toString());
        localStorage.setItem('shared_pet_name', this.petName);
        localStorage.setItem('shared_labubu_sleeping', this.isSleeping.toString());
        localStorage.setItem('shared_labubu_pets', JSON.stringify(this.pets));
        localStorage.setItem('shared_active_pet_id', this.activePetId);
        localStorage.setItem('sound_enabled', this.soundEnabled.toString());
        localStorage.setItem('telegram_connected', this.telegramConnected.toString());
        localStorage.setItem('game_user_id', this.gameUserId);
        localStorage.setItem('shared_current_skin', this.currentSkin);
        localStorage.setItem('shared_unlocked_skins', JSON.stringify(this.unlockedSkins));
        localStorage.setItem('shared_chest_count', this.chestCount.toString());
        localStorage.setItem('shared_friends_invited', this.friendsInvited.toString());
        localStorage.setItem('shared_last_chest_level', this.lastChestLevel.toString());
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ Telegram
        this.updateTelegramStats();
    }
    
    init() {
        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫
        this.updateTimeAndWeather();
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        this.initEventListeners();
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
        this.switchTab('care');
    }
    
    initEventListeners() {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
        document.addEventListener('click', (e) => {
            // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–º–µ–Ω–∏
            if (e.target.id === 'editNameBtn') {
                this.showNameEdit();
            } else if (e.target.id === 'saveNameBtn') {
                this.saveNameEdit();
            } else if (e.target.id === 'cancelNameBtn') {
                this.cancelNameEdit();
            }
            // –ó–≤—É–∫
            else if (e.target.id === 'soundToggle') {
                this.toggleSound();
            }
            // –í–∫–ª–∞–¥–∫–∏
            else if (e.target.classList.contains('tab-btn')) {
                this.switchTab(e.target.dataset.tab);
            }
            // –ú–∏–Ω–∏-–∏–≥—Ä—ã
            else if (e.target.id === 'cancelGameBtn') {
                this.closeMiniGame();
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter –¥–ª—è –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏
        document.addEventListener('keypress', (e) => {
            if (e.target.id === 'nameInput' && e.key === 'Enter') {
                this.saveNameEdit();
            }
        });
    }
    
    updateTimeAndWeather() {
        const hour = new Date().getHours();
        const timeElement = document.getElementById('timeOfDay');
        const weatherElement = document.getElementById('weather');
        
        if (hour >= 6 && hour < 12) timeElement.textContent = 'üåÖ';
        else if (hour >= 12 && hour < 18) timeElement.textContent = '‚òÄÔ∏è';
        else if (hour >= 18 && hour < 22) timeElement.textContent = 'üåÜ';
        else timeElement.textContent = 'üåô';
        
        const weathers = ['‚òÄÔ∏è', '‚òÅÔ∏è', 'üåßÔ∏è', '‚ùÑÔ∏è'];
        weatherElement.textContent = weathers[Math.floor(Math.random() * weathers.length)];
    }
    
    updateDisplay() {
        // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
        const petNameDisplay = document.getElementById('petNameDisplay');
        const levelDisplay = document.getElementById('levelDisplay');
        const moneyDisplay = document.getElementById('moneyDisplay');
        const expDisplay = document.getElementById('expDisplay');
        const ageDisplay = document.getElementById('ageDisplay');
        const ageText = document.getElementById('ageText');
        const soundToggle = document.getElementById('soundToggle');
        
        if (petNameDisplay) petNameDisplay.textContent = this.petName;
        if (levelDisplay) levelDisplay.textContent = `Lv.${this.level}`;
        if (moneyDisplay) moneyDisplay.textContent = `üí∞${this.money}`;
        if (expDisplay) expDisplay.textContent = `‚≠ê${this.experience}/100`;
        if (ageDisplay) ageDisplay.textContent = `üéÇ${this.age}–¥`;
        if (ageText) ageText.textContent = this.age;
        
        // –ó–≤—É–∫
        if (soundToggle) soundToggle.textContent = this.soundEnabled ? 'üîä' : 'üîá';
        
        // Telegram —Å—Ç–∞—Ç—É—Å
        const telegramBtn = document.getElementById('telegramBtn');
        const telegramStatus = document.getElementById('telegramStatus');
        
        if (this.telegramConnected) {
            if (telegramBtn) telegramBtn.classList.add('hidden');
            if (telegramStatus) telegramStatus.classList.remove('hidden');
        } else {
            if (telegramBtn) telegramBtn.classList.remove('hidden');
            if (telegramStatus) telegramStatus.classList.add('hidden');
        }
        
        // –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ
        const mood = this.getMood();
        const moodEmoji = document.getElementById('moodEmoji');
        const moodStatus = document.getElementById('moodStatus');
        const evolutionStage = document.getElementById('evolutionStage');
        const petImage = document.getElementById('petImage');
        
        if (moodEmoji) moodEmoji.textContent = mood.emoji;
        if (moodStatus) moodStatus.textContent = mood.status;
        if (evolutionStage) evolutionStage.textContent = this.evolutionStages[this.evolutionStage].name;
        
        // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–∏—Ç–æ–º—Ü–∞
        if (petImage) petImage.src = this.skins[this.currentSkin].image;
        
        // –°–æ–Ω –∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
        const sleepIndicator = document.getElementById('sleepIndicator');
        const criticalIndicator = document.getElementById('criticalIndicator');
        const moodIndicator = document.getElementById('moodIndicator');
        
        if (sleepIndicator) sleepIndicator.classList.toggle('hidden', !this.isSleeping);
        
        const avgStats = Object.values(this.stats).reduce((a, b) => a + b, 0) / 6;
        if (criticalIndicator) criticalIndicator.classList.toggle('hidden', avgStats > 10);
        
        if (moodIndicator) {
            if (mood.emoji === 'ü•∞') moodIndicator.textContent = '‚ù§Ô∏è';
            else moodIndicator.textContent = '';
        }
        
        // –û–¥–µ–∂–¥–∞
        this.updateOutfit();
        
        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        this.updateStatsDisplay();
    }
    
    updateOutfit() {
        const outfitContainer = document.getElementById('outfitContainer');
        const currentOutfitEl = document.getElementById('currentOutfit');
        
        if (!outfitContainer || !currentOutfitEl) return;
        
        outfitContainer.innerHTML = '';
        
        if (this.outfit !== 'default') {
            const outfitData = this.outfits[this.outfit];
            currentOutfitEl.textContent = `${outfitData.emoji} ${outfitData.name}`;
            currentOutfitEl.classList.remove('hidden');
            
            if (outfitData.image) {
                const outfitImg = document.createElement('img');
                outfitImg.src = outfitData.image;
                outfitImg.className = 'absolute object-contain';
                
                if (this.outfit === 'cute') {
                    outfitImg.className += ' top-2 left-1/2 transform -translate-x-1/2 w-28 h-28';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'cool') {
                    outfitImg.className += ' top-8 left-1/2 transform -translate-x-1/2 w-16 h-8';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'formal') {
                    outfitImg.className += ' top-8 left-1/2 transform -translate-x-1/2 w-28 h-32';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'winter') {
                    outfitImg.className += ' top-6 left-1/2 transform -translate-x-1/2 w-30 h-34';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'summer') {
                    outfitImg.className += ' top-2 left-1/2 transform -translate-x-1/2 w-28 h-28';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'ninja') {
                    outfitImg.className += ' top-4 left-1/2 transform -translate-x-1/2 w-32 h-36';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'pirate') {
                    outfitImg.className += ' top-6 left-1/2 transform -translate-x-1/2 w-30 h-34';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'wizard') {
                    outfitImg.className += ' top-0 left-1/2 transform -translate-x-1/2 w-32 h-40';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'school') {
                    outfitImg.className += ' top-8 left-1/2 transform -translate-x-1/2 w-28 h-32';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'chef') {
                    outfitImg.className += ' top-2 left-1/2 transform -translate-x-1/2 w-30 h-34';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'superhero') {
                    outfitImg.className += ' top-4 left-1/2 transform -translate-x-1/2 w-32 h-36';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'princess') {
                    outfitImg.className += ' top-6 left-1/2 transform -translate-x-1/2 w-32 h-36';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'astronaut') {
                    outfitImg.className += ' top-2 left-1/2 transform -translate-x-1/2 w-32 h-38';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'detective') {
                    outfitImg.className += ' top-4 left-1/2 transform -translate-x-1/2 w-30 h-34';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'doctor') {
                    outfitImg.className += ' top-6 left-1/2 transform -translate-x-1/2 w-28 h-32';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'dancer') {
                    outfitImg.className += ' top-8 left-1/2 transform -translate-x-1/2 w-30 h-32';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'knight') {
                    outfitImg.className += ' top-4 left-1/2 transform -translate-x-1/2 w-32 h-36';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'vampire') {
                    outfitImg.className += ' top-2 left-1/2 transform -translate-x-1/2 w-34 h-38';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'angel') {
                    outfitImg.className += ' top-0 left-1/2 transform -translate-x-1/2 w-36 h-40';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'robot') {
                    outfitImg.className += ' top-2 left-1/2 transform -translate-x-1/2 w-34 h-38';
                    outfitImg.style.zIndex = '10';
                }
                
                outfitContainer.appendChild(outfitImg);
            }
        } else {
            currentOutfitEl.classList.add('hidden');
        }
    }
    
    updateStatsDisplay() {
        const container = document.getElementById('statsContainer');
        if (!container) return;
        
        const stats = [
            { label: 'üçΩÔ∏è –ì–æ–ª–æ–¥', value: this.stats.hunger, color: 'bg-orange-500' },
            { label: 'üòä –°—á–∞—Å—Ç—å–µ', value: this.stats.happiness, color: 'bg-yellow-500' },
            { label: 'üõÅ –ß–∏—Å—Ç–æ—Ç–∞', value: this.stats.cleanliness, color: 'bg-blue-500' },
            { label: '‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ', value: this.stats.health, color: 'bg-red-500' },
            { label: '‚ö° –≠–Ω–µ—Ä–≥–∏—è', value: this.stats.energy, color: 'bg-green-500' },
            { label: 'üò¥ –°–æ–Ω', value: this.stats.sleep, color: 'bg-purple-500' }
        ];
        
        container.innerHTML = stats.map(stat => `
            <div class="mb-2">
                <div class="flex justify-between mb-1">
                    <span class="text-xs font-medium">${stat.label}</span>
                    <span class="text-xs">${stat.value}%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-1.5">
                    <div class="h-1.5 rounded-full transition-all duration-300 ${stat.color}" style="width: ${stat.value}%"></div>
                </div>
            </div>
        `).join('');
    }
    
    getMood() {
        if (this.isSleeping) return { emoji: 'üò¥', status: '–°–ø–∏—Ç' };
        
        const avg = Object.values(this.stats).reduce((a, b) => a + b, 0) / 6;
        if (avg > 90) return { emoji: 'ü•∞', status: '–í–æ—Å—Ö–∏—Ç–∏—Ç–µ–ª—å–Ω–æ' };
        if (avg > 80) return { emoji: 'üòä', status: '–û—á–µ–Ω—å —Å—á–∞—Å—Ç–ª–∏–≤' };
        if (avg > 60) return { emoji: 'üôÇ', status: '–°—á–∞—Å—Ç–ª–∏–≤' };
        if (avg > 40) return { emoji: 'üòê', status: '–ù–æ—Ä–º–∞–ª—å–Ω–æ' };
        if (avg > 20) return { emoji: 'üòü', status: '–ì—Ä—É—Å—Ç–Ω–æ' };
        if (avg > 10) return { emoji: 'üò¢', status: '–û—á–µ–Ω—å –≥—Ä—É—Å—Ç–Ω–æ' };
        return { emoji: 'üíÄ', status: '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ' };
    }
    
    showMessage(msg) {
        const messageEl = document.getElementById('gameMessage');
        messageEl.textContent = msg;
        messageEl.classList.remove('hidden');
        setTimeout(() => messageEl.classList.add('hidden'), 3000);
    }
    
    showNotification(message, type) {
        const notification = {
            id: Date.now(),
            message,
            type,
            timestamp: Date.now()
        };
        
        this.notifications.push(notification);
        
        const notificationEl = document.createElement('div');
        notificationEl.className = `p-3 rounded-lg shadow-lg text-white text-sm max-w-xs notification-enter ${this.getNotificationColor(type)}`;
        notificationEl.textContent = message;
        
        document.getElementById('notifications').appendChild(notificationEl);
        
        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram
        this.sendTelegramNotification(message, type);
        
        setTimeout(() => {
            notificationEl.classList.add('notification-exit');
            setTimeout(() => {
                if (notificationEl.parentNode) {
                    notificationEl.parentNode.removeChild(notificationEl);
                }
            }, 300);
            this.notifications = this.notifications.filter(n => n.id !== notification.id);
        }, 5000);
    }
    
    getNotificationColor(type) {
        const colors = {
            reminder: 'bg-blue-500',
            sad: 'bg-red-500',
            sleepy: 'bg-purple-500',
            hungry: 'bg-orange-500',
            dirty: 'bg-blue-600',
            sick: 'bg-red-600',
            tired: 'bg-yellow-500'
        };
        return colors[type] || 'bg-gray-500';
    }
    
    showNameEdit() {
        document.getElementById('nameEditSection').classList.remove('hidden');
        document.getElementById('editNameBtn').classList.add('hidden');
        document.getElementById('nameInput').value = this.petName;
        document.getElementById('nameInput').focus();
    }
    
    saveNameEdit() {
        const newName = document.getElementById('nameInput').value.trim();
        if (newName && newName.length <= 15) {
            this.petName = newName;
            this.showMessage(`–¢–µ–ø–µ—Ä—å –∑–æ–≤—É—Ç ${this.petName}!`);
            this.saveData();
            this.updateDisplay();
        }
        this.cancelNameEdit();
    }
    
    cancelNameEdit() {
        document.getElementById('nameEditSection').classList.add('hidden');
        document.getElementById('editNameBtn').classList.remove('hidden');
    }
    
    toggleSound() {
        this.soundEnabled = !this.soundEnabled;
        this.updateDisplay();
        this.saveData();
    }
    
    playSound(frequency, duration = 200, type = 'sine') {
        if (!this.soundEnabled) return;
        
        try {
            if (!this.audioContext) {
                this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            
            const oscillator = this.audioContext.createOscillator();
            const gainNode = this.audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(this.audioContext.destination);
            
            oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
            oscillator.type = type;
            
            gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration / 1000);
            
            oscillator.start();
            oscillator.stop(this.audioContext.currentTime + duration / 1000);
        } catch (error) {
            console.log('Sound not available');
        }
    }
    
    playHappySound() {
        this.playSound(523, 100);
        setTimeout(() => this.playSound(659, 100), 100);
        setTimeout(() => this.playSound(784, 150), 200);
    }
    
    switchTab(tab) {
        this.activeTab = tab;
        
        // –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏
        document.querySelectorAll('.tab-btn').forEach(btn => {
            if (btn.dataset.tab === tab) {
                btn.className = 'tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors bg-purple-500 text-white';
            } else {
                btn.className = 'tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors text-purple-500 hover:bg-purple-50';
            }
        });
        
        // –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç
        const content = document.getElementById('tabContent');
        content.innerHTML = this.getTabContent(tab);
    }
    
    getTabContent(tab) {
        switch (tab) {
            case 'care':
                return this.getCareTabContent();
            case 'games':
                return this.getGamesTabContent();
            case 'shop':
                return this.getShopTabContent();
            case 'chests':
                return this.getChestsTabContent();
            case 'pets':
                return this.getPetsTabContent();
            case 'info':
                return this.getInfoTabContent();
            default:
                return '';
        }
    }
    
    getCareTabContent() {
        const foodGrid = this.food.map((item, index) => `
            <button onclick="game.feedPet(${index})" class="bg-orange-100 hover:bg-orange-200 p-2 rounded text-xs transition-colors" ${this.isSleeping ? 'disabled' : ''}>
                <div class="text-sm">${item.emoji}</div>
                <div class="font-medium text-xs">${item.name}</div>
                <div class="text-xs text-gray-600">${item.price}üí∞</div>
            </button>
        `).join('');
        
        return `
            <div class="space-y-3">
                <div class="bg-white rounded-lg p-3 shadow">
                    <h3 class="font-bold mb-2 text-purple-800 text-sm">üçΩÔ∏è –ö–æ—Ä–º–ª–µ–Ω–∏–µ</h3>
                    <div class="grid grid-cols-4 gap-1">${foodGrid}</div>
                </div>
                <div class="bg-white rounded-lg p-3 shadow">
                    <h3 class="font-bold mb-2 text-purple-800 text-sm">‚ö° –î–µ–π—Å—Ç–≤–∏—è</h3>
                    <div class="grid grid-cols-3 gap-1">
                        <button onclick="game.washPet()" class="bg-blue-100 hover:bg-blue-200 p-2 rounded text-xs transition-colors" ${this.isSleeping ? 'disabled' : ''}>
                            <div class="text-sm">üõÅ</div>
                            <div class="font-medium">–ú—ã—Ç—å</div>
                        </button>
                        <button onclick="game.healPet()" class="bg-red-100 hover:bg-red-200 p-2 rounded text-xs transition-colors">
                            <div class="text-sm">üíä</div>
                            <div class="font-medium">–õ–µ—á–∏—Ç—å</div>
                            <div class="text-xs">30üí∞</div>
                        </button>
                        <button onclick="game.toggleSleep()" class="bg-purple-100 hover:bg-purple-200 p-2 rounded text-xs transition-colors">
                            <div class="text-sm">${this.isSleeping ? '‚òÄÔ∏è' : 'üò¥'}</div>
                            <div class="font-medium">${this.isSleeping ? '–ë—É–¥–∏—Ç—å' : '–°–ø–∞—Ç—å'}</div>
                        </button>
                    </div>
                </div>
            </div>
        `;
    }
    
    getGamesTabContent() {
        const gamesGrid = this.miniGames.map((game, index) => `
            <button onclick="game.startMiniGame(${index})" class="p-2 rounded-lg text-xs transition-colors bg-yellow-100 hover:bg-yellow-200 flex flex-col items-center" ${this.isSleeping || this.stats.energy < 15 ? 'disabled' : ''}>
                <span class="text-lg mb-1">${game.emoji}</span>
                <div class="font-medium text-center">${game.name}</div>
                <div class="text-xs text-gray-600 text-center">${game.description}</div>
                <div class="text-xs text-red-600 mt-1">-15 —ç–Ω–µ—Ä–≥–∏–∏</div>
            </button>
        `).join('');
        
        return `
            <div class="bg-white rounded-lg p-3 shadow">
                <h3 class="font-bold mb-2 text-purple-800 text-sm">üéÆ –ú–∏–Ω–∏-–∏–≥—Ä—ã</h3>
                <div class="grid grid-cols-2 gap-2">${gamesGrid}</div>
            </div>
        `;
    }
    
    getShopTabContent() {
        const outfitsList = Object.entries(this.outfits).map(([key, item]) => `
            <button onclick="game.buyOutfit('${key}')" class="w-full p-2 rounded-lg text-xs transition-colors flex items-center justify-between ${
                this.outfit === key ? 'bg-green-100 border-2 border-green-500' : 'bg-gray-100 hover:bg-gray-200'
            }">
                <div class="flex items-center space-x-2">
                    <span class="text-lg">${item.emoji}</span>
                    <div class="text-left">
                        <div class="font-medium">${item.name}</div>
                        <div class="text-xs text-gray-500">${item.description}</div>
                        <div class="text-xs text-gray-600 font-bold">
                            ${item.price === 0 ? '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ' : `${item.price}üí∞`}
                        </div>
                    </div>
                </div>
                ${this.outfit === key ? '<span class="text-green-600 font-bold">‚úì</span>' : ''}
            </button>
        `).join('');
        
        return `
            <div class="bg-white rounded-lg p-3 shadow">
                <h3 class="font-bold mb-2 text-purple-800 text-sm">üëó –ú–∞–≥–∞–∑–∏–Ω –æ–¥–µ–∂–¥—ã</h3>
                <div class="grid grid-cols-1 gap-1 max-h-64 overflow-y-auto">${outfitsList}</div>
            </div>
        `;
    }
    
    getPetsTabContent() {
        return `
            <div class="bg-white rounded-lg p-3 shadow">
                <h3 class="font-bold mb-2 text-purple-800 text-sm">üê∞ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∏—Ç–æ–º—Ü–∞–º–∏</h3>
                <button onclick="game.createNewPet()" class="w-full mb-3 p-3 bg-green-100 hover:bg-green-200 rounded-lg text-sm transition-colors">
                    ‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞
                </button>
                <div class="bg-blue-50 p-3 rounded-lg">
                    <h4 class="font-bold text-sm text-blue-800 mb-2">üë• –°–æ–≤–º–µ—Å—Ç–Ω–æ–µ –≤–æ—Å–ø–∏—Ç–∞–Ω–∏–µ</h4>
                    <p class="text-xs text-blue-700">–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏!</p>
                </div>
            </div>
        `;
    }
    
    getInfoTabContent() {
        return `
            <div class="bg-white rounded-lg p-3 shadow">
                <h3 class="font-bold mb-3 text-purple-800 text-sm">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                <div class="space-y-3 text-xs">
                    <div class="bg-blue-50 p-2 rounded">
                        <h4 class="font-bold text-blue-800 mb-1">üöÄ –ë—É–¥—É—â–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</h4>
                        <p class="text-blue-700">–ë–æ—Ç –±—É–¥–µ—Ç —Ä–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è! –û–∂–∏–¥–∞–π—Ç–µ:</p>
                        <ul class="list-disc list-inside text-blue-700 mt-1">
                            <li>–ù–æ–≤—ã–µ –º–∏–Ω–∏-–∏–≥—Ä—ã –∏ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</li>
                            <li>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∫–∏–Ω—ã –∏ –æ–¥–µ–∂–¥–∞</li>
                            <li>–û—Å–æ–±—ã–µ —Å–æ–±—ã—Ç–∏—è –∏ –ø—Ä–∞–∑–¥–Ω–∏–∫–∏</li>
                            <li>–£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —ç–≤–æ–ª—é—Ü–∏–∏</li>
                            <li>–ú–Ω–æ–≥–æ –¥—Ä—É–≥–∏—Ö –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π!</li>
                        </ul>
                    </div>
                    <div class="bg-green-50 p-2 rounded">
                        <h4 class="font-bold text-green-800 mb-1">üéÆ –ö–∞–∫ –∏–≥—Ä–∞—Ç—å</h4>
                        <ul class="list-disc list-inside text-green-700">
                            <li>–ö–æ—Ä–º–∏—Ç–µ ${this.petName} –∫–æ–≥–¥–∞ –≥–æ–ª–æ–¥–µ–Ω</li>
                            <li>–ò–≥—Ä–∞–π—Ç–µ –≤ –º–∏–Ω–∏-–∏–≥—Ä—ã –¥–ª—è –æ–ø—ã—Ç–∞</li>
                            <li>–ü–æ–∫—É–ø–∞–π—Ç–µ –æ–¥–µ–∂–¥—É –∑–∞ –º–æ–Ω–µ—Ç—ã</li>
                            <li>–°–ª–µ–¥–∏—Ç–µ –∑–∞ –≤—Å–µ–º–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞–º–∏</li>
                            <li>–í–∞—à –ø–∏—Ç–æ–º–µ—Ü —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç —Å –≤–æ–∑—Ä–∞—Å—Ç–æ–º!</li>
                        </ul>
                    </div>
                    <div class="bg-purple-50 p-2 rounded">
                        <h4 class="font-bold text-purple-800 mb-1">‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</h4>
                        <ul class="list-disc list-inside text-purple-700">
                            <li>20 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –º–∏–Ω–∏-–∏–≥—Ä</li>
                            <li>22 –≤–∏–¥–∞ –æ–¥–µ–∂–¥—ã</li>
                            <li>5 —Å—Ç–∞–¥–∏–π —ç–≤–æ–ª—é—Ü–∏–∏</li>
                            <li>–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ —Å—Ç–∞—Ä–µ–Ω–∏–µ (1 –¥–µ–Ω—å = 1 –¥–µ–Ω—å)</li>
                            <li>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</li>
                            <li>–ó–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã</li>
                        </ul>
                    </div>
                    <div class="bg-orange-50 p-2 rounded">
                        <h4 class="font-bold text-orange-800 mb-1">‚è∞ –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</h4>
                        <ul class="list-disc list-inside text-orange-700">
                            <li>–ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç: "–¢—ã –Ω–µ –∑–∞–±—ã–ª –º–µ–Ω—è?"</li>
                            <li>–ü—Ä–∏ –≥–æ–ª–æ–¥–µ < 50%: "–Ø –≥–æ–ª–æ–¥–µ–Ω!"</li>
                            <li>–ü—Ä–∏ —Å—á–∞—Å—Ç—å–µ < 50%: "–ú–Ω–µ —Å–∫—É—á–Ω–æ!"</li>
                            <li>–ü—Ä–∏ —Å–Ω–µ < 50%: "–Ø —Ö–æ—á—É —Å–ø–∞—Ç—å!"</li>
                            <li>–ü—Ä–∏ –∑–¥–æ—Ä–æ–≤—å–µ < 50%: "–ú–Ω–µ –ø–ª–æ—Ö–æ!"</li>
                            <li>–ü—Ä–∏ —á–∏—Å—Ç–æ—Ç–µ < 50%: "–Ø –≥—Ä—è–∑–Ω—ã–π!"</li>
                        </ul>
                    </div>
                    <div class="text-center text-gray-500">
                        <p>üê∞ –°–æ–∑–¥–∞–Ω–æ —Å –ª—é–±–æ–≤—å—é –¥–ª—è ${this.petName}! üíï</p>
                        <p class="text-xs mt-1">–í–µ—Ä—Å–∏—è 4.0 - HTML Edition</p>
                    </div>
                </div>
            </div>
        `;
    }
    
    // –ò–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
    feedPet(foodIndex) {
        if (this.isSleeping) {
            this.showMessage(`${this.petName} —Å–ø–∏—Ç! üò¥`);
            return;
        }
        
        const food = this.food[foodIndex];
        if (this.money >= food.price) {
            this.money -= food.price;
            this.stats.hunger = Math.min(100, this.stats.hunger + (food.hunger || 0));
            this.stats.happiness = Math.min(100, this.stats.happiness + (food.happiness || 0));
            this.stats.health = Math.min(100, this.stats.health + (food.health || 0));
            this.stats.energy = Math.min(100, this.stats.energy + (food.energy || 0));
            this.stats.cleanliness = Math.min(100, this.stats.cleanliness + (food.cleanliness || 0));
            this.experience += 10;
            
            this.playSound(800, 150);
            this.showMessage(`${this.petName} —Å—ä–µ–ª ${food.name}! ${food.emoji}`);
            this.checkLevelUp();
            this.saveData();
            this.updateDisplay();
        } else {
            this.showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
        }
    }
    
    washPet() {
        if (this.isSleeping) {
            this.showMessage(`–ù–µ –±—É–¥–∏ —Å–ø—è—â–µ–≥–æ ${this.petName}! üò¥`);
            return;
        }
        
        this.stats.cleanliness = 100;
        this.stats.happiness = Math.min(100, this.stats.happiness + 10);
        this.experience += 8;
        
        this.playSound(400, 200);
        this.showMessage(`${this.petName} —á–∏—Å—Ç—ã–π –∏ —Å—á–∞—Å—Ç–ª–∏–≤—ã–π! üõÅ`);
        this.checkLevelUp();
        this.saveData();
        this.updateDisplay();
    }
    
    healPet() {
        if (this.money >= 30) {
            this.money -= 30;
            this.stats.health = 100;
            this.stats.happiness = Math.min(100, this.stats.happiness + 5);
            this.experience += 12;
            
            this.showMessage(`${this.petName} –∑–¥–æ—Ä–æ–≤! üíä`);
            this.checkLevelUp();
            this.saveData();
            this.updateDisplay();
        } else {
            this.showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç –¥–ª—è –ª–µ—á–µ–Ω–∏—è!');
        }
    }
    
    toggleSleep() {
        this.isSleeping = !this.isSleeping;
        
        if (this.isSleeping) {
            this.playSound(300, 500);
            this.showMessage(`${this.petName} –ª–æ–∂–∏—Ç—Å—è —Å–ø–∞—Ç—å... üò¥`);
        } else {
            this.playHappySound();
            this.showMessage(`${this.petName} –ø—Ä–æ—Å–Ω—É–ª—Å—è! üòä`);
        }
        
        this.saveData();
        this.updateDisplay();
        this.switchTab('care');
    }
    
    buyOutfit(outfitKey) {
        const outfit = this.outfits[outfitKey];
        
        if (this.outfit === outfitKey) {
            this.showMessage('–≠—Ç–∞ –æ–¥–µ–∂–¥–∞ —É–∂–µ –Ω–∞–¥–µ—Ç–∞!');
            return;
        }
        
        if (this.money >= outfit.price) {
            this.money -= outfit.price;
            this.outfit = outfitKey;
            this.stats.happiness = Math.min(100, this.stats.happiness + 20);
            
            this.playHappySound();
            this.showMessage(`–ù–æ–≤–∞—è –æ–¥–µ–∂–¥–∞: ${outfit.name}! ${outfit.emoji}`);
            this.saveData();
            this.updateDisplay();
            this.switchTab('shop');
        } else {
            this.showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
        }
    }
    
    createNewPet() {
        const newPetId = `pet${this.pets.length + 1}`;
        const newPet = {
            id: newPetId,
            name: `${this.petName} ${this.pets.length + 1}`,
            stats: { hunger: 100, happiness: 100, cleanliness: 100, health: 100, energy: 100, sleep: 100 },
            outfit: 'default',
            age: 0,
            evolutionStage: 'baby'
        };
        
        this.pets.push(newPet);
        this.activePetId = newPetId;
        this.showMessage(`–ù–æ–≤—ã–π –ø–∏—Ç–æ–º–µ—Ü ${newPet.name} —Å–æ–∑–¥–∞–Ω! üéâ`);
        this.saveData();
    }
    
    startMiniGame(gameIndex) {
        if (this.isSleeping) {
            this.showMessage(`${this.petName} —Å–ø–∏—Ç! –†–∞–∑–±—É–¥–∏ –µ–≥–æ —Å–Ω–∞—á–∞–ª–∞! üò¥`);
            return;
        }
        if (this.stats.energy < 15) {
            this.showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏! –ù—É–∂–Ω–æ –æ—Ç–¥–æ—Ö–Ω—É—Ç—å.');
            return;
        }
        
        this.currentMiniGame = this.miniGames[gameIndex];
        this.showMiniGameModal();
    }
    
    showMiniGameModal() {
        document.getElementById('gameTitle').textContent = `${this.currentMiniGame.name} ${this.currentMiniGame.emoji}`;
        document.getElementById('gameContent').innerHTML = this.getMiniGameContent();
        document.getElementById('miniGameModal').classList.remove('hidden');
    }
    
    closeMiniGame() {
        document.getElementById('miniGameModal').classList.add('hidden');
        this.currentMiniGame = null;
    }
    
    getMiniGameContent() {
        const gameId = this.currentMiniGame.id;
        
        if (gameId === 'memory') {
            return this.getMemoryGameContent();
        } else if (gameId === 'reaction') {
            return this.getReactionGameContent();
        } else if (gameId === 'math') {
            return this.getMathGameContent();
        } else if (gameId === 'puzzle') {
            return this.getPuzzleGameContent();
        } else if (gameId === 'quiz') {
            return this.getQuizGameContent();
        } else if (gameId === 'rhythm') {
            return this.getRhythmGameContent();
        } else if (gameId === 'treasure') {
            return this.getTreasureGameContent();
        } else if (gameId === 'balance') {
            return this.getBalanceGameContent();
        } else if (gameId === 'matching') {
            return this.getMatchingGameContent();
        } else if (gameId === 'simon') {
            return this.getSimonGameContent();
        } else if (gameId === 'catch') {
            return this.getCatchGameContent();
        } else if (gameId === 'target') {
            return this.getTargetGameContent();
        } else if (gameId === 'code') {
            return this.getCodeGameContent();
        } else if (gameId === 'stack') {
            return this.getStackGameContent();
        } else if (gameId === 'speed') {
            return this.getSpeedGameContent();
        } else if (gameId === 'maze') {
            return this.getMazeGameContent();
        } else if (gameId === 'pattern') {
            return this.getPatternGameContent();
        } else if (gameId === 'word') {
            return this.getWordGameContent();
        } else if (gameId === 'color') {
            return this.getColorGameContent();
        } else if (gameId === 'sequence') {
            return this.getSequenceGameContent();
        } else {
            // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∏–≥—Ä
            return `
                <div class="text-center">
                    <p class="mb-4">${this.currentMiniGame.description}</p>
                    <p class="text-sm text-gray-600 mb-4">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É —á—Ç–æ–±—ã –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å!</p>
                    <button onclick="game.completeMiniGame(${Math.random() > 0.3})" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-bold transition-colors">
                        –ò–≥—Ä–∞—Ç—å!
                    </button>
                </div>
            `;
        }
    }
    
    getMemoryGameContent() {
        if (!this.gameState) this.gameState = 'waiting';
        
        return `
            <div class="text-center">
                <p class="mb-4">–ó–∞–ø–æ–º–Ω–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ü–≤–µ—Ç–æ–≤!</p>
                <div class="grid grid-cols-2 gap-2 mb-4">
                    <button onclick="game.handleMemoryClick(0)" class="h-16 bg-red-400 hover:bg-red-500 rounded transition-colors" id="memory-0">üî¥</button>
                    <button onclick="game.handleMemoryClick(1)" class="h-16 bg-blue-400 hover:bg-blue-500 rounded transition-colors" id="memory-1">üîµ</button>
                    <button onclick="game.handleMemoryClick(2)" class="h-16 bg-green-400 hover:bg-green-500 rounded transition-colors" id="memory-2">üü¢</button>
                    <button onclick="game.handleMemoryClick(3)" class="h-16 bg-yellow-400 hover:bg-yellow-500 rounded transition-colors" id="memory-3">üü°</button>
                </div>
                <button onclick="game.startMemorySequence()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded">
                    –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
                </button>
            </div>
        `;
    }
    
    getReactionGameContent() {
        return `
            <div class="text-center">
                <p class="mb-4">–ù–∞–∂–º–∏ –Ω–∞ –∑–µ–ª–µ–Ω—ã–π —Å–∏–≥–Ω–∞–ª –∫–∞–∫ –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–µ–µ!</p>
                <div id="reaction-light" class="w-20 h-20 bg-red-400 rounded-full mx-auto mb-4 transition-colors"></div>
                <button onclick="game.startReactionTest()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg">
                    –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç
                </button>
                <button onclick="game.reactionClick()" id="reaction-btn" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg hidden">
                    –ù–ê–ñ–ú–ò!
                </button>
            </div>
        `;
    }
    
    getMathGameContent() {
        const a = Math.floor(Math.random() * 10) + 1;
        const b = Math.floor(Math.random() * 10) + 1;
        const answer = a + b;
        this.mathAnswer = answer;
        
        const options = [answer - 1, answer, answer + 1].sort(() => Math.random() - 0.5);
        
        return `
            <div class="text-center">
                <p class="text-2xl mb-6">${a} + ${b} = ?</p>
                <div class="grid grid-cols-3 gap-2">
                    ${options.map(num => `
                        <button onclick="game.checkMathAnswer(${num})" class="bg-blue-500 hover:bg-blue-600 text-white p-3 rounded text-xl transition-colors">
                            ${num}
                        </button>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    getPuzzleGameContent() {
        this.puzzlePieces = [1, 2, 3, 4].sort(() => Math.random() - 0.5);
        
        return `
            <div class="text-center">
                <p class="mb-4">–†–∞—Å—Å—Ç–∞–≤—å —á–∏—Å–ª–∞ –ø–æ –ø–æ—Ä—è–¥–∫—É (1, 2, 3, 4):</p>
                <div class="grid grid-cols-4 gap-2 mb-4">
                    ${this.puzzlePieces.map((piece, index) => `
                        <button onclick="game.swapPuzzlePiece(${index})" class="bg-green-400 hover:bg-green-500 text-white p-4 rounded text-xl transition-colors">
                            ${piece}
                        </button>
                    `).join('')}
                </div>
                <p class="text-xs text-gray-600">–ù–∞–∂–º–∏ –Ω–∞ —á–∏—Å–ª–æ —á—Ç–æ–±—ã –ø–æ–º–µ–Ω—è—Ç—å –º–µ—Å—Ç–∞–º–∏ —Å —Å–æ—Å–µ–¥–Ω–∏–º</p>
            </div>
        `;
    }
    
    getQuizGameContent() {
        const questions = [
            { q: '–ö–∞–∫–æ–≥–æ —Ü–≤–µ—Ç–∞ —Å–æ–ª–Ω—Ü–µ?', answers: ['–ñ–µ–ª—Ç–æ–µ', '–°–∏–Ω–µ–µ', '–ö—Ä–∞—Å–Ω–æ–µ'], correct: 0 },
            { q: '–°–∫–æ–ª—å–∫–æ –Ω–æ–≥ —É –∫–æ—Ç–∞?', answers: ['2', '4', '6'], correct: 1 },
            { q: '–ß—Ç–æ –µ–¥—è—Ç –∫—Ä–æ–ª–∏–∫–∏?', answers: ['–ú—è—Å–æ', '–ú–æ—Ä–∫–æ–≤—å', '–†—ã–±—É'], correct: 1 },
            { q: '–°–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –≤ –Ω–µ–¥–µ–ª–µ?', answers: ['5', '6', '7'], correct: 2 },
            { q: '–ö–∞–∫–æ–π —Ü–≤–µ—Ç —É —Ç—Ä–∞–≤—ã?', answers: ['–ö—Ä–∞—Å–Ω—ã–π', '–ó–µ–ª–µ–Ω—ã–π', '–°–∏–Ω–∏–π'], correct: 1 }
        ];
        
        this.currentQuestion = questions[Math.floor(Math.random() * questions.length)];
        
        return `
            <div class="text-center">
                <p class="text-lg mb-4">${this.currentQuestion.q}</p>
                <div class="space-y-2">
                    ${this.currentQuestion.answers.map((answer, index) => `
                        <button onclick="game.checkQuizAnswer(${index})" class="w-full bg-purple-400 hover:bg-purple-500 text-white p-3 rounded transition-colors">
                            ${answer}
                        </button>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    getRhythmGameContent() {
        return `
            <div class="text-center">
                <p class="mb-4">–ü–æ–≤—Ç–æ—Ä–∏ —Ä–∏—Ç–º: üî¥üîµüî¥üîµ</p>
                <div class="flex justify-center space-x-4 mb-4">
                    <button onclick="game.addRhythmBeat(1)" class="w-16 h-16 bg-red-400 hover:bg-red-500 rounded-full text-2xl transition-colors">
                        üî¥
                    </button>
                    <button onclick="game.addRhythmBeat(0)" class="w-16 h-16 bg-blue-400 hover:bg-blue-500 rounded-full text-2xl transition-colors">
                        üîµ
                    </button>
                </div>
                <div id="rhythm-display" class="mb-4 text-lg">–í–∞—à —Ä–∏—Ç–º: </div>
                <button onclick="game.checkRhythm()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
                </button>
                <button onclick="game.resetRhythm()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded ml-2">
                    –°–±—Ä–æ—Å–∏—Ç—å
                </button>
            </div>
        `;
    }
    
    getTreasureGameContent() {
        this.treasurePosition = Math.floor(Math.random() * 9);
        this.treasureAttempts = 0;
        
        return `
            <div class="text-center">
                <p class="mb-4">–ù–∞–π–¥–∏ —Å–æ–∫—Ä–æ–≤–∏—â–µ! üíé</p>
                <p class="mb-2 text-sm text-gray-600">–£ –≤–∞—Å 3 –ø–æ–ø—ã—Ç–∫–∏</p>
                <div class="attempts-message text-center text-sm text-blue-600 mb-2">–ü–æ–ø—ã—Ç–æ–∫ –æ—Å—Ç–∞–ª–æ—Å—å: 3</div>
                <div class="grid grid-cols-3 gap-2">
                    ${Array.from({length: 9}, (_, index) => `
                        <button onclick="game.checkTreasure(${index})" class="treasure-btn bg-yellow-400 hover:bg-yellow-500 text-white p-4 rounded h-16 text-2xl transition-colors">
                            ‚ùì
                        </button>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    getBalanceGameContent() {
        this.balance = 50;
        this.balanceTimer = 10;
        
        return `
            <div class="text-center">
                <p class="mb-2">–£–¥–µ—Ä–∂–∏ –±–∞–ª–∞–Ω—Å –≤ –∑–µ–ª–µ–Ω–æ–π –∑–æ–Ω–µ 10 —Å–µ–∫—É–Ω–¥!</p>
                <p class="mb-4 text-lg font-bold">–í—Ä–µ–º—è: <span id="balance-timer">10</span>—Å</p>
                <div class="relative h-8 bg-gray-300 rounded mb-4">
                    <div class="absolute top-0 h-8 bg-green-400 rounded" style="left: 30%; right: 30%;"></div>
                    <div class="absolute top-0 h-8 bg-red-400 rounded-l" style="left: 0%; right: 70%;"></div>
                    <div class="absolute top-0 h-8 bg-red-400 rounded-r" style="left: 70%; right: 0%;"></div>
                    <div id="balance-marker" class="absolute top-0 w-3 h-8 bg-blue-800 rounded transition-all duration-150" style="left: 50%; transform: translateX(-50%);"></div>
                </div>
                <div class="flex justify-center space-x-4">
                    <button onclick="game.adjustBalance(-5)" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded font-bold">
                        ‚¨ÖÔ∏è –í–ª–µ–≤–æ
                    </button>
                    <button onclick="game.adjustBalance(5)" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded font-bold">
                        –í–ø—Ä–∞–≤–æ ‚û°Ô∏è
                    </button>
                </div>
                <button onclick="game.startBalanceGame()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded mt-4">
                    –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
                </button>
            </div>
        `;
    }
    
    getMatchingGameContent() {
        const symbols = ['üçé', 'üçå', 'üçá', 'üçä'];
        this.matchingCards = [...symbols, ...symbols].sort(() => Math.random() - 0.5);
        this.flippedCards = [];
        this.matchedCards = [];
        
        return `
            <div class="text-center">
                <p class="mb-4">–ù–∞–π–¥–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø–∞—Ä—ã!</p>
                <div class="grid grid-cols-4 gap-2">
                    ${this.matchingCards.map((card, index) => `
                        <button onclick="game.flipCard(${index})" id="card-${index}" class="h-16 w-16 bg-blue-400 hover:bg-blue-500 rounded text-2xl transition-colors">
                            ‚ùì
                        </button>
                    `).join('')}
                </div>
                <div class="text-xs text-gray-600 mt-2">
                    –ù–∞–π–¥–µ–Ω–æ –ø–∞—Ä: <span id="pairs-found">0</span> / 4
                </div>
            </div>
        `;
    }
    
    getSimonGameContent() {
        return `
            <div class="text-center">
                <p class="mb-4">–ü–æ–≤—Ç–æ—Ä–∏ –∫–æ–º–∞–Ω–¥—ã –°–∞–π–º–æ–Ω–∞!</p>
                <div class="grid grid-cols-2 gap-2 mb-4">
                    <button onclick="game.simonClick(0)" id="simon-0" class="h-16 bg-red-400 hover:bg-red-500 rounded transition-colors">üî¥</button>
                    <button onclick="game.simonClick(1)" id="simon-1" class="h-16 bg-blue-400 hover:bg-blue-500 rounded transition-colors">üîµ</button>
                    <button onclick="game.simonClick(2)" id="simon-2" class="h-16 bg-green-400 hover:bg-green-500 rounded transition-colors">üü¢</button>
                    <button onclick="game.simonClick(3)" id="simon-3" class="h-16 bg-yellow-400 hover:bg-yellow-500 rounded transition-colors">üü°</button>
                </div>
                <button onclick="game.startSimonGame()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded">
                    –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
                </button>
                <div id="simon-status" class="mt-2 text-sm text-gray-600"></div>
            </div>
        `;
    }
    
    getCatchGameContent() {
        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        setTimeout(() => this.startCatchGame(), 100);
        
        return `
            <div class="text-center">
                <p class="mb-2">–ü–æ–π–º–∞–π –ø–∞–¥–∞—é—â–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã!</p>
                <p id="catch-score" class="mb-4">–ü–æ–π–º–∞–Ω–æ: 0/5</p>
                <div id="catch-game-area" class="relative w-full h-40 bg-blue-100 rounded border overflow-hidden">
                    <div id="catch-bucket" class="absolute bottom-0 w-12 h-6 bg-green-500 rounded-t transition-all duration-200 flex items-center justify-center text-xs" style="left: 50%; transform: translateX(-50%); z-index: 10;">
                        ü™£
                    </div>
                </div>
                <div class="flex justify-center space-x-4 mt-2">
                    <button onclick="game.moveCatchPlayer('left')" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
                        ‚¨ÖÔ∏è –í–ª–µ–≤–æ
                    </button>
                    <button onclick="game.moveCatchPlayer('right')" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
                        –í–ø—Ä–∞–≤–æ ‚û°Ô∏è
                    </button>
                </div>
                <div class="text-xs text-gray-600 mt-2">
                    15 —Å–µ–∫—É–Ω–¥ ‚Ä¢ –ù—É–∂–Ω–æ –ø–æ–π–º–∞—Ç—å 5 –∑–≤–µ–∑–¥–æ—á–µ–∫
                </div>
            </div>
        `;
    }
    
    getTargetGameContent() {
        this.targetScore = 0;
        this.targetPos = { x: 50, y: 50 };
        
        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        this.startTargetGame();
        
        return `
            <div class="text-center">
                <p class="mb-2">–ü–æ–ø–∞–¥–∏ –≤ –¥–≤–∏–∂—É—â—É—é—Å—è –º–∏—à–µ–Ω—å!</p>
                <p id="target-score" class="mb-4">–ü–æ–ø–∞–¥–∞–Ω–∏–π: 0/3</p>
                <div id="target-game-area" class="relative w-full h-40 bg-gray-200 rounded border">
                    <button id="moving-target" onclick="game.hitTarget()" class="absolute w-8 h-8 bg-red-500 rounded-full transition-all duration-300" style="left: 50%; top: 50%; transform: translate(-50%, -50%);">
                        üéØ
                    </button>
                </div>
                <p class="text-xs text-gray-600 mt-2">–ú–∏—à–µ–Ω—å –¥–≤–∏–∂–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 1.5 —Å–µ–∫—É–Ω–¥—ã!</p>
            </div>
        `;
    }
    
    getCodeGameContent() {
        this.secretCode = Array.from({length: 4}, () => Math.floor(Math.random() * 4));
        this.codeAttempt = [];
        
        return `
            <div class="text-center">
                <p class="mb-4">–í–∑–ª–æ–º–∞–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥!</p>
                <p class="mb-2 text-xs text-gray-600">–ö–æ–¥ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 4 —Ü–∏—Ñ—Ä (0-3)</p>
                <div class="flex justify-center space-x-2 mb-4">
                    ${Array.from({length: 4}, (_, i) => `
                        <div id="code-slot-${i}" class="w-8 h-8 border-2 border-gray-400 rounded flex items-center justify-center bg-white">
                            ?
                        </div>
                    `).join('')}
                </div>
                <div class="grid grid-cols-4 gap-2 mb-3">
                    ${[0, 1, 2, 3].map(digit => `
                        <button onclick="game.enterCodeDigit(${digit})" class="bg-purple-400 hover:bg-purple-500 active:bg-purple-600 text-white p-3 rounded transition-colors font-bold text-lg">
                            ${digit}
                        </button>
                    `).join('')}
                </div>
                <button onclick="game.resetCode()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded transition-colors">
                    üîÑ –°–±—Ä–æ—Å–∏—Ç—å
                </button>
            </div>
        `;
    }
    
    getStackGameContent() {
        // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞
        setTimeout(() => this.startStackTimer(), 100);
        
        return `
            <div class="text-center">
                <p class="mb-2">–°–æ–±–µ—Ä–∏ –±–∞—à–Ω—é –∏–∑ –±–ª–æ–∫–æ–≤!</p>
                <p class="mb-2">–í—ã—Å–æ—Ç–∞: <span id="stack-height">0</span>/5</p>
                <p class="mb-4">–í—Ä–µ–º—è: <span id="stack-timer">10</span>—Å</p>
                <div id="stack-area" class="flex flex-col-reverse items-center h-32 justify-end mb-4 bg-gray-100 rounded border-2 border-dashed border-gray-300">
                </div>
                <button onclick="game.addStackBlock()" class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-3 rounded font-bold transition-colors active:scale-95">
                    üß± –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫
                </button>
                <div class="text-xs text-gray-600 mt-2">
                    –ü–æ—Å—Ç—Ä–æ–π—Ç–µ –±–∞—à–Ω—é –≤—ã—Å–æ—Ç–æ–π 5 –±–ª–æ–∫–æ–≤ –∑–∞ 10 —Å–µ–∫—É–Ω–¥!
                </div>
            </div>
        `;
    }
    
    getSpeedGameContent() {
        // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞
        setTimeout(() => this.startSpeedTimer(), 100);
        
        return `
            <div class="text-center">
                <p class="mb-2">–ù–∞–∂–º–∏ –∫–∞–∫ –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–µ–µ!</p>
                <p class="mb-2">–ù–∞–∂–∞—Ç–∏–π: <span id="click-count">0</span>/20</p>
                <p class="mb-4">–í—Ä–µ–º—è: <span id="speed-timer">5</span>—Å</p>
                <button onclick="game.speedClick()" class="w-32 h-32 bg-red-500 hover:bg-red-600 active:bg-red-700 text-white text-3xl rounded-full animate-pulse transition-all active:scale-95">
                    üí® –ö–õ–ò–ö!
                </button>
                <div class="text-xs text-gray-600 mt-2">
                    –¶–µ–ª—å: 20+ –∫–ª–∏–∫–æ–≤ –∑–∞ 5 —Å–µ–∫—É–Ω–¥
                </div>
            </div>
        `;
    }
    
    completeMiniGame(success = null) {
        if (success === null) {
            success = Math.random() > 0.3; // 70% —à–∞–Ω—Å —É—Å–ø–µ—Ö–∞
        }
        
        if (success && this.currentMiniGame) {
            const reward = this.currentMiniGame.reward;
            this.stats.happiness = Math.min(100, this.stats.happiness + (reward.happiness || 0));
            this.stats.energy = Math.max(0, this.stats.energy - 15);
            this.experience += reward.experience || 0;
            this.money += reward.money || 0;
            
            this.playHappySound();
            this.showMessage(`–û—Ç–ª–∏—á–Ω–æ! +${reward.experience} –æ–ø—ã—Ç–∞, +${reward.money} –º–æ–Ω–µ—Ç!`);
        } else {
            this.stats.energy = Math.max(0, this.stats.energy - 10);
            this.playSound(200, 300);
            this.showMessage('–ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑!');
        }
        
        this.checkLevelUp();
        this.saveData();
        this.updateDisplay();
        this.closeMiniGame();
    }
    
    // –ò–≥—Ä–∞ "–ü–∞–º—è—Ç—å"
    startMemorySequence() {
        this.memorySequence = Array.from({length: 4}, () => Math.floor(Math.random() * 4));
        this.userMemorySequence = [];
        this.currentMemoryStep = 0;
        this.showMemorySequence();
    }
    
    showMemorySequence() {
        if (this.currentMemoryStep < this.memorySequence.length) {
            const colorIndex = this.memorySequence[this.currentMemoryStep];
            const button = document.getElementById(`memory-${colorIndex}`);
            button.style.transform = 'scale(1.1)';
            button.style.boxShadow = '0 0 20px rgba(255,255,255,0.8)';
            
            setTimeout(() => {
                button.style.transform = 'scale(1)';
                button.style.boxShadow = 'none';
                this.currentMemoryStep++;
                setTimeout(() => this.showMemorySequence(), 300);
            }, 600);
        } else {
            this.showMessage('–¢–µ–ø–µ—Ä—å –ø–æ–≤—Ç–æ—Ä–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å!');
        }
    }
    
    handleMemoryClick(colorIndex) {
        if (this.currentMemoryStep >= this.memorySequence.length) {
            this.userMemorySequence.push(colorIndex);
            
            if (this.userMemorySequence[this.userMemorySequence.length - 1] !== this.memorySequence[this.userMemorySequence.length - 1]) {
                this.completeMiniGame(false);
                return;
            }
            
            if (this.userMemorySequence.length === this.memorySequence.length) {
                this.completeMiniGame(true);
            }
        }
    }
    
    generateUserId() {
        return 'user_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
    }
    
    connectTelegram() {
        const chatId = prompt(`ü§ñ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Telegram –±–æ—Ç—É:

1. –ù–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞ @LabubuCareBot –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É /start
3. –í–≤–µ–¥–∏—Ç–µ –≤–∞—à Chat ID (–æ–Ω –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –±–æ—Ç–∞):

–í–≤–µ–¥–∏—Ç–µ Chat ID:`);
        
        if (chatId && chatId.trim()) {
            this.registerTelegramUser(chatId.trim());
        }
    }
    
    async registerTelegramUser(chatId) {
        try {
            // –ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å URL –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
            const response = await fetch('https://your-bot-server.com/api/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    chatId: chatId,
                    gameUserId: this.gameUserId,
                    petName: this.petName
                })
            });
            
            if (response.ok) {
                this.telegramConnected = true;
                this.telegramChatId = chatId;
                localStorage.setItem('telegram_connected', 'true');
                localStorage.setItem('telegram_chat_id', chatId);
                
                document.getElementById('telegramBtn').classList.add('hidden');
                document.getElementById('telegramStatus').classList.remove('hidden');
                
                this.showMessage('‚úÖ Telegram —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω!');
            } else {
                this.showMessage('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Telegram');
            }
        } catch (error) {
            console.error('Telegram connection error:', error);
            this.showMessage('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
        }
    }
    
    async sendTelegramNotification(message, type) {
        if (!this.telegramConnected) return;
        
        try {
            await fetch('https://your-bot-server.com/api/notify', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    gameUserId: this.gameUserId,
                    message: message,
                    type: type,
                    petName: this.petName
                })
            });
        } catch (error) {
            console.error('Failed to send Telegram notification:', error);
        }
    }
    
    async updateTelegramStats() {
        if (!this.telegramConnected) return;
        
        try {
            await fetch('https://your-bot-server.com/api/update-stats', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    gameUserId: this.gameUserId,
                    stats: this.stats,
                    petName: this.petName,
                    level: this.level,
                    money: this.money,
                    age: this.age
                })
            });
        } catch (error) {
            console.error('Failed to update Telegram stats:', error);
        }
    }
    
    // –ò–≥—Ä–∞ "–†–µ–∞–∫—Ü–∏—è"
    startReactionTest() {
        const light = document.getElementById('reaction-light');
        const btn = document.getElementById('reaction-btn');
        light.className = 'w-20 h-20 bg-red-400 rounded-full mx-auto mb-4 transition-colors';
        btn.classList.add('hidden');
        
        const delay = 2000 + Math.random() * 3000;
        this.reactionStartTime = Date.now() + delay;
        
        setTimeout(() => {
            light.className = 'w-20 h-20 bg-green-500 rounded-full mx-auto mb-4 transition-colors animate-pulse';
            btn.classList.remove('hidden');
            this.reactionStarted = true;
        }, delay);
    }
    
    reactionClick() {
        if (this.reactionStarted) {
            const reactionTime = Date.now() - this.reactionStartTime;
            this.completeMiniGame(reactionTime < 1000);
        }
    }
    
    // –ò–≥—Ä–∞ "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞"
    checkMathAnswer(answer) {
        this.completeMiniGame(answer === this.mathAnswer);
    }
    
    // –ò–≥—Ä–∞ "–ü–∞–∑–ª"
    swapPuzzlePiece(index) {
        if (index < this.puzzlePieces.length - 1) {
            [this.puzzlePieces[index], this.puzzlePieces[index + 1]] = [this.puzzlePieces[index + 1], this.puzzlePieces[index]];
            
            // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            const content = this.getPuzzleGameContent();
            document.getElementById('gameContent').innerHTML = content;
            
            if (JSON.stringify(this.puzzlePieces) === JSON.stringify([1, 2, 3, 4])) {
                this.completeMiniGame(true);
            }
        }
    }
    
    // –ò–≥—Ä–∞ "–í–∏–∫—Ç–æ—Ä–∏–Ω–∞"
    checkQuizAnswer(answerIndex) {
        this.completeMiniGame(answerIndex === this.currentQuestion.correct);
    }
    
    // –ò–≥—Ä–∞ "–†–∏—Ç–º"
    addRhythmBeat(beat) {
        if (!this.userRhythm) this.userRhythm = [];
        this.userRhythm.push(beat);
        
        const display = document.getElementById('rhythm-display');
        display.textContent = '–í–∞—à —Ä–∏—Ç–º: ' + this.userRhythm.map(b => b === 1 ? 'üî¥' : 'üîµ').join('');
    }
    
    checkRhythm() {
        const targetRhythm = [1, 0, 1, 0]; // üî¥üîµüî¥üîµ
        this.completeMiniGame(JSON.stringify(this.userRhythm) === JSON.stringify(targetRhythm));
    }
    
    resetRhythm() {
        this.userRhythm = [];
        document.getElementById('rhythm-display').textContent = '–í–∞—à —Ä–∏—Ç–º: ';
    }
    
    // –ò–≥—Ä–∞ "–ö–ª–∞–¥" (–ò–°–ü–†–ê–í–õ–ï–ù–û)
    checkTreasure(position) {
        if (!this.treasureAttempts) this.treasureAttempts = 0;
        
        if (position === this.treasurePosition) {
            // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–∫—Ä–æ–≤–∏—â–µ
            const buttons = document.querySelectorAll('#gameContent .treasure-btn');
            if (buttons[position]) {
                buttons[position].textContent = 'üíé';
                buttons[position].className = 'treasure-btn bg-green-500 text-white p-4 rounded h-16 text-2xl animate-pulse';
            }
            setTimeout(() => this.completeMiniGame(true), 1000);
        } else {
            this.treasureAttempts++;
            const attemptsLeft = 3 - this.treasureAttempts;
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä
            const buttons = document.querySelectorAll('#gameContent .treasure-btn');
            if (buttons[position]) {
                buttons[position].textContent = '‚ùå';
                buttons[position].disabled = true;
                buttons[position].className = 'treasure-btn bg-red-400 text-white p-4 rounded h-16 text-2xl';
            }
            
            if (attemptsLeft > 0) {
                // –û–±–Ω–æ–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø–æ–ø—ã—Ç–∫–∞—Ö
                const messageEl = document.querySelector('#gameContent .attempts-message');
                if (messageEl) {
                    messageEl.textContent = `–û—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫: ${attemptsLeft}`;
                    messageEl.className = 'attempts-message text-center text-sm text-red-600 mt-2';
                }
            } else {
                // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Å–æ–∫—Ä–æ–≤–∏—â–∞
                if (buttons[this.treasurePosition]) {
                    buttons[this.treasurePosition].textContent = 'üíé';
                    buttons[this.treasurePosition].className = 'treasure-btn bg-yellow-500 text-white p-4 rounded h-16 text-2xl animate-pulse';
                }
                setTimeout(() => this.completeMiniGame(false), 1500);
            }
        }
    }
    
    // –ò–≥—Ä–∞ "–ë–∞–ª–∞–Ω—Å"
    startBalanceGame() {
        this.balance = 50;
        this.balanceTimer = 10;
        this.balanceInterval = setInterval(() => {
            this.balanceTimer--;
            document.getElementById('balance-timer').textContent = this.balanceTimer;
            
            if (this.balanceTimer <= 0) {
                clearInterval(this.balanceInterval);
                this.completeMiniGame(true);
            }
            
            // –°–ª—É—á–∞–π–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
            this.balance += (Math.random() - 0.5) * 4;
            this.balance = Math.max(0, Math.min(100, this.balance));
            
            const marker = document.getElementById('balance-marker');
            marker.style.left = this.balance + '%';
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Ä–æ–≤–∞–ª
            if (this.balance < 25 || this.balance > 75) {
                clearInterval(this.balanceInterval);
                this.completeMiniGame(false);
            }
        }, 1000);
    }
    
    adjustBalance(amount) {
        this.balance += amount;
        this.balance = Math.max(0, Math.min(100, this.balance));
        
        const marker = document.getElementById('balance-marker');
        marker.style.left = this.balance + '%';
    }
    
    // –ò–≥—Ä–∞ "–ù–∞–π–¥–∏ –ø–∞—Ä—É"
    flipCard(index) {
        if (this.flippedCards.length < 2 && !this.flippedCards.includes(index) && !this.matchedCards.includes(index)) {
            this.flippedCards.push(index);
            const card = document.getElementById(`card-${index}`);
            card.textContent = this.matchingCards[index];
            card.className = 'h-16 w-16 bg-green-200 rounded text-2xl transition-colors';
            
            if (this.flippedCards.length === 2) {
                setTimeout(() => {
                    if (this.matchingCards[this.flippedCards[0]] === this.matchingCards[this.flippedCards[1]]) {
                        this.matchedCards.push(...this.flippedCards);
                        document.getElementById('pairs-found').textContent = this.matchedCards.length / 2;
                        
                        if (this.matchedCards.length === this.matchingCards.length) {
                            this.completeMiniGame(true);
                        }
                    } else {
                        this.flippedCards.forEach(i => {
                            const card = document.getElementById(`card-${i}`);
                            card.textContent = '‚ùì';
                            card.className = 'h-16 w-16 bg-blue-400 hover:bg-blue-500 rounded text-2xl transition-colors';
                        });
                    }
                    this.flippedCards = [];
                }, 1000);
            }
        }
    }
    
    // –ò–≥—Ä–∞ "–°–∞–π–º–æ–Ω –≥–æ–≤–æ—Ä–∏—Ç"
    startSimonGame() {
        this.simonSequence = Array.from({length: 5}, () => Math.floor(Math.random() * 4));
        this.userSimonSequence = [];
        this.currentSimonStep = 0;
        this.showSimonSequence();
    }
    
    showSimonSequence() {
        if (this.currentSimonStep < this.simonSequence.length) {
            const colorIndex = this.simonSequence[this.currentSimonStep];
            const button = document.getElementById(`simon-${colorIndex}`);
            button.style.transform = 'scale(1.2)';
            button.style.filter = 'brightness(1.5)';
            
            setTimeout(() => {
                button.style.transform = 'scale(1)';
                button.style.filter = 'brightness(1)';
                this.currentSimonStep++;
                setTimeout(() => this.showSimonSequence(), 300);
            }, 600);
        } else {
            document.getElementById('simon-status').textContent = '–¢–µ–ø–µ—Ä—å –ø–æ–≤—Ç–æ—Ä–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å!';
        }
    }
    
    simonClick(colorIndex) {
        if (this.currentSimonStep >= this.simonSequence.length) {
            this.userSimonSequence.push(colorIndex);
            
            if (this.userSimonSequence[this.userSimonSequence.length - 1] !== this.simonSequence[this.userSimonSequence.length - 1]) {
                this.completeMiniGame(false);
                return;
            }
            
            if (this.userSimonSequence.length === this.simonSequence.length) {
                this.completeMiniGame(true);
            }
        }
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–ü–æ–π–º–∞–π –ø—Ä–µ–¥–º–µ—Ç" (–ò–°–ü–†–ê–í–õ–ï–ù–û)
    startCatchGame() {
        this.fallingItems = [];
        this.catchScore = 0;
        this.playerPos = 50;
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫
        this.updateCatchGameDisplay();
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∞–¥–∞—é—â–∏—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤
        this.catchSpawnInterval = setInterval(() => {
            const newItem = {
                id: Date.now() + Math.random(),
                x: Math.random() * 80 + 10,
                y: 0
            };
            this.fallingItems.push(newItem);
        }, 800);
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä—ã
        this.catchUpdateInterval = setInterval(() => {
            // –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏–∏ –≤—Å–µ—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤
            this.fallingItems = this.fallingItems.map(item => ({
                ...item,
                y: item.y + 5
            })).filter(item => {
                // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å –∫–æ—Ä–∑–∏–Ω–æ–π
                if (item.y >= 75 && item.y <= 85 && Math.abs(item.x - this.playerPos) < 15) {
                    this.catchScore++;
                    this.updateCatchGameDisplay();
                    
                    if (this.catchScore >= 5) {
                        this.endCatchGame(true);
                        return false;
                    }
                    return false; // –£–¥–∞–ª–∏—Ç—å –ø–æ–π–º–∞–Ω–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç
                }
                
                // –£–¥–∞–ª–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç—ã –∫–æ—Ç–æ—Ä—ã–µ —É–ø–∞–ª–∏
                return item.y <= 100;
            });
            
            this.renderFallingItems();
        }, 100);
        
        // –ó–∞–∫–æ–Ω—á–∏—Ç—å –∏–≥—Ä—É —á–µ—Ä–µ–∑ 15 —Å–µ–∫—É–Ω–¥
        this.catchGameTimeout = setTimeout(() => {
            this.endCatchGame(this.catchScore >= 5);
        }, 15000);
    }
    
    endCatchGame(success) {
        if (this.catchSpawnInterval) clearInterval(this.catchSpawnInterval);
        if (this.catchUpdateInterval) clearInterval(this.catchUpdateInterval);
        if (this.catchGameTimeout) clearTimeout(this.catchGameTimeout);
        
        this.completeMiniGame(success);
    }
    
    updateCatchGameDisplay() {
        const scoreElement = document.getElementById('catch-score');
        if (scoreElement) {
            scoreElement.textContent = `–ü–æ–π–º–∞–Ω–æ: ${this.catchScore}/5`;
        }
    }
    
    moveCatchPlayer(direction) {
        if (direction === 'left') {
            this.playerPos = Math.max(10, this.playerPos - 15);
        } else if (direction === 'right') {
            this.playerPos = Math.min(90, this.playerPos + 15);
        }
        
        const bucket = document.getElementById('catch-bucket');
        if (bucket) {
            bucket.style.left = this.playerPos + '%';
        }
    }
    
    renderFallingItems() {
        const gameArea = document.getElementById('catch-game-area');
        if (!gameArea) return;
        
        // –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã
        const oldItems = gameArea.querySelectorAll('.falling-item');
        oldItems.forEach(item => item.remove());
        
        // –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã
        this.fallingItems.forEach((item) => {
            const itemElement = document.createElement('div');
            itemElement.className = 'falling-item absolute w-6 h-6 bg-yellow-400 rounded-full cursor-pointer flex items-center justify-center text-xs';
            itemElement.style.left = item.x + '%';
            itemElement.style.top = item.y + '%';
            itemElement.style.transform = 'translate(-50%, -50%)';
            itemElement.innerHTML = '‚≠ê';
            itemElement.style.zIndex = '5';
            gameArea.appendChild(itemElement);
        });
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–ü–æ–ø–∞–¥–∏ –≤ —Ü–µ–ª—å" (–ò–°–ü–†–ê–í–õ–ï–ù–û)
    startTargetGame() {
        this.targetScore = 0;
        this.targetPos = { x: 50, y: 50 };
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫
        const scoreElement = document.getElementById('target-score');
        if (scoreElement) {
            scoreElement.textContent = `–ü–æ–ø–∞–¥–∞–Ω–∏–π: 0/3`;
        }
        
        // –ü–µ—Ä–≤–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –º–∏—à–µ–Ω–∏
        this.moveTarget();
        
        // –ò–Ω—Ç–µ—Ä–≤–∞–ª –¥–≤–∏–∂–µ–Ω–∏—è –º–∏—à–µ–Ω–∏
        this.targetGameInterval = setInterval(() => {
            this.moveTarget();
        }, 1500);
        
        // –ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
        this.targetGameTimeout = setTimeout(() => {
            if (this.targetGameInterval) {
                clearInterval(this.targetGameInterval);
                this.completeMiniGame(this.targetScore >= 3);
            }
        }, 10000);
    }
    
    moveTarget() {
        this.targetPos = {
            x: Math.random() * 70 + 15, // –ë–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã
            y: Math.random() * 70 + 15
        };
        
        const target = document.getElementById('moving-target');
        if (target) {
            target.style.left = this.targetPos.x + '%';
            target.style.top = this.targetPos.y + '%';
            target.style.transition = 'all 0.3s ease';
        }
    }
    
    hitTarget() {
        this.targetScore++;
        const scoreElement = document.getElementById('target-score');
        if (scoreElement) {
            scoreElement.textContent = `–ü–æ–ø–∞–¥–∞–Ω–∏–π: ${this.targetScore}/3`;
        }
        
        // –≠—Ñ—Ñ–µ–∫—Ç –ø–æ–ø–∞–¥–∞–Ω–∏—è
        const target = document.getElementById('moving-target');
        if (target) {
            target.style.transform = 'translate(-50%, -50%) scale(1.2)';
            setTimeout(() => {
                target.style.transform = 'translate(-50%, -50%) scale(1)';
            }, 200);
        }
        
        if (this.targetScore >= 3) {
            clearInterval(this.targetGameInterval);
            clearTimeout(this.targetGameTimeout);
            this.completeMiniGame(true);
        } else {
            // –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –º–∏—à–µ–Ω—å –ø–æ—Å–ª–µ –ø–æ–ø–∞–¥–∞–Ω–∏—è
            setTimeout(() => this.moveTarget(), 300);
        }
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–í–∑–ª–æ–º–∞–π –∫–æ–¥" (–ò–°–ü–†–ê–í–õ–ï–ù–û)
    enterCodeDigit(digit) {
        if (this.codeAttempt.length < 4) {
            this.codeAttempt.push(digit);
            
            const slot = document.getElementById(`code-slot-${this.codeAttempt.length - 1}`);
            if (slot) {
                slot.textContent = digit;
                slot.className = 'w-8 h-8 border-2 border-blue-400 rounded flex items-center justify-center bg-blue-50 font-bold';
            }
            
            if (this.codeAttempt.length === 4) {
                // –ü–æ–∫–∞–∑–∞—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é –ø—Ä–æ–≤–µ—Ä–∫–∏
                for (let i = 0; i < 4; i++) {
                    const slot = document.getElementById(`code-slot-${i}`);
                    if (slot) {
                        slot.className = 'w-8 h-8 border-2 border-yellow-400 rounded flex items-center justify-center bg-yellow-100 font-bold animate-pulse';
                    }
                }
                
                setTimeout(() => {
                    if (JSON.stringify(this.codeAttempt) === JSON.stringify(this.secretCode)) {
                        // –ö–æ–¥ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
                        for (let i = 0; i < 4; i++) {
                            const slot = document.getElementById(`code-slot-${i}`);
                            if (slot) {
                                slot.className = 'w-8 h-8 border-2 border-green-500 rounded flex items-center justify-center bg-green-100 font-bold';
                            }
                        }
                        setTimeout(() => this.completeMiniGame(true), 1000);
                    } else {
                        // –ö–æ–¥ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
                        for (let i = 0; i < 4; i++) {
                            const slot = document.getElementById(`code-slot-${i}`);
                            if (slot) {
                                slot.className = 'w-8 h-8 border-2 border-red-500 rounded flex items-center justify-center bg-red-100 font-bold animate-bounce';
                            }
                        }
                        
                        setTimeout(() => {
                            this.resetCode();
                            this.showMessage('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–¥! –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑.');
                        }, 1500);
                    }
                }, 1000);
            }
        }
    }
    
    resetCode() {
        this.codeAttempt = [];
        for (let i = 0; i < 4; i++) {
            const slot = document.getElementById(`code-slot-${i}`);
            if (slot) {
                slot.textContent = '?';
                slot.className = 'w-8 h-8 border-2 border-gray-400 rounded flex items-center justify-center bg-white';
            }
        }
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–°–æ–±–µ—Ä–∏ –±–∞—à–Ω—é" (–ò–°–ü–†–ê–í–õ–ï–ù–û)
    startStackTimer() {
        this.stackHeight = 0;
        this.stackTimer = 10;
        
        this.stackTimerInterval = setInterval(() => {
            this.stackTimer--;
            const timerElement = document.getElementById('stack-timer');
            if (timerElement) {
                timerElement.textContent = this.stackTimer;
            }
            
            if (this.stackTimer <= 0) {
                clearInterval(this.stackTimerInterval);
                this.completeMiniGame(this.stackHeight >= 5);
            }
        }, 1000);
    }
    
    addStackBlock() {
        if (this.stackTimer <= 0) return;
        
        this.stackHeight++;
        
        const heightElement = document.getElementById('stack-height');
        if (heightElement) {
            heightElement.textContent = this.stackHeight;
        }
        
        const stackArea = document.getElementById('stack-area');
        if (stackArea) {
            const block = document.createElement('div');
            block.className = 'w-16 h-6 bg-orange-400 border border-orange-600 mb-1 rounded';
            block.style.animation = 'fadeIn 0.2s ease-in';
            stackArea.appendChild(block);
        }
        
        if (this.stackHeight >= 5) {
            clearInterval(this.stackTimerInterval);
            this.completeMiniGame(true);
        }
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–°–∫–æ—Ä–æ—Å—Ç—å"
    startSpeedTimer() {
        this.clickCount = 0;
        this.speedTimer = 5;
        
        this.speedTimerInterval = setInterval(() => {
            this.speedTimer--;
            const timerElement = document.getElementById('speed-timer');
            if (timerElement) {
                timerElement.textContent = this.speedTimer;
            }
            
            if (this.speedTimer <= 0) {
                clearInterval(this.speedTimerInterval);
                this.completeMiniGame(this.clickCount >= 20);
            }
        }, 1000);
    }
    
    speedClick() {
        if (this.speedTimer <= 0) return;
        
        this.clickCount++;
        const countElement = document.getElementById('click-count');
        if (countElement) {
            countElement.textContent = this.clickCount;
        }
        
        if (this.clickCount >= 20) {
            clearInterval(this.speedTimerInterval);
            this.completeMiniGame(true);
        }
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–õ–∞–±–∏—Ä–∏–Ω—Ç" (–ù–û–í–û–ï)
    getMazeGameContent() {
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–æ—Å—Ç–æ–π –ª–∞–±–∏—Ä–∏–Ω—Ç 5x5
        this.mazeSize = 5;
        this.playerPos = { x: 0, y: 0 };
        this.exitPos = { x: 4, y: 4 };
        this.maze = this.generateMaze();
        
        return `
            <div class="text-center">
                <p class="mb-2">–ù–∞–π–¥–∏ –≤—ã—Ö–æ–¥ –∏–∑ –ª–∞–±–∏—Ä–∏–Ω—Ç–∞!</p>
                <p class="mb-4">üèÅ –î–æ–π–¥–∏ –¥–æ –≤—ã—Ö–æ–¥–∞ –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É</p>
                <div id="maze-grid" class="grid grid-cols-5 gap-1 mb-4 mx-auto max-w-40">
                    ${this.renderMaze()}
                </div>
                <div class="flex justify-center space-x-2">
                    <button onclick="game.moveMazePlayer('up')" class="bg-blue-500 text-white px-3 py-2 rounded">‚¨ÜÔ∏è</button>
                </div>
                <div class="flex justify-center space-x-2 mt-1">
                    <button onclick="game.moveMazePlayer('left')" class="bg-blue-500 text-white px-3 py-2 rounded">‚¨ÖÔ∏è</button>
                    <button onclick="game.moveMazePlayer('down')" class="bg-blue-500 text-white px-3 py-2 rounded">‚¨áÔ∏è</button>
                    <button onclick="game.moveMazePlayer('right')" class="bg-blue-500 text-white px-3 py-2 rounded">‚û°Ô∏è</button>
                </div>
            </div>
        `;
    }
    
    generateMaze() {
        // –ü—Ä–æ—Å—Ç–æ–π –ª–∞–±–∏—Ä–∏–Ω—Ç 5x5 –≥–¥–µ 1 = —Å—Ç–µ–Ω–∞, 0 = —Å–≤–æ–±–æ–¥–Ω–æ
        const maze = [
            [0, 1, 0, 0, 0],
            [0, 1, 0, 1, 0],
            [0, 0, 0, 1, 0],
            [1, 1, 0, 0, 0],
            [0, 0, 0, 1, 0]
        ];
        return maze;
    }
    
    renderMaze() {
        let html = '';
        for (let y = 0; y < this.mazeSize; y++) {
            for (let x = 0; x < this.mazeSize; x++) {
                const isPlayer = this.playerPos.x === x && this.playerPos.y === y;
                const isExit = this.exitPos.x === x && this.exitPos.y === y;
                const isWall = this.maze[y][x] === 1;
                
                let cellClass = 'w-8 h-8 flex items-center justify-center text-xs border ';
                let content = '';
                
                if (isPlayer) {
                    cellClass += 'bg-green-500 text-white';
                    content = 'üë§';
                } else if (isExit) {
                    cellClass += 'bg-red-500 text-white';
                    content = 'üèÅ';
                } else if (isWall) {
                    cellClass += 'bg-gray-800';
                    content = '';
                } else {
                    cellClass += 'bg-white border-gray-300';
                    content = '';
                }
                
                html += `<div class="${cellClass}">${content}</div>`;
            }
        }
        return html;
    }
    
    moveMazePlayer(direction) {
        let newX = this.playerPos.x;
        let newY = this.playerPos.y;
        
        switch (direction) {
            case 'up':
                newY = Math.max(0, newY - 1);
                break;
            case 'down':
                newY = Math.min(this.mazeSize - 1, newY + 1);
                break;
            case 'left':
                newX = Math.max(0, newX - 1);
                break;
            case 'right':
                newX = Math.min(this.mazeSize - 1, newX + 1);
                break;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å–æ —Å—Ç–µ–Ω–æ–π
        if (this.maze[newY][newX] !== 1) {
            this.playerPos = { x: newX, y: newY };
            
            // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            const mazeGrid = document.getElementById('maze-grid');
            if (mazeGrid) {
                mazeGrid.innerHTML = this.renderMaze();
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –≤—ã—Ö–æ–¥–∞
            if (newX === this.exitPos.x && newY === this.exitPos.y) {
                setTimeout(() => this.completeMiniGame(true), 500);
            }
        }
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–£–∑–æ—Ä" (–ù–û–í–û–ï)
    getPatternGameContent() {
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–∑–æ—Ä –∏–∑ —Ü–≤–µ—Ç–æ–≤
        this.pattern = this.generatePattern();
        this.userPattern = [];
        this.showingPattern = true;
        
        setTimeout(() => {
            this.showingPattern = false;
            this.updatePatternDisplay();
        }, 3000);
        
        return `
            <div class="text-center">
                <p class="mb-2">–ó–∞–ø–æ–º–Ω–∏ –∏ –ø–æ–≤—Ç–æ—Ä–∏ —É–∑–æ—Ä!</p>
                <p id="pattern-instruction" class="mb-4 text-sm text-gray-600">–ó–∞–ø–æ–º–∏–Ω–∞–π...</p>
                <div id="pattern-display" class="grid grid-cols-3 gap-2 mb-4 mx-auto max-w-32">
                    ${this.renderPattern()}
                </div>
                <div id="pattern-buttons" class="grid grid-cols-3 gap-2 mx-auto max-w-32" style="display: none;">
                    ${this.renderPatternButtons()}
                </div>
                <div class="text-xs text-gray-600 mt-2">
                    –ü—Ä–æ–≥—Ä–µ—Å—Å: <span id="pattern-progress">0</span>/${this.pattern.length}
                </div>
            </div>
        `;
    }
    
    generatePattern() {
        const colors = ['red', 'blue', 'green', 'yellow'];
        const pattern = [];
        for (let i = 0; i < 6; i++) {
            pattern.push(colors[Math.floor(Math.random() * colors.length)]);
        }
        return pattern;
    }
    
    renderPattern() {
        return this.pattern.map((color, index) => {
            const bgColor = this.getColorClass(color);
            const isVisible = this.showingPattern || this.userPattern.length > index;
            return `
                <div class="w-8 h-8 rounded border-2 ${isVisible ? bgColor : 'bg-gray-200'} ${
                    this.showingPattern && Math.floor(Date.now() / 500) % 2 === 0 ? 'animate-pulse' : ''
                }"></div>
            `;
        }).join('');
    }
    
    renderPatternButtons() {
        const colors = ['red', 'blue', 'green', 'yellow'];
        return colors.map(color => `
            <button onclick="game.addPatternColor('${color}')" class="w-8 h-8 rounded border-2 ${this.getColorClass(color)} hover:scale-110 transition-transform">
            </button>
        `).join('');
    }
    
    getColorClass(color) {
        const colorMap = {
            red: 'bg-red-500',
            blue: 'bg-blue-500',
            green: 'bg-green-500',
            yellow: 'bg-yellow-500'
        };
        return colorMap[color] || 'bg-gray-500';
    }
    
    updatePatternDisplay() {
        const instruction = document.getElementById('pattern-instruction');
        const patternDisplay = document.getElementById('pattern-display');
        const patternButtons = document.getElementById('pattern-buttons');
        
        if (instruction) instruction.textContent = '–ü–æ–≤—Ç–æ—Ä–∏ —É–∑–æ—Ä:';
        if (patternDisplay) patternDisplay.innerHTML = this.renderPattern();
        if (patternButtons) patternButtons.style.display = 'grid';
    }
    
    addPatternColor(color) {
        if (this.showingPattern) return;
        
        this.userPattern.push(color);
        
        // –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
        const progress = document.getElementById('pattern-progress');
        if (progress) progress.textContent = this.userPattern.length;
        
        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å
        const isCorrect = this.userPattern[this.userPattern.length - 1] === this.pattern[this.userPattern.length - 1];
        
        if (!isCorrect) {
            this.completeMiniGame(false);
            return;
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        this.updatePatternDisplay();
        
        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
        if (this.userPattern.length === this.pattern.length) {
            this.completeMiniGame(true);
        }
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–°–æ—Å—Ç–∞–≤—å —Å–ª–æ–≤–æ" (–ù–û–í–û–ï)
    getWordGameContent() {
        const words = ['–ö–û–¢', '–î–û–ú', '–°–ê–î', '–ú–ò–†', '–°–û–ù', '–õ–ï–°', '–ú–ê–ö', '–õ–£–ö'];
        this.targetWord = words[Math.floor(Math.random() * words.length)];
        this.availableLetters = this.shuffleWord(this.targetWord);
        this.userWord = '';
        
        return `
            <div class="text-center">
                <p class="mb-2">–°–æ—Å—Ç–∞–≤—å —Å–ª–æ–≤–æ –∏–∑ –±—É–∫–≤!</p>
                <p class="mb-4 text-lg font-bold">–¶–µ–ª—å: ${this.targetWord}</p>
                <div class="mb-4">
                    <div class="text-lg font-mono bg-gray-100 p-2 rounded min-h-8">
                        <span id="user-word">${this.userWord || '_'.repeat(this.targetWord.length)}</span>
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-2 mb-4">
                    ${this.availableLetters.map((letter, index) => `
                        <button onclick="game.addLetter('${letter}', ${index})" id="letter-${index}" class="bg-blue-500 hover:bg-blue-600 text-white p-3 rounded font-bold transition-colors">
                            ${letter}
                        </button>
                    `).join('')}
                </div>
                <div class="flex justify-center space-x-2">
                    <button onclick="game.clearWord()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                        üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å
                    </button>
                    <button onclick="game.checkWord()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                        ‚úì –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
                    </button>
                </div>
            </div>
        `;
    }
    
    shuffleWord(word) {
        return word.split('').sort(() => Math.random() - 0.5);
    }
    
    addLetter(letter, index) {
        if (this.userWord.length < this.targetWord.length) {
            this.userWord += letter;
            
            // –°–∫—Ä—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—É—é –±—É–∫–≤—É
            const letterBtn = document.getElementById(`letter-${index}`);
            if (letterBtn) {
                letterBtn.style.display = 'none';
            }
            
            // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ª–æ–≤–∞
            const userWordEl = document.getElementById('user-word');
            if (userWordEl) {
                userWordEl.textContent = this.userWord + '_'.repeat(this.targetWord.length - this.userWord.length);
            }
        }
    }
    
    clearWord() {
        this.userWord = '';
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –±—É–∫–≤—ã
        this.availableLetters.forEach((_, index) => {
            const letterBtn = document.getElementById(`letter-${index}`);
            if (letterBtn) {
                letterBtn.style.display = 'block';
            }
        });
        
        // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        const userWordEl = document.getElementById('user-word');
        if (userWordEl) {
            userWordEl.textContent = '_'.repeat(this.targetWord.length);
        }
    }
    
    checkWord() {
        this.completeMiniGame(this.userWord === this.targetWord);
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–¶–≤–µ—Ç–Ω–∞—è –∏–≥—Ä–∞" (–ù–û–í–û–ï)
    getColorGameContent() {
        const colors = [
            { name: '–ö–†–ê–°–ù–´–ô', color: 'red', textColor: 'blue' },
            { name: '–°–ò–ù–ò–ô', color: 'blue', textColor: 'green' },
            { name: '–ó–ï–õ–ï–ù–´–ô', color: 'green', textColor: 'red' },
            { name: '–ñ–ï–õ–¢–´–ô', color: 'yellow', textColor: 'purple' }
        ];
        
        this.currentColor = colors[Math.floor(Math.random() * colors.length)];
        this.colorOptions = colors.map(c => c.color).sort(() => Math.random() - 0.5);
        
        return `
            <div class="text-center">
                <p class="mb-4">–í—ã–±–µ—Ä–∏ –¶–í–ï–¢ —Ç–µ–∫—Å—Ç–∞, –∞ –Ω–µ —Ç–æ —á—Ç–æ –Ω–∞–ø–∏—Å–∞–Ω–æ!</p>
                <div class="mb-6 p-4 bg-gray-100 rounded-lg">
                    <div class="text-4xl font-bold" style="color: ${this.getActualColor(this.currentColor.textColor)}">
                        ${this.currentColor.name}
                    </div>
                </div>
                <p class="mb-4 text-sm text-gray-600">–ö–∞–∫–æ–≥–æ —Ü–≤–µ—Ç–∞ —Ç–µ–∫—Å—Ç –≤—ã—à–µ?</p>
                <div class="grid grid-cols-2 gap-3">
                    ${this.colorOptions.map(color => `
                        <button onclick="game.selectColor('${color}')" class="p-3 rounded-lg text-white font-bold transition-colors ${this.getColorButtonClass(color)}">
                            ${this.getColorName(color)}
                        </button>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    getActualColor(color) {
        const colorMap = {
            red: '#ef4444',
            blue: '#3b82f6',
            green: '#22c55e',
            yellow: '#eab308',
            purple: '#a855f7'
        };
        return colorMap[color] || '#000000';
    }
    
    getColorButtonClass(color) {
        const classMap = {
            red: 'bg-red-500 hover:bg-red-600',
            blue: 'bg-blue-500 hover:bg-blue-600',
            green: 'bg-green-500 hover:bg-green-600',
            yellow: 'bg-yellow-500 hover:bg-yellow-600'
        };
        return classMap[color] || 'bg-gray-500 hover:bg-gray-600';
    }
    
    getColorName(color) {
        const nameMap = {
            red: '–ö–†–ê–°–ù–´–ô',
            blue: '–°–ò–ù–ò–ô',
            green: '–ó–ï–õ–ï–ù–´–ô',
            yellow: '–ñ–ï–õ–¢–´–ô'
        };
        return nameMap[color] || '–¶–í–ï–¢';
    }
    
    selectColor(selectedColor) {
        this.completeMiniGame(selectedColor === this.currentColor.textColor);
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å" (–ù–û–í–û–ï)
    getSequenceGameContent() {
        const sequences = [
            { seq: [2, 4, 6, 8], next: 10, rule: '—á–µ—Ç–Ω—ã–µ —á–∏—Å–ª–∞' },
            { seq: [1, 3, 5, 7], next: 9, rule: '–Ω–µ—á–µ—Ç–Ω—ã–µ —á–∏—Å–ª–∞' },
            { seq: [1, 4, 7, 10], next: 13, rule: '+3' },
            { seq: [2, 6, 18, 54], next: 162, rule: '√ó3' },
            { seq: [1, 1, 2, 3], next: 5, rule: '–§–∏–±–æ–Ω–∞—á—á–∏' }
        ];
        
        this.currentSequence = sequences[Math.floor(Math.random() * sequences.length)];
        this.sequenceOptions = this.generateSequenceOptions(this.currentSequence.next);
        
        return `
            <div class="text-center">
                <p class="mb-4">–ù–∞–π–¥–∏ —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:</p>
                <div class="mb-6 p-4 bg-gray-100 rounded-lg">
                    <div class="text-2xl font-bold">
                        ${this.currentSequence.seq.join(', ')}, ?
                    </div>
                </div>
                <p class="mb-4 text-sm text-gray-600">–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–ª–µ–¥—É—é—â–∏–º?</p>
                <div class="grid grid-cols-2 gap-3">
                    ${this.sequenceOptions.map(option => `
                        <button onclick="game.selectSequenceNumber(${option})" class="bg-purple-500 hover:bg-purple-600 text-white p-3 rounded-lg font-bold transition-colors">
                            ${option}
                        </button>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    generateSequenceOptions(correctAnswer) {
        const options = new Set([correctAnswer]);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
        while (options.size < 4) {
            const variation = correctAnswer + (Math.random() - 0.5) * 10;
            options.add(Math.round(variation));
        }
        
        return Array.from(options).sort(() => Math.random() - 0.5);
    }
    
    selectSequenceNumber(selectedNumber) {
        this.completeMiniGame(selectedNumber === this.currentSequence.next);
    }
    
    checkLevelUp() {
        const newLevel = Math.floor(this.experience / 100) + 1;
        if (newLevel > this.level) {
            this.level = newLevel;
            this.money += 50;
            this.playHappySound();
            this.showMessage('üéâ –£—Ä–æ–≤–µ–Ω—å –ø–æ–≤—ã—à–µ–Ω! +50 –º–æ–Ω–µ—Ç!');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É–Ω–¥—É–∫–æ–≤ –∑–∞ —É—Ä–æ–≤–Ω–∏
            this.checkChestReward();
        }
    }
    
    checkChestReward() {
        const chestsEarned = Math.floor(this.level / 10);
        const chestsToAdd = chestsEarned - Math.floor(this.lastChestLevel / 10);
        
        if (chestsToAdd > 0) {
            this.chestCount += chestsToAdd;
            this.lastChestLevel = this.level;
            this.showMessage(`üéÅ –ü–æ–ª—É—á–µ–Ω${chestsToAdd > 1 ? '–æ' : ''} ${chestsToAdd} —Å—É–Ω–¥—É–∫${chestsToAdd > 1 ? '–∞' : ''}!`);
            this.saveData();
        }
    }
    
    getChestsTabContent() {
        const availableChests = this.chestCount;
        const chestsFromFriends = Math.floor(this.friendsInvited / 5);
        const totalChests = availableChests + chestsFromFriends;
        
        return `
            <div class="space-y-3">
                <div class="bg-white rounded-lg p-3 shadow">
                    <h3 class="font-bold mb-2 text-purple-800 text-sm">üì¶ –°—É–Ω–¥—É–∫–∏</h3>
                    <div class="text-center mb-4">
                        <div class="text-3xl mb-2">üì¶</div>
                        <p class="text-lg font-bold">–î–æ—Å—Ç—É–ø–Ω–æ —Å—É–Ω–¥—É–∫–æ–≤: ${totalChests}</p>
                        <p class="text-xs text-gray-600">–ó–∞ —É—Ä–æ–≤–Ω–∏: ${availableChests} ‚Ä¢ –ó–∞ –¥—Ä—É–∑–µ–π: ${chestsFromFriends}</p>
                    </div>
                    
                    ${totalChests > 0 ? `
                        <button onclick="game.openChest()" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white py-3 px-4 rounded-lg font-bold transition-colors animate-pulse">
                            üéÅ –û—Ç–∫—Ä—ã—Ç—å —Å—É–Ω–¥—É–∫
                        </button>
                    ` : `
                        <div class="text-center text-gray-500 py-4">
                            <p class="mb-2">üîí –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å—É–Ω–¥—É–∫–æ–≤</p>
                            <p class="text-xs">–ü–æ–ª—É—á–∞–π—Ç–µ —É—Ä–æ–≤–Ω–∏ –∏–ª–∏ –ø—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π!</p>
                        </div>
                    `}
                </div>
                
                <div class="bg-white rounded-lg p-3 shadow">
                    <h3 class="font-bold mb-2 text-purple-800 text-sm">üéØ –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Å—É–Ω–¥—É–∫–∏</h3>
                    <div class="space-y-2 text-xs">
                        <div class="flex justify-between items-center p-2 bg-blue-50 rounded">
                            <span>üìà –ö–∞–∂–¥—ã–µ 10 —É—Ä–æ–≤–Ω–µ–π</span>
                            <span class="font-bold text-blue-600">+1 —Å—É–Ω–¥—É–∫</span>
                        </div>
                        <div class="flex justify-between items-center p-2 bg-green-50 rounded">
                            <span>üë• –ö–∞–∂–¥—ã–µ 5 –¥—Ä—É–∑–µ–π</span>
                            <span class="font-bold text-green-600">+1 —Å—É–Ω–¥—É–∫</span>
                        </div>
                    </div>
                    <div class="mt-3 text-xs text-gray-600">
                        <p>–î–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å—É–Ω–¥—É–∫–∞: ${10 - (this.level % 10)} —É—Ä–æ–≤–Ω–µ–π</p>
                        <p>–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ –¥—Ä—É–∑–µ–π: ${this.friendsInvited}/5</p>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg p-3 shadow">
                    <h3 class="font-bold mb-2 text-purple-800 text-sm">üíé –í–æ–∑–º–æ–∂–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã</h3>
                    <div class="grid grid-cols-1 gap-1 text-xs">
                        ${Object.entries(this.skins).map(([key, skin]) => `
                            <div class="flex items-center justify-between p-2 rounded" style="background-color: ${skin.color}22;">
                                <div class="flex items-center space-x-2">
                                    <span>${this.rarities[skin.rarity].emoji}</span>
                                    <span class="font-medium">${skin.name}</span>
                                    <span class="text-xs" style="color: ${this.rarities[skin.rarity].color};">${this.rarities[skin.rarity].name}</span>
                                </div>
                                <span class="font-bold">${skin.chance}%</span>
                            </div>
                        `).join('')}
                        <div class="flex items-center justify-between p-2 bg-yellow-50 rounded">
                            <div class="flex items-center space-x-2">
                                <span>üí∞</span>
                                <span class="font-medium">100 –º–æ–Ω–µ—Ç</span>
                            </div>
                            <span class="font-bold">90%</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg p-3 shadow">
                    <h3 class="font-bold mb-2 text-purple-800 text-sm">üëó –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å —Å–∫–∏–Ω–æ–≤</h3>
                    <div class="grid grid-cols-2 gap-2 max-h-40 overflow-y-auto">
                        ${this.unlockedSkins.map(skinKey => {
                            const skin = this.skins[skinKey];
                            const isActive = this.currentSkin === skinKey;
                            return `
                                <button onclick="game.selectSkin('${skinKey}')" class="p-2 rounded-lg text-xs transition-colors ${
                                    isActive ? 'bg-green-100 border-2 border-green-500' : 'bg-gray-100 hover:bg-gray-200'
                                }">
                                    <div class="text-center">
                                        <div class="w-12 h-12 mx-auto mb-1 rounded-full flex items-center justify-center text-lg" style="background-color: ${skin.color};">
                                            üê∞
                                        </div>
                                        <div class="font-medium">${skin.name}</div>
                                        <div class="text-xs" style="color: ${this.rarities[skin.rarity].color};">
                                            ${this.rarities[skin.rarity].emoji} ${this.rarities[skin.rarity].name}
                                        </div>
                                        ${isActive ? '<div class="text-green-600 font-bold mt-1">‚úì –ê–∫—Ç–∏–≤–µ–Ω</div>' : ''}
                                    </div>
                                </button>
                            `;
                        }).join('')}
                    </div>
                </div>
            </div>
        `;
    }
    
    openChest() {
        if (this.chestCount <= 0) {
            this.showMessage('‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å—É–Ω–¥—É–∫–æ–≤!');
            return;
        }
        
        this.chestCount--;
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–≥—Ä–∞–¥—É
        const random = Math.random() * 100;
        let reward = null;
        
        // 90% —à–∞–Ω—Å –Ω–∞ –º–æ–Ω–µ—Ç—ã (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ –≤—ã–ø–∞–ª–∏ —Å–∫–∏–Ω—ã)
        if (random <= 90) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–ø–∞–ª –ª–∏ —Å–∫–∏–Ω
            let skinChance = 0;
            let foundSkin = null;
            
            for (const [key, skin] of Object.entries(this.skins)) {
                skinChance += skin.chance;
                if (random <= skinChance) {
                    foundSkin = key;
                    break;
                }
            }
            
            if (foundSkin && !this.unlockedSkins.includes(foundSkin)) {
                // –í—ã–ø–∞–ª –Ω–æ–≤—ã–π —Å–∫–∏–Ω
                reward = { type: 'skin', key: foundSkin, skin: this.skins[foundSkin] };
                this.unlockedSkins.push(foundSkin);
            } else {
                // –í—ã–ø–∞–ª–∏ –º–æ–Ω–µ—Ç—ã
                reward = { type: 'money', amount: 100 };
                this.money += 100;
            }
        } else {
            // –ü—ã—Ç–∞–µ–º—Å—è –¥–∞—Ç—å —Å–∫–∏–Ω
            let cumulativeChance = 0;
            for (const [key, skin] of Object.entries(this.skins)) {
                cumulativeChance += skin.chance;
                if (random <= cumulativeChance) {
                    if (!this.unlockedSkins.includes(key)) {
                        reward = { type: 'skin', key: key, skin: skin };
                        this.unlockedSkins.push(key);
                    } else {
                        reward = { type: 'money', amount: 100 };
                        this.money += 100;
                    }
                    break;
                }
            }
        }
        
        this.playHappySound();
        this.saveData();
        this.updateDisplay();
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        this.showChestResult(reward);
    }
    
    showChestResult(reward) {
        let message = '';
        let className = '';
        
        if (reward.type === 'skin') {
            message = `üéâ –ù–æ–≤—ã–π —Å–∫–∏–Ω: ${reward.skin.name}!`;
            className = 'bg-purple-100 border-purple-500 text-purple-700';
        } else {
            message = `üí∞ –ü–æ–ª—É—á–µ–Ω–æ ${reward.amount} –º–æ–Ω–µ—Ç!`;
            className = 'bg-yellow-100 border-yellow-500 text-yellow-700';
        }
        
        // –°–æ–∑–¥–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
        modal.innerHTML = `
            <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4">
                <div class="text-center">
                    <div class="text-4xl mb-4">üéÅ</div>
                    <h3 class="text-lg font-bold mb-2">–°—É–Ω–¥—É–∫ –æ—Ç–∫—Ä—ã—Ç!</h3>
                    <div class="p-4 rounded-lg mb-4 ${className}">
                        ${message}
                    </div>
                    ${reward.type === 'skin' ? `
                        <div class="mb-4">
                            <div class="w-16 h-16 mx-auto rounded-full flex items-center justify-center text-2xl" style="background-color: ${reward.skin.color};">
                                üê∞
                            </div>
                            <p class="text-sm mt-2" style="color: ${this.rarities[reward.skin.rarity].color};">
                                ${this.rarities[reward.skin.rarity].emoji} ${this.rarities[reward.skin.rarity].name}
                            </p>
                        </div>
                    ` : ''}
                    <button onclick="this.parentElement.parentElement.parentElement.remove()" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-2 rounded-lg font-bold">
                        –û—Ç–ª–∏—á–Ω–æ!
                    </button>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
        setTimeout(() => {
            this.switchTab('chests');
        }, 100);
    }
    
    selectSkin(skinKey) {
        if (this.unlockedSkins.includes(skinKey)) {
            this.currentSkin = skinKey;
            this.saveData();
            this.updateDisplay();
            this.showMessage(`‚ú® –í—ã–±—Ä–∞–Ω —Å–∫–∏–Ω: ${this.skins[skinKey].name}!`);
            this.switchTab('chests');
        } else {
            this.showMessage('‚ùå –°–∫–∏–Ω –Ω–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!');
        }
    }
    
    checkNotifications() {
        if (this.stats.happiness < 50) {
            this.showNotification(`üò¢ ${this.petName}: –ú–Ω–µ —Å–∫—É—á–Ω–æ! –ü–æ–∏–≥—Ä–∞–π —Å–æ –º–Ω–æ–π!`, 'sad');
        }
        if (this.stats.sleep < 50) {
            this.showNotification(`üò¥ ${this.petName}: –Ø —Ö–æ—á—É —Å–ø–∞—Ç—å! –£–ª–æ–∂–∏ –º–µ–Ω—è –≤ –∫—Ä–æ–≤–∞—Ç–∫—É!`, 'sleepy');
        }
        if (this.stats.hunger < 50) {
            this.showNotification(`üçΩÔ∏è ${this.petName}: –Ø –≥–æ–ª–æ–¥–µ–Ω! –ü–æ–∫–æ—Ä–º–∏ –º–µ–Ω—è —á–µ–º-–Ω–∏–±—É–¥—å –≤–∫—É—Å–Ω—ã–º!`, 'hungry');
        }
        if (this.stats.cleanliness < 50) {
            this.showNotification(`üõÅ ${this.petName}: –Ø –≥—Ä—è–∑–Ω—ã–π! –ü–æ–º–æ–π –º–µ–Ω—è, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞!`, 'dirty');
        }
        if (this.stats.health < 50) {
            this.showNotification(`üíä ${this.petName}: –ú–Ω–µ –ø–ª–æ—Ö–æ! –í—ã–ª–µ—á–∏ –º–µ–Ω—è!`, 'sick');
        }
        if (this.stats.energy < 30) {
            this.showNotification(`‚ö° ${this.petName}: –£ –º–µ–Ω—è –º–∞–ª–æ —ç–Ω–µ—Ä–≥–∏–∏! –î–∞–π –º–Ω–µ –æ—Ç–¥–æ—Ö–Ω—É—Ç—å!`, 'tired');
        }
    }
    
    checkEvolution() {
        const currentStage = Object.entries(this.evolutionStages)
            .reverse()
            .find(([_, stage]) => this.age >= stage.minAge)?.[0] || 'baby';
        
        if (currentStage !== this.evolutionStage) {
            this.evolutionStage = currentStage;
            this.playHappySound();
            this.showMessage(`üéâ –≠–≤–æ–ª—é—Ü–∏—è! –¢–µ–ø–µ—Ä—å ${this.evolutionStages[currentStage].name}!`);
        }
    }
    
    startGameLoop() {
        setInterval(() => {
            const now = Date.now();
            const timeDiff = Math.floor((now - this.lastUpdate) / 1000);
            
            // –°—Ç–∞—Ä–µ–Ω–∏–µ: 1 —Ä–µ–∞–ª—å–Ω—ã–π –¥–µ–Ω—å = 1 –¥–µ–Ω—å –ø–∏—Ç–æ–º—Ü–∞ (86400 —Å–µ–∫—É–Ω–¥ = 1 –¥–µ–Ω—å)
            if (timeDiff >= 86400) {
                const daysToAdd = Math.floor(timeDiff / 86400);
                this.age += daysToAdd;
                this.checkEvolution();
                this.lastUpdate = now;
            }
            
            // –°–Ω–∏–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç (300 —Å–µ–∫—É–Ω–¥) - —Ç–µ–ø–µ—Ä—å –ø–∞–¥–∞—é—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ
            if (timeDiff >= 300) {
                if (!this.isSleeping) {
                    this.stats.hunger = Math.max(0, this.stats.hunger - 3);
                    this.stats.happiness = Math.max(0, this.stats.happiness - 2);
                    this.stats.cleanliness = Math.max(0, this.stats.cleanliness - 2);
                    this.stats.health = Math.max(0, this.stats.health - (this.stats.hunger < 20 ? 3 : 1));
                    this.stats.energy = Math.max(0, this.stats.energy - 3);
                    this.stats.sleep = Math.max(0, this.stats.sleep - 3);
                    
                    this.checkNotifications();
                } else {
                    this.stats.energy = Math.min(100, this.stats.energy + 8);
                    this.stats.sleep = Math.min(100, this.stats.sleep + 12);
                }
                
                this.lastUpdate = now;
                this.saveData();
                this.updateDisplay();
            }
        }, 60000); // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
    }
    
    startNotificationTimer() {
        setInterval(() => {
            const now = Date.now();
            const timeSinceLastNotification = now - this.lastNotification;
            
            // 30 –º–∏–Ω—É—Ç = 1800000 –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥
            if (timeSinceLastNotification >= 1800000) {
                this.showNotification(`üí≠ ${this.petName}: –¢—ã –Ω–µ –∑–∞–±—ã–ª –æ–±–æ –º–Ω–µ? –Ø —Å–∫—É—á–∞—é!`, 'reminder');
                this.lastNotification = now;
                localStorage.setItem('shared_labubu_last_notification', now.toString());
            }
        }, 60000); // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
    }
}

// –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
let game;
document.addEventListener('DOMContentLoaded', () => {
    game = new LabubuCareGame();
});
</script>

</body>
</html>

// –î–æ–±–∞–≤—å —ç—Ç–æ—Ç –∫–æ–¥ –≤ —Ñ–∞–π–ª main.js –∏–ª–∏ game.js —Ç–≤–æ–µ–π –∏–≥—Ä—ã Labubu Care

class TelegramSaveSystem {
  constructor() {
    // URL —Ç–≤–æ–µ–≥–æ –±–æ—Ç–∞ –Ω–∞ Heroku (–∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π!)
    this.API_BASE = 'https://—Ç–≤–æ–π-–±–æ—Ç.herokuapp.com/api';
    this.gameUserId = this.generateGameUserId();
    this.isConnected = false;
    this.petName = 'Labubu';
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
    this.loadConnection();
  }

  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID –∏–≥—Ä–æ–∫–∞
  generateGameUserId() {
    const saved = localStorage.getItem('labubu_game_user_id');
    if (saved) return saved;
    
    const newId = 'player_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    localStorage.setItem('labubu_game_user_id', newId);
    return newId;
  }

  // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
  loadConnection() {
    const connected = localStorage.getItem('labubu_telegram_connected');
    const chatId = localStorage.getItem('labubu_chat_id');
    const petName = localStorage.getItem('labubu_pet_name');
    
    if (connected === 'true' && chatId) {
      this.isConnected = true;
      this.chatId = chatId;
      this.petName = petName || 'Labubu';
      console.log('üîó Telegram –ø–æ–¥–∫–ª—é—á–µ–Ω! Chat ID:', chatId);
    }
  }

  // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Telegram
  async connectToTelegram(chatId, petName = 'Labubu') {
    try {
      console.log('üîó –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Telegram...', { chatId, gameUserId: this.gameUserId, petName });
      
      const response = await fetch(`${this.API_BASE}/register`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          chatId: chatId,
          gameUserId: this.gameUserId,
          petName: petName
        })
      });

      const result = await response.json();

      if (result.success) {
        this.isConnected = true;
        this.chatId = chatId;
        this.petName = petName;
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
        localStorage.setItem('labubu_telegram_connected', 'true');
        localStorage.setItem('labubu_chat_id', chatId);
        localStorage.setItem('labubu_pet_name', petName);
        
        console.log('‚úÖ Telegram —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω!');
        return { success: true, message: '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ!' };
      } else {
        console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:', result);
        return { success: false, error: result.error };
      }
    } catch (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ Telegram:', error);
      return { success: false, error: '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º' };
    }
  }

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–∞
  async savePlayerData(playerData) {
    if (!this.isConnected) {
      console.log('üì± Telegram –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ');
      return this.saveToLocalStorage(playerData);
    }

    try {
      console.log('üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä...', playerData);
      
      const dataToSave = {
        gameUserId: this.gameUserId,
        petName: playerData.petName || this.petName,
        stats: {
          hunger: Math.round(playerData.hunger || 100),
          happiness: Math.round(playerData.happiness || 100),
          cleanliness: Math.round(playerData.cleanliness || 100),
          health: Math.round(playerData.health || 100),
          energy: Math.round(playerData.energy || 100),
          sleep: Math.round(playerData.sleep || 100)
        },
        level: playerData.level || 1,
        experience: playerData.experience || 0,
        money: playerData.money || 100,
        age: playerData.age || 0,
        outfit: playerData.outfit || 'default',
        currentSkin: playerData.currentSkin || 'default',
        unlockedSkins: playerData.unlockedSkins || ['default'],
        evolutionStage: playerData.evolutionStage || 'baby',
        chestCount: playerData.chestCount || 0,
        friendsInvited: playerData.friendsInvited || 0,
        lastChestLevel: playerData.lastChestLevel || 0,
        isSleeping: playerData.isSleeping || false
      };

      const response = await fetch(`${this.API_BASE}/update-player`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(dataToSave)
      });

      const result = await response.json();

      if (result.success) {
        console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä!');
        // –¢–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ –∫–∞–∫ –±—ç–∫–∞–ø
        this.saveToLocalStorage(playerData);
        return { success: true };
      } else {
        console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä:', result);
        // –ü—Ä–∏ –æ—à–∏–±–∫–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ö–æ—Ç—è –±—ã –ª–æ–∫–∞–ª—å–Ω–æ
        this.saveToLocalStorage(playerData);
        return { success: false, error: result.error };
      }
    } catch (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏:', error);
      // –ü—Ä–∏ –æ—à–∏–±–∫–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ö–æ—Ç—è –±—ã –ª–æ–∫–∞–ª—å–Ω–æ
      this.saveToLocalStorage(playerData);
      return { success: false, error: '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è' };
    }
  }

  // –£–õ–£–ß–®–ï–ù–ù–ê–Ø –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–∞ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º —Å–µ—Ä–≤–µ—Ä–∞
  async loadPlayerData() {
    console.log('üì• –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–∞...');
    
    // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å —Å–µ—Ä–≤–µ—Ä–∞ (–¥–∞–∂–µ –µ—Å–ª–∏ Telegram –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω)
    try {
      console.log('üåê –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å —Å–µ—Ä–≤–µ—Ä–∞...');
      
      const response = await fetch(`${this.API_BASE}/player/${this.gameUserId}`, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
        }
      });
      
      if (response.ok) {
        const result = await response.json();
        
        if (result.success && result.found && result.stats) {
          console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å —Å–µ—Ä–≤–µ—Ä–∞!');
          console.log('üìä –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', result.stats);
          
          // –í–∞–ª–∏–¥–∏—Ä—É–µ–º –∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ
          const normalizedData = this.normalizePlayerData(result.stats);
          
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ –∫–∞–∫ –±—ç–∫–∞–ø
          this.saveToLocalStorage(normalizedData);
          
          return {
            success: true,
            data: normalizedData,
            source: 'server'
          };
        }
      }
      
      console.log('üìÇ –î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ');
    } catch (error) {
      console.log('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å —Å–µ—Ä–≤–µ—Ä–∞:', error.message);
    }
    
    // –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å —Å —Å–µ—Ä–≤–µ—Ä–∞, –∑–∞–≥—Ä—É–∂–∞–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
    console.log('üíæ –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ localStorage...');
    const localResult = this.loadFromLocalStorage();
    
    if (localResult.success) {
      localResult.source = 'local';
      console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ');
    } else {
      console.log('üìÇ –õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
    }
    
    return localResult;
  }

  // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
  normalizePlayerData(data) {
    // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç–∞—Ä–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –±–µ–∑ –≤–ª–æ–∂–µ–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã stats
    if (data.hunger !== undefined && !data.stats) {
      return {
        petName: data.petName || 'Labubu',
        stats: {
          hunger: data.hunger || 100,
          happiness: data.happiness || 100,
          cleanliness: data.cleanliness || 100,
          health: data.health || 100,
          energy: data.energy || 100,
          sleep: data.sleep || 100
        },
        level: data.level || 1,
        experience: data.experience || 0,
        money: data.money || 100,
        age: data.age || 0,
        outfit: data.outfit || 'default',
        currentSkin: data.currentSkin || 'default',
        unlockedSkins: data.unlockedSkins || ['default'],
        evolutionStage: data.evolutionStage || 'baby',
        chestCount: data.chestCount || 0,
        friendsInvited: data.friendsInvited || 0,
        lastChestLevel: data.lastChestLevel || 0,
        isSleeping: data.isSleeping || false
      };
    }
    
    // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
    return {
      petName: data.petName || 'Labubu',
      stats: data.stats || {
        hunger: 100,
        happiness: 100,
        cleanliness: 100,
        health: 100,
        energy: 100,
        sleep: 100
      },
      level: data.level || 1,
      experience: data.experience || 0,
      money: data.money || 100,
      age: data.age || 0,
      outfit: data.outfit || 'default',
      currentSkin: data.currentSkin || 'default',
      unlockedSkins: data.unlockedSkins || ['default'],
      evolutionStage: data.evolutionStage || 'baby',
      chestCount: data.chestCount || 0,
      friendsInvited: data.friendsInvited || 0,
      lastChestLevel: data.lastChestLevel || 0,
      isSleeping: data.isSleeping || false
    };
  }

  // –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  async sendNotification(message, type = 'reminder') {
    if (!this.isConnected) {
      console.log('üì± Telegram –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ');
      return;
    }

    try {
      const response = await fetch(`${this.API_BASE}/notify`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          gameUserId: this.gameUserId,
          message: message,
          type: type,
          petName: this.petName
        })
      });

      const result = await response.json();
      
      if (result.success) {
        console.log('‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!');
      } else {
        console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:', result);
      }
    } catch (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:', error);
    }
  }

  // –õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (–±—ç–∫–∞–ø)
  saveToLocalStorage(data) {
    try {
      localStorage.setItem('labubu_save_data', JSON.stringify(data));
      console.log('üíæ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ');
      return { success: true };
    } catch (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
      return { success: false, error: '–û—à–∏–±–∫–∞ localStorage' };
    }
  }

  // –õ–æ–∫–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
  loadFromLocalStorage() {
    try {
      const saved = localStorage.getItem('labubu_save_data');
      if (saved) {
        const data = JSON.parse(saved);
        console.log('üìÇ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ');
        return { success: true, data: data };
      } else {
        console.log('üìÇ –õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
        return { success: false, error: '–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö' };
      }
    } catch (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ localStorage:', error);
      return { success: false, error: '–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è localStorage' };
    }
  }

  // –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç Telegram
  disconnect() {
    this.isConnected = false;
    this.chatId = null;
    
    localStorage.removeItem('labubu_telegram_connected');
    localStorage.removeItem('labubu_chat_id');
    localStorage.removeItem('labubu_pet_name');
    
    console.log('üîå Telegram –æ—Ç–∫–ª—é—á–µ–Ω');
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
  getConnectionStatus() {
    return {
      connected: this.isConnected,
      chatId: this.chatId,
      gameUserId: this.gameUserId,
      petName: this.petName
    };
  }
}

// –°–æ–∑–¥–∞–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ —Å–∏—Å—Ç–µ–º—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
window.telegramSave = new TelegramSaveSystem();

// =============================================================================
// –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –í –¢–í–û–Æ –ò–ì–†–£ - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
// =============================================================================

// 1. –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –¥–∞–Ω–Ω—ã—Ö:
async function initializeGame() {
  console.log('üéÆ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã...');
  
  try {
    const loadResult = await window.telegramSave.loadPlayerData();
    
    if (loadResult.success && loadResult.data) {
      const data = loadResult.data;
      console.log('üì• –ó–∞–≥—Ä—É–∂–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ:', data);
      
      // –í–ê–ñ–ù–û: –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–∏–º–µ–Ω—è–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      if (data.stats) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –æ–±—ä–µ–∫—Ç player —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        if (typeof player !== 'undefined') {
          player.hunger = Math.max(0, Math.min(100, data.stats.hunger || 100));
          player.happiness = Math.max(0, Math.min(100, data.stats.happiness || 100));
          player.cleanliness = Math.max(0, Math.min(100, data.stats.cleanliness || 100));
          player.health = Math.max(0, Math.min(100, data.stats.health || 100));
          player.energy = Math.max(0, Math.min(100, data.stats.energy || 100));
          player.sleep = Math.max(0, Math.min(100, data.stats.sleep || 100));
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –µ—Å–ª–∏ –æ–Ω–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
        updateStatsDisplay();
      }
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      if (typeof player !== 'undefined') {
        player.level = Math.max(1, data.level || 1);
        player.experience = Math.max(0, data.experience || 0);
        player.money = Math.max(0, data.money || 100);
        player.age = Math.max(0, data.age || 0);
        player.outfit = data.outfit || 'default';
        player.currentSkin = data.currentSkin || 'default';
        player.unlockedSkins = Array.isArray(data.unlockedSkins) ? data.unlockedSkins : ['default'];
        player.evolutionStage = data.evolutionStage || 'baby';
        player.chestCount = Math.max(0, data.chestCount || 0);
        player.friendsInvited = Math.max(0, data.friendsInvited || 0);
        player.lastChestLevel = Math.max(0, data.lastChestLevel || 0);
        player.isSleeping = Boolean(data.isSleeping);
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–º—è –ø–∏—Ç–æ–º—Ü–∞
        if (data.petName && data.petName !== 'Labubu') {
          player.name = data.petName;
        }
      }
      
      // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –≤–µ—Å—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
      updateAllUI();
      
      console.log('‚úÖ –ò–≥—Ä–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏');
      console.log('üí∞ –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–µ–Ω—å–≥–∏:', data.money);
      console.log('üìä –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å:', data.level);
      
    } else {
      console.log('üÜï –ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—É—é –∏–≥—Ä—É - –¥–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç
      initializeNewGame();
    }
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä—ã:', error);
    // –ü—Ä–∏ –æ—à–∏–±–∫–µ –Ω–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—É—é –∏–≥—Ä—É
    initializeNewGame();
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–æ–≤–æ–π –∏–≥—Ä—ã
function initializeNewGame() {
  console.log('üÜï –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–æ–≤–æ–π –∏–≥—Ä—ã —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏');
  
  if (typeof player !== 'undefined') {
    player.hunger = 100;
    player.happiness = 100;
    player.cleanliness = 100;
    player.health = 100;
    player.energy = 100;
    player.sleep = 100;
    player.level = 1;
    player.experience = 0;
    player.money = 100;
    player.age = 0;
    player.outfit = 'default';
    player.currentSkin = 'default';
    player.unlockedSkins = ['default'];
    player.evolutionStage = 'baby';
    player.chestCount = 0;
    player.friendsInvited = 0;
    player.lastChestLevel = 0;
    player.isSleeping = false;
    player.name = 'Labubu';
  }
  
  updateAllUI();
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
function updateAllUI() {
  // –í—ã–∑—ã–≤–∞–µ–º –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
  if (typeof updateStatsDisplay === 'function') updateStatsDisplay();
  if (typeof updateLevelDisplay === 'function') updateLevelDisplay();
  if (typeof updateMoneyDisplay === 'function') updateMoneyDisplay();
  if (typeof updateAgeDisplay === 'function') updateAgeDisplay();
  if (typeof updatePetAppearance === 'function') updatePetAppearance();
  if (typeof updateOutfitDisplay === 'function') updateOutfitDisplay();
  if (typeof updateChestDisplay === 'function') updateChestDisplay();
  
  // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ DOM —ç–ª–µ–º–µ–Ω—Ç—ã
  try {
    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–µ–Ω—å–≥–∏
    const moneyElements = document.querySelectorAll('[data-money], .money-display, #money, #moneyDisplay');
    moneyElements.forEach(el => {
      if (typeof player !== 'undefined' && player.money !== undefined) {
        el.textContent = player.money;
      }
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å
    const levelElements = document.querySelectorAll('[data-level], .level-display, #level, #levelDisplay');
    levelElements.forEach(el => {
      if (typeof player !== 'undefined' && player.level !== undefined) {
        el.textContent = player.level;
      }
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –æ–ø—ã—Ç
    const expElements = document.querySelectorAll('[data-experience], .exp-display, #experience, #expDisplay');
    expElements.forEach(el => {
      if (typeof player !== 'undefined' && player.experience !== undefined) {
        el.textContent = player.experience;
      }
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –≤–æ–∑—Ä–∞—Å—Ç
    const ageElements = document.querySelectorAll('[data-age], .age-display, #age, #ageDisplay');
    ageElements.forEach(el => {
      if (typeof player !== 'undefined' && player.age !== undefined) {
        el.textContent = player.age;
      }
    });
    
  } catch (error) {
    console.log('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ UI —ç–ª–µ–º–µ–Ω—Ç–æ–≤:', error);
  }
}

// –í–ê–ñ–ù–û: –í—ã–∑—ã–≤–∞—Ç—å initializeGame() –ü–û–°–õ–ï –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ –∏–≥—Ä—ã
// –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ –≤ –∫–æ–Ω–µ—Ü –≤–∞—à–µ–≥–æ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ –∏–≥—Ä—ã:
document.addEventListener('DOMContentLoaded', function() {
  // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
  setTimeout(() => {
    initializeGame();
  }, 100);
});

// –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± - –µ—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å —Å–æ–±—ã—Ç–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∏–≥—Ä—ã
if (typeof window.gameReady !== 'undefined') {
  window.gameReady.then(() => {
    initializeGame();
  });
} else {
  // –ï—Å–ª–∏ –Ω–µ—Ç —Å–æ–±—ã—Ç–∏—è, –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
  window.addEventListener('load', () => {
    setTimeout(initializeGame, 500);
  });
}

// 2. –£–õ–£–ß–®–ï–ù–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏:
async function saveGame() {
  try {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –æ–±—ä–µ–∫—Ç player —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    if (typeof player === 'undefined') {
      console.log('‚ö†Ô∏è –û–±—ä–µ–∫—Ç player –Ω–µ –Ω–∞–π–¥–µ–Ω, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ');
      return;
    }
    
    const playerData = {
      petName: player.name || 'Labubu',
      stats: {
        hunger: Math.max(0, Math.min(100, player.hunger || 100)),
        happiness: Math.max(0, Math.min(100, player.happiness || 100)),
        cleanliness: Math.max(0, Math.min(100, player.cleanliness || 100)),
        health: Math.max(0, Math.min(100, player.health || 100)),
        energy: Math.max(0, Math.min(100, player.energy || 100)),
        sleep: Math.max(0, Math.min(100, player.sleep || 100))
      },
      level: Math.max(1, player.level || 1),
      experience: Math.max(0, player.experience || 0),
      money: Math.max(0, player.money || 0),
      age: Math.max(0, player.age || 0),
      outfit: player.outfit || 'default',
      currentSkin: player.currentSkin || 'default',
      unlockedSkins: Array.isArray(player.unlockedSkins) ? player.unlockedSkins : ['default'],
      evolutionStage: player.evolutionStage || 'baby',
      chestCount: Math.max(0, player.chestCount || 0),
      friendsInvited: Math.max(0, player.friendsInvited || 0),
      lastChestLevel: Math.max(0, player.lastChestLevel || 0),
      isSleeping: Boolean(player.isSleeping),
      lastSave: new Date().toISOString()
    };
    
    console.log('üíæ –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ:', playerData);
    
    const result = await window.telegramSave.savePlayerData(playerData);
    
    if (result.success) {
      console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
    } else {
      console.log('‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', result.error);
    }
    
    return result;
    
  } catch (error) {
    console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏:', error);
    return { success: false, error: error.message };
  }
}

// 3. –£–õ–£–ß–®–ï–ù–ù–û–ï –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç —Å–ø–∞–º–∞:
let lastSaveTime = 0;
const SAVE_COOLDOWN = 5000; // 5 —Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è–º–∏

async function saveGameWithCooldown() {
  const now = Date.now();
  if (now - lastSaveTime < SAVE_COOLDOWN) {
    console.log('‚è≥ –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (–∫—É–ª–¥–∞—É–Ω)');
    return;
  }
  
  lastSaveTime = now;
  return await saveGame();
}

// –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
const autoSaveInterval = setInterval(saveGameWithCooldown, 30000);

// 4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö –∏–≥—Ä—ã:
window.addEventListener('beforeunload', function(e) {
  // –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
  saveGame();
});

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('visibilitychange', function() {
  if (document.hidden) {
    saveGame();
  }
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–¥–ª—è –∫–Ω–æ–ø–∫–∏ –≤ –∏–≥—Ä–µ)
async function forceSave() {
  console.log('üíæ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...');
  const result = await saveGame();
  
  if (result && result.success) {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    if (typeof showNotification === 'function') {
      showNotification('–ò–≥—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!', 'success');
    } else {
      console.log('‚úÖ –ò–≥—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
    }
  } else {
    if (typeof showNotification === 'function') {
      showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!', 'error');
    } else {
      console.log('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!');
    }
  }
  
  return result;
}

// 5. –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Telegram –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∏–≥—Ä—ã:
function showTelegramSettings() {
  const status = window.telegramSave.getConnectionStatus();
  
  if (status.connected) {
    alert(`‚úÖ Telegram –ø–æ–¥–∫–ª—é—á–µ–Ω!\nChat ID: ${status.chatId}\n–ü–∏—Ç–æ–º–µ—Ü: ${status.petName}`);
  } else {
    const chatId = prompt('–í–≤–µ–¥–∏—Ç–µ Chat ID –∏–∑ Telegram –±–æ—Ç–∞:');
    if (chatId) {
      const petName = prompt('–ò–º—è –ø–∏—Ç–æ–º—Ü–∞:', 'Labubu') || 'Labubu';
      
      window.telegramSave.connectToTelegram(chatId, petName).then(result => {
        if (result.success) {
          alert('‚úÖ Telegram —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω!');
        } else {
          alert('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + result.error);
        }
      });
    }
  }
}

// 6. –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏—è—Ö:
function checkAndNotify() {
  if (player.hunger < 30) {
    window.telegramSave.sendNotification(`${player.name}: –Ø –æ—á–µ–Ω—å –≥–æ–ª–æ–¥–µ–Ω! –ü–æ–∫–æ—Ä–º–∏ –º–µ–Ω—è! üçé`, 'hungry');
  }
  if (player.happiness < 30) {
    window.telegramSave.sendNotification(`${player.name}: –ú–Ω–µ —Å–∫—É—á–Ω–æ! –ü–æ–∏–≥—Ä–∞–π —Å–æ –º–Ω–æ–π! üéÆ`, 'sad');
  }
  if (player.energy < 20) {
    window.telegramSave.sendNotification(`${player.name}: –Ø –æ—á–µ–Ω—å —É—Å—Ç–∞–ª! –î–∞–π –º–Ω–µ –æ—Ç–¥–æ—Ö–Ω—É—Ç—å! üò¥`, 'tired');
  }
  if (player.cleanliness < 30) {
    window.telegramSave.sendNotification(`${player.name}: –Ø –≥—Ä—è–∑–Ω—ã–π! –ü–æ–º–æ–π –º–µ–Ω—è! üõÅ`, 'dirty');
  }
  if (player.health < 30) {
    window.telegramSave.sendNotification(`${player.name}: –ú–Ω–µ –ø–ª–æ—Ö–æ! –í—ã–ª–µ—á–∏ –º–µ–Ω—è! üíä`, 'sick');
  }
}

// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã
setInterval(checkAndNotify, 120000);

// 7. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è—Ö:
function onLevelUp(newLevel) {
  window.telegramSave.sendNotification(`üéâ ${player.name} –¥–æ—Å—Ç–∏–≥ ${newLevel} —É—Ä–æ–≤–Ω—è! –ü–æ–∑–¥—Ä–∞–≤–ª—è—é!`, 'levelup');
  saveGame(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
}

function onEvolution(newStage) {
  window.telegramSave.sendNotification(`‚ú® ${player.name} —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–ª –≤ ${newStage}! –£–¥–∏–≤–∏—Ç–µ–ª—å–Ω–æ!`, 'evolution');
  saveGame(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
}

// =============================================================================
// DEBUG –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ü–†–û–í–ï–†–ö–ò –°–û–•–†–ê–ù–ï–ù–ò–Ø
// =============================================================================

// –î–æ–±–∞–≤–ª—è–µ–º debug —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å
window.debugSave = {
  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞
  checkPlayerData() {
    if (typeof player === 'undefined') {
      console.log('‚ùå –û–±—ä–µ–∫—Ç player –Ω–µ –Ω–∞–π–¥–µ–Ω!');
      return;
    }
    
    console.log('üéÆ –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞:', {
      name: player.name,
      hunger: player.hunger,
      happiness: player.happiness,
      cleanliness: player.cleanliness,
      health: player.health,
      energy: player.energy,
      sleep: player.sleep,
      level: player.level,
      experience: player.experience,
      money: player.money,
      age: player.age,
      outfit: player.outfit,
      currentSkin: player.currentSkin,
      unlockedSkins: player.unlockedSkins,
      evolutionStage: player.evolutionStage,
      chestCount: player.chestCount,
      friendsInvited: player.friendsInvited,
      lastChestLevel: player.lastChestLevel,
      isSleeping: player.isSleeping
    });
  },
  
  // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å
  async save() {
    console.log('üîß DEBUG: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...');
    return await forceSave();
  },
  
  // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å
  async load() {
    console.log('üîß DEBUG: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞...');
    return await initializeGame();
  },
  
  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å localStorage
  checkLocalStorage() {
    const saved = localStorage.getItem('labubu_save_data');
    if (saved) {
      console.log('üíæ –î–∞–Ω–Ω—ã–µ –≤ localStorage:', JSON.parse(saved));
    } else {
      console.log('üìÇ –î–∞–Ω–Ω—ã–µ –≤ localStorage –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
    }
  },
  
  // –û—á–∏—Å—Ç–∏—Ç—å localStorage
  clearLocalStorage() {
    localStorage.removeItem('labubu_save_data');
    localStorage.removeItem('labubu_telegram_connected');
    localStorage.removeItem('labubu_chat_id');
    localStorage.removeItem('labubu_pet_name');
    localStorage.removeItem('labubu_game_user_id');
    console.log('üóëÔ∏è localStorage –æ—á–∏—â–µ–Ω');
  },
  
  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
  async checkServer() {
    try {
      const response = await fetch(`${window.telegramSave.API_BASE}/status`);
      const result = await response.json();
      console.log('üåê –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞:', result);
    } catch (error) {
      console.log('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É:', error);
    }
  },
  
  // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–µ–Ω—å–≥–∏
  setTestMoney(amount = 9999) {
    if (typeof player !== 'undefined') {
      player.money = amount;
      updateAllUI();
      console.log(`üí∞ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–µ–Ω—å–≥–∏: ${amount}`);
    }
  }
};

// –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
console.log(`
üîß DEBUG –ö–û–ú–ê–ù–î–´ –î–û–°–¢–£–ü–ù–´:

–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

debugSave.checkPlayerData()     - –ø–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞
debugSave.save()               - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å
debugSave.load()               - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å
debugSave.checkLocalStorage()  - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å localStorage
debugSave.clearLocalStorage()  - –æ—á–∏—Å—Ç–∏—Ç—å localStorage
debugSave.checkServer()        - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
debugSave.setTestMoney(5000)   - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–µ–Ω—å–≥–∏

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–µ–Ω–µ–≥:
1. debugSave.setTestMoney(5000)
2. debugSave.save()
3. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É
4. debugSave.checkPlayerData()
`);

console.log('üîó –°–∏—Å—Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è Telegram –∑–∞–≥—Ä—É–∂–µ–Ω–∞!');
console.log('üéÆ –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è initializeGame()');

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
setTimeout(() => {
  if (typeof player === 'undefined') {
    console.log('‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –û–±—ä–µ–∫—Ç player –Ω–µ –Ω–∞–π–¥–µ–Ω!');
    console.log('üí° –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ initializeGame() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ –∏–≥—Ä—ã');
  } else {
    console.log('‚úÖ –û–±—ä–µ–∫—Ç player –Ω–∞–π–¥–µ–Ω, —Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ');
  }
}, 2000);

