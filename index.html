<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Labubu TBB Game - –ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .notification-enter {
            animation: slideInRight 0.3s ease-out;
        }
        .notification-exit {
            animation: fadeOut 0.3s ease-out;
        }
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        .pet-bounce {
            animation: bounce 2s infinite;
        }
        .pet-sleep {
            animation: pulse 2s infinite;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-pink-100 via-purple-100 to-blue-100 min-h-screen">

<!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
<div id="notifications" class="fixed top-4 right-4 z-50 space-y-2"></div>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–≥—Ä—ã -->
<div class="max-w-lg mx-auto bg-gradient-to-b from-pink-100 to-purple-100 rounded-xl p-4 shadow-lg min-h-screen">
    
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –ø–æ–≥–æ–¥–æ–π –∏ –≤—Ä–µ–º–µ–Ω–µ–º -->
    <div class="text-center mb-4">
        <div class="flex justify-between items-center mb-2">
            <div class="text-sm" id="timeOfDay">‚òÄÔ∏è</div>
            <div class="text-center">
                <h1 class="text-xl font-bold text-purple-800">üê∞ <span id="petNameDisplay">Labubu</span> Care</h1>
                <div id="nameEditSection" class="hidden mt-2">
                    <input type="text" id="nameInput" class="text-sm px-2 py-1 border rounded" maxlength="15">
                    <div class="mt-1">
                        <button id="saveNameBtn" class="text-xs bg-blue-500 text-white px-2 py-1 rounded mr-1">‚úì</button>
                        <button id="cancelNameBtn" class="text-xs bg-gray-500 text-white px-2 py-1 rounded">‚úï</button>
                    </div>
                </div>
                <button id="editNameBtn" class="text-xs text-purple-600 hover:text-purple-800 mt-1">‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è</button>
            </div>
            <div class="text-sm" id="weather">‚òÄÔ∏è</div>
        </div>
        <div class="flex justify-between text-xs">
            <span id="levelDisplay">Lv.1</span>
            <span id="moneyDisplay">üí∞100</span>
            <span id="expDisplay">‚≠ê0/100</span>
            <span id="ageDisplay">üéÇ0–¥</span>
            <button id="soundToggle" class="text-xs">üîä</button>
        </div>
        <div id="collaboratorsInfo" class="text-xs text-purple-600 mt-1 hidden"></div>
    </div>

    <!-- –ü–µ—Ä—Å–æ–Ω–∞–∂ Labubu -->
    <div class="text-center mb-4 bg-white rounded-lg p-6 shadow">
        <div class="mb-4 relative inline-block">
            <img id="petImage" src="https://i.pinimg.com/474x/49/b9/bc/49b9bc9d7961d675e91a963b192c16a9.jpg" alt="Labubu" class="w-32 h-32 mx-auto object-contain">
            
            <!-- –û–¥–µ–∂–¥–∞ -->
            <div class="absolute inset-0" id="outfitContainer"></div>
            
            <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã -->
            <div id="sleepIndicator" class="absolute -top-2 -right-2 text-lg animate-pulse hidden">üí§</div>
            <div id="moodIndicator" class="absolute -top-1 -left-1 text-sm"></div>
            <div id="criticalIndicator" class="absolute inset-0 bg-red-500 bg-opacity-20 rounded-full animate-pulse hidden"></div>
        </div>
        
        <div class="text-2xl mb-2" id="moodEmoji">üòä</div>
        <div class="text-sm text-gray-600 font-medium" id="moodStatus">–°—á–∞—Å—Ç–ª–∏–≤</div>
        <div class="text-xs text-purple-600 mt-1" id="evolutionStage">–ú–∞–ª—ã—à</div>
        <div id="currentOutfit" class="text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded-full mt-2 inline-block hidden"></div>
        <div class="text-xs text-gray-500 mt-1">üéÇ –í–æ–∑—Ä–∞—Å—Ç: <span id="ageText">0</span> –¥–Ω–µ–π</div>
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
    <div id="gameMessage" class="bg-yellow-100 border border-yellow-400 text-yellow-700 px-3 py-2 rounded mb-3 text-center text-xs hidden"></div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
    <div class="mb-4 bg-white rounded-lg p-3 shadow">
        <div id="statsContainer"></div>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∏ -->
    <div class="flex mb-3 bg-white rounded-lg p-1 shadow text-xs">
        <button class="tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors bg-purple-500 text-white" data-tab="care">üîß –£—Ö–æ–¥</button>
        <button class="tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors text-purple-500 hover:bg-purple-50" data-tab="games">üéÆ –ò–≥—Ä—ã</button>
        <button class="tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors text-purple-500 hover:bg-purple-50" data-tab="shop">üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω</button>
        <button class="tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors text-purple-500 hover:bg-purple-50" data-tab="chests">üì¶ –°—É–Ω–¥—É–∫–∏</button>
        <button class="tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors text-purple-500 hover:bg-purple-50" data-tab="pets">üê∞ –ü–∏—Ç–æ–º—Ü—ã</button>
        <button class="tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors text-purple-500 hover:bg-purple-50" data-tab="info">‚ÑπÔ∏è –ò–Ω—Ñ–æ</button>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ -->
    <div id="tabContent"></div>
</div>

<!-- –ú–æ–¥–∞–ª –º–∏–Ω–∏-–∏–≥—Ä—ã -->
<div id="miniGameModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4 max-h-96 overflow-y-auto">
        <h3 id="gameTitle" class="text-lg font-bold mb-4"></h3>
        <div id="gameContent"></div>
        <button id="cancelGameBtn" class="mt-4 bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded w-full transition-colors">–û—Ç–º–µ–Ω–∞</button>
    </div>
</div>

<script>
class LabubuCareGame {
    constructor() {
        // –í–ê–ñ–ù–û: –°–Ω–∞—á–∞–ª–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º gameUserId
        this.gameUserId = this.generateUserId();
        console.log('üÜî –°–æ–∑–¥–∞–Ω gameUserId:', this.gameUserId);
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–≤–æ–π—Å—Ç–≤ –¥–æ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        this.stats = {
            hunger: 100, happiness: 100, cleanliness: 100,
            health: 100, energy: 100, sleep: 100
        };
        this.evolutionStages = {
            baby: { name: '–ú–∞–ª—ã—à', minAge: 0 },
            child: { name: '–†–µ–±–µ–Ω–æ–∫', minAge: 3 },
            teen: { name: '–ü–æ–¥—Ä–æ—Å—Ç–æ–∫', minAge: 10 },
            adult: { name: '–í–∑—Ä–æ—Å–ª—ã–π', minAge: 20 },
            elder: { name: '–ú—É–¥—Ä–µ—Ü', minAge: 40 }
        };
        this.skins = {
            default: { 
                name: '–ë–∞–∑–æ–≤—ã–π –õ–∞–±—É–±—É', 
                rarity: 'common', 
                chance: 50, 
                image: 'https://i.ebayimg.com/images/g/yVoAAOSwiqJnxCvP/s-l1600.jpg',
                color: '#DEB887'
            }
        };
        this.outfits = {
            default: { name: '–û–±—ã—á–Ω–∞—è –æ–¥–µ–∂–¥–∞', price: 0, emoji: 'üëï', description: '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Å—Ç–∏–ª—å' }
        };
        this.currentSkin = 'default';
        this.outfit = 'default';
        this.evolutionStage = 'baby';
        this.petName = 'Labubu';
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∞—Å—Å–∏–≤–æ–≤ –¥–æ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        this.food = [
            { name: '–ü–µ—á–µ–Ω—å–µ', hunger: 20, price: 20, emoji: 'üç™', happiness: 5 },
            { name: '–§—Ä—É–∫—Ç—ã', hunger: 30, price: 35, emoji: 'üçé', health: 5 },
            { name: '–°—É—à–∏', hunger: 50, price: 65, emoji: 'üç£', happiness: 10 },
            { name: '–¢–æ—Ä—Ç', hunger: 40, happiness: 15, price: 75, emoji: 'üç∞' },
            { name: '–ú–æ—Ä–æ–∂–µ–Ω–æ–µ', hunger: 25, happiness: 20, price: 45, emoji: 'üç¶' },
            { name: '–ü–∏—Ü—Ü–∞', hunger: 60, price: 80, emoji: 'üçï', happiness: 10 },
            { name: '–í–∏—Ç–∞–º–∏–Ω—ã', health: 30, price: 95, emoji: 'üíä' },
            { name: '–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫', energy: 40, price: 55, emoji: '‚ö°' },
            { name: '–ë—É—Ä–≥–µ—Ä', hunger: 45, price: 50, emoji: 'üçî', happiness: 8 },
            { name: '–†—ã–±–∞', hunger: 35, health: 10, price: 45, emoji: 'üêü' },
            { name: '–°–∞–ª–∞—Ç', health: 15, cleanliness: 10, price: 40, emoji: 'ü•ó' },
            { name: '–ú–æ–ª–æ–∫–æ', hunger: 15, health: 8, price: 25, emoji: 'ü•õ' }
        ];
        
        this.miniGames = [
            { id: 'memory', name: '–ú–µ–º–æ—Ä–∏', emoji: 'üß†', description: '–ó–∞–ø–æ–º–Ω–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å', reward: { happiness: 25, experience: 20, money: 15 } },
            { id: 'reaction', name: '–†–µ–∞–∫—Ü–∏—è', emoji: '‚ö°', description: '–ù–∞–∂–º–∏ –∫–æ–≥–¥–∞ –ø–æ—è–≤–∏—Ç—Å—è —Å–∏–≥–Ω–∞–ª', reward: { happiness: 20, experience: 15, money: 10 } },
            { id: 'math', name: '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', emoji: 'üî¢', description: '–†–µ—à–∏ –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä', reward: { happiness: 30, experience: 25, money: 20 } },
            { id: 'puzzle', name: '–ü–∞–∑–ª', emoji: 'üß©', description: '–°–æ–±–µ—Ä–∏ —á–∏—Å–ª–∞ –ø–æ –ø–æ—Ä—è–¥–∫—É', reward: { happiness: 35, experience: 30, money: 25 } },
            { id: 'quiz', name: '–í–∏–∫—Ç–æ—Ä–∏–Ω–∞', emoji: 'ü§î', description: '–û—Ç–≤–µ—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å', reward: { happiness: 28, experience: 22, money: 18 } },
            { id: 'rhythm', name: '–†–∏—Ç–º', emoji: 'üéµ', description: '–ü–æ–≤—Ç–æ—Ä–∏ —Ä–∏—Ç–º', reward: { happiness: 40, experience: 25, money: 20 } },
            { id: 'treasure', name: '–ö–ª–∞–¥', emoji: 'üíé', description: '–ù–∞–π–¥–∏ —Å–æ–∫—Ä–æ–≤–∏—â–µ', reward: { happiness: 20, experience: 15, money: 35 } },
            { id: 'balance', name: '–ë–∞–ª–∞–Ω—Å', emoji: '‚öñÔ∏è', description: '–£–¥–µ—Ä–∂–∏ —Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ', reward: { happiness: 25, experience: 20, money: 15 } },
            { id: 'matching', name: '–ù–∞–π–¥–∏ –ø–∞—Ä—É', emoji: 'üÉè', description: '–ù–∞–π–¥–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏', reward: { happiness: 30, experience: 25, money: 22 } },
            { id: 'simon', name: '–°–∞–π–º–æ–Ω –≥–æ–≤–æ—Ä–∏—Ç', emoji: 'üéØ', description: '–ü–æ–≤—Ç–æ—Ä–∏ –∫–æ–º–∞–Ω–¥—ã –°–∞–π–º–æ–Ω–∞', reward: { happiness: 32, experience: 28, money: 25 } },
            { id: 'word', name: '–°–æ—Å—Ç–∞–≤—å —Å–ª–æ–≤–æ', emoji: 'üìù', description: '–°–æ—Å—Ç–∞–≤—å —Å–ª–æ–≤–æ –∏–∑ –±—É–∫–≤', reward: { happiness: 35, experience: 30, money: 28 } },
            { id: 'color', name: '–¶–≤–µ—Ç–Ω–∞—è –∏–≥—Ä–∞', emoji: 'üåà', description: '–£–≥–∞–¥–∞–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ü–≤–µ—Ç', reward: { happiness: 28, experience: 22, money: 18 } },
            { id: 'sequence', name: '–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å', emoji: 'üî§', description: '–ù–∞–π–¥–∏ —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç', reward: { happiness: 33, experience: 27, money: 24 } },
            { id: 'target', name: '–ü–æ–ø–∞–¥–∏ –≤ —Ü–µ–ª—å', emoji: 'üéØ', description: '–ü–æ–ø–∞–¥–∏ –≤ –¥–≤–∏–∂—É—â—É—é—Å—è –º–∏—à–µ–Ω—å', reward: { happiness: 30, experience: 25, money: 20 } },
            { id: 'catch', name: '–ü–æ–π–º–∞–π –ø—Ä–µ–¥–º–µ—Ç', emoji: 'ü™£', description: '–ü–æ–π–º–∞–π –ø–∞–¥–∞—é—â–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã', reward: { happiness: 35, experience: 28, money: 26 } },
            { id: 'maze', name: '–õ–∞–±–∏—Ä–∏–Ω—Ç', emoji: 'üåÄ', description: '–ù–∞–π–¥–∏ –≤—ã—Ö–æ–¥ –∏–∑ –ª–∞–±–∏—Ä–∏–Ω—Ç–∞', reward: { happiness: 40, experience: 35, money: 30 } },
            { id: 'code', name: '–í–∑–ª–æ–º–∞–π –∫–æ–¥', emoji: 'üîê', description: '–£–≥–∞–¥–∞–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥', reward: { happiness: 38, experience: 32, money: 28 } },
            { id: 'stack', name: '–°–æ–±–µ—Ä–∏ –±–∞—à–Ω—é', emoji: 'üèóÔ∏è', description: '–ü–æ—Å—Ç—Ä–æ–π –≤—ã—Å–æ–∫—É—é –±–∞—à–Ω—é', reward: { happiness: 36, experience: 30, money: 25 } },
            { id: 'speed', name: '–°–∫–æ—Ä–æ—Å—Ç—å', emoji: 'üí®', description: '–ù–∞–∂–º–∏ –∫–∞–∫ –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–µ–µ', reward: { happiness: 25, experience: 20, money: 15 } },
            { id: 'pattern', name: '–£–∑–æ—Ä', emoji: 'üé®', description: '–ü–æ–≤—Ç–æ—Ä–∏ —É–∑–æ—Ä', reward: { happiness: 34, experience: 28, money: 23 } }
        ];
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
        this.initializeData();
        
        // –ó–≤—É–∫–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
        this.audioContext = null;
        this.soundEnabled = this.loadData('sound_enabled', true, 'boolean');
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        this.activeTab = 'care';
        this.currentMiniGame = null;
        this.notifications = [];
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–∑—Ä–∞—Å—Ç –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        this.checkEvolution();
        
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
        setTimeout(() => {
            this.updateDisplay();
            this.debugSaveSystem();
        }, 50);
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        this.init();
        this.startGameLoop();
        this.startNotificationTimer();
        
        // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        this.startAutoSave();
        
        // –ï—â–µ –æ–¥–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
        setTimeout(() => {
            this.updateDisplay();
            console.log('üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ');
        }, 1000);
    }
    
    async initializeData() {
        console.log('üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä—ã...');
        
        try {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º gameUserId
        const existingUserId = localStorage.getItem('game_user_id');
        if (existingUserId) {
            this.gameUserId = existingUserId;
        } else {
            this.gameUserId = this.generateUserId();
            localStorage.setItem('game_user_id', this.gameUserId);
        }
        console.log('üÜî –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è gameUserId:', this.gameUserId);
            this.telegramConnected = this.loadData('telegram_connected', false, 'boolean');
            this.telegramChatId = this.loadData('telegram_chat_id', '', 'string');
            
            console.log('üíæ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...');
            
            // –°–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ –ë–î
            const loadedFromDB = await this.loadFromDatabaseSync();
            
            if (loadedFromDB) {
                console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö');
            } else {
                console.log('üì± –ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ localStorage –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤...');
                
                // –ï—Å–ª–∏ –ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ localStorage –¥–ª—è –≠–¢–û–ì–û –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                this.stats = this.loadData('labubu_stats', {
                    hunger: 100, happiness: 100, cleanliness: 100,
                    health: 100, energy: 100, sleep: 100
                });
                
                this.money = this.loadData('labubu_money', 100, 'number');
                this.outfit = this.loadData('labubu_outfit', 'default', 'string');
                this.ownedOutfits = this.loadData('owned_outfits', ['default']);
                this.lastStatDecay = this.loadData('last_stat_decay', Date.now(), 'number');
                this.level = this.loadData('labubu_level', 1, 'number');
                this.experience = this.loadData('labubu_experience', 0, 'number');
                this.age = this.loadData('labubu_age', 0, 'number');
                this.evolutionStage = this.loadData('labubu_evolution', 'baby', 'string');
                this.lastUpdate = this.loadData('labubu_last_update', Date.now(), 'number');
                this.lastNotification = this.loadData('labubu_last_notification', Date.now(), 'number');
                this.petName = this.loadData('pet_name', 'Labubu', 'string');
                this.isSleeping = this.loadData('labubu_sleeping', false, 'boolean');
                this.currentSkin = this.loadData('current_skin', 'default', 'string');
                this.unlockedSkins = this.loadData('unlocked_skins', ['default']);
                this.chestCount = this.loadData('chest_count', 0, 'number');
                this.friendsInvited = this.loadData('friends_invited', 0, 'number');
                this.lastChestLevel = this.loadData('last_chest_level', 0, 'number');
                
                console.log('‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑-–∑–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ë–î');
            }
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–∏—Ç–æ–º—Ü–µ–≤ (–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
            this.pets = this.loadData('labubu_pets', [
                { 
                    id: 'pet1', 
                    name: this.petName, 
                    stats: this.stats, 
                    outfit: this.outfit, 
                    age: this.age, 
                    evolutionStage: this.evolutionStage,
                    currentSkin: this.currentSkin
                }
            ]);
            this.activePetId = this.loadData('active_pet_id', 'pet1', 'string');
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            this.validateGameData();
            
            console.log('‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö:', error);
            this.resetToDefaults();
        }
        
        // –°–∫–∏–Ω—ã –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π —Å —Ä–µ–¥–∫–æ—Å—Ç—è–º–∏ –∏ —à–∞–Ω—Å–∞–º–∏
        this.skins = {
            default: { 
                name: '–ë–∞–∑–æ–≤—ã–π –õ–∞–±—É–±—É', 
                rarity: 'common', 
                chance: 50, 
                image: 'https://i.ebayimg.com/images/g/yVoAAOSwiqJnxCvP/s-l1600.jpg',
                color: '#DEB887'
            },
            pink: { 
                name: '–†–æ–∑–æ–≤—ã–π –õ–∞–±—É–±—É', 
                rarity: 'rare', 
                chance: 27, 
                image: 'https://i.postimg.cc/8s8qs9Sv/photo-2025-06-29-05-15-51.jpg',
                color: '#FFB6C1'
            },
            orange: { 
                name: '–û—Ä–∞–Ω–∂–µ–≤—ã–π –õ–∞–±—É–±—É', 
                rarity: 'rare', 
                chance: 26.5, 
                image: 'https://i.postimg.cc/C5n3hYWY/photo-2025-06-29-05-16-06.jpg',
                color: '#FFA500'
            },
            blue: { 
                name: '–ì–æ–ª—É–±–æ–π –õ–∞–±—É–±—É', 
                rarity: 'rare', 
                chance: 25, 
                image: 'https://i.postimg.cc/QNBC97DN/photo-2025-06-29-05-16-17.jpg',
                color: '#87CEEB'
            },
            rainbow: { 
                name: '–†–∞–¥—É–∂–Ω—ã–π –õ–∞–±—É–±—É', 
                rarity: 'legendary', 
                chance: 9, 
                image: 'https://i.postimg.cc/SQwsW-KQ6/photo-2025-06-29-05-16-29.jpg',
                color: '#FF69B4'
            },
            golden: { 
                name: '–ó–æ–ª–æ—Ç–æ–π –õ–∞–±—É–±—É', 
                rarity: 'mythic', 
                chance: 1, 
                image: 'https://i.postimg.cc/wTLBFd3S/photo-2025-06-29-05-16-38.jpg',
                color: '#FFD700'
            }
        };

        // –†–µ–¥–∫–æ—Å—Ç–∏
        this.rarities = {
            common: { name: '–û–±—ã—á–Ω–∞—è', color: '#888888', emoji: '‚ö™' },
            rare: { name: '–†–µ–¥–∫–∞—è', color: '#4A90E2', emoji: 'üîµ' },
            legendary: { name: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è', color: '#FF6B35', emoji: 'üü†' },
            mythic: { name: '–ú–∏—Ñ–∏—á–µ—Å–∫–∞—è', color: '#FFD700', emoji: 'üü°' }
        };

        // –≠–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–µ —Å—Ç–∞–¥–∏–∏
        this.evolutionStages = {
            baby: { name: '–ú–∞–ª—ã—à', minAge: 0 },
            child: { name: '–†–µ–±–µ–Ω–æ–∫', minAge: 3 },
            teen: { name: '–ü–æ–¥—Ä–æ—Å—Ç–æ–∫', minAge: 10 },
            adult: { name: '–í–∑—Ä–æ—Å–ª—ã–π', minAge: 20 },
            elder: { name: '–ú—É–¥—Ä–µ—Ü', minAge: 40 }
        };
        
        // –û–¥–µ–∂–¥–∞ —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ (–æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é —Ü–µ–Ω)
        this.outfits = {
            default: { name: '–û–±—ã—á–Ω–∞—è –æ–¥–µ–∂–¥–∞', price: 0, emoji: 'üëï', description: '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Å—Ç–∏–ª—å' },
            cool: { name: '–ö—Ä—É—Ç—ã–µ –æ—á–∫–∏', price: 250, emoji: 'üòé', description: '–°—Ç–∏–ª—å–Ω—ã–µ —Å–æ–ª–Ω—Ü–µ–∑–∞—â–∏—Ç–Ω—ã–µ –æ—á–∫–∏', image: 'https://via.placeholder.com/80x40/000000/ffffff?text=üï∂Ô∏è' },
            cute: { name: '–ú–∏–ª–∞—è —à–∞–ø–æ—á–∫–∞-–∑–∞–π—á–∏–∫', price: 300, emoji: 'üê∞', description: '–û—á–∞—Ä–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –±–µ–ª–∞—è —à–∞–ø–æ—á–∫–∞ —Å —Ä–æ–∑–æ–≤—ã–º–∏ —É—à–∫–∞–º–∏', image: 'https://via.placeholder.com/100x80/ffb6c1/ffffff?text=üëí' },
            artist: { name: '–•—É–¥–æ–∂–Ω–∏–∫', price: 380, emoji: 'üé®', description: '–ë–µ—Ä–µ—Ç –∏ –ø–∞–ª–∏—Ç—Ä–∞ —Ö—É–¥–æ–∂–Ω–∏–∫–∞' },
            summer: { name: '–õ–µ—Ç–Ω—è—è –ø–∞–Ω–∞–º–∞', price: 500, emoji: 'üëí', description: '–ó–∞—â–∏—Ç–∞ –æ—Ç —Å–æ–ª–Ω—Ü–∞ –≤ –∂–∞—Ä–∫–∏–µ –¥–Ω–∏', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KQgNY3oPaKq-vJXjqtKJhwoKBgt5rHdjiTq7FSl987ybzI3bnqyqEZliWC6n1k_YWtItJfQNjLu5ZcOheY9IUSTB5eoHuGKqoBu3HtCCn0pcimU1FsxfZKjdZ6dW-gMU6qVKPPAfeTa9-dgIn97icgGJyx5N3s-FwgRq5B525IWj_oNWw=s1024' },
            pirate: { name: '–ü–∏—Ä–∞—Ç—Å–∫–∏–π –∫–æ—Å—Ç—é–º', price: 500, emoji: 'üè¥‚Äç‚ò†Ô∏è', description: '–§–ª–∞–≥ –∏ –ø–æ–≤—è–∑–∫–∞ –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ –º–æ—Ä—Å–∫–æ–≥–æ —Ä–∞–∑–±–æ–π–Ω–∏–∫–∞', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KTqA1YhFzadswfIqFeTFATGNWcVmql50yfSGR14sxF3P_7fA51t61z9O_ElOyuBffWnyEP4uFz70PvgU0UFiXiYv83KqIeQr45k0r4FdFhb0yqWCa2ULVO0DPUanQNk8B4ROzTQGmHwO6-p5dkt8uD0yfrk6P7_DOd7jvVYx27V56CjLg=s1024' },
            formal: { name: '–î–µ–ª–æ–≤–æ–π –∫–æ—Å—Ç—é–º', price: 1500, emoji: 'ü§µ', description: '–≠–ª–µ–≥–∞–Ω—Ç–Ω—ã–π —á–µ—Ä–Ω—ã–π –∫–æ—Å—Ç—é–º —Å –≥–∞–ª—Å—Ç—É–∫–æ–º', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KSeqdykkIdnGZHfOH14tCALa06aMF9P6d9Sw0rm7WeTi1NR-nW-0C4x231qu8Zts6k-Jnxg16chpirg1zJFbt7wjgHf3Wo6DQYdth3uXsQeeM8B0bdfsfoxXMLCwUHjQ4JgzFxFqRApcbPf5MYgsGj5pORBo_pAj1K0LHVhXMX6xMSEQQ=s1024' },
            winter: { name: '–ó–∏–º–Ω—è—è –∫—É—Ä—Ç–∫–∞', price: 2000, emoji: 'üß•', description: '–¢–µ–ø–ª–∞—è –∫—É—Ä—Ç–∫–∞ –¥–ª—è —Ö–æ–ª–æ–¥–Ω–æ–π –ø–æ–≥–æ–¥—ã', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KTxCEBZrsAcaOt8mt4LjcLthFQZ2lhlrIZTcwekzMR3ODS-7V-y_m7c-_yFdPd-hCb9i08p3fW0vCajAEdJkip67TQJw0rsP09l5c49ZyG_rBEsv2io9mW2msQJsli2hr7kv2kRopjHwdbN8hVyDVCoX7yBTzkkXxygobNfvPx1uqTp=s1024' },
            school: { name: '–®–∫–æ–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞', price: 3000, emoji: 'üéí', description: '–ê–∫–∫—É—Ä–∞—Ç–Ω–∞—è —à–∫–æ–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞ —Å —Ä—é–∫–∑–∞—á–∫–æ–º', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KSzueH3-hMtM7lA2WveRFgZV9iCXa0D5N9Z8Vw9AAR_mLgCyE6zTrqu6BABMCTH80UkFmp-vmBh0Cr7ZlDw7Lq-UttAyk21eli4s9rRagGFYjxeQESpOyAQXL9CSCPtGawNsaBfta6Wa_g7pku3LgMzEv6SzWSYs1UzxoJ9tJcQV2pr=s1024' },
            knight: { name: '–†—ã—Ü–∞—Ä—å', price: 3000, emoji: '‚öîÔ∏è', description: '–î–æ—Å–ø–µ—Ö–∏ –∏ –º–µ—á —Ö—Ä–∞–±—Ä–æ–≥–æ —Ä—ã—Ü–∞—Ä—è', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KQEyf89ZUfFdb4fEyslGacR2ovpuyvcMZ-2bBZNsjz6M3GboPgvXfVYSnJAarf5-kmyKBphmBLdZL63T4JlUTb1-IdxnLTjNTC-vMkNoj4heCd7LVeQWQ-47m5g-cOgDo75-3eLrKC9roxWbeHbtAgRJl3tRgA2jd0FBOXi-GqZqV3J3w=s1024' },
            chef: { name: '–ö–æ—Å—Ç—é–º –ø–æ–≤–∞—Ä–∞', price: 4000, emoji: 'üë®‚Äçüç≥', description: '–ë–µ–ª—ã–π –∫–æ–ª–ø–∞–∫ –∏ —Ñ–∞—Ä—Ç—É–∫ —à–µ—Ñ-–ø–æ–≤–∞—Ä–∞', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KRAnLRL68CsnxJmlEhhul-fAzzg0wyNCnUd_IYARXgWj1m9mDqKeOVJy4e59Fwpz86mPm43o5IjyKxS7wEXPHVh626clvIWqEVAtrmmm7dgL-XopAKZ1YRujxo4ZBJbMjiSJ_sD2FwU1_nthVxma-b1Uut01G8839lnChFiagdPIsqjkQ=s1024' },
            superhero: { name: '–°—É–ø–µ—Ä–≥–µ—Ä–æ–π', price: 4500, emoji: 'ü¶∏', description: '–ü–ª–∞—â –∏ –º–∞—Å–∫–∞ –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ –≥–µ—Ä–æ—è', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KT-a_UoSupy-qHI_hWHRFiSG1i_9VeWgkZDicgclAVN_VHcGZy0oMTtQYzI_LivmJS7w_MM0PIslsYPPhSgwIZhQwdIq3eYkAhKxtNxtx0NKEjmucGdKxLetlYZZC6sZwoJxMBOhGyL49rjiF4ZKnSGBqavOq6EaxZUhYYBekqKFgZu=s1024' },
            doctor: { name: '–î–æ–∫—Ç–æ—Ä', price: 4800, emoji: 'üë®‚Äç‚öïÔ∏è', description: '–ë–µ–ª—ã–π —Ö–∞–ª–∞—Ç –∏ —Å—Ç–µ—Ç–æ—Å–∫–æ–ø', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KSVy9I1VlEurY9loVBGFCv5A7ydPo1u5iMtuyVSql4t4SATcmjUsn8deyd1wVd7B_Eb1RXkb0ig_Wok-qf6tE3RFjxrfzOSB8wYvL03UOJ4A6By6BQv0M6IEWZ0XOX9vL0VP_1kgkxg5iZhnR_GIxm38rrIJPTUHFnhrPrU-njScGl1dg=s1024' },
            ninja: { name: '–ö–æ—Å—Ç—é–º –Ω–∏–Ω–¥–∑—è', price: 5000, emoji: 'ü•∑', description: '–°–µ–∫—Ä–µ—Ç–Ω–∞—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –¥–ª—è —Å–∫—Ä—ã—Ç–Ω–æ—Å—Ç–∏', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KRshrrG8dFl75oR5qhzwIbpryxVJm5O8JyV17jwiybRyM2y5uotp52ANgD0AdevW_ZcWb1LrrMsdUeTHBUJ-tn8UZgA4BsRc7AI5CLstqTPYm9Ndb0eJRZhN1hfeUhRms8DP6LO2kKSPkZHSwEPYOFK2kBWm7-mmKALA7w8iWua8rTh=s1024' },
            detective: { name: '–î–µ—Ç–µ–∫—Ç–∏–≤', price: 5000, emoji: 'üïµÔ∏è', description: '–ü–ª–∞—â –∏ —à–ª—è–ø–∞ —Å—ã—â–∏–∫–∞', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KTue-dtDhus0c5YaMD8XV9cM5RoZE_vv8hpx0XE6td8Rnf2S-XcR8I2O3gX_I-cknpK80NXU6vJ14RUY-j9w6-w4o4OfGXKaALMV-YEKugOVlyi5nNrPTQB-YKgkzS2Rxv2P-Hqui9vuXZmQVxP9Qf2tlEbKI8Va7-B_bsRbJ11XcBBhw=s1024' },
            wizard: { name: '–ö–æ—Å—Ç—é–º –≤–æ–ª—à–µ–±–Ω–∏–∫–∞', price: 5500, emoji: 'üßô', description: '–ú–∞–≥–∏—á–µ—Å–∫–∞—è —à–ª—è–ø–∞ —Å–æ –∑–≤–µ–∑–¥–∞–º–∏', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KQPxv5r4tIYWRApKphxhkgxvnGKQM3xsq4M3aXc0geAPt-2vndpdQsdIj8NRVBWgKdMidAYute_I8JJm0ODHTBNQaJiocoUFom3YDGKQ8OVooO5DRr6FnrnXGQNeKxte5OkiBp0oSLIJJj5gLx4FSnqzIrX2gWgFz-4trg_FY9wwko_=s1024' },
            astronaut: { name: '–ö–æ—Å–º–æ–Ω–∞–≤—Ç', price: 6000, emoji: 'üë®‚ÄçüöÄ', description: '–°–∫–∞—Ñ–∞–Ω–¥—Ä –¥–ª—è –∫–æ—Å–º–∏—á–µ—Å–∫–∏—Ö –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KT324-72aIqf_NQFi9Tnsm9RzZ1AMnpOiazs-OFBLsEscgjEI9veiZtGCKxmQk3colgJi1PMqB_eMay5IMKIz6PNNMi7EQ0TBZpBo7wL8txaVuxYXUhXtKUsrw7tmyT_aO5RFDQJWqxCihIvzMxa64kcSOD6zzyFXFbZLZGCIvnRkggxQ=s1024' },
            dancer: { name: '–¢–∞–Ω—Ü–æ—Ä', price: 9000, emoji: 'üíÉ', description: '–Ø—Ä–∫–∏–π –∫–æ—Å—Ç—é–º –¥–ª—è —Ç–∞–Ω—Ü–µ–≤', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KQ1bWEIPopeYlRuCPeUOosampl8EutcqIbnPK8lFvkeqjxJW3_WJnqNouxj_V8rT8CpbIL1qquBwojfG7jXpGnpK6_gN881tPaFJVTaEeTbumY1RQI25STXm7xOo7aX_GplQe8czmFNvmmoyTIdUo8728z2C0fn09vYSiZnah0Z2zJb=s1024' },
            vampire: { name: '–í–∞–º–ø–∏—Ä', price: 9999, emoji: 'üßõ', description: '–ß–µ—Ä–Ω—ã–π –ø–ª–∞—â —Å –∫—Ä–∞—Å–Ω–æ–π –ø–æ–¥–∫–ª–∞–¥–∫–æ–π', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KSuo6SXblej9rDGQ8LILADG9BLIwAjJ4E2YLtjshoZUuodp0PuVPENbbyrkcpbzkZv3d7hvN1h8FBnqxoo1L-3X3ehM1TNmCv6REelZ5qgFQgwCczuogCjCvrO1RhZEY_QTA44gBkzOuU0DsRgsWALWmatt0SEkQSlW-gX1pCE28q7eTw=s1024' },
            princess: { name: '–ü—Ä–∏–Ω—Ü–µ—Å—Å–∞', price: 10000, emoji: 'üë∏', description: '–†–æ—Å–∫–æ—à–Ω–æ–µ –ø–ª–∞—Ç—å–µ —Å —Ç–∏–∞—Ä–æ–π', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KT4Tt1J4Ad-O_QldsJl73yIYw2kiZytty5vsBTyRFyvDwq97eF62z6tZX4btNnDdy7vC1OiD-yz6hyGf_D4zzkFUZIx8ztfjmAALzJwveorga1bVO2z6awSb7B6bHBcjA3ElV1VqtYwbH8XGP39uVttD2NGXRxmCAKbxNyqhwmGBttx=s1024' },
            angel: { name: '–ê–Ω–≥–µ–ª', price: 14000, emoji: 'üëº', description: '–ë–µ–ª—ã–µ –∫—Ä—ã–ª—å—è –∏ –Ω–∏–º–±', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KSVmpstfVgB8mEks0YIUTCbhnziSNQu2lnWaN_czBj4obZG1n1OcLstyYdCGRYIRqkZ73KQb780aNr-E-Ntn-QC-AD0wGE-q1nl-Qn2r59f4YmPNf6L-GqacgaCRLB-Y9rXuFfJaFIVRsKPYV2UW4zfDfAGzhwp9Vc59TukY2RF7If-_A=s1024' },
            robot: { name: '–†–æ–±–æ—Ç', price: 20000, emoji: 'ü§ñ', description: '–ú–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–π –∫–æ—Å—Ç—é–º –±—É–¥—É—â–µ–≥–æ', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KRydl7aa74Zq_cG1QWNF0soJHjskQIeTDTjzGT-Bktd9uAxlZmiQy-xEn2DmyeC_YdApcJhIhvq6-z4Mx6P-7if4kAjiMIn6kvNao3Yt59wCR6jjeZy4tnFTT2_GpJhhdNlG6GwlS9g1pn0_mrCs42iLOXH3GXHiH0BjFnlrvki7QZ_QA=s1024' }
        };
        

    }
    
    loadData(key, defaultValue, type = 'auto') {
        try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ gameUserId
            if (!this.gameUserId) {
                console.warn('‚ö†Ô∏è gameUserId –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ã—á–Ω—ã–π –∫–ª—é—á');
                const saved = localStorage.getItem(key);
                return saved ? this.parseValue(saved, type, defaultValue) : defaultValue;
            }
            
            // –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const userKey = `${this.gameUserId}_${key}`;
            const saved = localStorage.getItem(userKey);
            
            if (saved === null || saved === undefined) {
                return defaultValue;
            }
            
            return this.parseValue(saved, type, defaultValue);
        } catch (error) {
            console.error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–ª—é—á–∞ ${key}:`, error);
            return defaultValue;
        }
    }
    
    parseValue(saved, type, defaultValue) {
        try {
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
            switch (type) {
                case 'string':
                    return saved;
                    
                case 'number':
                    const num = parseFloat(saved);
                    return isNaN(num) ? defaultValue : num;
                    
                case 'boolean':
                    return saved === 'true';
                    
                case 'auto':
                default:
                    try {
                        return JSON.parse(saved);
                    } catch (parseError) {
                        console.warn(`–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∑–Ω–∞—á–µ–Ω–∏—è:`, parseError);
                        return defaultValue;
                    }
            }
        } catch (error) {
            return defaultValue;
        }
    }
    
    saveData() {
        try {
            console.log('üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä—ã...');
            console.log('üÜî gameUserId –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', this.gameUserId);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            this.lastUpdate = Date.now();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞
            this.updateActivePet();
            
            // –ü–†–ò–û–†–ò–¢–ï–¢: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
            this.saveToDatabaseAsync().then(success => {
                if (success) {
                    console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ë–î (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)');
                } else {
                    console.log('‚ö†Ô∏è –ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –≤ localStorage');
                }
            });
            
            // –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ localStorage –∫–∞–∫ –∫—ç—à
            this.saveToLocalStorage();
            
            // –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
            this.createBackup();
            
            console.log('‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–æ');
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
            this.showMessage('‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
        }
    }
    
    saveValue(key, value) {
        try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ gameUserId
            if (!this.gameUserId) {
                console.warn('‚ö†Ô∏è gameUserId –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ã—á–Ω—ã–π –∫–ª—é—á');
                if (typeof value === 'object') {
                    localStorage.setItem(key, JSON.stringify(value));
                } else {
                    localStorage.setItem(key, value.toString());
                }
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const userKey = `${this.gameUserId}_${key}`;
            if (typeof value === 'object') {
                localStorage.setItem(userKey, JSON.stringify(value));
            } else {
                localStorage.setItem(userKey, value.toString());
            }
            
            console.log(`üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: ${userKey} = ${typeof value === 'object' ? JSON.stringify(value) : value}`);
        } catch (error) {
            console.error(`–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è ${key}:`, error);
        }
    }
    
    validateGameData() {
        console.log('üîç –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä—ã...');
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫
        if (!this.stats || typeof this.stats !== 'object') {
            this.stats = {
                hunger: 100, happiness: 100, cleanliness: 100,
                health: 100, energy: 100, sleep: 100
            };
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–∏—Å–ª–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
        this.money = Math.max(0, this.money || 0);
        this.level = Math.max(1, this.level || 1);
        this.experience = Math.max(0, this.experience || 0);
        this.age = Math.max(0, this.age || 0);
        this.chestCount = Math.max(0, this.chestCount || 0);
        this.friendsInvited = Math.max(0, this.friendsInvited || 0);
        this.lastChestLevel = Math.max(0, this.lastChestLevel || 0);
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫ –ø–∏—Ç–æ–º—Ü–∞ (0-100)
        Object.keys(this.stats).forEach(stat => {
            this.stats[stat] = Math.max(0, Math.min(100, this.stats[stat] || 100));
        });
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –ø–æ–ª–µ–π
        this.petName = this.petName || 'Labubu';
        this.outfit = this.outfit || 'default';
        this.currentSkin = this.currentSkin || 'default';
        this.evolutionStage = this.evolutionStage || 'baby';
        this.gameUserId = this.gameUserId || this.generateUserId();
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –º–∞—Å—Å–∏–≤–æ–≤
        if (!Array.isArray(this.unlockedSkins)) {
            this.unlockedSkins = ['default'];
        }
        
        if (!Array.isArray(this.pets)) {
            this.pets = [{
                id: 'pet1',
                name: this.petName,
                stats: this.stats,
                outfit: this.outfit,
                age: this.age,
                evolutionStage: this.evolutionStage,
                currentSkin: this.currentSkin
            }];
        }
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫
        if (!this.lastUpdate || this.lastUpdate > Date.now()) {
            this.lastUpdate = Date.now();
        }
        
        if (!this.lastNotification || this.lastNotification > Date.now()) {
            this.lastNotification = Date.now();
        }
        
        console.log('‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
        console.log('üìä –§–∏–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:', {
            petName: this.petName,
            level: this.level,
            money: this.money,
            experience: this.experience,
            age: this.age,
            stats: this.stats
        });
    }
    
    updateActivePet() {
        const activePet = this.pets.find(pet => pet.id === this.activePetId);
        if (activePet) {
            activePet.name = this.petName;
            activePet.stats = { ...this.stats };
            activePet.outfit = this.outfit;
            activePet.age = this.age;
            activePet.evolutionStage = this.evolutionStage;
            activePet.currentSkin = this.currentSkin;
            activePet.level = this.level;
            activePet.experience = this.experience;
            activePet.money = this.money;
        }
    }
    
    createBackup() {
        try {
            const backupData = {
                timestamp: Date.now(),
                version: '4.0',
                gameUserId: this.gameUserId,
                data: {
                    stats: this.stats,
                    money: this.money,
                    outfit: this.outfit,
                    level: this.level,
                    experience: this.experience,
                    age: this.age,
                    evolutionStage: this.evolutionStage,
                    petName: this.petName,
                    isSleeping: this.isSleeping,
                    currentSkin: this.currentSkin,
                    unlockedSkins: this.unlockedSkins,
                    chestCount: this.chestCount,
                    friendsInvited: this.friendsInvited,
                    pets: this.pets,
                    ownedOutfits: this.ownedOutfits
                }
            };
            
            // –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –±—ç–∫–∞–ø –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const backupKey = `${this.gameUserId}_labubu_backup`;
            const historyKey = `${this.gameUserId}_labubu_backup_history`;
            
            localStorage.setItem(backupKey, JSON.stringify(backupData));
            
            // –•—Ä–∞–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏
            const backupHistory = JSON.parse(localStorage.getItem(historyKey) || '[]');
            backupHistory.push(backupData);
            
            if (backupHistory.length > 3) {
                backupHistory.shift();
            }
            
            localStorage.setItem(historyKey, JSON.stringify(backupHistory));
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏:', error);
        }
    }
    
    restoreFromBackup() {
        try {
            const backupKey = `${this.gameUserId}_labubu_backup`;
            const backup = JSON.parse(localStorage.getItem(backupKey) || '{}');
            
            if (backup.data && backup.timestamp && backup.gameUserId === this.gameUserId) {
                const data = backup.data;
                
                this.stats = data.stats || this.stats;
                this.money = data.money || this.money;
                this.outfit = data.outfit || this.outfit;
                this.level = data.level || this.level;
                this.experience = data.experience || this.experience;
                this.age = data.age || this.age;
                this.evolutionStage = data.evolutionStage || this.evolutionStage;
                this.petName = data.petName || this.petName;
                this.isSleeping = data.isSleeping || this.isSleeping;
                this.currentSkin = data.currentSkin || this.currentSkin;
                this.unlockedSkins = data.unlockedSkins || this.unlockedSkins;
                this.chestCount = data.chestCount || this.chestCount;
                this.friendsInvited = data.friendsInvited || this.friendsInvited;
                this.pets = data.pets || this.pets;
                this.ownedOutfits = data.ownedOutfits || this.ownedOutfits;
                
                this.saveData();
                this.updateDisplay();
                
                return true;
            }
            
            return false;
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏:', error);
            return false;
        }
    }
    
    resetToDefaults() {
        console.log('üîÑ –°–±—Ä–æ—Å –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é...');
        
        this.stats = {
            hunger: 100, happiness: 100, cleanliness: 100,
            health: 100, energy: 100, sleep: 100
        };
        
        this.money = 100;
        this.outfit = 'default';
        this.level = 1;
        this.experience = 0;
        this.age = 0;
        this.evolutionStage = 'baby';
        this.lastUpdate = Date.now();
        this.lastNotification = Date.now();
        this.petName = 'Labubu';
        this.isSleeping = false;
        this.telegramConnected = false;
        this.telegramChatId = '';
        this.gameUserId = this.generateUserId();
        this.currentSkin = 'default';
        this.unlockedSkins = ['default'];
        this.chestCount = 0;
        this.friendsInvited = 0;
        this.lastChestLevel = 0;
        
        this.pets = [{
            id: 'pet1',
            name: this.petName,
            stats: this.stats,
            outfit: this.outfit,
            age: this.age,
            evolutionStage: this.evolutionStage,
            currentSkin: this.currentSkin
        }];
        this.activePetId = 'pet1';
        
        this.saveData();
    }
    
    startAutoSave() {
        // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        setInterval(() => {
            this.saveData();
        }, 30000);
        
        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –ë–î –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã
        setInterval(() => {
            this.loadFromDatabaseAsync();
        }, 120000);
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('beforeunload', () => {
            this.saveData();
        });
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞
        window.addEventListener('blur', () => {
            this.saveData();
        });
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ
        window.addEventListener('focus', () => {
            this.loadFromDatabaseAsync();
        });
    }
    
    exportGameData() {
        try {
            const exportData = {
                version: '4.0',
                timestamp: Date.now(),
                playerName: this.petName,
                data: {
                    stats: this.stats,
                    money: this.money,
                    outfit: this.outfit,
                    level: this.level,
                    experience: this.experience,
                    age: this.age,
                    evolutionStage: this.evolutionStage,
                    petName: this.petName,
                    isSleeping: this.isSleeping,
                    currentSkin: this.currentSkin,
                    unlockedSkins: this.unlockedSkins,
                    chestCount: this.chestCount,
                    friendsInvited: this.friendsInvited,
                    pets: this.pets,
                    gameUserId: this.gameUserId
                }
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `labubu_save_${new Date().toISOString().slice(0, 10)}.json`;
            link.click();
            
            this.showMessage('üìÅ –î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:', error);
            this.showMessage('‚ùå –û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö!');
        }
    }
    
    importGameData(fileContent) {
        try {
            const importData = JSON.parse(fileContent);
            
            if (!importData.data || !importData.version) {
                throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞');
            }
            
            const data = importData.data;
            
            // –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
            this.stats = data.stats || this.stats;
            this.money = Math.max(0, data.money || 0);
            this.outfit = data.outfit || 'default';
            this.level = Math.max(1, data.level || 1);
            this.experience = Math.max(0, data.experience || 0);
            this.age = Math.max(0, data.age || 0);
            this.evolutionStage = data.evolutionStage || 'baby';
            this.petName = data.petName || 'Labubu';
            this.isSleeping = data.isSleeping || false;
            this.currentSkin = data.currentSkin || 'default';
            this.unlockedSkins = Array.isArray(data.unlockedSkins) ? data.unlockedSkins : ['default'];
            this.chestCount = Math.max(0, data.chestCount || 0);
            this.friendsInvited = Math.max(0, data.friendsInvited || 0);
            this.pets = Array.isArray(data.pets) ? data.pets : this.pets;
            
            if (data.gameUserId) {
                this.gameUserId = data.gameUserId;
            }
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            this.validateGameData();
            this.saveData();
            this.updateDisplay();
            
            this.showMessage('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞:', error);
            this.showMessage('‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö!');
        }
    }
    
    init() {
        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫
        this.updateTimeAndWeather();
        
        // –í–ê–ñ–ù–û: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
        this.updateDisplay();
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        this.initEventListeners();
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
        this.switchTab('care');
        
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –µ—â–µ —Ä–∞–∑ –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–∫–ª–∞–¥–∫–∏
        setTimeout(() => {
            this.updateDisplay();
        }, 100);
    }
    
    initEventListeners() {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
        document.addEventListener('click', (e) => {
            // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–º–µ–Ω–∏
            if (e.target.id === 'editNameBtn') {
                this.showNameEdit();
            } else if (e.target.id === 'saveNameBtn') {
                this.saveNameEdit();
            } else if (e.target.id === 'cancelNameBtn') {
                this.cancelNameEdit();
            }
            // –ó–≤—É–∫
            else if (e.target.id === 'soundToggle') {
                this.toggleSound();
            }
            // –í–∫–ª–∞–¥–∫–∏
            else if (e.target.classList.contains('tab-btn')) {
                this.switchTab(e.target.dataset.tab);
            }
            // –ú–∏–Ω–∏-–∏–≥—Ä—ã
            else if (e.target.id === 'cancelGameBtn') {
                this.closeMiniGame();
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter –¥–ª—è –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏
        document.addEventListener('keypress', (e) => {
            if (e.target.id === 'nameInput' && e.key === 'Enter') {
                this.saveNameEdit();
            }
        });
    }
    
    updateTimeAndWeather() {
        const hour = new Date().getHours();
        const timeElement = document.getElementById('timeOfDay');
        const weatherElement = document.getElementById('weather');
        
        if (hour >= 6 && hour < 12) timeElement.textContent = 'üåÖ';
        else if (hour >= 12 && hour < 18) timeElement.textContent = '‚òÄÔ∏è';
        else if (hour >= 18 && hour < 22) timeElement.textContent = 'üåÜ';
        else timeElement.textContent = 'üåô';
        
        const weathers = ['‚òÄÔ∏è', '‚òÅÔ∏è', 'üåßÔ∏è', '‚ùÑÔ∏è'];
        weatherElement.textContent = weathers[Math.floor(Math.random() * weathers.length)];
    }
    
    updateDisplay() {
        console.log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è...', {
            petName: this.petName,
            level: this.level,
            money: this.money,
            experience: this.experience,
            age: this.age
        });
        
        // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
        const petNameDisplay = document.getElementById('petNameDisplay');
        const levelDisplay = document.getElementById('levelDisplay');
        const moneyDisplay = document.getElementById('moneyDisplay');
        const expDisplay = document.getElementById('expDisplay');
        const ageDisplay = document.getElementById('ageDisplay');
        const ageText = document.getElementById('ageText');
        const soundToggle = document.getElementById('soundToggle');
        
        if (petNameDisplay) {
            petNameDisplay.textContent = this.petName;
            console.log('‚úÖ –ò–º—è –ø–∏—Ç–æ–º—Ü–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–æ:', this.petName);
        }
        if (levelDisplay) {
            levelDisplay.textContent = `Lv.${this.level}`;
            console.log('‚úÖ –£—Ä–æ–≤–µ–Ω—å –æ–±–Ω–æ–≤–ª–µ–Ω:', this.level);
        }
        if (moneyDisplay) {
            moneyDisplay.textContent = `üí∞${this.money}`;
            console.log('‚úÖ –î–µ–Ω—å–≥–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã:', this.money);
        }
        if (expDisplay) {
            expDisplay.textContent = `‚≠ê${this.experience}/100`;
            console.log('‚úÖ –û–ø—ã—Ç –æ–±–Ω–æ–≤–ª–µ–Ω:', this.experience);
        }
        if (ageDisplay) ageDisplay.textContent = `üéÇ${this.age}–¥`;
        if (ageText) ageText.textContent = this.age;
        
        // –ó–≤—É–∫
        if (soundToggle) soundToggle.textContent = this.soundEnabled ? 'üîä' : 'üîá';
        
        // Telegram —Å—Ç–∞—Ç—É—Å (optional elements)
        const telegramBtn = document.getElementById('telegramBtn');
        const telegramStatus = document.getElementById('telegramStatus');
        
        if (telegramBtn && telegramStatus) {
            if (this.telegramConnected) {
                telegramBtn.classList.add('hidden');
                telegramStatus.classList.remove('hidden');
            } else {
                telegramBtn.classList.remove('hidden');
                telegramStatus.classList.add('hidden');
            }
        }
        
        // –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ
        const mood = this.getMood();
        const moodEmoji = document.getElementById('moodEmoji');
        const moodStatus = document.getElementById('moodStatus');
        const evolutionStage = document.getElementById('evolutionStage');
        const petImage = document.getElementById('petImage');
        
        if (moodEmoji && mood) moodEmoji.textContent = mood.emoji;
        if (moodStatus && mood) moodStatus.textContent = mood.status;
        if (evolutionStage && this.evolutionStages && this.evolutionStages[this.evolutionStage]) {
            evolutionStage.textContent = this.evolutionStages[this.evolutionStage].name;
        }
        
        // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–∏—Ç–æ–º—Ü–∞
        if (petImage && this.skins && this.skins[this.currentSkin] && this.skins[this.currentSkin].image) {
            petImage.src = this.skins[this.currentSkin].image;
        }
        
        // –°–æ–Ω –∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
        const sleepIndicator = document.getElementById('sleepIndicator');
        const criticalIndicator = document.getElementById('criticalIndicator');
        const moodIndicator = document.getElementById('moodIndicator');
        
        if (sleepIndicator) sleepIndicator.classList.toggle('hidden', !this.isSleeping);
        
        // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ stats –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
        if (this.stats && typeof this.stats === 'object') {
            const avgStats = Object.values(this.stats).reduce((a, b) => a + b, 0) / 6;
            if (criticalIndicator) criticalIndicator.classList.toggle('hidden', avgStats > 10);
        }
        
        if (moodIndicator && mood) {
            if (mood.emoji === 'ü•∞') moodIndicator.textContent = '‚ù§Ô∏è';
            else moodIndicator.textContent = '';
        }
        
        // –û–¥–µ–∂–¥–∞
        this.updateOutfit();
        
        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        this.updateStatsDisplay();
    }
    
    updateOutfit() {
        const outfitContainer = document.getElementById('outfitContainer');
        const currentOutfitEl = document.getElementById('currentOutfit');
        
        if (!outfitContainer || !currentOutfitEl) return;
        
        outfitContainer.innerHTML = '';
        
        if (this.outfit !== 'default' && this.outfits && this.outfits[this.outfit]) {
            const outfitData = this.outfits[this.outfit];
            currentOutfitEl.textContent = `${outfitData.emoji} ${outfitData.name}`;
            currentOutfitEl.classList.remove('hidden');
            
            if (outfitData.image) {
                const outfitImg = document.createElement('img');
                outfitImg.src = outfitData.image;
                outfitImg.className = 'absolute object-contain';
                
                if (this.outfit === 'cute') {
                    outfitImg.className += ' top-2 left-1/2 transform -translate-x-1/2 w-28 h-28';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'cool') {
                    outfitImg.className += ' top-8 left-1/2 transform -translate-x-1/2 w-16 h-8';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'formal') {
                    outfitImg.className += ' top-8 left-1/2 transform -translate-x-1/2 w-28 h-32';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'winter') {
                    outfitImg.className += ' top-6 left-1/2 transform -translate-x-1/2 w-30 h-34';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'summer') {
                    outfitImg.className += ' top-2 left-1/2 transform -translate-x-1/2 w-28 h-28';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'ninja') {
                    outfitImg.className += ' top-4 left-1/2 transform -translate-x-1/2 w-32 h-36';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'pirate') {
                    outfitImg.className += ' top-6 left-1/2 transform -translate-x-1/2 w-30 h-34';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'wizard') {
                    outfitImg.className += ' top-0 left-1/2 transform -translate-x-1/2 w-32 h-40';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'school') {
                    outfitImg.className += ' top-8 left-1/2 transform -translate-x-1/2 w-28 h-32';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'chef') {
                    outfitImg.className += ' top-2 left-1/2 transform -translate-x-1/2 w-30 h-34';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'superhero') {
                    outfitImg.className += ' top-4 left-1/2 transform -translate-x-1/2 w-32 h-36';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'princess') {
                    outfitImg.className += ' top-6 left-1/2 transform -translate-x-1/2 w-32 h-36';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'astronaut') {
                    outfitImg.className += ' top-2 left-1/2 transform -translate-x-1/2 w-32 h-38';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'detective') {
                    outfitImg.className += ' top-4 left-1/2 transform -translate-x-1/2 w-30 h-34';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'doctor') {
                    outfitImg.className += ' top-6 left-1/2 transform -translate-x-1/2 w-28 h-32';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'dancer') {
                    outfitImg.className += ' top-8 left-1/2 transform -translate-x-1/2 w-30 h-32';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'knight') {
                    outfitImg.className += ' top-4 left-1/2 transform -translate-x-1/2 w-32 h-36';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'vampire') {
                    outfitImg.className += ' top-2 left-1/2 transform -translate-x-1/2 w-34 h-38';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'angel') {
                    outfitImg.className += ' top-0 left-1/2 transform -translate-x-1/2 w-36 h-40';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'robot') {
                    outfitImg.className += ' top-2 left-1/2 transform -translate-x-1/2 w-34 h-38';
                    outfitImg.style.zIndex = '10';
                }
                
                outfitContainer.appendChild(outfitImg);
            }
        } else {
            currentOutfitEl.classList.add('hidden');
        }
    }
    
    updateStatsDisplay() {
        const container = document.getElementById('statsContainer');
        if (!container) return;
        
        const stats = [
            { label: 'üçΩÔ∏è –ì–æ–ª–æ–¥', value: this.stats.hunger, color: 'bg-orange-500' },
            { label: 'üòä –°—á–∞—Å—Ç—å–µ', value: this.stats.happiness, color: 'bg-yellow-500' },
            { label: 'üõÅ –ß–∏—Å—Ç–æ—Ç–∞', value: this.stats.cleanliness, color: 'bg-blue-500' },
            { label: '‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ', value: this.stats.health, color: 'bg-red-500' },
            { label: '‚ö° –≠–Ω–µ—Ä–≥–∏—è', value: this.stats.energy, color: 'bg-green-500' },
            { label: 'üò¥ –°–æ–Ω', value: this.stats.sleep, color: 'bg-purple-500' }
        ];
        
        container.innerHTML = stats.map(stat => `
            <div class="mb-2">
                <div class="flex justify-between mb-1">
                    <span class="text-xs font-medium">${stat.label}</span>
                    <span class="text-xs">${stat.value}%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-1.5">
                    <div class="h-1.5 rounded-full transition-all duration-300 ${stat.color}" style="width: ${stat.value}%"></div>
                </div>
            </div>
        `).join('');
    }
    
    getMood() {
        if (this.isSleeping) return { emoji: 'üò¥', status: '–°–ø–∏—Ç' };
        
        // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ stats
        if (!this.stats || typeof this.stats !== 'object') {
            return { emoji: 'üòê', status: '–ó–∞–≥—Ä—É–∑–∫–∞...' };
        }
        
        const avg = Object.values(this.stats).reduce((a, b) => a + b, 0) / 6;
        if (avg > 90) return { emoji: 'ü•∞', status: '–í–æ—Å—Ö–∏—Ç–∏—Ç–µ–ª—å–Ω–æ' };
        if (avg > 80) return { emoji: 'üòä', status: '–û—á–µ–Ω—å —Å—á–∞—Å—Ç–ª–∏–≤' };
        if (avg > 60) return { emoji: 'üôÇ', status: '–°—á–∞—Å—Ç–ª–∏–≤' };
        if (avg > 40) return { emoji: 'üòê', status: '–ù–æ—Ä–º–∞–ª—å–Ω–æ' };
        if (avg > 20) return { emoji: 'üòü', status: '–ì—Ä—É—Å—Ç–Ω–æ' };
        if (avg > 10) return { emoji: 'üò¢', status: '–û—á–µ–Ω—å –≥—Ä—É—Å—Ç–Ω–æ' };
        return { emoji: 'üíÄ', status: '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ' };
    }
    
    showMessage(msg) {
        const messageEl = document.getElementById('gameMessage');
        messageEl.textContent = msg;
        messageEl.classList.remove('hidden');
        setTimeout(() => messageEl.classList.add('hidden'), 3000);
    }
    
    showNotification(message, type) {
        const notification = {
            id: Date.now(),
            message,
            type,
            timestamp: Date.now()
        };
        
        this.notifications.push(notification);
        
        const notificationEl = document.createElement('div');
        notificationEl.className = `p-3 rounded-lg shadow-lg text-white text-sm max-w-xs notification-enter ${this.getNotificationColor(type)}`;
        notificationEl.textContent = message;
        
        document.getElementById('notifications').appendChild(notificationEl);
        
        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram
        this.sendTelegramNotification(message, type);
        
        setTimeout(() => {
            notificationEl.classList.add('notification-exit');
            setTimeout(() => {
                if (notificationEl.parentNode) {
                    notificationEl.parentNode.removeChild(notificationEl);
                }
            }, 300);
            this.notifications = this.notifications.filter(n => n.id !== notification.id);
        }, 5000);
    }
    
    getNotificationColor(type) {
        const colors = {
            reminder: 'bg-blue-500',
            sad: 'bg-red-500',
            sleepy: 'bg-purple-500',
            hungry: 'bg-orange-500',
            dirty: 'bg-blue-600',
            sick: 'bg-red-600',
            tired: 'bg-yellow-500'
        };
        return colors[type] || 'bg-gray-500';
    }
    
    showNameEdit() {
        document.getElementById('nameEditSection').classList.remove('hidden');
        document.getElementById('editNameBtn').classList.add('hidden');
        document.getElementById('nameInput').value = this.petName;
        document.getElementById('nameInput').focus();
    }
    
    saveNameEdit() {
        const newName = document.getElementById('nameInput').value.trim();
        if (newName && newName.length <= 15) {
            this.petName = newName;
            this.showMessage(`–¢–µ–ø–µ—Ä—å –∑–æ–≤—É—Ç ${this.petName}!`);
            this.saveData();
            this.updateDisplay();
        }
        this.cancelNameEdit();
    }
    
    cancelNameEdit() {
        document.getElementById('nameEditSection').classList.add('hidden');
        document.getElementById('editNameBtn').classList.remove('hidden');
    }
    
    toggleSound() {
        this.soundEnabled = !this.soundEnabled;
        this.updateDisplay();
        this.saveData();
    }
    
    playSound(frequency, duration = 200, type = 'sine') {
        if (!this.soundEnabled) return;
        
        try {
            if (!this.audioContext) {
                this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            
            const oscillator = this.audioContext.createOscillator();
            const gainNode = this.audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(this.audioContext.destination);
            
            oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
            oscillator.type = type;
            
            gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration / 1000);
            
            oscillator.start();
            oscillator.stop(this.audioContext.currentTime + duration / 1000);
        } catch (error) {
            console.log('Sound not available');
        }
    }
    
    playHappySound() {
        this.playSound(523, 100);
        setTimeout(() => this.playSound(659, 100), 100);
        setTimeout(() => this.playSound(784, 150), 200);
    }
    
    switchTab(tab) {
        this.activeTab = tab;
        
        // –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏
        document.querySelectorAll('.tab-btn').forEach(btn => {
            if (btn.dataset.tab === tab) {
                btn.className = 'tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors bg-purple-500 text-white';
            } else {
                btn.className = 'tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors text-purple-500 hover:bg-purple-50';
            }
        });
        
        // –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç
        const content = document.getElementById('tabContent');
        content.innerHTML = this.getTabContent(tab);
    }
    
    getTabContent(tab) {
        switch (tab) {
            case 'care':
                return this.getCareTabContent();
            case 'games':
                return this.getGamesTabContent();
            case 'shop':
                return this.getShopTabContent();
            case 'chests':
                return this.getChestsTabContent();
            case 'pets':
                return this.getPetsTabContent();
            case 'info':
                return this.getInfoTabContent();
            default:
                return '';
        }
    }
    
    getCareTabContent() {
        const foodGrid = this.food.map((item, index) => `
            <button onclick="game.feedPet(${index})" class="bg-orange-100 hover:bg-orange-200 p-2 rounded text-xs transition-colors" ${this.isSleeping ? 'disabled' : ''}>
                <div class="text-sm">${item.emoji}</div>
                <div class="font-medium text-xs">${item.name}</div>
                <div class="text-xs text-gray-600">${item.price}üí∞</div>
            </button>
        `).join('');
        
        return `
            <div class="space-y-3">
                <div class="bg-white rounded-lg p-3 shadow">
                    <h3 class="font-bold mb-2 text-purple-800 text-sm">üçΩÔ∏è –ö–æ—Ä–º–ª–µ–Ω–∏–µ</h3>
                    <div class="grid grid-cols-4 gap-1">${foodGrid}</div>
                </div>
                <div class="bg-white rounded-lg p-3 shadow">
                    <h3 class="font-bold mb-2 text-purple-800 text-sm">‚ö° –î–µ–π—Å—Ç–≤–∏—è</h3>
                    <div class="grid grid-cols-3 gap-1">
                        <button onclick="game.washPet()" class="bg-blue-100 hover:bg-blue-200 p-2 rounded text-xs transition-colors" ${this.isSleeping ? 'disabled' : ''}>
                            <div class="text-sm">üõÅ</div>
                            <div class="font-medium">–ú—ã—Ç—å</div>
                        </button>
                        <button onclick="game.healPet()" class="bg-red-100 hover:bg-red-200 p-2 rounded text-xs transition-colors">
                            <div class="text-sm">üíä</div>
                            <div class="font-medium">–õ–µ—á–∏—Ç—å</div>
                            <div class="text-xs">30üí∞</div>
                        </button>
                        <button onclick="game.toggleSleep()" class="bg-purple-100 hover:bg-purple-200 p-2 rounded text-xs transition-colors">
                            <div class="text-sm">${this.isSleeping ? '‚òÄÔ∏è' : 'üò¥'}</div>
                            <div class="font-medium">${this.isSleeping ? '–ë—É–¥–∏—Ç—å' : '–°–ø–∞—Ç—å'}</div>
                        </button>
                    </div>
                </div>
            </div>
        `;
    }
    
    getGamesTabContent() {
        const gamesGrid = this.miniGames.map((game, index) => `
            <button onclick="game.startMiniGame(${index})" class="p-2 rounded-lg text-xs transition-colors bg-yellow-100 hover:bg-yellow-200 flex flex-col items-center" ${this.isSleeping || this.stats.energy < 15 ? 'disabled' : ''}>
                <span class="text-lg mb-1">${game.emoji}</span>
                <div class="font-medium text-center">${game.name}</div>
                <div class="text-xs text-gray-600 text-center">${game.description}</div>
                <div class="text-xs text-red-600 mt-1">-15 —ç–Ω–µ—Ä–≥–∏–∏</div>
            </button>
        `).join('');
        
        return `
            <div class="bg-white rounded-lg p-3 shadow">
                <h3 class="font-bold mb-2 text-purple-800 text-sm">üéÆ –ú–∏–Ω–∏-–∏–≥—Ä—ã</h3>
                <div class="grid grid-cols-2 gap-2">${gamesGrid}</div>
            </div>
        `;
    }
    
    getShopTabContent() {
        const outfitsList = Object.entries(this.outfits).map(([key, item]) => {
            const isOwned = this.ownedOutfits.includes(key);
            const isWearing = this.outfit === key;
            
            return `
            <button onclick="game.buyOutfit('${key}')" class="w-full p-2 rounded-lg text-xs transition-colors flex items-center justify-between ${
                isWearing ? 'bg-green-100 border-2 border-green-500' : 
                isOwned ? 'bg-blue-50 border-2 border-blue-300' :
                'bg-gray-100 hover:bg-gray-200'
            }">
                <div class="flex items-center space-x-2">
                    <span class="text-lg">${item.emoji}</span>
                    <div class="text-left">
                        <div class="font-medium">${item.name}</div>
                        <div class="text-xs text-gray-500">${item.description}</div>
                        <div class="text-xs text-gray-600 font-bold">
                            ${isOwned ? '–ö—É–ø–ª–µ–Ω–æ' : item.price === 0 ? '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ' : `${item.price}üí∞`}
                        </div>
                    </div>
                </div>
                ${isWearing ? '<span class="text-green-600 font-bold">‚úì –ù–∞–¥–µ—Ç–æ</span>' : 
                  isOwned ? '<span class="text-blue-600 font-bold">üëç –ù–∞–¥–µ—Ç—å</span>' : 
                  ''}
            </button>
        `
        }).join('');
        
        return `
            <div class="bg-white rounded-lg p-3 shadow">
                <h3 class="font-bold mb-2 text-purple-800 text-sm">üëó –ú–∞–≥–∞–∑–∏–Ω –æ–¥–µ–∂–¥—ã</h3>
                <div class="grid grid-cols-1 gap-1 max-h-64 overflow-y-auto">
                    ${Object.entries(this.outfits).map(([key, item]) => {
                        const isOwned = this.ownedOutfits.includes(key);
                        const isWearing = this.outfit === key;
                        
                        return `
                        <button onclick="game.buyOutfit('${key}')" class="w-full p-2 rounded-lg text-xs transition-colors flex items-center justify-between ${
                            isWearing ? 'bg-green-100 border-2 border-green-500' : 
                            isOwned ? 'bg-blue-50 border-2 border-blue-300' :
                            'bg-gray-100 hover:bg-gray-200'
                        }">
                            <div class="flex items-center space-x-2">
                                <span class="text-lg">${item.emoji}</span>
                                <div class="text-left">
                                    <div class="font-medium">${item.name}</div>
                                    <div class="text-xs text-gray-500">${item.description}</div>
                                    <div class="text-xs text-gray-600 font-bold">
                                        ${isOwned ? '–ö—É–ø–ª–µ–Ω–æ' : item.price === 0 ? '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ' : `${item.price}üí∞`}
                                    </div>
                                </div>
                            </div>
                            ${isWearing ? '<span class="text-green-600 font-bold">‚úì –ù–∞–¥–µ—Ç–æ</span>' : 
                              isOwned ? '<span class="text-blue-600 font-bold">üëç –ù–∞–¥–µ—Ç—å</span>' : 
                              ''}
                        </button>
                        `;
                    }).join('')}
                </div>
            </div>
        `;
    }
    
    getPetsTabContent() {
        return `
            <div class="bg-white rounded-lg p-3 shadow">
                <h3 class="font-bold mb-2 text-purple-800 text-sm">üê∞ –í–∞—à –ª–∏—á–Ω—ã–π –ø–∏—Ç–æ–º–µ—Ü</h3>
                <div class="text-center mb-4">
                    <div class="text-4xl mb-2">üê∞</div>
                    <h4 class="font-bold text-lg text-purple-800">${this.petName}</h4>
                    <p class="text-sm text-gray-600">–í–∞—à —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –ø–∏—Ç–æ–º–µ—Ü</p>
                    <div class="bg-green-50 p-2 rounded-lg mt-3">
                        <p class="text-xs text-green-800">üîí –¢–æ–ª—å–∫–æ –≤—ã –º–æ–∂–µ—Ç–µ —É—Ö–∞–∂–∏–≤–∞—Ç—å –∑–∞ ${this.petName}</p>
                        <p class="text-xs text-green-600">üíæ –í—Å–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ</p>
                    </div>
                </div>
                <div class="bg-blue-50 p-3 rounded-lg">
                    <h4 class="font-bold text-sm text-blue-800 mb-2">üÜî –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–∫–∫–∞—É–Ω—Ç–µ</h4>
                    <div class="text-xs text-blue-700 space-y-1">
                        <p><strong>ID –∏–≥—Ä–æ–∫–∞:</strong> ${this.gameUserId.slice(-8)}</p>
                        <p><strong>–ò–º—è –ø–∏—Ç–æ–º—Ü–∞:</strong> ${this.petName}</p>
                        <p><strong>–í–æ–∑—Ä–∞—Å—Ç:</strong> ${this.age} –¥–Ω–µ–π</p>
                        <p><strong>–£—Ä–æ–≤–µ–Ω—å:</strong> ${this.level}</p>
                    </div>
                </div>
            </div>
        `;
    }
    
    getInfoTabContent() {
        return `
            <div class="space-y-3">

                
                <div class="bg-white rounded-lg p-3 shadow">
                    <h3 class="font-bold mb-3 text-purple-800 text-sm">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–≥—Ä–µ</h3>
                    <div class="space-y-3 text-xs">
                        <div class="bg-blue-50 p-2 rounded">
                            <h4 class="font-bold text-blue-800 mb-1">üöÄ –ë—É–¥—É—â–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</h4>
                            <p class="text-blue-700">–ë–æ—Ç –±—É–¥–µ—Ç —Ä–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è! –û–∂–∏–¥–∞–π—Ç–µ:</p>
                            <ul class="list-disc list-inside text-blue-700 mt-1">
                                <li>–ù–æ–≤—ã–µ –º–∏–Ω–∏-–∏–≥—Ä—ã –∏ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</li>
                                <li>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∫–∏–Ω—ã –∏ –æ–¥–µ–∂–¥–∞</li>
                                <li>–û—Å–æ–±—ã–µ —Å–æ–±—ã—Ç–∏—è –∏ –ø—Ä–∞–∑–¥–Ω–∏–∫–∏</li>
                                <li>–£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —ç–≤–æ–ª—é—Ü–∏–∏</li>
                                <li>–ú–Ω–æ–≥–æ –¥—Ä—É–≥–∏—Ö –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π!</li>
                            </ul>
                        </div>
                        <div class="bg-green-50 p-2 rounded">
                            <h4 class="font-bold text-green-800 mb-1">üéÆ –ö–∞–∫ –∏–≥—Ä–∞—Ç—å</h4>
                            <ul class="list-disc list-inside text-green-700">
                                <li>–ö–æ—Ä–º–∏—Ç–µ ${this.petName} –∫–æ–≥–¥–∞ –≥–æ–ª–æ–¥–µ–Ω</li>
                                <li>–ò–≥—Ä–∞–π—Ç–µ –≤ –º–∏–Ω–∏-–∏–≥—Ä—ã –¥–ª—è –æ–ø—ã—Ç–∞</li>
                                <li>–ü–æ–∫—É–ø–∞–π—Ç–µ –æ–¥–µ–∂–¥—É –∑–∞ –º–æ–Ω–µ—Ç—ã</li>
                                <li>–°–ª–µ–¥–∏—Ç–µ –∑–∞ –≤—Å–µ–º–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞–º–∏</li>
                                <li>–í–∞—à –ø–∏—Ç–æ–º–µ—Ü —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç —Å –≤–æ–∑—Ä–∞—Å—Ç–æ–º!</li>
                            </ul>
                        </div>
                        <div class="bg-purple-50 p-2 rounded">
                            <h4 class="font-bold text-purple-800 mb-1">‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</h4>
                            <ul class="list-disc list-inside text-purple-700">
                                <li>20 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –º–∏–Ω–∏-–∏–≥—Ä</li>
                                <li>22 –≤–∏–¥–∞ –æ–¥–µ–∂–¥—ã</li>
                                <li>6 —Ä–µ–¥–∫–∏—Ö —Å–∫–∏–Ω–æ–≤ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π</li>
                                <li>5 —Å—Ç–∞–¥–∏–π —ç–≤–æ–ª—é—Ü–∏–∏</li>
                                <li>–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ —Å—Ç–∞—Ä–µ–Ω–∏–µ (1 –¥–µ–Ω—å = 1 –¥–µ–Ω—å)</li>
                                <li>üîí –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–∏—Ç–æ–º–µ—Ü –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞</li>
                                <li>üíæ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –±—ç–∫–∞–ø—ã</li>
                                <li>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</li>
                                <li>–ó–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã</li>
                            </ul>
                        </div>
                        <div class="bg-orange-50 p-2 rounded">
                            <h4 class="font-bold text-orange-800 mb-1">‚è∞ –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</h4>
                            <ul class="list-disc list-inside text-orange-700">
                                <li>–ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç: "–¢—ã –Ω–µ –∑–∞–±—ã–ª –º–µ–Ω—è?"</li>
                                <li>–ü—Ä–∏ –≥–æ–ª–æ–¥–µ < 50%: "–Ø –≥–æ–ª–æ–¥–µ–Ω!"</li>
                                <li>–ü—Ä–∏ —Å—á–∞—Å—Ç—å–µ < 50%: "–ú–Ω–µ —Å–∫—É—á–Ω–æ!"</li>
                                <li>–ü—Ä–∏ —Å–Ω–µ < 50%: "–Ø —Ö–æ—á—É —Å–ø–∞—Ç—å!"</li>
                                <li>–ü—Ä–∏ –∑–¥–æ—Ä–æ–≤—å–µ < 50%: "–ú–Ω–µ –ø–ª–æ—Ö–æ!"</li>
                                <li>–ü—Ä–∏ —á–∏—Å—Ç–æ—Ç–µ < 50%: "–Ø –≥—Ä—è–∑–Ω—ã–π!"</li>
                            </ul>
                        </div>
                        <div class="bg-yellow-50 p-2 rounded">
                            <h4 class="font-bold text-yellow-800 mb-1">üîß –¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è</h4>
                            <div class="grid grid-cols-2 gap-1">
                                <button onclick="game.testSave()" class="bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded text-xs">
                                    üíæ –¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                                </button>
                                <button onclick="game.testLoad()" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs">
                                    üìÇ –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏
                                </button>
                                <button onclick="game.debugSaveSystem()" class="bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded text-xs">
                                    üîç Debug
                                </button>
                                <button onclick="game.clearSave()" class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs">
                                    üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å
                                </button>
                            </div>
                            <div class="grid grid-cols-2 gap-1 mt-2">
                                <button onclick="game.forceSave()" class="bg-orange-500 hover:bg-orange-600 text-white px-2 py-1 rounded text-xs">
                                    üíæ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
                                </button>
                                <button onclick="game.checkSaveIntegrity()" class="bg-cyan-500 hover:bg-cyan-600 text-white px-2 py-1 rounded text-xs">
                                    üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å
                                </button>
                            </div>
                        </div>
                        
                        <div class="text-center text-gray-500">
                            <p>üê∞ –°–æ–∑–¥–∞–Ω–æ —Å –ª—é–±–æ–≤—å—é –¥–ª—è ${this.petName}! üíï</p>
                            <p class="text-xs mt-1">–í–µ—Ä—Å–∏—è 4.2 - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è</p>
                            <div class="bg-green-50 p-2 rounded mt-2">
                                <p class="text-xs text-green-700">üéØ –£ –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞ —Ç–µ–ø–µ—Ä—å —Å–≤–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –ø–∏—Ç–æ–º–µ—Ü!</p>
                                <p class="text-xs text-green-600">ID: ${this.gameUserId.slice(-8)}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }
    
    // –ò–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
    feedPet(foodIndex) {
        if (this.isSleeping) {
            this.showMessage(`${this.petName} —Å–ø–∏—Ç! üò¥`);
            return;
        }
        
        const food = this.food[foodIndex];
        if (this.money >= food.price) {
            this.money -= food.price;
            this.stats.hunger = Math.min(100, this.stats.hunger + (food.hunger || 0));
            this.stats.happiness = Math.min(100, this.stats.happiness + (food.happiness || 0));
            this.stats.health = Math.min(100, this.stats.health + (food.health || 0));
            this.stats.energy = Math.min(100, this.stats.energy + (food.energy || 0));
            this.stats.cleanliness = Math.min(100, this.stats.cleanliness + (food.cleanliness || 0));
            
            // –ë–æ–ª—å—à–∏–π –±–æ–Ω—É—Å —ç–Ω–µ—Ä–≥–∏–∏ –æ—Ç –µ–¥—ã
            if (!food.energy) {
                this.stats.energy = Math.min(100, this.stats.energy + 10); // –£–≤–µ–ª–∏—á–µ–Ω –±–æ–Ω—É—Å —ç–Ω–µ—Ä–≥–∏–∏
            }
            
            this.experience += 10;
            
            this.playSound(800, 150);
            this.showMessage(`${this.petName} —Å—ä–µ–ª ${food.name}! ${food.emoji}`);
            this.checkLevelUp();
            this.saveData();
            this.updateDisplay();
        } else {
            this.showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
        }
    }
    
    washPet() {
        if (this.isSleeping) {
            this.showMessage(`–ù–µ –±—É–¥–∏ —Å–ø—è—â–µ–≥–æ ${this.petName}! üò¥`);
            return;
        }
        
        this.stats.cleanliness = 100;
        this.stats.happiness = Math.min(100, this.stats.happiness + 10);
        this.experience += 8;
        
        this.playSound(400, 200);
        this.showMessage(`${this.petName} —á–∏—Å—Ç—ã–π –∏ —Å—á–∞—Å—Ç–ª–∏–≤—ã–π! üõÅ`);
        this.checkLevelUp();
        this.saveData();
        this.updateDisplay();
    }
    
    healPet() {
        if (this.money >= 30) {
            this.money -= 30;
            this.stats.health = 100;
            this.stats.happiness = Math.min(100, this.stats.happiness + 5);
            this.experience += 12;
            
            this.showMessage(`${this.petName} –∑–¥–æ—Ä–æ–≤! üíä`);
            this.checkLevelUp();
            this.saveData();
            this.updateDisplay();
        } else {
            this.showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç –¥–ª—è –ª–µ—á–µ–Ω–∏—è!');
        }
    }
    
    toggleSleep() {
        this.isSleeping = !this.isSleeping;
        
        if (this.isSleeping) {
            this.playSound(300, 500);
            this.showMessage(`${this.petName} –ª–æ–∂–∏—Ç—Å—è —Å–ø–∞—Ç—å... üò¥`);
        } else {
            this.playHappySound();
            this.showMessage(`${this.petName} –ø—Ä–æ—Å–Ω—É–ª—Å—è! üòä`);
        }
        
        this.saveData();
        this.updateDisplay();
        this.switchTab('care');
    }
    
    buyOutfit(outfitKey) {
        const outfit = this.outfits[outfitKey];
        
        if (this.ownedOutfits.includes(outfitKey)) {
            // –£–∂–µ –∫—É–ø–ª–µ–Ω - –ø—Ä–æ—Å—Ç–æ –Ω–∞–¥–µ–≤–∞–µ–º
            this.outfit = outfitKey;
            this.stats.happiness = Math.min(100, this.stats.happiness + 10);
            this.showMessage(`–ù–∞–¥–µ—Ç–æ: ${outfit.name}! ${outfit.emoji}`);
            this.saveData();
            this.updateDisplay();
            this.switchTab('shop');
            return;
        }
        
        if (this.money >= outfit.price) {
            this.money -= outfit.price;
            this.ownedOutfits.push(outfitKey);
            this.outfit = outfitKey;
            this.stats.happiness = Math.min(100, this.stats.happiness + 20);
            
            this.playHappySound();
            this.showMessage(`–ö—É–ø–ª–µ–Ω–æ –∏ –Ω–∞–¥–µ—Ç–æ: ${outfit.name}! ${outfit.emoji}`);
            this.saveData();
            this.updateDisplay();
            this.switchTab('shop');
        } else {
            this.showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
        }
    }
    
    createNewPet() {
        const newPetId = `pet${this.pets.length + 1}`;
        const newPet = {
            id: newPetId,
            name: `${this.petName} ${this.pets.length + 1}`,
            stats: { hunger: 100, happiness: 100, cleanliness: 100, health: 100, energy: 100, sleep: 100 },
            outfit: 'default',
            age: 0,
            evolutionStage: 'baby'
        };
        
        this.pets.push(newPet);
        this.activePetId = newPetId;
        this.showMessage(`–ù–æ–≤—ã–π –ø–∏—Ç–æ–º–µ—Ü ${newPet.name} —Å–æ–∑–¥–∞–Ω! üéâ`);
        this.saveData();
    }
    
    startMiniGame(gameIndex) {
        if (this.isSleeping) {
            this.showMessage(`${this.petName} —Å–ø–∏—Ç! –†–∞–∑–±—É–¥–∏ –µ–≥–æ —Å–Ω–∞—á–∞–ª–∞! üò¥`);
            return;
        }
        if (this.stats.energy < 15) {
            this.showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏! –ù—É–∂–Ω–æ –æ—Ç–¥–æ—Ö–Ω—É—Ç—å.');
            return;
        }
        
        this.currentMiniGame = this.miniGames[gameIndex];
        this.showMiniGameModal();
    }
    
    showMiniGameModal() {
        document.getElementById('gameTitle').textContent = `${this.currentMiniGame.name} ${this.currentMiniGame.emoji}`;
        document.getElementById('gameContent').innerHTML = this.getMiniGameContent();
        document.getElementById('miniGameModal').classList.remove('hidden');
    }
    
    closeMiniGame() {
        document.getElementById('miniGameModal').classList.add('hidden');
        this.currentMiniGame = null;
    }
    
    getMiniGameContent() {
        const gameId = this.currentMiniGame.id;
        
        if (gameId === 'memory') {
            return this.getMemoryGameContent();
        } else if (gameId === 'reaction') {
            return this.getReactionGameContent();
        } else if (gameId === 'math') {
            return this.getMathGameContent();
        } else if (gameId === 'puzzle') {
            return this.getPuzzleGameContent();
        } else if (gameId === 'quiz') {
            return this.getQuizGameContent();
        } else if (gameId === 'rhythm') {
            return this.getRhythmGameContent();
        } else if (gameId === 'treasure') {
            return this.getTreasureGameContent();
        } else if (gameId === 'balance') {
            return this.getBalanceGameContent();
        } else if (gameId === 'matching') {
            return this.getMatchingGameContent();
        } else if (gameId === 'simon') {
            return this.getSimonGameContent();
        } else if (gameId === 'catch') {
            return this.getCatchGameContent();
        } else if (gameId === 'target') {
            return this.getTargetGameContent();
        } else if (gameId === 'code') {
            return this.getCodeGameContent();
        } else if (gameId === 'stack') {
            return this.getStackGameContent();
        } else if (gameId === 'speed') {
            return this.getSpeedGameContent();
        } else if (gameId === 'maze') {
            return this.getMazeGameContent();
        } else if (gameId === 'pattern') {
            return this.getPatternGameContent();
        } else if (gameId === 'word') {
            return this.getWordGameContent();
        } else if (gameId === 'color') {
            return this.getColorGameContent();
        } else if (gameId === 'sequence') {
            return this.getSequenceGameContent();
        } else {
            // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∏–≥—Ä
            return `
                <div class="text-center">
                    <p class="mb-4">${this.currentMiniGame.description}</p>
                    <p class="text-sm text-gray-600 mb-4">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É —á—Ç–æ–±—ã –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å!</p>
                    <button onclick="game.completeMiniGame(${Math.random() > 0.3})" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-bold transition-colors">
                        –ò–≥—Ä–∞—Ç—å!
                    </button>
                </div>
            `;
        }
    }
    
    getMemoryGameContent() {
        if (!this.gameState) this.gameState = 'waiting';
        
        return `
            <div class="text-center">
                <p class="mb-4">–ó–∞–ø–æ–º–Ω–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ü–≤–µ—Ç–æ–≤!</p>
                <div class="grid grid-cols-2 gap-2 mb-4">
                    <button onclick="game.handleMemoryClick(0)" class="h-16 bg-red-400 hover:bg-red-500 rounded transition-colors" id="memory-0">üî¥</button>
                    <button onclick="game.handleMemoryClick(1)" class="h-16 bg-blue-400 hover:bg-blue-500 rounded transition-colors" id="memory-1">üîµ</button>
                    <button onclick="game.handleMemoryClick(2)" class="h-16 bg-green-400 hover:bg-green-500 rounded transition-colors" id="memory-2">üü¢</button>
                    <button onclick="game.handleMemoryClick(3)" class="h-16 bg-yellow-400 hover:bg-yellow-500 rounded transition-colors" id="memory-3">üü°</button>
                </div>
                <button onclick="game.startMemorySequence()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded">
                    –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
                </button>
            </div>
        `;
    }
    
    getReactionGameContent() {
        return `
            <div class="text-center">
                <p class="mb-4">–ù–∞–∂–º–∏ –Ω–∞ –∑–µ–ª–µ–Ω—ã–π —Å–∏–≥–Ω–∞–ª –∫–∞–∫ –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–µ–µ!</p>
                <div id="reaction-light" class="w-20 h-20 bg-red-400 rounded-full mx-auto mb-4 transition-colors"></div>
                <button onclick="game.startReactionTest()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg">
                    –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç
                </button>
                <button onclick="game.reactionClick()" id="reaction-btn" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg hidden">
                    –ù–ê–ñ–ú–ò!
                </button>
            </div>
        `;
    }
    
    getMathGameContent() {
        const a = Math.floor(Math.random() * 10) + 1;
        const b = Math.floor(Math.random() * 10) + 1;
        const answer = a + b;
        this.mathAnswer = answer;
        
        const options = [answer - 1, answer, answer + 1].sort(() => Math.random() - 0.5);
        
        return `
            <div class="text-center">
                <p class="text-2xl mb-6">${a} + ${b} = ?</p>
                <div class="grid grid-cols-3 gap-2">
                    ${options.map(num => `
                        <button onclick="game.checkMathAnswer(${num})" class="bg-blue-500 hover:bg-blue-600 text-white p-3 rounded text-xl transition-colors">
                            ${num}
                        </button>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    getPuzzleGameContent() {
        this.puzzlePieces = [1, 2, 3, 4].sort(() => Math.random() - 0.5);
        
        return `
            <div class="text-center">
                <p class="mb-4">–†–∞—Å—Å—Ç–∞–≤—å —á–∏—Å–ª–∞ –ø–æ –ø–æ—Ä—è–¥–∫—É (1, 2, 3, 4):</p>
                <div class="grid grid-cols-4 gap-2 mb-4">
                    ${this.puzzlePieces.map((piece, index) => `
                        <button onclick="game.swapPuzzlePiece(${index})" class="bg-green-400 hover:bg-green-500 text-white p-4 rounded text-xl transition-colors">
                            ${piece}
                        </button>
                    `).join('')}
                </div>
                <p class="text-xs text-gray-600">–ù–∞–∂–º–∏ –Ω–∞ —á–∏—Å–ª–æ —á—Ç–æ–±—ã –ø–æ–º–µ–Ω—è—Ç—å –º–µ—Å—Ç–∞–º–∏ —Å —Å–æ—Å–µ–¥–Ω–∏–º</p>
            </div>
        `;
    }
    
    getQuizGameContent() {
        const questions = [
            { q: '–ö–∞–∫–æ–≥–æ —Ü–≤–µ—Ç–∞ —Å–æ–ª–Ω—Ü–µ?', answers: ['–ñ–µ–ª—Ç–æ–µ', '–°–∏–Ω–µ–µ', '–ö—Ä–∞—Å–Ω–æ–µ'], correct: 0 },
            { q: '–°–∫–æ–ª—å–∫–æ –Ω–æ–≥ —É –∫–æ—Ç–∞?', answers: ['2', '4', '6'], correct: 1 },
            { q: '–ß—Ç–æ –µ–¥—è—Ç –∫—Ä–æ–ª–∏–∫–∏?', answers: ['–ú—è—Å–æ', '–ú–æ—Ä–∫–æ–≤—å', '–†—ã–±—É'], correct: 1 },
            { q: '–°–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –≤ –Ω–µ–¥–µ–ª–µ?', answers: ['5', '6', '7'], correct: 2 },
            { q: '–ö–∞–∫–æ–π —Ü–≤–µ—Ç —É —Ç—Ä–∞–≤—ã?', answers: ['–ö—Ä–∞—Å–Ω—ã–π', '–ó–µ–ª–µ–Ω—ã–π', '–°–∏–Ω–∏–π'], correct: 1 }
        ];
        
        this.currentQuestion = questions[Math.floor(Math.random() * questions.length)];
        
        return `
            <div class="text-center">
                <p class="text-lg mb-4">${this.currentQuestion.q}</p>
                <div class="space-y-2">
                    ${this.currentQuestion.answers.map((answer, index) => `
                        <button onclick="game.checkQuizAnswer(${index})" class="w-full bg-purple-400 hover:bg-purple-500 text-white p-3 rounded transition-colors">
                            ${answer}
                        </button>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    getRhythmGameContent() {
        return `
            <div class="text-center">
                <p class="mb-4">–ü–æ–≤—Ç–æ—Ä–∏ —Ä–∏—Ç–º: üî¥üîµüî¥üîµ</p>
                <div class="flex justify-center space-x-4 mb-4">
                    <button onclick="game.addRhythmBeat(1)" class="w-16 h-16 bg-red-400 hover:bg-red-500 rounded-full text-2xl transition-colors">
                        üî¥
                    </button>
                    <button onclick="game.addRhythmBeat(0)" class="w-16 h-16 bg-blue-400 hover:bg-blue-500 rounded-full text-2xl transition-colors">
                        üîµ
                    </button>
                </div>
                <div id="rhythm-display" class="mb-4 text-lg">–í–∞—à —Ä–∏—Ç–º: </div>
                <button onclick="game.checkRhythm()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
                </button>
                <button onclick="game.resetRhythm()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded ml-2">
                    –°–±—Ä–æ—Å–∏—Ç—å
                </button>
            </div>
        `;
    }
    
    getTreasureGameContent() {
        this.treasurePosition = Math.floor(Math.random() * 9);
        this.treasureAttempts = 0;
        
        return `
            <div class="text-center">
                <p class="mb-4">–ù–∞–π–¥–∏ —Å–æ–∫—Ä–æ–≤–∏—â–µ! üíé</p>
                <p class="mb-2 text-sm text-gray-600">–£ –≤–∞—Å 3 –ø–æ–ø—ã—Ç–∫–∏</p>
                <div class="attempts-message text-center text-sm text-blue-600 mb-2">–ü–æ–ø—ã—Ç–æ–∫ –æ—Å—Ç–∞–ª–æ—Å—å: 3</div>
                <div class="grid grid-cols-3 gap-2">
                    ${Array.from({length: 9}, (_, index) => `
                        <button onclick="game.checkTreasure(${index})" class="treasure-btn bg-yellow-400 hover:bg-yellow-500 text-white p-4 rounded h-16 text-2xl transition-colors">
                            ‚ùì
                        </button>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    getBalanceGameContent() {
        this.balance = 50;
        this.balanceTimer = 10;
        
        return `
            <div class="text-center">
                <p class="mb-2">–£–¥–µ—Ä–∂–∏ –±–∞–ª–∞–Ω—Å –≤ –∑–µ–ª–µ–Ω–æ–π –∑–æ–Ω–µ 10 —Å–µ–∫—É–Ω–¥!</p>
                <p class="mb-4 text-lg font-bold">–í—Ä–µ–º—è: <span id="balance-timer">10</span>—Å</p>
                <div class="relative h-8 bg-gray-300 rounded mb-4">
                    <div class="absolute top-0 h-8 bg-green-400 rounded" style="left: 30%; right: 30%;"></div>
                    <div class="absolute top-0 h-8 bg-red-400 rounded-l" style="left: 0%; right: 70%;"></div>
                    <div class="absolute top-0 h-8 bg-red-400 rounded-r" style="left: 70%; right: 0%;"></div>
                    <div id="balance-marker" class="absolute top-0 w-3 h-8 bg-blue-800 rounded transition-all duration-150" style="left: 50%; transform: translateX(-50%);"></div>
                </div>
                <div class="flex justify-center space-x-4">
                    <button onclick="game.adjustBalance(-5)" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded font-bold">
                        ‚¨ÖÔ∏è –í–ª–µ–≤–æ
                    </button>
                    <button onclick="game.adjustBalance(5)" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded font-bold">
                        –í–ø—Ä–∞–≤–æ ‚û°Ô∏è
                    </button>
                </div>
                <button onclick="game.startBalanceGame()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded mt-4">
                    –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
                </button>
            </div>
        `;
    }
    
    getMatchingGameContent() {
        const symbols = ['üçé', 'üçå', 'üçá', 'üçä'];
        this.matchingCards = [...symbols, ...symbols].sort(() => Math.random() - 0.5);
        this.flippedCards = [];
        this.matchedCards = [];
        
        return `
            <div class="text-center">
                <p class="mb-4">–ù–∞–π–¥–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø–∞—Ä—ã!</p>
                <div class="grid grid-cols-4 gap-2">
                    ${this.matchingCards.map((card, index) => `
                        <button onclick="game.flipCard(${index})" id="card-${index}" class="h-16 w-16 bg-blue-400 hover:bg-blue-500 rounded text-2xl transition-colors">
                            ‚ùì
                        </button>
                    `).join('')}
                </div>
                <div class="text-xs text-gray-600 mt-2">
                    –ù–∞–π–¥–µ–Ω–æ –ø–∞—Ä: <span id="pairs-found">0</span> / 4
                </div>
            </div>
        `;
    }
    
    getSimonGameContent() {
        return `
            <div class="text-center">
                <p class="mb-4">–ü–æ–≤—Ç–æ—Ä–∏ –∫–æ–º–∞–Ω–¥—ã –°–∞–π–º–æ–Ω–∞!</p>
                <div class="grid grid-cols-2 gap-2 mb-4">
                    <button onclick="game.simonClick(0)" id="simon-0" class="h-16 bg-red-400 hover:bg-red-500 rounded transition-colors">üî¥</button>
                    <button onclick="game.simonClick(1)" id="simon-1" class="h-16 bg-blue-400 hover:bg-blue-500 rounded transition-colors">üîµ</button>
                    <button onclick="game.simonClick(2)" id="simon-2" class="h-16 bg-green-400 hover:bg-green-500 rounded transition-colors">üü¢</button>
                    <button onclick="game.simonClick(3)" id="simon-3" class="h-16 bg-yellow-400 hover:bg-yellow-500 rounded transition-colors">üü°</button>
                </div>
                <button onclick="game.startSimonGame()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded">
                    –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
                </button>
                <div id="simon-status" class="mt-2 text-sm text-gray-600"></div>
            </div>
        `;
    }
    
    getCatchGameContent() {
        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        setTimeout(() => this.startCatchGame(), 100);
        
        return `
            <div class="text-center">
                <p class="mb-2">–ü–æ–π–º–∞–π –ø–∞–¥–∞—é—â–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã!</p>
                <p id="catch-score" class="mb-4">–ü–æ–π–º–∞–Ω–æ: 0/5</p>
                <div id="catch-game-area" class="relative w-full h-40 bg-blue-100 rounded border overflow-hidden">
                    <div id="catch-bucket" class="absolute bottom-0 w-12 h-6 bg-green-500 rounded-t transition-all duration-200 flex items-center justify-center text-xs" style="left: 50%; transform: translateX(-50%); z-index: 10;">
                        ü™£
                    </div>
                </div>
                <div class="flex justify-center space-x-4 mt-2">
                    <button onclick="game.moveCatchPlayer('left')" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
                        ‚¨ÖÔ∏è –í–ª–µ–≤–æ
                    </button>
                    <button onclick="game.moveCatchPlayer('right')" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
                        –í–ø—Ä–∞–≤–æ ‚û°Ô∏è
                    </button>
                </div>
                <div class="text-xs text-gray-600 mt-2">
                    15 —Å–µ–∫—É–Ω–¥ ‚Ä¢ –ù—É–∂–Ω–æ –ø–æ–π–º–∞—Ç—å 5 –∑–≤–µ–∑–¥–æ—á–µ–∫
                </div>
            </div>
        `;
    }
    
    getTargetGameContent() {
        this.targetScore = 0;
        this.targetPos = { x: 50, y: 50 };
        
        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        this.startTargetGame();
        
        return `
            <div class="text-center">
                <p class="mb-2">–ü–æ–ø–∞–¥–∏ –≤ –¥–≤–∏–∂—É—â—É—é—Å—è –º–∏—à–µ–Ω—å!</p>
                <p id="target-score" class="mb-4">–ü–æ–ø–∞–¥–∞–Ω–∏–π: 0/3</p>
                <div id="target-game-area" class="relative w-full h-40 bg-gray-200 rounded border">
                    <button id="moving-target" onclick="game.hitTarget()" class="absolute w-8 h-8 bg-red-500 rounded-full transition-all duration-300" style="left: 50%; top: 50%; transform: translate(-50%, -50%);">
                        üéØ
                    </button>
                </div>
                <p class="text-xs text-gray-600 mt-2">–ú–∏—à–µ–Ω—å –¥–≤–∏–∂–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 1.5 —Å–µ–∫—É–Ω–¥—ã!</p>
            </div>
        `;
    }
    
    getCodeGameContent() {
        this.secretCode = Array.from({length: 4}, () => Math.floor(Math.random() * 4));
        this.codeAttempt = [];
        
        return `
            <div class="text-center">
                <p class="mb-4">–í–∑–ª–æ–º–∞–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥!</p>
                <p class="mb-2 text-xs text-gray-600">–ö–æ–¥ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 4 —Ü–∏—Ñ—Ä (0-3)</p>
                <div class="flex justify-center space-x-2 mb-4">
                    ${Array.from({length: 4}, (_, i) => `
                        <div id="code-slot-${i}" class="w-8 h-8 border-2 border-gray-400 rounded flex items-center justify-center bg-white">
                            ?
                        </div>
                    `).join('')}
                </div>
                <div class="grid grid-cols-4 gap-2 mb-3">
                    ${[0, 1, 2, 3].map(digit => `
                        <button onclick="game.enterCodeDigit(${digit})" class="bg-purple-400 hover:bg-purple-500 active:bg-purple-600 text-white p-3 rounded transition-colors font-bold text-lg">
                            ${digit}
                        </button>
                    `).join('')}
                </div>
                <button onclick="game.resetCode()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded transition-colors">
                    üîÑ –°–±—Ä–æ—Å–∏—Ç—å
                </button>
            </div>
        `;
    }
    
    getStackGameContent() {
        // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞
        setTimeout(() => this.startStackTimer(), 100);
        
        return `
            <div class="text-center">
                <p class="mb-2">–°–æ–±–µ—Ä–∏ –±–∞—à–Ω—é –∏–∑ –±–ª–æ–∫–æ–≤!</p>
                <p class="mb-2">–í—ã—Å–æ—Ç–∞: <span id="stack-height">0</span>/5</p>
                <p class="mb-4">–í—Ä–µ–º—è: <span id="stack-timer">10</span>—Å</p>
                <div id="stack-area" class="flex flex-col-reverse items-center h-32 justify-end mb-4 bg-gray-100 rounded border-2 border-dashed border-gray-300">
                </div>
                <button onclick="game.addStackBlock()" class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-3 rounded font-bold transition-colors active:scale-95">
                    üß± –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫
                </button>
                <div class="text-xs text-gray-600 mt-2">
                    –ü–æ—Å—Ç—Ä–æ–π—Ç–µ –±–∞—à–Ω—é –≤—ã—Å–æ—Ç–æ–π 5 –±–ª–æ–∫–æ–≤ –∑–∞ 10 —Å–µ–∫—É–Ω–¥!
                </div>
            </div>
        `;
    }
    
    getSpeedGameContent() {
        // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞
        setTimeout(() => this.startSpeedTimer(), 100);
        
        return `
            <div class="text-center">
                <p class="mb-2">–ù–∞–∂–º–∏ –∫–∞–∫ –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–µ–µ!</p>
                <p class="mb-2">–ù–∞–∂–∞—Ç–∏–π: <span id="click-count">0</span>/20</p>
                <p class="mb-4">–í—Ä–µ–º—è: <span id="speed-timer">5</span>—Å</p>
                <button onclick="game.speedClick()" class="w-32 h-32 bg-red-500 hover:bg-red-600 active:bg-red-700 text-white text-3xl rounded-full animate-pulse transition-all active:scale-95">
                    üí® –ö–õ–ò–ö!
                </button>
                <div class="text-xs text-gray-600 mt-2">
                    –¶–µ–ª—å: 20+ –∫–ª–∏–∫–æ–≤ –∑–∞ 5 —Å–µ–∫—É–Ω–¥
                </div>
            </div>
        `;
    }
    
    completeMiniGame(success = null) {
        if (success === null) {
            success = Math.random() > 0.3; // 70% —à–∞–Ω—Å —É—Å–ø–µ—Ö–∞
        }
        
        if (success && this.currentMiniGame) {
            const reward = this.currentMiniGame.reward;
            this.stats.happiness = Math.min(100, this.stats.happiness + (reward.happiness || 0));
            this.stats.energy = Math.max(0, this.stats.energy - 15);
            this.experience += reward.experience || 0;
            this.money += reward.money || 0;
            
            this.playHappySound();
            this.showMessage(`–û—Ç–ª–∏—á–Ω–æ! +${reward.experience} –æ–ø—ã—Ç–∞, +${reward.money} –º–æ–Ω–µ—Ç!`);
        } else {
            this.stats.energy = Math.max(0, this.stats.energy - 10);
            this.playSound(200, 300);
            this.showMessage('–ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑!');
        }
        
        this.checkLevelUp();
        this.saveData();
        this.updateDisplay();
        this.closeMiniGame();
    }
    
    // –ò–≥—Ä–∞ "–ü–∞–º—è—Ç—å"
    startMemorySequence() {
        this.memorySequence = Array.from({length: 4}, () => Math.floor(Math.random() * 4));
        this.userMemorySequence = [];
        this.currentMemoryStep = 0;
        this.showMemorySequence();
    }
    
    showMemorySequence() {
        if (this.currentMemoryStep < this.memorySequence.length) {
            const colorIndex = this.memorySequence[this.currentMemoryStep];
            const button = document.getElementById(`memory-${colorIndex}`);
            button.style.transform = 'scale(1.1)';
            button.style.boxShadow = '0 0 20px rgba(255,255,255,0.8)';
            
            setTimeout(() => {
                button.style.transform = 'scale(1)';
                button.style.boxShadow = 'none';
                this.currentMemoryStep++;
                setTimeout(() => this.showMemorySequence(), 300);
            }, 600);
        } else {
            this.showMessage('–¢–µ–ø–µ—Ä—å –ø–æ–≤—Ç–æ—Ä–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å!');
        }
    }
    
    handleMemoryClick(colorIndex) {
        if (this.currentMemoryStep >= this.memorySequence.length) {
            this.userMemorySequence.push(colorIndex);
            
            if (this.userMemorySequence[this.userMemorySequence.length - 1] !== this.memorySequence[this.userMemorySequence.length - 1]) {
                this.completeMiniGame(false);
                return;
            }
            
            if (this.userMemorySequence.length === this.memorySequence.length) {
                this.completeMiniGame(true);
            }
        }
    }
    
    generateUserId() {
        return 'user_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
    }
    
    debugSaveSystem() {
        console.log('üîç –û–¢–õ–ê–î–ö–ê –°–ò–°–¢–ï–ú–´ –°–û–•–†–ê–ù–ï–ù–ò–Ø:');
        console.log('gameUserId:', this.gameUserId);
        console.log('petName:', this.petName);
        console.log('money:', this.money);
        console.log('level:', this.level);
        console.log('stats:', this.stats);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ localStorage
        console.log('üíæ –í localStorage:');
        console.log(`${this.gameUserId}_pet_name:`, localStorage.getItem(`${this.gameUserId}_pet_name`));
        console.log(`${this.gameUserId}_labubu_money:`, localStorage.getItem(`${this.gameUserId}_labubu_money`));
        console.log(`${this.gameUserId}_labubu_level:`, localStorage.getItem(`${this.gameUserId}_labubu_level`));
    }
    
    handleFileImport(event) {
        const file = event.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                this.importGameData(e.target.result);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞:', error);
                this.showMessage('‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞!');
            }
        };
        reader.readAsText(file);
    }
    
    restoreFromBackupPrompt() {
        if (confirm('üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏?\n\n–≠—Ç–æ –∑–∞–º–µ–Ω–∏—Ç —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ.')) {
            if (this.restoreFromBackup()) {
                this.showMessage('‚úÖ –î–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏!');
                this.updateDisplay();
                this.switchTab('care');
            } else {
                this.showMessage('‚ùå –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∞!');
            }
        }
    }
    
    resetGamePrompt() {
        const confirmation = prompt(`üóëÔ∏è –í–ù–ò–ú–ê–ù–ò–ï! –≠—Ç–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–±—Ä–æ—Å–∏—Ç –í–ê–®–£ –∏–≥—Ä—É!\n\n–í—Å–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ, –≤–∫–ª—é—á–∞—è:\n‚Ä¢ –£—Ä–æ–≤–µ–Ω—å ${this.level} –∏ ${this.experience} –æ–ø—ã—Ç–∞\n‚Ä¢ ${this.money} –º–æ–Ω–µ—Ç\n‚Ä¢ ${this.unlockedSkins.length} —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–∫–∏–Ω–æ–≤\n‚Ä¢ ${this.chestCount} —Å—É–Ω–¥—É–∫–æ–≤\n‚Ä¢ –í–æ–∑—Ä–∞—Å—Ç ${this.age} –¥–Ω–µ–π\n\n–≠—Ç–æ –∑–∞—Ç—Ä–æ–Ω–µ—Ç —Ç–æ–ª—å–∫–æ –í–ê–®–ï–ì–û –ø–∏—Ç–æ–º—Ü–∞!\n\n–ù–∞–ø–∏—à–∏—Ç–µ "–°–ë–†–û–°" —á—Ç–æ–±—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å:`);
        
        if (confirmation === '–°–ë–†–û–°') {
            // –û—á–∏—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –°–í–û–ò –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage
            const keysToRemove = [
                'labubu_stats', 'labubu_money', 'labubu_outfit',
                'labubu_level', 'labubu_experience', 'labubu_age',
                'labubu_evolution', 'labubu_last_update', 'pet_name',
                'labubu_sleeping', 'labubu_pets', 'active_pet_id',
                'current_skin', 'unlocked_skins', 'chest_count',
                'friends_invited', 'last_chest_level', 'labubu_last_notification',
                'owned_outfits', 'last_stat_decay'
            ];
            
            keysToRemove.forEach(key => {
                const userKey = `${this.gameUserId}_${key}`;
                localStorage.removeItem(userKey);
            });
            
            // –£–¥–∞–ª—è–µ–º –ª–∏—á–Ω—ã–µ –±—ç–∫–∞–ø—ã
            const backupKey = `${this.gameUserId}_labubu_backup`;
            const historyKey = `${this.gameUserId}_labubu_backup_history`;
            localStorage.removeItem(backupKey);
            localStorage.removeItem(historyKey);
            
            this.resetToDefaults();
            this.updateDisplay();
            this.switchTab('care');
            
            this.showMessage('üóëÔ∏è –í–∞—à–∞ –∏–≥—Ä–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–±—Ä–æ—à–µ–Ω–∞! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, –Ω–æ–≤—ã–π –≤–ª–∞–¥–µ–ª–µ—Ü –õ–∞–±—É–±—É!');
        } else {
            this.showMessage('‚ùå –°–±—Ä–æ—Å –æ—Ç–º–µ–Ω–µ–Ω.');
        }
    }
    

    
    async registerTelegramUser(chatId) {
        try {
            // URL –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
            const response = await fetch('https://labubu-server.onrender.com/api/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    chatId: chatId,
                    gameUserId: this.gameUserId,
                    petName: this.petName
                })
            });
            
            if (response.ok) {
                this.telegramConnected = true;
                this.telegramChatId = chatId;
                localStorage.setItem('telegram_connected', 'true');
                localStorage.setItem('telegram_chat_id', chatId);
                
                document.getElementById('telegramBtn').classList.add('hidden');
                document.getElementById('telegramStatus').classList.remove('hidden');
                
                this.showMessage('‚úÖ Telegram —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω!');
            } else {
                this.showMessage('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Telegram');
            }
        } catch (error) {
            console.error('Telegram connection error:', error);
            this.showMessage('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
        }
    }
    
    async sendTelegramNotification(message, type) {
        if (!this.telegramConnected) return;
        
        try {
            await fetch('https://labubu-server.onrender.com/api/notify', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    gameUserId: this.gameUserId,
                    message: message,
                    type: type,
                    petName: this.petName
                })
            });
        } catch (error) {
            console.error('Failed to send Telegram notification:', error);
        }
    }
    
    async saveToDatabaseAsync() {
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ)
        try {
            if (!this.gameUserId) {
                console.log('‚ö†Ô∏è gameUserId –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î');
                return false;
            }

            console.log('üåê –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö...');

            const gameData = {
                gameUserId: this.gameUserId,
                petName: this.petName,
                stats: this.stats,
                level: this.level,
                experience: this.experience,
                money: this.money,
                age: this.age,
                outfit: this.outfit,
                currentSkin: this.currentSkin,
                unlockedSkins: this.unlockedSkins,
                evolutionStage: this.evolutionStage,
                chestCount: this.chestCount,
                friendsInvited: this.friendsInvited,
                lastChestLevel: this.lastChestLevel,
                isSleeping: this.isSleeping,
                lastUpdate: this.lastUpdate
            };

            const response = await fetch('https://labubu-server.onrender.com/api/save-game', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(gameData),
                signal: AbortSignal.timeout(8000) // 8 —Å–µ–∫—É–Ω–¥ —Ç–∞–π–º–∞—É—Ç –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
            });

            if (response.ok) {
                console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö');
                return true;
            } else {
                console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î:', response.status);
                return false;
            }

        } catch (error) {
            console.warn('‚ö†Ô∏è –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ:', error.message);
            return false;
        }
    }

    async loadFromDatabaseSync() {
        // –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ (–±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö)
        try {
            if (!this.gameUserId) {
                console.log('‚ö†Ô∏è gameUserId –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∏–∑ –ë–î');
                return false;
            }

            console.log('üåê –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...');

            const response = await fetch(`https://labubu-server.onrender.com/api/load-game/${this.gameUserId}`, {
                method: 'GET',
                signal: AbortSignal.timeout(8000) // 8 —Å–µ–∫—É–Ω–¥ —Ç–∞–π–º–∞—É—Ç –¥–ª—è –ø–µ—Ä–≤–∏—á–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
            });

            if (response.ok) {
                const data = await response.json();
                
                if (data.success && data.gameData) {
                    const gameData = data.gameData;
                    
                    console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã –∏–∑ –ë–î, –ø—Ä–∏–º–µ–Ω—è–µ–º...');
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î
                    this.stats = gameData.stats || {
                        hunger: 100, happiness: 100, cleanliness: 100,
                        health: 100, energy: 100, sleep: 100
                    };
                    this.money = gameData.money || 100;
                    this.level = gameData.level || 1;
                    this.experience = gameData.experience || 0;
                    this.age = gameData.age || 0;
                    this.outfit = gameData.outfit || 'default';
                    this.currentSkin = gameData.currentSkin || 'default';
                    this.unlockedSkins = gameData.unlockedSkins || ['default'];
                    this.evolutionStage = gameData.evolutionStage || 'baby';
                    this.chestCount = gameData.chestCount || 0;
                    this.friendsInvited = gameData.friendsInvited || 0;
                    this.lastChestLevel = gameData.lastChestLevel || 0;
                    this.isSleeping = gameData.isSleeping || false;
                    this.petName = gameData.petName || 'Labubu';
                    this.lastUpdate = gameData.lastUpdate || Date.now();
                    this.lastNotification = this.loadData('shared_labubu_last_notification', Date.now(), 'number');
                    
                    // –°—Ä–∞–∑—É —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –∫–∞–∫ –∫—ç—à
                    this.saveToLocalStorage();
                    
                    console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –∏–∑ –ë–î –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ localStorage –∫–∞–∫ –∫—ç—à');
                    return true;
                } else {
                    console.log('‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç –ë–î');
                    return false;
                }
            } else {
                console.log('‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ –ë–î –∏–ª–∏ –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                return false;
            }

        } catch (error) {
            console.warn('‚ö†Ô∏è –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞:', error.message);
            return false;
        }
    }

    async loadFromDatabaseAsync() {
        // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–æ–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ–Ω–µ)
        try {
            if (!this.gameUserId) {
                console.log('‚ö†Ô∏è gameUserId –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∏–∑ –ë–î');
                return;
            }

            console.log('üîÑ –§–æ–Ω–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –≤ –ë–î...');

            const response = await fetch(`https://labubu-server.onrender.com/api/load-game/${this.gameUserId}`, {
                method: 'GET',
                signal: AbortSignal.timeout(5000) // 5 —Å–µ–∫—É–Ω–¥ —Ç–∞–π–º–∞—É—Ç
            });

            if (response.ok) {
                const data = await response.json();
                
                if (data.success && data.gameData) {
                    const gameData = data.gameData;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î –Ω–æ–≤–µ–µ localStorage
                    const localLastUpdate = this.lastUpdate;
                    
                    if (gameData.lastUpdate > localLastUpdate) {
                        console.log('üîÑ –ù–∞–π–¥–µ–Ω—ã –±–æ–ª–µ–µ —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ –ë–î, –æ–±–Ω–æ–≤–ª—è–µ–º...');
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î
                        this.stats = gameData.stats || this.stats;
                        this.money = gameData.money || this.money;
                        this.level = gameData.level || this.level;
                        this.experience = gameData.experience || this.experience;
                        this.age = gameData.age || this.age;
                        this.outfit = gameData.outfit || this.outfit;
                        this.currentSkin = gameData.currentSkin || this.currentSkin;
                        this.unlockedSkins = gameData.unlockedSkins || this.unlockedSkins;
                        this.evolutionStage = gameData.evolutionStage || this.evolutionStage;
                        this.chestCount = gameData.chestCount || this.chestCount;
                        this.friendsInvited = gameData.friendsInvited || this.friendsInvited;
                        this.lastChestLevel = gameData.lastChestLevel || this.lastChestLevel;
                        this.isSleeping = gameData.isSleeping || this.isSleeping;
                        this.petName = gameData.petName || this.petName;
                        this.lastUpdate = gameData.lastUpdate || this.lastUpdate;
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ localStorage –∫–∞–∫ –∫—ç—à
                        this.saveToLocalStorage();
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
                        this.updateDisplay();
                        
                        console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –∏–∑ –ë–î —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
                        this.showMessage('üì± –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Å —Å–µ—Ä–≤–µ—Ä–∞!');
                    } else {
                        console.log('üì± –õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã');
                    }
                }
            }

        } catch (error) {
            console.warn('‚ö†Ô∏è –§–æ–Ω–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞:', error.message);
        }
    }

    saveToLocalStorage() {
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –≤ localStorage (–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
        this.saveValue('labubu_stats', this.stats);
        this.saveValue('labubu_money', this.money);
        this.saveValue('labubu_outfit', this.outfit);
        this.saveValue('labubu_level', this.level);
        this.saveValue('labubu_experience', this.experience);
        this.saveValue('labubu_age', this.age);
        this.saveValue('labubu_evolution', this.evolutionStage);
        this.saveValue('labubu_last_update', Date.now());
        this.saveValue('pet_name', this.petName);
        this.saveValue('labubu_sleeping', this.isSleeping);
        this.saveValue('current_skin', this.currentSkin);
        this.saveValue('unlocked_skins', this.unlockedSkins);
        this.saveValue('chest_count', this.chestCount);
        this.saveValue('friends_invited', this.friendsInvited);
        this.saveValue('last_chest_level', this.lastChestLevel);
        this.saveValue('labubu_last_notification', this.lastNotification);
        this.saveValue('owned_outfits', this.ownedOutfits);
        this.saveValue('last_stat_decay', this.lastStatDecay);
        this.saveValue('labubu_pets', this.pets);
        this.saveValue('active_pet_id', this.activePetId);
    }
    
    // –ò–≥—Ä–∞ "–†–µ–∞–∫—Ü–∏—è"
    startReactionTest() {
        const light = document.getElementById('reaction-light');
        const btn = document.getElementById('reaction-btn');
        light.className = 'w-20 h-20 bg-red-400 rounded-full mx-auto mb-4 transition-colors';
        btn.classList.add('hidden');
        
        const delay = 2000 + Math.random() * 3000;
        this.reactionStartTime = Date.now() + delay;
        
        setTimeout(() => {
            light.className = 'w-20 h-20 bg-green-500 rounded-full mx-auto mb-4 transition-colors animate-pulse';
            btn.classList.remove('hidden');
            this.reactionStarted = true;
        }, delay);
    }
    
    reactionClick() {
        if (this.reactionStarted) {
            const reactionTime = Date.now() - this.reactionStartTime;
            this.completeMiniGame(reactionTime < 1000);
        }
    }
    
    // –ò–≥—Ä–∞ "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞"
    checkMathAnswer(answer) {
        this.completeMiniGame(answer === this.mathAnswer);
    }
    
    // –ò–≥—Ä–∞ "–ü–∞–∑–ª"
    swapPuzzlePiece(index) {
        if (index < this.puzzlePieces.length - 1) {
            [this.puzzlePieces[index], this.puzzlePieces[index + 1]] = [this.puzzlePieces[index + 1], this.puzzlePieces[index]];
            
            // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            const content = this.getPuzzleGameContent();
            document.getElementById('gameContent').innerHTML = content;
            
            if (JSON.stringify(this.puzzlePieces) === JSON.stringify([1, 2, 3, 4])) {
                this.completeMiniGame(true);
            }
        }
    }
    
    // –ò–≥—Ä–∞ "–í–∏–∫—Ç–æ—Ä–∏–Ω–∞"
    checkQuizAnswer(answerIndex) {
        this.completeMiniGame(answerIndex === this.currentQuestion.correct);
    }
    
    // –ò–≥—Ä–∞ "–†–∏—Ç–º"
    addRhythmBeat(beat) {
        if (!this.userRhythm) this.userRhythm = [];
        this.userRhythm.push(beat);
        
        const display = document.getElementById('rhythm-display');
        display.textContent = '–í–∞—à —Ä–∏—Ç–º: ' + this.userRhythm.map(b => b === 1 ? 'üî¥' : 'üîµ').join('');
    }
    
    checkRhythm() {
        const targetRhythm = [1, 0, 1, 0]; // üî¥üîµüî¥üîµ
        this.completeMiniGame(JSON.stringify(this.userRhythm) === JSON.stringify(targetRhythm));
    }
    
    resetRhythm() {
        this.userRhythm = [];
        document.getElementById('rhythm-display').textContent = '–í–∞—à —Ä–∏—Ç–º: ';
    }
    
    // –ò–≥—Ä–∞ "–ö–ª–∞–¥" (–ò–°–ü–†–ê–í–õ–ï–ù–û)
    checkTreasure(position) {
        if (!this.treasureAttempts) this.treasureAttempts = 0;
        
        if (position === this.treasurePosition) {
            // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–∫—Ä–æ–≤–∏—â–µ
            const buttons = document.querySelectorAll('#gameContent .treasure-btn');
            if (buttons[position]) {
                buttons[position].textContent = 'üíé';
                buttons[position].className = 'treasure-btn bg-green-500 text-white p-4 rounded h-16 text-2xl animate-pulse';
            }
            setTimeout(() => this.completeMiniGame(true), 1000);
        } else {
            this.treasureAttempts++;
            const attemptsLeft = 3 - this.treasureAttempts;
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä
            const buttons = document.querySelectorAll('#gameContent .treasure-btn');
            if (buttons[position]) {
                buttons[position].textContent = '‚ùå';
                buttons[position].disabled = true;
                buttons[position].className = 'treasure-btn bg-red-400 text-white p-4 rounded h-16 text-2xl';
            }
            
            if (attemptsLeft > 0) {
                // –û–±–Ω–æ–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø–æ–ø—ã—Ç–∫–∞—Ö
                const messageEl = document.querySelector('#gameContent .attempts-message');
                if (messageEl) {
                    messageEl.textContent = `–û—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫: ${attemptsLeft}`;
                    messageEl.className = 'attempts-message text-center text-sm text-red-600 mt-2';
                }
            } else {
                // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Å–æ–∫—Ä–æ–≤–∏—â–∞
                if (buttons[this.treasurePosition]) {
                    buttons[this.treasurePosition].textContent = 'üíé';
                    buttons[this.treasurePosition].className = 'treasure-btn bg-yellow-500 text-white p-4 rounded h-16 text-2xl animate-pulse';
                }
                setTimeout(() => this.completeMiniGame(false), 1500);
            }
        }
    }
    
    // –ò–≥—Ä–∞ "–ë–∞–ª–∞–Ω—Å"
    startBalanceGame() {
        this.balance = 50;
        this.balanceTimer = 10;
        this.balanceInterval = setInterval(() => {
            this.balanceTimer--;
            document.getElementById('balance-timer').textContent = this.balanceTimer;
            
            if (this.balanceTimer <= 0) {
                clearInterval(this.balanceInterval);
                this.completeMiniGame(true);
            }
            
            // –°–ª—É—á–∞–π–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
            this.balance += (Math.random() - 0.5) * 4;
            this.balance = Math.max(0, Math.min(100, this.balance));
            
            const marker = document.getElementById('balance-marker');
            marker.style.left = this.balance + '%';
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Ä–æ–≤–∞–ª
            if (this.balance < 25 || this.balance > 75) {
                clearInterval(this.balanceInterval);
                this.completeMiniGame(false);
            }
        }, 1000);
    }
    
    adjustBalance(amount) {
        this.balance += amount;
        this.balance = Math.max(0, Math.min(100, this.balance));
        
        const marker = document.getElementById('balance-marker');
        marker.style.left = this.balance + '%';
    }
    
    // –ò–≥—Ä–∞ "–ù–∞–π–¥–∏ –ø–∞—Ä—É"
    flipCard(index) {
        if (this.flippedCards.length < 2 && !this.flippedCards.includes(index) && !this.matchedCards.includes(index)) {
            this.flippedCards.push(index);
            const card = document.getElementById(`card-${index}`);
            card.textContent = this.matchingCards[index];
            card.className = 'h-16 w-16 bg-green-200 rounded text-2xl transition-colors';
            
            if (this.flippedCards.length === 2) {
                setTimeout(() => {
                    if (this.matchingCards[this.flippedCards[0]] === this.matchingCards[this.flippedCards[1]]) {
                        this.matchedCards.push(...this.flippedCards);
                        document.getElementById('pairs-found').textContent = this.matchedCards.length / 2;
                        
                        if (this.matchedCards.length === this.matchingCards.length) {
                            this.completeMiniGame(true);
                        }
                    } else {
                        this.flippedCards.forEach(i => {
                            const card = document.getElementById(`card-${i}`);
                            card.textContent = '‚ùì';
                            card.className = 'h-16 w-16 bg-blue-400 hover:bg-blue-500 rounded text-2xl transition-colors';
                        });
                    }
                    this.flippedCards = [];
                }, 1000);
            }
        }
    }
    
    // –ò–≥—Ä–∞ "–°–∞–π–º–æ–Ω –≥–æ–≤–æ—Ä–∏—Ç"
    startSimonGame() {
        this.simonSequence = Array.from({length: 5}, () => Math.floor(Math.random() * 4));
        this.userSimonSequence = [];
        this.currentSimonStep = 0;
        this.showSimonSequence();
    }
    
    showSimonSequence() {
        if (this.currentSimonStep < this.simonSequence.length) {
            const colorIndex = this.simonSequence[this.currentSimonStep];
            const button = document.getElementById(`simon-${colorIndex}`);
            button.style.transform = 'scale(1.2)';
            button.style.filter = 'brightness(1.5)';
            
            setTimeout(() => {
                button.style.transform = 'scale(1)';
                button.style.filter = 'brightness(1)';
                this.currentSimonStep++;
                setTimeout(() => this.showSimonSequence(), 300);
            }, 600);
        } else {
            document.getElementById('simon-status').textContent = '–¢–µ–ø–µ—Ä—å –ø–æ–≤—Ç–æ—Ä–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å!';
        }
    }
    
    simonClick(colorIndex) {
        if (this.currentSimonStep >= this.simonSequence.length) {
            this.userSimonSequence.push(colorIndex);
            
            if (this.userSimonSequence[this.userSimonSequence.length - 1] !== this.simonSequence[this.userSimonSequence.length - 1]) {
                this.completeMiniGame(false);
                return;
            }
            
            if (this.userSimonSequence.length === this.simonSequence.length) {
                this.completeMiniGame(true);
            }
        }
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–ü–æ–π–º–∞–π –ø—Ä–µ–¥–º–µ—Ç" (–ò–°–ü–†–ê–í–õ–ï–ù–û)
    startCatchGame() {
        this.fallingItems = [];
        this.catchScore = 0;
        this.playerPos = 50;
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫
        this.updateCatchGameDisplay();
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∞–¥–∞—é—â–∏—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤
        this.catchSpawnInterval = setInterval(() => {
            const newItem = {
                id: Date.now() + Math.random(),
                x: Math.random() * 80 + 10,
                y: 0
            };
            this.fallingItems.push(newItem);
        }, 800);
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä—ã
        this.catchUpdateInterval = setInterval(() => {
            // –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏–∏ –≤—Å–µ—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤
            this.fallingItems = this.fallingItems.map(item => ({
                ...item,
                y: item.y + 5
            })).filter(item => {
                // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å –∫–æ—Ä–∑–∏–Ω–æ–π
                if (item.y >= 75 && item.y <= 85 && Math.abs(item.x - this.playerPos) < 15) {
                    this.catchScore++;
                    this.updateCatchGameDisplay();
                    
                    if (this.catchScore >= 5) {
                        this.endCatchGame(true);
                        return false;
                    }
                    return false; // –£–¥–∞–ª–∏—Ç—å –ø–æ–π–º–∞–Ω–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç
                }
                
                // –£–¥–∞–ª–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç—ã –∫–æ—Ç–æ—Ä—ã–µ —É–ø–∞–ª–∏
                return item.y <= 100;
            });
            
            this.renderFallingItems();
        }, 100);
        
        // –ó–∞–∫–æ–Ω—á–∏—Ç—å –∏–≥—Ä—É —á–µ—Ä–µ–∑ 15 —Å–µ–∫—É–Ω–¥
        this.catchGameTimeout = setTimeout(() => {
            this.endCatchGame(this.catchScore >= 5);
        }, 15000);
    }
    
    endCatchGame(success) {
        if (this.catchSpawnInterval) clearInterval(this.catchSpawnInterval);
        if (this.catchUpdateInterval) clearInterval(this.catchUpdateInterval);
        if (this.catchGameTimeout) clearTimeout(this.catchGameTimeout);
        
        this.completeMiniGame(success);
    }
    
    updateCatchGameDisplay() {
        const scoreElement = document.getElementById('catch-score');
        if (scoreElement) {
            scoreElement.textContent = `–ü–æ–π–º–∞–Ω–æ: ${this.catchScore}/5`;
        }
    }
    
    moveCatchPlayer(direction) {
        if (direction === 'left') {
            this.playerPos = Math.max(10, this.playerPos - 15);
        } else if (direction === 'right') {
            this.playerPos = Math.min(90, this.playerPos + 15);
        }
        
        const bucket = document.getElementById('catch-bucket');
        if (bucket) {
            bucket.style.left = this.playerPos + '%';
        }
    }
    
    renderFallingItems() {
        const gameArea = document.getElementById('catch-game-area');
        if (!gameArea) return;
        
        // –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã
        const oldItems = gameArea.querySelectorAll('.falling-item');
        oldItems.forEach(item => item.remove());
        
        // –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã
        this.fallingItems.forEach((item) => {
            const itemElement = document.createElement('div');
            itemElement.className = 'falling-item absolute w-6 h-6 bg-yellow-400 rounded-full cursor-pointer flex items-center justify-center text-xs';
            itemElement.style.left = item.x + '%';
            itemElement.style.top = item.y + '%';
            itemElement.style.transform = 'translate(-50%, -50%)';
            itemElement.innerHTML = '‚≠ê';
            itemElement.style.zIndex = '5';
            gameArea.appendChild(itemElement);
        });
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–ü–æ–ø–∞–¥–∏ –≤ —Ü–µ–ª—å" (–ò–°–ü–†–ê–í–õ–ï–ù–û)
    startTargetGame() {
        this.targetScore = 0;
        this.targetPos = { x: 50, y: 50 };
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫
        const scoreElement = document.getElementById('target-score');
        if (scoreElement) {
            scoreElement.textContent = `–ü–æ–ø–∞–¥–∞–Ω–∏–π: 0/3`;
        }
        
        // –ü–µ—Ä–≤–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –º–∏—à–µ–Ω–∏
        this.moveTarget();
        
        // –ò–Ω—Ç–µ—Ä–≤–∞–ª –¥–≤–∏–∂–µ–Ω–∏—è –º–∏—à–µ–Ω–∏
        this.targetGameInterval = setInterval(() => {
            this.moveTarget();
        }, 1500);
        
        // –ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
        this.targetGameTimeout = setTimeout(() => {
            if (this.targetGameInterval) {
                clearInterval(this.targetGameInterval);
                this.completeMiniGame(this.targetScore >= 3);
            }
        }, 10000);
    }
    
    moveTarget() {
        this.targetPos = {
            x: Math.random() * 70 + 15, // –ë–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã
            y: Math.random() * 70 + 15
        };
        
        const target = document.getElementById('moving-target');
        if (target) {
            target.style.left = this.targetPos.x + '%';
            target.style.top = this.targetPos.y + '%';
            target.style.transition = 'all 0.3s ease';
        }
    }
    
    hitTarget() {
        this.targetScore++;
        const scoreElement = document.getElementById('target-score');
        if (scoreElement) {
            scoreElement.textContent = `–ü–æ–ø–∞–¥–∞–Ω–∏–π: ${this.targetScore}/3`;
        }
        
        // –≠—Ñ—Ñ–µ–∫—Ç –ø–æ–ø–∞–¥–∞–Ω–∏—è
        const target = document.getElementById('moving-target');
        if (target) {
            target.style.transform = 'translate(-50%, -50%) scale(1.2)';
            setTimeout(() => {
                target.style.transform = 'translate(-50%, -50%) scale(1)';
            }, 200);
        }
        
        if (this.targetScore >= 3) {
            clearInterval(this.targetGameInterval);
            clearTimeout(this.targetGameTimeout);
            this.completeMiniGame(true);
        } else {
            // –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –º–∏—à–µ–Ω—å –ø–æ—Å–ª–µ –ø–æ–ø–∞–¥–∞–Ω–∏—è
            setTimeout(() => this.moveTarget(), 300);
        }
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–í–∑–ª–æ–º–∞–π –∫–æ–¥" (–ò–°–ü–†–ê–í–õ–ï–ù–û)
    enterCodeDigit(digit) {
        if (this.codeAttempt.length < 4) {
            this.codeAttempt.push(digit);
            
            const slot = document.getElementById(`code-slot-${this.codeAttempt.length - 1}`);
            if (slot) {
                slot.textContent = digit;
                slot.className = 'w-8 h-8 border-2 border-blue-400 rounded flex items-center justify-center bg-blue-50 font-bold';
            }
            
            if (this.codeAttempt.length === 4) {
                // –ü–æ–∫–∞–∑–∞—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é –ø—Ä–æ–≤–µ—Ä–∫–∏
                for (let i = 0; i < 4; i++) {
                    const slot = document.getElementById(`code-slot-${i}`);
                    if (slot) {
                        slot.className = 'w-8 h-8 border-2 border-yellow-400 rounded flex items-center justify-center bg-yellow-100 font-bold animate-pulse';
                    }
                }
                
                setTimeout(() => {
                    if (JSON.stringify(this.codeAttempt) === JSON.stringify(this.secretCode)) {
                        // –ö–æ–¥ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
                        for (let i = 0; i < 4; i++) {
                            const slot = document.getElementById(`code-slot-${i}`);
                            if (slot) {
                                slot.className = 'w-8 h-8 border-2 border-green-500 rounded flex items-center justify-center bg-green-100 font-bold';
                            }
                        }
                        setTimeout(() => this.completeMiniGame(true), 1000);
                    } else {
                        // –ö–æ–¥ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
                        for (let i = 0; i < 4; i++) {
                            const slot = document.getElementById(`code-slot-${i}`);
                            if (slot) {
                                slot.className = 'w-8 h-8 border-2 border-red-500 rounded flex items-center justify-center bg-red-100 font-bold animate-bounce';
                            }
                        }
                        
                        setTimeout(() => {
                            this.resetCode();
                            this.showMessage('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–¥! –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑.');
                        }, 1500);
                    }
                }, 1000);
            }
        }
    }
    
    resetCode() {
        this.codeAttempt = [];
        for (let i = 0; i < 4; i++) {
            const slot = document.getElementById(`code-slot-${i}`);
            if (slot) {
                slot.textContent = '?';
                slot.className = 'w-8 h-8 border-2 border-gray-400 rounded flex items-center justify-center bg-white';
            }
        }
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–°–æ–±–µ—Ä–∏ –±–∞—à–Ω—é" (–ò–°–ü–†–ê–í–õ–ï–ù–û)
    startStackTimer() {
        this.stackHeight = 0;
        this.stackTimer = 10;
        
        this.stackTimerInterval = setInterval(() => {
            this.stackTimer--;
            const timerElement = document.getElementById('stack-timer');
            if (timerElement) {
                timerElement.textContent = this.stackTimer;
            }
            
            if (this.stackTimer <= 0) {
                clearInterval(this.stackTimerInterval);
                this.completeMiniGame(this.stackHeight >= 5);
            }
        }, 1000);
    }
    
    addStackBlock() {
        if (this.stackTimer <= 0) return;
        
        this.stackHeight++;
        
        const heightElement = document.getElementById('stack-height');
        if (heightElement) {
            heightElement.textContent = this.stackHeight;
        }
        
        const stackArea = document.getElementById('stack-area');
        if (stackArea) {
            const block = document.createElement('div');
            block.className = 'w-16 h-6 bg-orange-400 border border-orange-600 mb-1 rounded';
            block.style.animation = 'fadeIn 0.2s ease-in';
            stackArea.appendChild(block);
        }
        
        if (this.stackHeight >= 5) {
            clearInterval(this.stackTimerInterval);
            this.completeMiniGame(true);
        }
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–°–∫–æ—Ä–æ—Å—Ç—å"
    startSpeedTimer() {
        this.clickCount = 0;
        this.speedTimer = 5;
        
        this.speedTimerInterval = setInterval(() => {
            this.speedTimer--;
            const timerElement = document.getElementById('speed-timer');
            if (timerElement) {
                timerElement.textContent = this.speedTimer;
            }
            
            if (this.speedTimer <= 0) {
                clearInterval(this.speedTimerInterval);
                this.completeMiniGame(this.clickCount >= 20);
            }
        }, 1000);
    }
    
    speedClick() {
        if (this.speedTimer <= 0) return;
        
        this.clickCount++;
        const countElement = document.getElementById('click-count');
        if (countElement) {
            countElement.textContent = this.clickCount;
        }
        
        if (this.clickCount >= 20) {
            clearInterval(this.speedTimerInterval);
            this.completeMiniGame(true);
        }
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–õ–∞–±–∏—Ä–∏–Ω—Ç" (–ù–û–í–û–ï)
    getMazeGameContent() {
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–æ—Å—Ç–æ–π –ª–∞–±–∏—Ä–∏–Ω—Ç 5x5
        this.mazeSize = 5;
        this.playerPos = { x: 0, y: 0 };
        this.exitPos = { x: 4, y: 4 };
        this.maze = this.generateMaze();
        
        return `
            <div class="text-center">
                <p class="mb-2">–ù–∞–π–¥–∏ –≤—ã—Ö–æ–¥ –∏–∑ –ª–∞–±–∏—Ä–∏–Ω—Ç–∞!</p>
                <p class="mb-4">üèÅ –î–æ–π–¥–∏ –¥–æ –≤—ã—Ö–æ–¥–∞ –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É</p>
                <div id="maze-grid" class="grid grid-cols-5 gap-1 mb-4 mx-auto max-w-40">
                    ${this.renderMaze()}
                </div>
                <div class="flex justify-center space-x-2">
                    <button onclick="game.moveMazePlayer('up')" class="bg-blue-500 text-white px-3 py-2 rounded">‚¨ÜÔ∏è</button>
                </div>
                <div class="flex justify-center space-x-2 mt-1">
                    <button onclick="game.moveMazePlayer('left')" class="bg-blue-500 text-white px-3 py-2 rounded">‚¨ÖÔ∏è</button>
                    <button onclick="game.moveMazePlayer('down')" class="bg-blue-500 text-white px-3 py-2 rounded">‚¨áÔ∏è</button>
                    <button onclick="game.moveMazePlayer('right')" class="bg-blue-500 text-white px-3 py-2 rounded">‚û°Ô∏è</button>
                </div>
            </div>
        `;
    }
    
    generateMaze() {
        // –ü—Ä–æ—Å—Ç–æ–π –ª–∞–±–∏—Ä–∏–Ω—Ç 5x5 –≥–¥–µ 1 = —Å—Ç–µ–Ω–∞, 0 = —Å–≤–æ–±–æ–¥–Ω–æ
        const maze = [
            [0, 1, 0, 0, 0],
            [0, 1, 0, 1, 0],
            [0, 0, 0, 1, 0],
            [1, 1, 0, 0, 0],
            [0, 0, 0, 1, 0]
        ];
        return maze;
    }
    
    renderMaze() {
        let html = '';
        for (let y = 0; y < this.mazeSize; y++) {
            for (let x = 0; x < this.mazeSize; x++) {
                const isPlayer = this.playerPos.x === x && this.playerPos.y === y;
                const isExit = this.exitPos.x === x && this.exitPos.y === y;
                const isWall = this.maze[y][x] === 1;
                
                let cellClass = 'w-8 h-8 flex items-center justify-center text-xs border ';
                let content = '';
                
                if (isPlayer) {
                    cellClass += 'bg-green-500 text-white';
                    content = 'üë§';
                } else if (isExit) {
                    cellClass += 'bg-red-500 text-white';
                    content = 'üèÅ';
                } else if (isWall) {
                    cellClass += 'bg-gray-800';
                    content = '';
                } else {
                    cellClass += 'bg-white border-gray-300';
                    content = '';
                }
                
                html += `<div class="${cellClass}">${content}</div>`;
            }
        }
        return html;
    }
    
    moveMazePlayer(direction) {
        let newX = this.playerPos.x;
        let newY = this.playerPos.y;
        
        switch (direction) {
            case 'up':
                newY = Math.max(0, newY - 1);
                break;
            case 'down':
                newY = Math.min(this.mazeSize - 1, newY + 1);
                break;
            case 'left':
                newX = Math.max(0, newX - 1);
                break;
            case 'right':
                newX = Math.min(this.mazeSize - 1, newX + 1);
                break;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å–æ —Å—Ç–µ–Ω–æ–π
        if (this.maze[newY][newX] !== 1) {
            this.playerPos = { x: newX, y: newY };
            
            // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            const mazeGrid = document.getElementById('maze-grid');
            if (mazeGrid) {
                mazeGrid.innerHTML = this.renderMaze();
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –≤—ã—Ö–æ–¥–∞
            if (newX === this.exitPos.x && newY === this.exitPos.y) {
                setTimeout(() => this.completeMiniGame(true), 500);
            }
        }
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–£–∑–æ—Ä" (–ù–û–í–û–ï)
    getPatternGameContent() {
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–∑–æ—Ä –∏–∑ —Ü–≤–µ—Ç–æ–≤
        this.pattern = this.generatePattern();
        this.userPattern = [];
        this.showingPattern = true;
        
        setTimeout(() => {
            this.showingPattern = false;
            this.updatePatternDisplay();
        }, 3000);
        
        return `
            <div class="text-center">
                <p class="mb-2">–ó–∞–ø–æ–º–Ω–∏ –∏ –ø–æ–≤—Ç–æ—Ä–∏ —É–∑–æ—Ä!</p>
                <p id="pattern-instruction" class="mb-4 text-sm text-gray-600">–ó–∞–ø–æ–º–∏–Ω–∞–π...</p>
                <div id="pattern-display" class="grid grid-cols-3 gap-2 mb-4 mx-auto max-w-32">
                    ${this.renderPattern()}
                </div>
                <div id="pattern-buttons" class="grid grid-cols-3 gap-2 mx-auto max-w-32" style="display: none;">
                    ${this.renderPatternButtons()}
                </div>
                <div class="text-xs text-gray-600 mt-2">
                    –ü—Ä–æ–≥—Ä–µ—Å—Å: <span id="pattern-progress">0</span>/${this.pattern.length}
                </div>
            </div>
        `;
    }
    
    generatePattern() {
        const colors = ['red', 'blue', 'green', 'yellow'];
        const pattern = [];
        for (let i = 0; i < 6; i++) {
            pattern.push(colors[Math.floor(Math.random() * colors.length)]);
        }
        return pattern;
    }
    
    renderPattern() {
        return this.pattern.map((color, index) => {
            const bgColor = this.getColorClass(color);
            const isVisible = this.showingPattern || this.userPattern.length > index;
            return `
                <div class="w-8 h-8 rounded border-2 ${isVisible ? bgColor : 'bg-gray-200'} ${
                    this.showingPattern && Math.floor(Date.now() / 500) % 2 === 0 ? 'animate-pulse' : ''
                }"></div>
            `;
        }).join('');
    }
    
    renderPatternButtons() {
        const colors = ['red', 'blue', 'green', 'yellow'];
        return colors.map(color => `
            <button onclick="game.addPatternColor('${color}')" class="w-8 h-8 rounded border-2 ${this.getColorClass(color)} hover:scale-110 transition-transform">
            </button>
        `).join('');
    }
    
    getColorClass(color) {
        const colorMap = {
            red: 'bg-red-500',
            blue: 'bg-blue-500',
            green: 'bg-green-500',
            yellow: 'bg-yellow-500'
        };
        return colorMap[color] || 'bg-gray-500';
    }
    
    updatePatternDisplay() {
        const instruction = document.getElementById('pattern-instruction');
        const patternDisplay = document.getElementById('pattern-display');
        const patternButtons = document.getElementById('pattern-buttons');
        
        if (instruction) instruction.textContent = '–ü–æ–≤—Ç–æ—Ä–∏ —É–∑–æ—Ä:';
        if (patternDisplay) patternDisplay.innerHTML = this.renderPattern();
        if (patternButtons) patternButtons.style.display = 'grid';
    }
    
    addPatternColor(color) {
        if (this.showingPattern) return;
        
        this.userPattern.push(color);
        
        // –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
        const progress = document.getElementById('pattern-progress');
        if (progress) progress.textContent = this.userPattern.length;
        
        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å
        const isCorrect = this.userPattern[this.userPattern.length - 1] === this.pattern[this.userPattern.length - 1];
        
        if (!isCorrect) {
            this.completeMiniGame(false);
            return;
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        this.updatePatternDisplay();
        
        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
        if (this.userPattern.length === this.pattern.length) {
            this.completeMiniGame(true);
        }
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–°–æ—Å—Ç–∞–≤—å —Å–ª–æ–≤–æ" (–ù–û–í–û–ï)
    getWordGameContent() {
        const words = ['–ö–û–¢', '–î–û–ú', '–°–ê–î', '–ú–ò–†', '–°–û–ù', '–õ–ï–°', '–ú–ê–ö', '–õ–£–ö'];
        this.targetWord = words[Math.floor(Math.random() * words.length)];
        this.availableLetters = this.shuffleWord(this.targetWord);
        this.userWord = '';
        
        return `
            <div class="text-center">
                <p class="mb-2">–°–æ—Å—Ç–∞–≤—å —Å–ª–æ–≤–æ –∏–∑ –±—É–∫–≤!</p>
                <p class="mb-4 text-lg font-bold">–¶–µ–ª—å: ${this.targetWord}</p>
                <div class="mb-4">
                    <div class="text-lg font-mono bg-gray-100 p-2 rounded min-h-8">
                        <span id="user-word">${this.userWord || '_'.repeat(this.targetWord.length)}</span>
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-2 mb-4">
                    ${this.availableLetters.map((letter, index) => `
                        <button onclick="game.addLetter('${letter}', ${index})" id="letter-${index}" class="bg-blue-500 hover:bg-blue-600 text-white p-3 rounded font-bold transition-colors">
                            ${letter}
                        </button>
                    `).join('')}
                </div>
                <div class="flex justify-center space-x-2">
                    <button onclick="game.clearWord()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                        üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å
                    </button>
                    <button onclick="game.checkWord()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                        ‚úì –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
                    </button>
                </div>
            </div>
        `;
    }
    
    shuffleWord(word) {
        return word.split('').sort(() => Math.random() - 0.5);
    }
    
    addLetter(letter, index) {
        if (this.userWord.length < this.targetWord.length) {
            this.userWord += letter;
            
            // –°–∫—Ä—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—É—é –±—É–∫–≤—É
            const letterBtn = document.getElementById(`letter-${index}`);
            if (letterBtn) {
                letterBtn.style.display = 'none';
            }
            
            // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ª–æ–≤–∞
            const userWordEl = document.getElementById('user-word');
            if (userWordEl) {
                userWordEl.textContent = this.userWord + '_'.repeat(this.targetWord.length - this.userWord.length);
            }
        }
    }
    
    clearWord() {
        this.userWord = '';
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –±—É–∫–≤—ã
        this.availableLetters.forEach((_, index) => {
            const letterBtn = document.getElementById(`letter-${index}`);
            if (letterBtn) {
                letterBtn.style.display = 'block';
            }
        });
        
        // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        const userWordEl = document.getElementById('user-word');
        if (userWordEl) {
            userWordEl.textContent = '_'.repeat(this.targetWord.length);
        }
    }
    
    checkWord() {
        this.completeMiniGame(this.userWord === this.targetWord);
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–¶–≤–µ—Ç–Ω–∞—è –∏–≥—Ä–∞" (–ù–û–í–û–ï)
    getColorGameContent() {
        const colors = [
            { name: '–ö–†–ê–°–ù–´–ô', color: 'red', textColor: 'blue' },
            { name: '–°–ò–ù–ò–ô', color: 'blue', textColor: 'green' },
            { name: '–ó–ï–õ–ï–ù–´–ô', color: 'green', textColor: 'red' },
            { name: '–ñ–ï–õ–¢–´–ô', color: 'yellow', textColor: 'purple' }
        ];
        
        this.currentColor = colors[Math.floor(Math.random() * colors.length)];
        this.colorOptions = colors.map(c => c.color).sort(() => Math.random() - 0.5);
        
        return `
            <div class="text-center">
                <p class="mb-4">–í—ã–±–µ—Ä–∏ –¶–í–ï–¢ —Ç–µ–∫—Å—Ç–∞, –∞ –Ω–µ —Ç–æ —á—Ç–æ –Ω–∞–ø–∏—Å–∞–Ω–æ!</p>
                <div class="mb-6 p-4 bg-gray-100 rounded-lg">
                    <div class="text-4xl font-bold" style="color: ${this.getActualColor(this.currentColor.textColor)}">
                        ${this.currentColor.name}
                    </div>
                </div>
                <p class="mb-4 text-sm text-gray-600">–ö–∞–∫–æ–≥–æ —Ü–≤–µ—Ç–∞ —Ç–µ–∫—Å—Ç –≤—ã—à–µ?</p>
                <div class="grid grid-cols-2 gap-3">
                    ${this.colorOptions.map(color => `
                        <button onclick="game.selectColor('${color}')" class="p-3 rounded-lg text-white font-bold transition-colors ${this.getColorButtonClass(color)}">
                            ${this.getColorName(color)}
                        </button>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    getActualColor(color) {
        const colorMap = {
            red: '#ef4444',
            blue: '#3b82f6',
            green: '#22c55e',
            yellow: '#eab308',
            purple: '#a855f7'
        };
        return colorMap[color] || '#000000';
    }
    
    getColorButtonClass(color) {
        const classMap = {
            red: 'bg-red-500 hover:bg-red-600',
            blue: 'bg-blue-500 hover:bg-blue-600',
            green: 'bg-green-500 hover:bg-green-600',
            yellow: 'bg-yellow-500 hover:bg-yellow-600'
        };
        return classMap[color] || 'bg-gray-500 hover:bg-gray-600';
    }
    
    getColorName(color) {
        const nameMap = {
            red: '–ö–†–ê–°–ù–´–ô',
            blue: '–°–ò–ù–ò–ô',
            green: '–ó–ï–õ–ï–ù–´–ô',
            yellow: '–ñ–ï–õ–¢–´–ô'
        };
        return nameMap[color] || '–¶–í–ï–¢';
    }
    
    selectColor(selectedColor) {
        this.completeMiniGame(selectedColor === this.currentColor.textColor);
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å" (–ù–û–í–û–ï)
    getSequenceGameContent() {
        const sequences = [
            { seq: [2, 4, 6, 8], next: 10, rule: '—á–µ—Ç–Ω—ã–µ —á–∏—Å–ª–∞' },
            { seq: [1, 3, 5, 7], next: 9, rule: '–Ω–µ—á–µ—Ç–Ω—ã–µ —á–∏—Å–ª–∞' },
            { seq: [1, 4, 7, 10], next: 13, rule: '+3' },
            { seq: [2, 6, 18, 54], next: 162, rule: '√ó3' },
            { seq: [1, 1, 2, 3], next: 5, rule: '–§–∏–±–æ–Ω–∞—á—á–∏' }
        ];
        
        this.currentSequence = sequences[Math.floor(Math.random() * sequences.length)];
        this.sequenceOptions = this.generateSequenceOptions(this.currentSequence.next);
        
        return `
            <div class="text-center">
                <p class="mb-4">–ù–∞–π–¥–∏ —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:</p>
                <div class="mb-6 p-4 bg-gray-100 rounded-lg">
                    <div class="text-2xl font-bold">
                        ${this.currentSequence.seq.join(', ')}, ?
                    </div>
                </div>
                <p class="mb-4 text-sm text-gray-600">–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–ª–µ–¥—É—é—â–∏–º?</p>
                <div class="grid grid-cols-2 gap-3">
                    ${this.sequenceOptions.map(option => `
                        <button onclick="game.selectSequenceNumber(${option})" class="bg-purple-500 hover:bg-purple-600 text-white p-3 rounded-lg font-bold transition-colors">
                            ${option}
                        </button>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    generateSequenceOptions(correctAnswer) {
        const options = new Set([correctAnswer]);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
        while (options.size < 4) {
            const variation = correctAnswer + (Math.random() - 0.5) * 10;
            options.add(Math.round(variation));
        }
        
        return Array.from(options).sort(() => Math.random() - 0.5);
    }
    
    selectSequenceNumber(selectedNumber) {
        this.completeMiniGame(selectedNumber === this.currentSequence.next);
    }
    
    // –¢–ï–°–¢–û–í–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –û–¢–õ–ê–î–ö–ò –°–û–•–†–ê–ù–ï–ù–ò–Ø
    testSave() {
        console.log('üß™ –¢–ï–°–¢ –°–û–•–†–ê–ù–ï–ù–ò–Ø');
        const oldMoney = this.money;
        const oldLevel = this.level;
        
        this.money += 100;
        this.level += 1;
        this.petName = 'Test Pet ' + Math.floor(Math.random() * 100);
        this.saveData();
        this.updateDisplay();
        
        console.log(`‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è: –î–µ–Ω—å–≥–∏ ${oldMoney} ‚Üí ${this.money}, –£—Ä–æ–≤–µ–Ω—å ${oldLevel} ‚Üí ${this.level}`);
        this.showMessage('üíæ –¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è - –¥–æ–±–∞–≤–ª–µ–Ω–æ 100 –º–æ–Ω–µ—Ç –∏ 1 —É—Ä–æ–≤–µ–Ω—å!');
    }
    
    testLoad() {
        console.log('üß™ –¢–ï–°–¢ –ó–ê–ì–†–£–ó–ö–ò');
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∏–º–µ–Ω–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ localStorage
        const userKeys = Object.keys(localStorage).filter(key => key.startsWith(this.gameUserId));
        console.log('üîç –ù–∞–π–¥–µ–Ω—ã –∫–ª—é—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', userKeys);
        
        const savedMoney = this.loadData('labubu_money', 100, 'number');
        const savedLevel = this.loadData('labubu_level', 1, 'number'); 
        const savedPetName = this.loadData('pet_name', 'Labubu', 'string');
        
        console.log('üìÇ –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', { savedMoney, savedLevel, savedPetName });
        console.log('üíæ –ö–ª—é—á–∏ –≤ localStorage:', userKeys.length);
        this.showMessage(`üìÇ –î–∞–Ω–Ω—ã–µ: ${savedMoney} –º–æ–Ω–µ—Ç, ${savedLevel} —É—Ä–æ–≤–µ–Ω—å, ${savedPetName} (${userKeys.length} –∫–ª—é—á–µ–π)`);
    }
    
    clearSave() {
        console.log('üóëÔ∏è –û–ß–ò–°–¢–ö–ê –°–û–•–†–ê–ù–ï–ù–ò–Ø');
        const keys = [
            'labubu_stats', 'labubu_money', 'labubu_outfit',
            'labubu_level', 'labubu_experience', 'labubu_age',
            'labubu_evolution', 'labubu_last_update', 'pet_name',
            'labubu_sleeping', 'current_skin', 'unlocked_skins',
            'owned_outfits', 'last_stat_decay', 'labubu_pets', 'active_pet_id'
        ];
        
        let deletedCount = 0;
        keys.forEach(key => {
            const userKey = `${this.gameUserId}_${key}`;
            if (localStorage.getItem(userKey)) {
                localStorage.removeItem(userKey);
                deletedCount++;
                console.log('‚úÖ –£–¥–∞–ª–µ–Ω –∫–ª—é—á:', userKey);
            }
        });
        
        console.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω–æ ${deletedCount} –∫–ª—é—á–µ–π –∏–∑ ${keys.length}`);
        this.showMessage(`üóëÔ∏è –û—á–∏—â–µ–Ω–æ ${deletedCount} –∫–ª—é—á–µ–π! –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è —Å–±—Ä–æ—Å–∞.`);
    }
    
    forceSave() {
        console.log('üíæ –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û–ï –°–û–•–†–ê–ù–ï–ù–ò–ï');
        console.log('üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã:');
        console.log('- petName:', this.petName);
        console.log('- money:', this.money);
        console.log('- level:', this.level);
        console.log('- experience:', this.experience);
        console.log('- stats:', this.stats);
        
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –∫–ª—é—á–µ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        this.saveValue('pet_name', this.petName);
        this.saveValue('labubu_money', this.money);
        this.saveValue('labubu_level', this.level);
        this.saveValue('labubu_experience', this.experience);
        this.saveValue('labubu_stats', this.stats);
        this.saveValue('labubu_age', this.age);
        this.saveValue('owned_outfits', this.ownedOutfits);
        this.saveValue('last_stat_decay', this.lastStatDecay);
        
        console.log('‚úÖ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ');
        this.showMessage('üíæ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
    }
    
    checkSaveIntegrity() {
        console.log('üîç –ü–†–û–í–ï–†–ö–ê –¶–ï–õ–û–°–¢–ù–û–°–¢–ò –î–ê–ù–ù–´–•');
        
        const currentData = {
            petName: this.petName,
            money: this.money,
            level: this.level,
            experience: this.experience
        };
        
        const savedData = {
            petName: this.loadData('pet_name', 'DEFAULT'),
            money: this.loadData('labubu_money', -1, 'number'),
            level: this.loadData('labubu_level', -1, 'number'),
            experience: this.loadData('labubu_experience', -1, 'number')
        };
        
        console.log('üìä –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ:', currentData);
        console.log('üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', savedData);
        
        let issuesFound = 0;
        Object.keys(currentData).forEach(key => {
            if (currentData[key] !== savedData[key]) {
                console.warn(`‚ö†Ô∏è –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ ${key}: —Ç–µ–∫—É—â–µ–µ=${currentData[key]}, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ=${savedData[key]}`);
                issuesFound++;
            }
        });
        
        const message = issuesFound === 0 
            ? '‚úÖ –î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã!'
            : `‚ö†Ô∏è –ù–∞–π–¥–µ–Ω–æ ${issuesFound} –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π (—Å–º. –∫–æ–Ω—Å–æ–ª—å)`;
            
        this.showMessage(message);
        console.log(`üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞: ${issuesFound} –ø—Ä–æ–±–ª–µ–º`);
    }
    
    checkLevelUp() {
        const newLevel = Math.floor(this.experience / 100) + 1;
        if (newLevel > this.level) {
            this.level = newLevel;
            this.money += 50;
            this.playHappySound();
            this.showMessage('üéâ –£—Ä–æ–≤–µ–Ω—å –ø–æ–≤—ã—à–µ–Ω! +50 –º–æ–Ω–µ—Ç!');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É–Ω–¥—É–∫–æ–≤ –∑–∞ —É—Ä–æ–≤–Ω–∏
            this.checkChestReward();
        }
    }
    
    checkChestReward() {
        const chestsEarned = Math.floor(this.level / 10);
        const chestsToAdd = chestsEarned - Math.floor(this.lastChestLevel / 10);
        
        if (chestsToAdd > 0) {
            this.chestCount += chestsToAdd;
            this.lastChestLevel = this.level;
            this.showMessage(`üéÅ –ü–æ–ª—É—á–µ–Ω${chestsToAdd > 1 ? '–æ' : ''} ${chestsToAdd} —Å—É–Ω–¥—É–∫${chestsToAdd > 1 ? '–∞' : ''}!`);
            this.saveData();
        }
    }
    
    getChestsTabContent() {
        const availableChests = this.chestCount;
        const chestsFromFriends = Math.floor(this.friendsInvited / 5);
        const totalChests = availableChests + chestsFromFriends;
        
        return `
            <div class="space-y-3">
                <div class="bg-white rounded-lg p-3 shadow">
                    <h3 class="font-bold mb-2 text-purple-800 text-sm">üì¶ –°—É–Ω–¥—É–∫–∏</h3>
                    <div class="text-center mb-4">
                        <div class="text-3xl mb-2">üì¶</div>
                        <p class="text-lg font-bold">–î–æ—Å—Ç—É–ø–Ω–æ —Å—É–Ω–¥—É–∫–æ–≤: ${totalChests}</p>
                        <p class="text-xs text-gray-600">–ó–∞ —É—Ä–æ–≤–Ω–∏: ${availableChests} ‚Ä¢ –ó–∞ –¥—Ä—É–∑–µ–π: ${chestsFromFriends}</p>
                    </div>
                    
                    ${totalChests > 0 ? `
                        <button onclick="game.openChest()" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white py-3 px-4 rounded-lg font-bold transition-colors animate-pulse">
                            üéÅ –û—Ç–∫—Ä—ã—Ç—å —Å—É–Ω–¥—É–∫
                        </button>
                    ` : `
                        <div class="text-center text-gray-500 py-4">
                            <p class="mb-2">üîí –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å—É–Ω–¥—É–∫–æ–≤</p>
                            <p class="text-xs">–ü–æ–ª—É—á–∞–π—Ç–µ —É—Ä–æ–≤–Ω–∏ –∏–ª–∏ –ø—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π!</p>
                        </div>
                    `}
                </div>
                
                <div class="bg-white rounded-lg p-3 shadow">
                    <h3 class="font-bold mb-2 text-purple-800 text-sm">üéØ –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Å—É–Ω–¥—É–∫–∏</h3>
                    <div class="space-y-2 text-xs">
                        <div class="flex justify-between items-center p-2 bg-blue-50 rounded">
                            <span>üìà –ö–∞–∂–¥—ã–µ 10 —É—Ä–æ–≤–Ω–µ–π</span>
                            <span class="font-bold text-blue-600">+1 —Å—É–Ω–¥—É–∫</span>
                        </div>
                        <div class="flex justify-between items-center p-2 bg-green-50 rounded">
                            <span>üë• –ö–∞–∂–¥—ã–µ 5 –¥—Ä—É–∑–µ–π</span>
                            <span class="font-bold text-green-600">+1 —Å—É–Ω–¥—É–∫</span>
                        </div>
                    </div>
                    <div class="mt-3 text-xs text-gray-600">
                        <p>–î–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å—É–Ω–¥—É–∫–∞: ${10 - (this.level % 10)} —É—Ä–æ–≤–Ω–µ–π</p>
                        <p>–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ –¥—Ä—É–∑–µ–π: ${this.friendsInvited}/5</p>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg p-3 shadow">
                    <h3 class="font-bold mb-2 text-purple-800 text-sm">üíé –í–æ–∑–º–æ–∂–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã</h3>
                    <div class="grid grid-cols-1 gap-1 text-xs">
                        ${Object.entries(this.skins).map(([key, skin]) => `
                            <div class="flex items-center justify-between p-2 rounded" style="background-color: ${skin.color}22;">
                                <div class="flex items-center space-x-2">
                                    <span>${this.rarities[skin.rarity].emoji}</span>
                                    <span class="font-medium">${skin.name}</span>
                                    <span class="text-xs" style="color: ${this.rarities[skin.rarity].color};">${this.rarities[skin.rarity].name}</span>
                                </div>
                                <span class="font-bold">${skin.chance}%</span>
                            </div>
                        `).join('')}
                        <div class="flex items-center justify-between p-2 bg-yellow-50 rounded">
                            <div class="flex items-center space-x-2">
                                <span>üí∞</span>
                                <span class="font-medium">100 –º–æ–Ω–µ—Ç</span>
                            </div>
                            <span class="font-bold">90%</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg p-3 shadow">
                    <h3 class="font-bold mb-2 text-purple-800 text-sm">üëó –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å —Å–∫–∏–Ω–æ–≤</h3>
                    <div class="grid grid-cols-2 gap-2 max-h-40 overflow-y-auto">
                        ${this.unlockedSkins.map(skinKey => {
                            const skin = this.skins[skinKey];
                            const isActive = this.currentSkin === skinKey;
                            return `
                                <button onclick="game.selectSkin('${skinKey}')" class="p-2 rounded-lg text-xs transition-colors ${
                                    isActive ? 'bg-green-100 border-2 border-green-500' : 'bg-gray-100 hover:bg-gray-200'
                                }">
                                    <div class="text-center">
                                        <div class="w-12 h-12 mx-auto mb-1 rounded-full flex items-center justify-center text-lg" style="background-color: ${skin.color};">
                                            üê∞
                                        </div>
                                        <div class="font-medium">${skin.name}</div>
                                        <div class="text-xs" style="color: ${this.rarities[skin.rarity].color};">
                                            ${this.rarities[skin.rarity].emoji} ${this.rarities[skin.rarity].name}
                                        </div>
                                        ${isActive ? '<div class="text-green-600 font-bold mt-1">‚úì –ê–∫—Ç–∏–≤–µ–Ω</div>' : ''}
                                    </div>
                                </button>
                            `;
                        }).join('')}
                    </div>
                </div>
            </div>
        `;
    }
    
    openChest() {
        if (this.chestCount <= 0) {
            this.showMessage('‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å—É–Ω–¥—É–∫–æ–≤!');
            return;
        }
        
        this.chestCount--;
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–≥—Ä–∞–¥—É
        const random = Math.random() * 100;
        let reward = null;
        
        // 90% —à–∞–Ω—Å –Ω–∞ –º–æ–Ω–µ—Ç—ã (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ –≤—ã–ø–∞–ª–∏ —Å–∫–∏–Ω—ã)
        if (random <= 90) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–ø–∞–ª –ª–∏ —Å–∫–∏–Ω
            let skinChance = 0;
            let foundSkin = null;
            
            for (const [key, skin] of Object.entries(this.skins)) {
                skinChance += skin.chance;
                if (random <= skinChance) {
                    foundSkin = key;
                    break;
                }
            }
            
            if (foundSkin && !this.unlockedSkins.includes(foundSkin)) {
                // –í—ã–ø–∞–ª –Ω–æ–≤—ã–π —Å–∫–∏–Ω
                reward = { type: 'skin', key: foundSkin, skin: this.skins[foundSkin] };
                this.unlockedSkins.push(foundSkin);
            } else {
                // –í—ã–ø–∞–ª–∏ –º–æ–Ω–µ—Ç—ã
                reward = { type: 'money', amount: 100 };
                this.money += 100;
            }
        } else {
            // –ü—ã—Ç–∞–µ–º—Å—è –¥–∞—Ç—å —Å–∫–∏–Ω
            let cumulativeChance = 0;
            for (const [key, skin] of Object.entries(this.skins)) {
                cumulativeChance += skin.chance;
                if (random <= cumulativeChance) {
                    if (!this.unlockedSkins.includes(key)) {
                        reward = { type: 'skin', key: key, skin: skin };
                        this.unlockedSkins.push(key);
                    } else {
                        reward = { type: 'money', amount: 100 };
                        this.money += 100;
                    }
                    break;
                }
            }
        }
        
        this.playHappySound();
        this.saveData();
        this.updateDisplay();
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        this.showChestResult(reward);
    }
    
    showChestResult(reward) {
        let message = '';
        let className = '';
        
        if (reward.type === 'skin') {
            message = `üéâ –ù–æ–≤—ã–π —Å–∫–∏–Ω: ${reward.skin.name}!`;
            className = 'bg-purple-100 border-purple-500 text-purple-700';
        } else {
            message = `üí∞ –ü–æ–ª—É—á–µ–Ω–æ ${reward.amount} –º–æ–Ω–µ—Ç!`;
            className = 'bg-yellow-100 border-yellow-500 text-yellow-700';
        }
        
        // –°–æ–∑–¥–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
        modal.innerHTML = `
            <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4">
                <div class="text-center">
                    <div class="text-4xl mb-4">üéÅ</div>
                    <h3 class="text-lg font-bold mb-2">–°—É–Ω–¥—É–∫ –æ—Ç–∫—Ä—ã—Ç!</h3>
                    <div class="p-4 rounded-lg mb-4 ${className}">
                        ${message}
                    </div>
                    ${reward.type === 'skin' ? `
                        <div class="mb-4">
                            <div class="w-16 h-16 mx-auto rounded-full flex items-center justify-center text-2xl" style="background-color: ${reward.skin.color};">
                                üê∞
                            </div>
                            <p class="text-sm mt-2" style="color: ${this.rarities[reward.skin.rarity].color};">
                                ${this.rarities[reward.skin.rarity].emoji} ${this.rarities[reward.skin.rarity].name}
                            </p>
                        </div>
                    ` : ''}
                    <button onclick="this.parentElement.parentElement.parentElement.remove()" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-2 rounded-lg font-bold">
                        –û—Ç–ª–∏—á–Ω–æ!
                    </button>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
        setTimeout(() => {
            this.switchTab('chests');
        }, 100);
    }
    
    selectSkin(skinKey) {
        if (this.unlockedSkins.includes(skinKey)) {
            this.currentSkin = skinKey;
            this.saveData();
            this.updateDisplay();
            this.showMessage(`‚ú® –í—ã–±—Ä–∞–Ω —Å–∫–∏–Ω: ${this.skins[skinKey].name}!`);
            this.switchTab('chests');
        } else {
            this.showMessage('‚ùå –°–∫–∏–Ω –Ω–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!');
        }
    }
    
    checkNotifications() {
        // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ stats
        if (!this.stats || typeof this.stats !== 'object') {
            return;
        }
        
        if (this.stats.happiness < 50) {
            this.showNotification(`üò¢ ${this.petName}: –ú–Ω–µ —Å–∫—É—á–Ω–æ! –ü–æ–∏–≥—Ä–∞–π —Å–æ –º–Ω–æ–π!`, 'sad');
        }
        if (this.stats.sleep < 50) {
            this.showNotification(`üò¥ ${this.petName}: –Ø —Ö–æ—á—É —Å–ø–∞—Ç—å! –£–ª–æ–∂–∏ –º–µ–Ω—è –≤ –∫—Ä–æ–≤–∞—Ç–∫—É!`, 'sleepy');
        }
        if (this.stats.hunger < 50) {
            this.showNotification(`üçΩÔ∏è ${this.petName}: –Ø –≥–æ–ª–æ–¥–µ–Ω! –ü–æ–∫–æ—Ä–º–∏ –º–µ–Ω—è —á–µ–º-–Ω–∏–±—É–¥—å –≤–∫—É—Å–Ω—ã–º!`, 'hungry');
        }
        if (this.stats.cleanliness < 50) {
            this.showNotification(`üõÅ ${this.petName}: –Ø –≥—Ä—è–∑–Ω—ã–π! –ü–æ–º–æ–π –º–µ–Ω—è, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞!`, 'dirty');
        }
        if (this.stats.health < 50) {
            this.showNotification(`üíä ${this.petName}: –ú–Ω–µ –ø–ª–æ—Ö–æ! –í—ã–ª–µ—á–∏ –º–µ–Ω—è!`, 'sick');
        }
        if (this.stats.energy < 30) {
            this.showNotification(`‚ö° ${this.petName}: –£ –º–µ–Ω—è –º–∞–ª–æ —ç–Ω–µ—Ä–≥–∏–∏! –î–∞–π –º–Ω–µ –æ—Ç–¥–æ—Ö–Ω—É—Ç—å!`, 'tired');
        }
    }
    
    checkEvolution() {
        const currentStage = Object.entries(this.evolutionStages)
            .reverse()
            .find(([_, stage]) => this.age >= stage.minAge)?.[0] || 'baby';
        
        if (currentStage !== this.evolutionStage) {
            const oldStage = this.evolutionStages[this.evolutionStage].name;
            const newStage = this.evolutionStages[currentStage].name;
            
            this.evolutionStage = currentStage;
            this.playHappySound();
            this.showMessage(`üéâ –≠–≤–æ–ª—é—Ü–∏—è! ${this.petName} –ø—Ä–µ–≤—Ä–∞—Ç–∏–ª—Å—è –∏–∑ ${oldStage} –≤ ${newStage}!`);
            
            // –ë–æ–Ω—É—Å –∑–∞ —ç–≤–æ–ª—é—Ü–∏—é
            this.money += 100;
            this.stats.happiness = Math.min(100, this.stats.happiness + 20);
            
            console.log(`‚ú® ${this.petName} —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–ª: ${oldStage} ‚Üí ${newStage} (–≤–æ–∑—Ä–∞—Å—Ç: ${this.age} –¥–Ω–µ–π)`);
        }
    }
    
    startGameLoop() {
        setInterval(() => {
            const now = Date.now();
            const timeDiff = Math.floor((now - this.lastStatDecay) / 1000);
            
            // –°—Ç–∞—Ä–µ–Ω–∏–µ: 1 —Ä–µ–∞–ª—å–Ω—ã–π –¥–µ–Ω—å = 1 –¥–µ–Ω—å –ø–∏—Ç–æ–º—Ü–∞ (86400 —Å–µ–∫—É–Ω–¥ = 1 –¥–µ–Ω—å)
            const agingTimeDiff = Math.floor((now - this.lastUpdate) / 1000);
            if (agingTimeDiff >= 86400) {
                const daysToAdd = Math.floor(agingTimeDiff / 86400);
                this.age += daysToAdd;
                this.lastUpdate = now - (agingTimeDiff % 86400) * 1000; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Å—Ç–∞—Ç–æ–∫ –≤—Ä–µ–º–µ–Ω–∏
                this.checkEvolution();
                this.saveData();
                console.log(`üéÇ ${this.petName} —Å–æ—Å—Ç–∞—Ä–∏–ª—Å—è –Ω–∞ ${daysToAdd} –¥–Ω–µ–π! –ù–æ–≤—ã–π –≤–æ–∑—Ä–∞—Å—Ç: ${this.age}`);
            }
            
            // –°–Ω–∏–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç (300 —Å–µ–∫—É–Ω–¥)
            if (timeDiff >= 300) {
                const intervalsPassed = Math.floor(timeDiff / 300);
                
                if (!this.isSleeping) {
                    this.stats.hunger = Math.max(0, this.stats.hunger - (3 * intervalsPassed));
                    this.stats.happiness = Math.max(0, this.stats.happiness - (2 * intervalsPassed));
                    this.stats.cleanliness = Math.max(0, this.stats.cleanliness - (2 * intervalsPassed));
                    this.stats.health = Math.max(0, this.stats.health - (1 * intervalsPassed));
                    this.stats.energy = Math.min(100, this.stats.energy + (1 * intervalsPassed)); // –ú–µ–¥–ª–µ–Ω–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
                    this.stats.sleep = Math.max(0, this.stats.sleep - (3 * intervalsPassed));
                    
                    this.checkNotifications();
                } else {
                    // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–æ –≤—Ä–µ–º—è —Å–Ω–∞
                    this.stats.energy = Math.min(100, this.stats.energy + (8 * intervalsPassed)); // –ë—ã—Å—Ç—Ä–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
                    this.stats.sleep = Math.min(100, this.stats.sleep + (12 * intervalsPassed));
                    this.stats.hunger = Math.max(0, this.stats.hunger - (1 * intervalsPassed)); // –ú–µ–¥–ª–µ–Ω–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ
                    this.stats.happiness = Math.max(0, this.stats.happiness - (1 * intervalsPassed));
                    this.stats.cleanliness = Math.max(0, this.stats.cleanliness - (1 * intervalsPassed));
                    this.stats.health = Math.max(0, this.stats.health - (0.5 * intervalsPassed));
                }
                
                this.lastStatDecay = now;
                this.saveData();
                this.updateDisplay();
            }
        }, 60000); // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
    }
    
    startNotificationTimer() {
        setInterval(() => {
            const now = Date.now();
            const timeSinceLastNotification = now - this.lastNotification;
            
            // 30 –º–∏–Ω—É—Ç = 1800000 –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥
            if (timeSinceLastNotification >= 1800000) {
                this.showNotification(`üí≠ ${this.petName}: –¢—ã –Ω–µ –∑–∞–±—ã–ª –æ–±–æ –º–Ω–µ? –Ø —Å–∫—É—á–∞—é!`, 'reminder');
                this.lastNotification = now;
                localStorage.setItem('shared_labubu_last_notification', now.toString());
            }
        }, 60000); // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
    }
}

// –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
let game;
document.addEventListener('DOMContentLoaded', () => {
    console.log('üöÄ DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã...');
    game = new LabubuCareGame();
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(() => {
        if (game) {
            console.log('üîÑ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è...');
            game.updateDisplay();
        }
    }, 2000);
});
</script>

</body>
</html>
