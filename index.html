<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Labubu TBB Game - –ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .notification-enter {
            animation: slideInRight 0.3s ease-out;
        }
        .notification-exit {
            animation: fadeOut 0.3s ease-out;
        }
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        .pet-bounce {
            animation: bounce 2s infinite;
        }
        .pet-sleep {
            animation: pulse 2s infinite;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-pink-100 via-purple-100 to-blue-100 min-h-screen">

<!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
<div id="notifications" class="fixed top-4 right-4 z-50 space-y-2"></div>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–≥—Ä—ã -->
<div class="max-w-lg mx-auto bg-gradient-to-b from-pink-100 to-purple-100 rounded-xl p-4 shadow-lg min-h-screen">
    
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –ø–æ–≥–æ–¥–æ–π –∏ –≤—Ä–µ–º–µ–Ω–µ–º -->
    <div class="text-center mb-4">
        <div class="flex justify-between items-center mb-2">
            <div class="text-sm" id="timeOfDay">‚òÄÔ∏è</div>
            <div class="text-center">
                <h1 class="text-xl font-bold text-purple-800">üê∞ <span id="petNameDisplay">Labubu</span> Care</h1>
                <div id="nameEditSection" class="hidden mt-2">
                    <input type="text" id="nameInput" class="text-sm px-2 py-1 border rounded" maxlength="15">
                    <div class="mt-1">
                        <button id="saveNameBtn" class="text-xs bg-blue-500 text-white px-2 py-1 rounded mr-1">‚úì</button>
                        <button id="cancelNameBtn" class="text-xs bg-gray-500 text-white px-2 py-1 rounded">‚úï</button>
                    </div>
                </div>
                <button id="editNameBtn" class="text-xs text-purple-600 hover:text-purple-800 mt-1">‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è</button>
            </div>
            <div class="text-sm" id="weather">‚òÄÔ∏è</div>
        </div>
        <div class="flex justify-between text-xs">
            <span id="levelDisplay">Lv.1</span>
            <span id="moneyDisplay">üí∞100</span>
            <span id="expDisplay">‚≠ê0/100</span>
            <span id="ageDisplay">üéÇ0–¥</span>
            <button id="soundToggle" class="text-xs">üîä</button>
        </div>
        <div id="collaboratorsInfo" class="text-xs text-purple-600 mt-1 hidden"></div>
    </div>

    <!-- –ü–µ—Ä—Å–æ–Ω–∞–∂ Labubu -->
    <div class="text-center mb-4 bg-white rounded-lg p-6 shadow">
        <div class="mb-4 relative inline-block">
            <img id="petImage" src="https://i.pinimg.com/474x/49/b9/bc/49b9bc9d7961d675e91a963b192c16a9.jpg" alt="Labubu" class="w-32 h-32 mx-auto object-contain">
            
            <!-- –û–¥–µ–∂–¥–∞ -->
            <div class="absolute inset-0" id="outfitContainer"></div>
            
            <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã -->
            <div id="sleepIndicator" class="absolute -top-2 -right-2 text-lg animate-pulse hidden">üí§</div>
            <div id="moodIndicator" class="absolute -top-1 -left-1 text-sm"></div>
            <div id="criticalIndicator" class="absolute inset-0 bg-red-500 bg-opacity-20 rounded-full animate-pulse hidden"></div>
        </div>
        
        <div class="text-2xl mb-2" id="moodEmoji">üòä</div>
        <div class="text-sm text-gray-600 font-medium" id="moodStatus">–°—á–∞—Å—Ç–ª–∏–≤</div>
        <div class="text-xs text-purple-600 mt-1" id="evolutionStage">–ú–∞–ª—ã—à</div>
        <div id="currentOutfit" class="text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded-full mt-2 inline-block hidden"></div>
        <div class="text-xs text-gray-500 mt-1">üéÇ –í–æ–∑—Ä–∞—Å—Ç: <span id="ageText">0</span> –¥–Ω–µ–π</div>
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
    <div id="gameMessage" class="bg-yellow-100 border border-yellow-400 text-yellow-700 px-3 py-2 rounded mb-3 text-center text-xs hidden"></div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
    <div class="mb-4 bg-white rounded-lg p-3 shadow">
        <div id="statsContainer"></div>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∏ -->
    <div class="flex mb-3 bg-white rounded-lg p-1 shadow text-xs">
        <button class="tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors bg-purple-500 text-white" data-tab="care">üîß –£—Ö–æ–¥</button>
        <button class="tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors text-purple-500 hover:bg-purple-50" data-tab="games">üéÆ –ò–≥—Ä—ã</button>
        <button class="tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors text-purple-500 hover:bg-purple-50" data-tab="shop">üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω</button>
        <button class="tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors text-purple-500 hover:bg-purple-50" data-tab="pets">üê∞ –ü–∏—Ç–æ–º—Ü—ã</button>
        <button class="tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors text-purple-500 hover:bg-purple-50" data-tab="info">‚ÑπÔ∏è –ò–Ω—Ñ–æ</button>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ -->
    <div id="tabContent"></div>
</div>

<!-- –ú–æ–¥–∞–ª –º–∏–Ω–∏-–∏–≥—Ä—ã -->
<div id="miniGameModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4 max-h-96 overflow-y-auto">
        <h3 id="gameTitle" class="text-lg font-bold mb-4"></h3>
        <div id="gameContent"></div>
        <button id="cancelGameBtn" class="mt-4 bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded w-full transition-colors">–û—Ç–º–µ–Ω–∞</button>
    </div>
</div>

<script>
class LabubuCareGame {
    constructor() {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
        this.initializeData();
        
        // –ó–≤—É–∫–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
        this.audioContext = null;
        this.soundEnabled = localStorage.getItem('sound_enabled') !== 'false';
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        this.activeTab = 'care';
        this.currentMiniGame = null;
        this.notifications = [];
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        this.init();
        this.startGameLoop();
        this.startNotificationTimer();
    }
    
    initializeData() {
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        this.stats = this.loadData('shared_labubu_stats', {
            hunger: 100, happiness: 100, cleanliness: 100,
            health: 100, energy: 100, sleep: 100
        });
        
        this.money = parseInt(localStorage.getItem('shared_labubu_money')) || 100;
        this.outfit = localStorage.getItem('shared_labubu_outfit') || 'default';
        this.level = parseInt(localStorage.getItem('shared_labubu_level')) || 1;
        this.experience = parseInt(localStorage.getItem('shared_labubu_experience')) || 0;
        this.age = parseInt(localStorage.getItem('shared_labubu_age')) || 0;
        this.evolutionStage = localStorage.getItem('shared_labubu_evolution') || 'baby';
        this.lastUpdate = parseInt(localStorage.getItem('shared_labubu_last_update')) || Date.now();
        this.lastNotification = parseInt(localStorage.getItem('shared_labubu_last_notification')) || Date.now();
        this.petName = localStorage.getItem('shared_pet_name') || 'Labubu';
        this.isSleeping = localStorage.getItem('shared_labubu_sleeping') === 'true';
        this.telegramConnected = localStorage.getItem('telegram_connected') === 'true';
        this.telegramChatId = localStorage.getItem('telegram_chat_id') || '';
        this.gameUserId = localStorage.getItem('game_user_id') || this.generateUserId();
        
        this.pets = this.loadData('shared_labubu_pets', [
            { id: 'pet1', name: 'Labubu', stats: this.stats, outfit: this.outfit, age: this.age, evolutionStage: this.evolutionStage }
        ]);
        this.activePetId = localStorage.getItem('shared_active_pet_id') || 'pet1';
        
        // –≠–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–µ —Å—Ç–∞–¥–∏–∏ (—Å –≤–∞—à–∏–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º)
        this.evolutionStages = {
            baby: { name: '–ú–∞–ª—ã—à', minAge: 0, image: 'https://i.pinimg.com/474x/49/b9/bc/49b9bc9d7961d675e91a963b192c16a9.jpg' },
            child: { name: '–†–µ–±–µ–Ω–æ–∫', minAge: 7, image: 'https://i.pinimg.com/474x/49/b9/bc/49b9bc9d7961d675e91a963b192c16a9.jpg' },
            teen: { name: '–ü–æ–¥—Ä–æ—Å—Ç–æ–∫', minAge: 30, image: 'https://i.pinimg.com/474x/49/b9/bc/49b9bc9d7961d675e91a963b192c16a9.jpg' },
            adult: { name: '–í–∑—Ä–æ—Å–ª—ã–π', minAge: 60, image: 'https://i.pinimg.com/474x/49/b9/bc/49b9bc9d7961d675e91a963b192c16a9.jpg' },
            elder: { name: '–ú—É–¥—Ä–µ—Ü', minAge: 100, image: 'https://i.pinimg.com/474x/49/b9/bc/49b9bc9d7961d675e91a963b192c16a9.jpg' }
        };
        
        // –û–¥–µ–∂–¥–∞ —Å –ø–æ–≤—ã—à–µ–Ω–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏
        this.outfits = {
            default: { name: '–û–±—ã—á–Ω–∞—è –æ–¥–µ–∂–¥–∞', price: 0, emoji: 'üëï', description: '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Å—Ç–∏–ª—å' },
            cute: { name: '–ú–∏–ª–∞—è —à–∞–ø–æ—á–∫–∞-–∑–∞–π—á–∏–∫', price: 300, emoji: 'üê∞', description: '–û—á–∞—Ä–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –±–µ–ª–∞—è —à–∞–ø–æ—á–∫–∞ —Å —Ä–æ–∑–æ–≤—ã–º–∏ —É—à–∫–∞–º–∏', image: 'https://via.placeholder.com/100x80/ffb6c1/ffffff?text=üëí' },
            cool: { name: '–ö—Ä—É—Ç—ã–µ –æ—á–∫–∏', price: 250, emoji: 'üòé', description: '–°—Ç–∏–ª—å–Ω—ã–µ —Å–æ–ª–Ω—Ü–µ–∑–∞—â–∏—Ç–Ω—ã–µ –æ—á–∫–∏', image: 'https://via.placeholder.com/80x40/000000/ffffff?text=üï∂Ô∏è' },
            formal: { name: '–î–µ–ª–æ–≤–æ–π –∫–æ—Å—Ç—é–º', price: 400, emoji: 'ü§µ', description: '–≠–ª–µ–≥–∞–Ω—Ç–Ω—ã–π —á–µ—Ä–Ω—ã–π –∫–æ—Å—Ç—é–º —Å –≥–∞–ª—Å—Ç—É–∫–æ–º', image: 'https://via.placeholder.com/80x96/2c3e50/ffffff?text=ü§µ' },
            winter: { name: '–ó–∏–º–Ω—è—è –∫—É—Ä—Ç–∫–∞', price: 350, emoji: 'üß•', description: '–¢–µ–ø–ª–∞—è –∫—É—Ä—Ç–∫–∞ –¥–ª—è —Ö–æ–ª–æ–¥–Ω–æ–π –ø–æ–≥–æ–¥—ã' },
            summer: { name: '–õ–µ—Ç–Ω—è—è –ø–∞–Ω–∞–º–∞', price: 280, emoji: 'üëí', description: '–ó–∞—â–∏—Ç–∞ –æ—Ç —Å–æ–ª–Ω—Ü–∞ –≤ –∂–∞—Ä–∫–∏–µ –¥–Ω–∏' },
            ninja: { name: '–ö–æ—Å—Ç—é–º –Ω–∏–Ω–¥–∑—è', price: 500, emoji: 'ü•∑', description: '–°–µ–∫—Ä–µ—Ç–Ω–∞—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –¥–ª—è —Å–∫—Ä—ã—Ç–Ω–æ—Å—Ç–∏' },
            pirate: { name: '–ü–∏—Ä–∞—Ç—Å–∫–∏–π –∫–æ—Å—Ç—é–º', price: 480, emoji: 'üè¥‚Äç‚ò†Ô∏è', description: '–§–ª–∞–≥ –∏ –ø–æ–≤—è–∑–∫–∞ –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ –º–æ—Ä—Å–∫–æ–≥–æ —Ä–∞–∑–±–æ–π–Ω–∏–∫–∞' },
            wizard: { name: '–ö–æ—Å—Ç—é–º –≤–æ–ª—à–µ–±–Ω–∏–∫–∞', price: 550, emoji: 'üßô', description: '–ú–∞–≥–∏—á–µ—Å–∫–∞—è —à–ª—è–ø–∞ —Å–æ –∑–≤–µ–∑–¥–∞–º–∏' },
            school: { name: '–®–∫–æ–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞', price: 380, emoji: 'üéí', description: '–ê–∫–∫—É—Ä–∞—Ç–Ω–∞—è —à–∫–æ–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞ —Å —Ä—é–∫–∑–∞—á–∫–æ–º' },
            chef: { name: '–ö–æ—Å—Ç—é–º –ø–æ–≤–∞—Ä–∞', price: 420, emoji: 'üë®‚Äçüç≥', description: '–ë–µ–ª—ã–π –∫–æ–ª–ø–∞–∫ –∏ —Ñ–∞—Ä—Ç—É–∫ —à–µ—Ñ-–ø–æ–≤–∞—Ä–∞' },
            superhero: { name: '–°—É–ø–µ—Ä–≥–µ—Ä–æ–π', price: 600, emoji: 'ü¶∏', description: '–ü–ª–∞—â –∏ –º–∞—Å–∫–∞ –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ –≥–µ—Ä–æ—è' },
            princess: { name: '–ü—Ä–∏–Ω—Ü–µ—Å—Å–∞', price: 580, emoji: 'üë∏', description: '–†–æ—Å–∫–æ—à–Ω–æ–µ –ø–ª–∞—Ç—å–µ —Å —Ç–∏–∞—Ä–æ–π' },
            astronaut: { name: '–ö–æ—Å–º–æ–Ω–∞–≤—Ç', price: 700, emoji: 'üë®‚ÄçüöÄ', description: '–°–∫–∞—Ñ–∞–Ω–¥—Ä –¥–ª—è –∫–æ—Å–º–∏—á–µ—Å–∫–∏—Ö –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π' },
            detective: { name: '–î–µ—Ç–µ–∫—Ç–∏–≤', price: 450, emoji: 'üïµÔ∏è', description: '–ü–ª–∞—â –∏ —à–ª—è–ø–∞ —Å—ã—â–∏–∫–∞' },
            doctor: { name: '–î–æ–∫—Ç–æ—Ä', price: 520, emoji: 'üë®‚Äç‚öïÔ∏è', description: '–ë–µ–ª—ã–π —Ö–∞–ª–∞—Ç –∏ —Å—Ç–µ—Ç–æ—Å–∫–æ–ø' },
            artist: { name: '–•—É–¥–æ–∂–Ω–∏–∫', price: 380, emoji: 'üé®', description: '–ë–µ—Ä–µ—Ç –∏ –ø–∞–ª–∏—Ç—Ä–∞ —Ö—É–¥–æ–∂–Ω–∏–∫–∞' },
            dancer: { name: '–¢–∞–Ω—Ü–æ—Ä', price: 460, emoji: 'üíÉ', description: '–Ø—Ä–∫–∏–π –∫–æ—Å—Ç—é–º –¥–ª—è —Ç–∞–Ω—Ü–µ–≤' },
            knight: { name: '–†—ã—Ü–∞—Ä—å', price: 650, emoji: '‚öîÔ∏è', description: '–î–æ—Å–ø–µ—Ö–∏ –∏ –º–µ—á —Ö—Ä–∞–±—Ä–æ–≥–æ —Ä—ã—Ü–∞—Ä—è' },
            vampire: { name: '–í–∞–º–ø–∏—Ä', price: 480, emoji: 'üßõ', description: '–ß–µ—Ä–Ω—ã–π –ø–ª–∞—â —Å –∫—Ä–∞—Å–Ω–æ–π –ø–æ–¥–∫–ª–∞–¥–∫–æ–π' },
            angel: { name: '–ê–Ω–≥–µ–ª', price: 550, emoji: 'üëº', description: '–ë–µ–ª—ã–µ –∫—Ä—ã–ª—å—è –∏ –Ω–∏–º–±' },
            robot: { name: '–†–æ–±–æ—Ç', price: 600, emoji: 'ü§ñ', description: '–ú–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–π –∫–æ—Å—Ç—é–º –±—É–¥—É—â–µ–≥–æ' }
        };
        
        // –ï–¥–∞
        this.food = [
            { name: '–ü–µ—á–µ–Ω—å–µ', hunger: 20, price: 8, emoji: 'üç™', happiness: 5 },
            { name: '–§—Ä—É–∫—Ç—ã', hunger: 30, price: 15, emoji: 'üçé', health: 5 },
            { name: '–°—É—à–∏', hunger: 50, price: 30, emoji: 'üç£', happiness: 10 },
            { name: '–¢–æ—Ä—Ç', hunger: 40, happiness: 15, price: 35, emoji: 'üç∞' },
            { name: '–ú–æ—Ä–æ–∂–µ–Ω–æ–µ', hunger: 25, happiness: 20, price: 25, emoji: 'üç¶' },
            { name: '–ü–∏—Ü—Ü–∞', hunger: 60, price: 40, emoji: 'üçï', happiness: 10 },
            { name: '–í–∏—Ç–∞–º–∏–Ω—ã', health: 30, price: 50, emoji: 'üíä' },
            { name: '–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫', energy: 40, price: 30, emoji: '‚ö°' },
            { name: '–ë—É—Ä–≥–µ—Ä', hunger: 45, price: 28, emoji: 'üçî', happiness: 8 },
            { name: '–†—ã–±–∞', hunger: 35, health: 10, price: 22, emoji: 'üêü' },
            { name: '–°–∞–ª–∞—Ç', health: 15, cleanliness: 10, price: 18, emoji: 'ü•ó' },
            { name: '–ú–æ–ª–æ–∫–æ', hunger: 15, health: 8, price: 12, emoji: 'ü•õ' }
        ];
        
        // 20 –º–∏–Ω–∏-–∏–≥—Ä
        this.miniGames = [
            { id: 'memory', name: '–ú–µ–º–æ—Ä–∏', emoji: 'üß†', description: '–ó–∞–ø–æ–º–Ω–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å', reward: { happiness: 25, experience: 20, money: 15 } },
            { id: 'reaction', name: '–†–µ–∞–∫—Ü–∏—è', emoji: '‚ö°', description: '–ù–∞–∂–º–∏ –∫–æ–≥–¥–∞ –ø–æ—è–≤–∏—Ç—Å—è —Å–∏–≥–Ω–∞–ª', reward: { happiness: 20, experience: 15, money: 10 } },
            { id: 'math', name: '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', emoji: 'üî¢', description: '–†–µ—à–∏ –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä', reward: { happiness: 30, experience: 25, money: 20 } },
            { id: 'puzzle', name: '–ü–∞–∑–ª', emoji: 'üß©', description: '–°–æ–±–µ—Ä–∏ —á–∏—Å–ª–∞ –ø–æ –ø–æ—Ä—è–¥–∫—É', reward: { happiness: 35, experience: 30, money: 25 } },
            { id: 'quiz', name: '–í–∏–∫—Ç–æ—Ä–∏–Ω–∞', emoji: 'ü§î', description: '–û—Ç–≤–µ—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å', reward: { happiness: 28, experience: 22, money: 18 } },
            { id: 'rhythm', name: '–†–∏—Ç–º', emoji: 'üéµ', description: '–ü–æ–≤—Ç–æ—Ä–∏ —Ä–∏—Ç–º', reward: { happiness: 40, experience: 25, money: 20 } },
            { id: 'treasure', name: '–ö–ª–∞–¥', emoji: 'üíé', description: '–ù–∞–π–¥–∏ —Å–æ–∫—Ä–æ–≤–∏—â–µ', reward: { happiness: 20, experience: 15, money: 35 } },
            { id: 'balance', name: '–ë–∞–ª–∞–Ω—Å', emoji: '‚öñÔ∏è', description: '–£–¥–µ—Ä–∂–∏ —Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ', reward: { happiness: 25, experience: 20, money: 15 } },
            { id: 'matching', name: '–ù–∞–π–¥–∏ –ø–∞—Ä—É', emoji: 'üÉè', description: '–ù–∞–π–¥–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏', reward: { happiness: 30, experience: 25, money: 22 } },
            { id: 'simon', name: '–°–∞–π–º–æ–Ω –≥–æ–≤–æ—Ä–∏—Ç', emoji: 'üéØ', description: '–ü–æ–≤—Ç–æ—Ä–∏ –∫–æ–º–∞–Ω–¥—ã –°–∞–π–º–æ–Ω–∞', reward: { happiness: 32, experience: 28, money: 25 } },
            { id: 'word', name: '–°–æ—Å—Ç–∞–≤—å —Å–ª–æ–≤–æ', emoji: 'üìù', description: '–°–æ—Å—Ç–∞–≤—å —Å–ª–æ–≤–æ –∏–∑ –±—É–∫–≤', reward: { happiness: 35, experience: 30, money: 28 } },
            { id: 'color', name: '–¶–≤–µ—Ç–Ω–∞—è –∏–≥—Ä–∞', emoji: 'üåà', description: '–£–≥–∞–¥–∞–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ü–≤–µ—Ç', reward: { happiness: 28, experience: 22, money: 18 } },
            { id: 'sequence', name: '–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å', emoji: 'üî§', description: '–ù–∞–π–¥–∏ —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç', reward: { happiness: 33, experience: 27, money: 24 } },
            { id: 'target', name: '–ü–æ–ø–∞–¥–∏ –≤ —Ü–µ–ª—å', emoji: 'üéØ', description: '–ü–æ–ø–∞–¥–∏ –≤ –¥–≤–∏–∂—É—â—É—é—Å—è –º–∏—à–µ–Ω—å', reward: { happiness: 30, experience: 25, money: 20 } },
            { id: 'catch', name: '–ü–æ–π–º–∞–π –ø—Ä–µ–¥–º–µ—Ç', emoji: 'ü™£', description: '–ü–æ–π–º–∞–π –ø–∞–¥–∞—é—â–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã', reward: { happiness: 35, experience: 28, money: 26 } },
            { id: 'maze', name: '–õ–∞–±–∏—Ä–∏–Ω—Ç', emoji: 'üåÄ', description: '–ù–∞–π–¥–∏ –≤—ã—Ö–æ–¥ –∏–∑ –ª–∞–±–∏—Ä–∏–Ω—Ç–∞', reward: { happiness: 40, experience: 35, money: 30 } },
            { id: 'code', name: '–í–∑–ª–æ–º–∞–π –∫–æ–¥', emoji: 'üîê', description: '–£–≥–∞–¥–∞–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥', reward: { happiness: 38, experience: 32, money: 28 } },
            { id: 'stack', name: '–°–æ–±–µ—Ä–∏ –±–∞—à–Ω—é', emoji: 'üèóÔ∏è', description: '–ü–æ—Å—Ç—Ä–æ–π –≤—ã—Å–æ–∫—É—é –±–∞—à–Ω—é', reward: { happiness: 36, experience: 30, money: 25 } },
            { id: 'speed', name: '–°–∫–æ—Ä–æ—Å—Ç—å', emoji: 'üí®', description: '–ù–∞–∂–º–∏ –∫–∞–∫ –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–µ–µ', reward: { happiness: 25, experience: 20, money: 15 } },
            { id: 'pattern', name: '–£–∑–æ—Ä', emoji: 'üé®', description: '–ü–æ–≤—Ç–æ—Ä–∏ —É–∑–æ—Ä', reward: { happiness: 34, experience: 28, money: 23 } }
        ];
    }
    
    loadData(key, defaultValue) {
        const saved = localStorage.getItem(key);
        return saved ? JSON.parse(saved) : defaultValue;
    }
    
    saveData() {
        localStorage.setItem('shared_labubu_stats', JSON.stringify(this.stats));
        localStorage.setItem('shared_labubu_money', this.money.toString());
        localStorage.setItem('shared_labubu_outfit', this.outfit);
        localStorage.setItem('shared_labubu_level', this.level.toString());
        localStorage.setItem('shared_labubu_experience', this.experience.toString());
        localStorage.setItem('shared_labubu_age', this.age.toString());
        localStorage.setItem('shared_labubu_evolution', this.evolutionStage);
        localStorage.setItem('shared_labubu_last_update', Date.now().toString());
        localStorage.setItem('shared_pet_name', this.petName);
        localStorage.setItem('shared_labubu_sleeping', this.isSleeping.toString());
        localStorage.setItem('shared_labubu_pets', JSON.stringify(this.pets));
        localStorage.setItem('shared_active_pet_id', this.activePetId);
        localStorage.setItem('sound_enabled', this.soundEnabled.toString());
        localStorage.setItem('telegram_connected', this.telegramConnected.toString());
        localStorage.setItem('game_user_id', this.gameUserId);
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ Telegram
        this.updateTelegramStats();
    }
    
    init() {
        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫
        this.updateTimeAndWeather();
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        this.initEventListeners();
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
        this.switchTab('care');
    }
    
    initEventListeners() {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
        document.addEventListener('click', (e) => {
            // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–º–µ–Ω–∏
            if (e.target.id === 'editNameBtn') {
                this.showNameEdit();
            } else if (e.target.id === 'saveNameBtn') {
                this.saveNameEdit();
            } else if (e.target.id === 'cancelNameBtn') {
                this.cancelNameEdit();
            }
            // –ó–≤—É–∫
            else if (e.target.id === 'soundToggle') {
                this.toggleSound();
            }
            // –í–∫–ª–∞–¥–∫–∏
            else if (e.target.classList.contains('tab-btn')) {
                this.switchTab(e.target.dataset.tab);
            }
            // –ú–∏–Ω–∏-–∏–≥—Ä—ã
            else if (e.target.id === 'cancelGameBtn') {
                this.closeMiniGame();
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter –¥–ª—è –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏
        document.addEventListener('keypress', (e) => {
            if (e.target.id === 'nameInput' && e.key === 'Enter') {
                this.saveNameEdit();
            }
        });
    }
    
    updateTimeAndWeather() {
        const hour = new Date().getHours();
        const timeElement = document.getElementById('timeOfDay');
        const weatherElement = document.getElementById('weather');
        
        if (hour >= 6 && hour < 12) timeElement.textContent = 'üåÖ';
        else if (hour >= 12 && hour < 18) timeElement.textContent = '‚òÄÔ∏è';
        else if (hour >= 18 && hour < 22) timeElement.textContent = 'üåÜ';
        else timeElement.textContent = 'üåô';
        
        const weathers = ['‚òÄÔ∏è', '‚òÅÔ∏è', 'üåßÔ∏è', '‚ùÑÔ∏è'];
        weatherElement.textContent = weathers[Math.floor(Math.random() * weathers.length)];
    }
    
    updateDisplay() {
        // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
        const petNameDisplay = document.getElementById('petNameDisplay');
        const levelDisplay = document.getElementById('levelDisplay');
        const moneyDisplay = document.getElementById('moneyDisplay');
        const expDisplay = document.getElementById('expDisplay');
        const ageDisplay = document.getElementById('ageDisplay');
        const ageText = document.getElementById('ageText');
        const soundToggle = document.getElementById('soundToggle');
        
        if (petNameDisplay) petNameDisplay.textContent = this.petName;
        if (levelDisplay) levelDisplay.textContent = `Lv.${this.level}`;
        if (moneyDisplay) moneyDisplay.textContent = `üí∞${this.money}`;
        if (expDisplay) expDisplay.textContent = `‚≠ê${this.experience}/100`;
        if (ageDisplay) ageDisplay.textContent = `üéÇ${this.age}–¥`;
        if (ageText) ageText.textContent = this.age;
        
        // –ó–≤—É–∫
        if (soundToggle) soundToggle.textContent = this.soundEnabled ? 'üîä' : 'üîá';
        
        // Telegram —Å—Ç–∞—Ç—É—Å
        const telegramBtn = document.getElementById('telegramBtn');
        const telegramStatus = document.getElementById('telegramStatus');
        
        if (this.telegramConnected) {
            if (telegramBtn) telegramBtn.classList.add('hidden');
            if (telegramStatus) telegramStatus.classList.remove('hidden');
        } else {
            if (telegramBtn) telegramBtn.classList.remove('hidden');
            if (telegramStatus) telegramStatus.classList.add('hidden');
        }
        
        // –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ
        const mood = this.getMood();
        const moodEmoji = document.getElementById('moodEmoji');
        const moodStatus = document.getElementById('moodStatus');
        const evolutionStage = document.getElementById('evolutionStage');
        const petImage = document.getElementById('petImage');
        
        if (moodEmoji) moodEmoji.textContent = mood.emoji;
        if (moodStatus) moodStatus.textContent = mood.status;
        if (evolutionStage) evolutionStage.textContent = this.evolutionStages[this.evolutionStage].name;
        
        // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–∏—Ç–æ–º—Ü–∞
        if (petImage) petImage.src = this.evolutionStages[this.evolutionStage].image;
        
        // –°–æ–Ω –∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
        const sleepIndicator = document.getElementById('sleepIndicator');
        const criticalIndicator = document.getElementById('criticalIndicator');
        const moodIndicator = document.getElementById('moodIndicator');
        
        if (sleepIndicator) sleepIndicator.classList.toggle('hidden', !this.isSleeping);
        
        const avgStats = Object.values(this.stats).reduce((a, b) => a + b, 0) / 6;
        if (criticalIndicator) criticalIndicator.classList.toggle('hidden', avgStats > 10);
        
        if (moodIndicator) {
            if (mood.emoji === 'ü•∞') moodIndicator.textContent = '‚ù§Ô∏è';
            else moodIndicator.textContent = '';
        }
        
        // –û–¥–µ–∂–¥–∞
        this.updateOutfit();
        
        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        this.updateStatsDisplay();
    }
    
    updateOutfit() {
        const outfitContainer = document.getElementById('outfitContainer');
        const currentOutfitEl = document.getElementById('currentOutfit');
        
        if (!outfitContainer || !currentOutfitEl) return;
        
        outfitContainer.innerHTML = '';
        
        if (this.outfit !== 'default') {
            const outfitData = this.outfits[this.outfit];
            currentOutfitEl.textContent = `${outfitData.emoji} ${outfitData.name}`;
            currentOutfitEl.classList.remove('hidden');
            
            if (outfitData.image) {
                const outfitImg = document.createElement('img');
                outfitImg.src = outfitData.image;
                outfitImg.className = 'absolute object-contain';
                
                if (this.outfit === 'cute') {
                    outfitImg.className += ' top-2 left-1/2 transform -translate-x-1/2 w-28 h-28';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'cool') {
                    outfitImg.className += ' top-8 left-1/2 transform -translate-x-1/2 w-16 h-8';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'formal') {
                    outfitImg.className += ' top-12 left-1/2 transform -translate-x-1/2 w-20 h-24';
                    outfitImg.style.zIndex = '10';
                }
                
                outfitContainer.appendChild(outfitImg);
            }
        } else {
            currentOutfitEl.classList.add('hidden');
        }
    }
    
    updateStatsDisplay() {
        const container = document.getElementById('statsContainer');
        if (!container) return;
        
        const stats = [
            { label: 'üçΩÔ∏è –ì–æ–ª–æ–¥', value: this.stats.hunger, color: 'bg-orange-500' },
            { label: 'üòä –°—á–∞—Å—Ç—å–µ', value: this.stats.happiness, color: 'bg-yellow-500' },
            { label: 'üõÅ –ß–∏—Å—Ç–æ—Ç–∞', value: this.stats.cleanliness, color: 'bg-blue-500' },
            { label: '‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ', value: this.stats.health, color: 'bg-red-500' },
            { label: '‚ö° –≠–Ω–µ—Ä–≥–∏—è', value: this.stats.energy, color: 'bg-green-500' },
            { label: 'üò¥ –°–æ–Ω', value: this.stats.sleep, color: 'bg-purple-500' }
        ];
        
        container.innerHTML = stats.map(stat => `
            <div class="mb-2">
                <div class="flex justify-between mb-1">
                    <span class="text-xs font-medium">${stat.label}</span>
                    <span class="text-xs">${stat.value}%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-1.5">
                    <div class="h-1.5 rounded-full transition-all duration-300 ${stat.color}" style="width: ${stat.value}%"></div>
                </div>
            </div>
        `).join('');
    }
    
    getMood() {
        if (this.isSleeping) return { emoji: 'üò¥', status: '–°–ø–∏—Ç' };
        
        const avg = Object.values(this.stats).reduce((a, b) => a + b, 0) / 6;
        if (avg > 90) return { emoji: 'ü•∞', status: '–í–æ—Å—Ö–∏—Ç–∏—Ç–µ–ª—å–Ω–æ' };
        if (avg > 80) return { emoji: 'üòä', status: '–û—á–µ–Ω—å —Å—á–∞—Å—Ç–ª–∏–≤' };
        if (avg > 60) return { emoji: 'üôÇ', status: '–°—á–∞—Å—Ç–ª–∏–≤' };
        if (avg > 40) return { emoji: 'üòê', status: '–ù–æ—Ä–º–∞–ª—å–Ω–æ' };
        if (avg > 20) return { emoji: 'üòü', status: '–ì—Ä—É—Å—Ç–Ω–æ' };
        if (avg > 10) return { emoji: 'üò¢', status: '–û—á–µ–Ω—å –≥—Ä—É—Å—Ç–Ω–æ' };
        return { emoji: 'üíÄ', status: '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ' };
    }
    
    showMessage(msg) {
        const messageEl = document.getElementById('gameMessage');
        messageEl.textContent = msg;
        messageEl.classList.remove('hidden');
        setTimeout(() => messageEl.classList.add('hidden'), 3000);
    }
    
    showNotification(message, type) {
        const notification = {
            id: Date.now(),
            message,
            type,
            timestamp: Date.now()
        };
        
        this.notifications.push(notification);
        
        const notificationEl = document.createElement('div');
        notificationEl.className = `p-3 rounded-lg shadow-lg text-white text-sm max-w-xs notification-enter ${this.getNotificationColor(type)}`;
        notificationEl.textContent = message;
        
        document.getElementById('notifications').appendChild(notificationEl);
        
        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram
        this.sendTelegramNotification(message, type);
        
        setTimeout(() => {
            notificationEl.classList.add('notification-exit');
            setTimeout(() => {
                if (notificationEl.parentNode) {
                    notificationEl.parentNode.removeChild(notificationEl);
                }
            }, 300);
            this.notifications = this.notifications.filter(n => n.id !== notification.id);
        }, 5000);
    }
    
    getNotificationColor(type) {
        const colors = {
            reminder: 'bg-blue-500',
            sad: 'bg-red-500',
            sleepy: 'bg-purple-500',
            hungry: 'bg-orange-500',
            dirty: 'bg-blue-600',
            sick: 'bg-red-600',
            tired: 'bg-yellow-500'
        };
        return colors[type] || 'bg-gray-500';
    }
    
    showNameEdit() {
        document.getElementById('nameEditSection').classList.remove('hidden');
        document.getElementById('editNameBtn').classList.add('hidden');
        document.getElementById('nameInput').value = this.petName;
        document.getElementById('nameInput').focus();
    }
    
    saveNameEdit() {
        const newName = document.getElementById('nameInput').value.trim();
        if (newName && newName.length <= 15) {
            this.petName = newName;
            this.showMessage(`–¢–µ–ø–µ—Ä—å –∑–æ–≤—É—Ç ${this.petName}!`);
            this.saveData();
            this.updateDisplay();
        }
        this.cancelNameEdit();
    }
    
    cancelNameEdit() {
        document.getElementById('nameEditSection').classList.add('hidden');
        document.getElementById('editNameBtn').classList.remove('hidden');
    }
    
    toggleSound() {
        this.soundEnabled = !this.soundEnabled;
        this.updateDisplay();
        this.saveData();
    }
    
    playSound(frequency, duration = 200, type = 'sine') {
        if (!this.soundEnabled) return;
        
        try {
            if (!this.audioContext) {
                this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            
            const oscillator = this.audioContext.createOscillator();
            const gainNode = this.audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(this.audioContext.destination);
            
            oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
            oscillator.type = type;
            
            gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration / 1000);
            
            oscillator.start();
            oscillator.stop(this.audioContext.currentTime + duration / 1000);
        } catch (error) {
            console.log('Sound not available');
        }
    }
    
    playHappySound() {
        this.playSound(523, 100);
        setTimeout(() => this.playSound(659, 100), 100);
        setTimeout(() => this.playSound(784, 150), 200);
    }
    
    switchTab(tab) {
        this.activeTab = tab;
        
        // –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏
        document.querySelectorAll('.tab-btn').forEach(btn => {
            if (btn.dataset.tab === tab) {
                btn.className = 'tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors bg-purple-500 text-white';
            } else {
                btn.className = 'tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors text-purple-500 hover:bg-purple-50';
            }
        });
        
        // –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç
        const content = document.getElementById('tabContent');
        content.innerHTML = this.getTabContent(tab);
    }
    
    getTabContent(tab) {
        switch (tab) {
            case 'care':
                return this.getCareTabContent();
            case 'games':
                return this.getGamesTabContent();
            case 'shop':
                return this.getShopTabContent();
            case 'pets':
                return this.getPetsTabContent();
            case 'info':
                return this.getInfoTabContent();
            default:
                return '';
        }
    }
    
    getCareTabContent() {
        const foodGrid = this.food.map((item, index) => `
            <button onclick="game.feedPet(${index})" class="bg-orange-100 hover:bg-orange-200 p-2 rounded text-xs transition-colors" ${this.isSleeping ? 'disabled' : ''}>
                <div class="text-sm">${item.emoji}</div>
                <div class="font-medium text-xs">${item.name}</div>
                <div class="text-xs text-gray-600">${item.price}üí∞</div>
            </button>
        `).join('');
        
        return `
            <div class="space-y-3">
                <div class="bg-white rounded-lg p-3 shadow">
                    <h3 class="font-bold mb-2 text-purple-800 text-sm">üçΩÔ∏è –ö–æ—Ä–º–ª–µ–Ω–∏–µ</h3>
                    <div class="grid grid-cols-4 gap-1">${foodGrid}</div>
                </div>
                <div class="bg-white rounded-lg p-3 shadow">
                    <h3 class="font-bold mb-2 text-purple-800 text-sm">‚ö° –î–µ–π—Å—Ç–≤–∏—è</h3>
                    <div class="grid grid-cols-3 gap-1">
                        <button onclick="game.washPet()" class="bg-blue-100 hover:bg-blue-200 p-2 rounded text-xs transition-colors" ${this.isSleeping ? 'disabled' : ''}>
                            <div class="text-sm">üõÅ</div>
                            <div class="font-medium">–ú—ã—Ç—å</div>
                        </button>
                        <button onclick="game.healPet()" class="bg-red-100 hover:bg-red-200 p-2 rounded text-xs transition-colors">
                            <div class="text-sm">üíä</div>
                            <div class="font-medium">–õ–µ—á–∏—Ç—å</div>
                            <div class="text-xs">30üí∞</div>
                        </button>
                        <button onclick="game.toggleSleep()" class="bg-purple-100 hover:bg-purple-200 p-2 rounded text-xs transition-colors">
                            <div class="text-sm">${this.isSleeping ? '‚òÄÔ∏è' : 'üò¥'}</div>
                            <div class="font-medium">${this.isSleeping ? '–ë—É–¥–∏—Ç—å' : '–°–ø–∞—Ç—å'}</div>
                        </button>
                    </div>
                </div>
            </div>
        `;
    }
    
    getGamesTabContent() {
        const gamesGrid = this.miniGames.map((game, index) => `
            <button onclick="game.startMiniGame(${index})" class="p-2 rounded-lg text-xs transition-colors bg-yellow-100 hover:bg-yellow-200 flex flex-col items-center" ${this.isSleeping || this.stats.energy < 15 ? 'disabled' : ''}>
                <span class="text-lg mb-1">${game.emoji}</span>
                <div class="font-medium text-center">${game.name}</div>
                <div class="text-xs text-gray-600 text-center">${game.description}</div>
                <div class="text-xs text-red-600 mt-1">-15 —ç–Ω–µ—Ä–≥–∏–∏</div>
            </button>
        `).join('');
        
        return `
            <div class="bg-white rounded-lg p-3 shadow">
                <h3 class="font-bold mb-2 text-purple-800 text-sm">üéÆ –ú–∏–Ω–∏-–∏–≥—Ä—ã</h3>
                <div class="grid grid-cols-2 gap-2">${gamesGrid}</div>
            </div>
        `;
    }
    
    getShopTabContent() {
        const outfitsList = Object.entries(this.outfits).map(([key, item]) => `
            <button onclick="game.buyOutfit('${key}')" class="w-full p-2 rounded-lg text-xs transition-colors flex items-center justify-between ${
                this.outfit === key ? 'bg-green-100 border-2 border-green-500' : 'bg-gray-100 hover:bg-gray-200'
            }">
                <div class="flex items-center space-x-2">
                    <span class="text-lg">${item.emoji}</span>
                    <div class="text-left">
                        <div class="font-medium">${item.name}</div>
                        <div class="text-xs text-gray-500">${item.description}</div>
                        <div class="text-xs text-gray-600 font-bold">
                            ${item.price === 0 ? '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ' : `${item.price}üí∞`}
                        </div>
                    </div>
                </div>
                ${this.outfit === key ? '<span class="text-green-600 font-bold">‚úì</span>' : ''}
            </button>
        `).join('');
        
        return `
            <div class="bg-white rounded-lg p-3 shadow">
                <h3 class="font-bold mb-2 text-purple-800 text-sm">üëó –ú–∞–≥–∞–∑–∏–Ω –æ–¥–µ–∂–¥—ã</h3>
                <div class="grid grid-cols-1 gap-1 max-h-64 overflow-y-auto">${outfitsList}</div>
            </div>
        `;
    }
    
    getPetsTabContent() {
        return `
            <div class="bg-white rounded-lg p-3 shadow">
                <h3 class="font-bold mb-2 text-purple-800 text-sm">üê∞ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∏—Ç–æ–º—Ü–∞–º–∏</h3>
                <button onclick="game.createNewPet()" class="w-full mb-3 p-3 bg-green-100 hover:bg-green-200 rounded-lg text-sm transition-colors">
                    ‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞
                </button>
                <div class="bg-blue-50 p-3 rounded-lg">
                    <h4 class="font-bold text-sm text-blue-800 mb-2">üë• –°–æ–≤–º–µ—Å—Ç–Ω–æ–µ –≤–æ—Å–ø–∏—Ç–∞–Ω–∏–µ</h4>
                    <p class="text-xs text-blue-700">–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏!</p>
                </div>
            </div>
        `;
    }
    
    getInfoTabContent() {
        return `
            <div class="bg-white rounded-lg p-3 shadow">
                <h3 class="font-bold mb-3 text-purple-800 text-sm">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                <div class="space-y-3 text-xs">
                    <div class="bg-blue-50 p-2 rounded">
                        <h4 class="font-bold text-blue-800 mb-1">üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã</h4>
                        <p class="text-blue-700">–ò–≥—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å –Ω–µ –ø–æ—Ç–µ—Ä—è–µ—Ç—Å—è!</p>
                    </div>
                    <div class="bg-green-50 p-2 rounded">
                        <h4 class="font-bold text-green-800 mb-1">üéÆ –ö–∞–∫ –∏–≥—Ä–∞—Ç—å</h4>
                        <ul class="list-disc list-inside text-green-700">
                            <li>–ö–æ—Ä–º–∏—Ç–µ ${this.petName} –∫–æ–≥–¥–∞ –≥–æ–ª–æ–¥–µ–Ω</li>
                            <li>–ò–≥—Ä–∞–π—Ç–µ –≤ –º–∏–Ω–∏-–∏–≥—Ä—ã –¥–ª—è –æ–ø—ã—Ç–∞</li>
                            <li>–ü–æ–∫—É–ø–∞–π—Ç–µ –æ–¥–µ–∂–¥—É –∑–∞ –º–æ–Ω–µ—Ç—ã</li>
                            <li>–°–ª–µ–¥–∏—Ç–µ –∑–∞ –≤—Å–µ–º–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞–º–∏</li>
                            <li>–í–∞—à –ø–∏—Ç–æ–º–µ—Ü —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç —Å –≤–æ–∑—Ä–∞—Å—Ç–æ–º!</li>
                        </ul>
                    </div>
                    <div class="bg-purple-50 p-2 rounded">
                        <h4 class="font-bold text-purple-800 mb-1">‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</h4>
                        <ul class="list-disc list-inside text-purple-700">
                            <li>20 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –º–∏–Ω–∏-–∏–≥—Ä</li>
                            <li>22 –≤–∏–¥–∞ –æ–¥–µ–∂–¥—ã</li>
                            <li>5 —Å—Ç–∞–¥–∏–π —ç–≤–æ–ª—é—Ü–∏–∏</li>
                            <li>–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ —Å—Ç–∞—Ä–µ–Ω–∏–µ (1 –¥–µ–Ω—å = 1 –¥–µ–Ω—å)</li>
                            <li>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</li>
                            <li>–ó–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã</li>
                        </ul>
                    </div>
                    <div class="bg-orange-50 p-2 rounded">
                        <h4 class="font-bold text-orange-800 mb-1">‚è∞ –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</h4>
                        <ul class="list-disc list-inside text-orange-700">
                            <li>–ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç: "–¢—ã –Ω–µ –∑–∞–±—ã–ª –º–µ–Ω—è?"</li>
                            <li>–ü—Ä–∏ –≥–æ–ª–æ–¥–µ < 50%: "–Ø –≥–æ–ª–æ–¥–µ–Ω!"</li>
                            <li>–ü—Ä–∏ —Å—á–∞—Å—Ç—å–µ < 50%: "–ú–Ω–µ —Å–∫—É—á–Ω–æ!"</li>
                            <li>–ü—Ä–∏ —Å–Ω–µ < 50%: "–Ø —Ö–æ—á—É —Å–ø–∞—Ç—å!"</li>
                            <li>–ü—Ä–∏ –∑–¥–æ—Ä–æ–≤—å–µ < 50%: "–ú–Ω–µ –ø–ª–æ—Ö–æ!"</li>
                            <li>–ü—Ä–∏ —á–∏—Å—Ç–æ—Ç–µ < 50%: "–Ø –≥—Ä—è–∑–Ω—ã–π!"</li>
                        </ul>
                    </div>
                    <div class="text-center text-gray-500">
                        <p>üê∞ –°–æ–∑–¥–∞–Ω–æ —Å –ª—é–±–æ–≤—å—é –¥–ª—è ${this.petName}! üíï</p>
                        <p class="text-xs mt-1">–í–µ—Ä—Å–∏—è 4.0 - HTML Edition</p>
                    </div>
                </div>
            </div>
        `;
    }
    
    // –ò–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
    feedPet(foodIndex) {
        if (this.isSleeping) {
            this.showMessage(`${this.petName} —Å–ø–∏—Ç! üò¥`);
            return;
        }
        
        const food = this.food[foodIndex];
        if (this.money >= food.price) {
            this.money -= food.price;
            this.stats.hunger = Math.min(100, this.stats.hunger + (food.hunger || 0));
            this.stats.happiness = Math.min(100, this.stats.happiness + (food.happiness || 0));
            this.stats.health = Math.min(100, this.stats.health + (food.health || 0));
            this.stats.energy = Math.min(100, this.stats.energy + (food.energy || 0));
            this.stats.cleanliness = Math.min(100, this.stats.cleanliness + (food.cleanliness || 0));
            this.experience += 10;
            
            this.playSound(800, 150);
            this.showMessage(`${this.petName} —Å—ä–µ–ª ${food.name}! ${food.emoji}`);
            this.checkLevelUp();
            this.saveData();
            this.updateDisplay();
        } else {
            this.showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
        }
    }
    
    washPet() {
        if (this.isSleeping) {
            this.showMessage(`–ù–µ –±—É–¥–∏ —Å–ø—è—â–µ–≥–æ ${this.petName}! üò¥`);
            return;
        }
        
        this.stats.cleanliness = 100;
        this.stats.happiness = Math.min(100, this.stats.happiness + 10);
        this.experience += 8;
        
        this.playSound(400, 200);
        this.showMessage(`${this.petName} —á–∏—Å—Ç—ã–π –∏ —Å—á–∞—Å—Ç–ª–∏–≤—ã–π! üõÅ`);
        this.checkLevelUp();
        this.saveData();
        this.updateDisplay();
    }
    
    healPet() {
        if (this.money >= 30) {
            this.money -= 30;
            this.stats.health = 100;
            this.stats.happiness = Math.min(100, this.stats.happiness + 5);
            this.experience += 12;
            
            this.showMessage(`${this.petName} –∑–¥–æ—Ä–æ–≤! üíä`);
            this.checkLevelUp();
            this.saveData();
            this.updateDisplay();
        } else {
            this.showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç –¥–ª—è –ª–µ—á–µ–Ω–∏—è!');
        }
    }
    
    toggleSleep() {
        this.isSleeping = !this.isSleeping;
        
        if (this.isSleeping) {
            this.playSound(300, 500);
            this.showMessage(`${this.petName} –ª–æ–∂–∏—Ç—Å—è —Å–ø–∞—Ç—å... üò¥`);
        } else {
            this.playHappySound();
            this.showMessage(`${this.petName} –ø—Ä–æ—Å–Ω—É–ª—Å—è! üòä`);
        }
        
        this.saveData();
        this.updateDisplay();
        this.switchTab('care');
    }
    
    buyOutfit(outfitKey) {
        const outfit = this.outfits[outfitKey];
        
        if (this.outfit === outfitKey) {
            this.showMessage('–≠—Ç–∞ –æ–¥–µ–∂–¥–∞ —É–∂–µ –Ω–∞–¥–µ—Ç–∞!');
            return;
        }
        
        if (this.money >= outfit.price) {
            this.money -= outfit.price;
            this.outfit = outfitKey;
            this.stats.happiness = Math.min(100, this.stats.happiness + 20);
            
            this.playHappySound();
            this.showMessage(`–ù–æ–≤–∞—è –æ–¥–µ–∂–¥–∞: ${outfit.name}! ${outfit.emoji}`);
            this.saveData();
            this.updateDisplay();
            this.switchTab('shop');
        } else {
            this.showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
        }
    }
    
    createNewPet() {
        const newPetId = `pet${this.pets.length + 1}`;
        const newPet = {
            id: newPetId,
            name: `${this.petName} ${this.pets.length + 1}`,
            stats: { hunger: 100, happiness: 100, cleanliness: 100, health: 100, energy: 100, sleep: 100 },
            outfit: 'default',
            age: 0,
            evolutionStage: 'baby'
        };
        
        this.pets.push(newPet);
        this.activePetId = newPetId;
        this.showMessage(`–ù–æ–≤—ã–π –ø–∏—Ç–æ–º–µ—Ü ${newPet.name} —Å–æ–∑–¥–∞–Ω! üéâ`);
        this.saveData();
    }
    
    startMiniGame(gameIndex) {
        if (this.isSleeping) {
            this.showMessage(`${this.petName} —Å–ø–∏—Ç! –†–∞–∑–±—É–¥–∏ –µ–≥–æ —Å–Ω–∞—á–∞–ª–∞! üò¥`);
            return;
        }
        if (this.stats.energy < 15) {
            this.showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏! –ù—É–∂–Ω–æ –æ—Ç–¥–æ—Ö–Ω—É—Ç—å.');
            return;
        }
        
        this.currentMiniGame = this.miniGames[gameIndex];
        this.showMiniGameModal();
    }
    
    showMiniGameModal() {
        document.getElementById('gameTitle').textContent = `${this.currentMiniGame.name} ${this.currentMiniGame.emoji}`;
        document.getElementById('gameContent').innerHTML = this.getMiniGameContent();
        document.getElementById('miniGameModal').classList.remove('hidden');
    }
    
    closeMiniGame() {
        document.getElementById('miniGameModal').classList.add('hidden');
        this.currentMiniGame = null;
    }
    
    getMiniGameContent() {
        const gameId = this.currentMiniGame.id;
        
        if (gameId === 'memory') {
            return this.getMemoryGameContent();
        } else if (gameId === 'reaction') {
            return this.getReactionGameContent();
        } else if (gameId === 'math') {
            return this.getMathGameContent();
        } else if (gameId === 'puzzle') {
            return this.getPuzzleGameContent();
        } else if (gameId === 'quiz') {
            return this.getQuizGameContent();
        } else if (gameId === 'rhythm') {
            return this.getRhythmGameContent();
        } else if (gameId === 'treasure') {
            return this.getTreasureGameContent();
        } else if (gameId === 'balance') {
            return this.getBalanceGameContent();
        } else if (gameId === 'matching') {
            return this.getMatchingGameContent();
        } else if (gameId === 'simon') {
            return this.getSimonGameContent();
        } else if (gameId === 'catch') {
            return this.getCatchGameContent();
        } else if (gameId === 'target') {
            return this.getTargetGameContent();
        } else if (gameId === 'code') {
            return this.getCodeGameContent();
        } else if (gameId === 'stack') {
            return this.getStackGameContent();
        } else if (gameId === 'speed') {
            return this.getSpeedGameContent();
        } else if (gameId === 'maze') {
            return this.getMazeGameContent();
        } else if (gameId === 'pattern') {
            return this.getPatternGameContent();
        } else if (gameId === 'word') {
            return this.getWordGameContent();
        } else if (gameId === 'color') {
            return this.getColorGameContent();
        } else if (gameId === 'sequence') {
            return this.getSequenceGameContent();
        } else {
            // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∏–≥—Ä
            return `
                <div class="text-center">
                    <p class="mb-4">${this.currentMiniGame.description}</p>
                    <p class="text-sm text-gray-600 mb-4">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É —á—Ç–æ–±—ã –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å!</p>
                    <button onclick="game.completeMiniGame(${Math.random() > 0.3})" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-bold transition-colors">
                        –ò–≥—Ä–∞—Ç—å!
                    </button>
                </div>
            `;
        }
    }
    
    getMemoryGameContent() {
        if (!this.gameState) this.gameState = 'waiting';
        
        return `
            <div class="text-center">
                <p class="mb-4">–ó–∞–ø–æ–º–Ω–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ü–≤–µ—Ç–æ–≤!</p>
                <div class="grid grid-cols-2 gap-2 mb-4">
                    <button onclick="game.handleMemoryClick(0)" class="h-16 bg-red-400 hover:bg-red-500 rounded transition-colors" id="memory-0">üî¥</button>
                    <button onclick="game.handleMemoryClick(1)" class="h-16 bg-blue-400 hover:bg-blue-500 rounded transition-colors" id="memory-1">üîµ</button>
                    <button onclick="game.handleMemoryClick(2)" class="h-16 bg-green-400 hover:bg-green-500 rounded transition-colors" id="memory-2">üü¢</button>
                    <button onclick="game.handleMemoryClick(3)" class="h-16 bg-yellow-400 hover:bg-yellow-500 rounded transition-colors" id="memory-3">üü°</button>
                </div>
                <button onclick="game.startMemorySequence()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded">
                    –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
                </button>
            </div>
        `;
    }
    
    getReactionGameContent() {
        return `
            <div class="text-center">
                <p class="mb-4">–ù–∞–∂–º–∏ –Ω–∞ –∑–µ–ª–µ–Ω—ã–π —Å–∏–≥–Ω–∞–ª –∫–∞–∫ –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–µ–µ!</p>
                <div id="reaction-light" class="w-20 h-20 bg-red-400 rounded-full mx-auto mb-4 transition-colors"></div>
                <button onclick="game.startReactionTest()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg">
                    –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç
                </button>
                <button onclick="game.reactionClick()" id="reaction-btn" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg hidden">
                    –ù–ê–ñ–ú–ò!
                </button>
            </div>
        `;
    }
    
    getMathGameContent() {
        const a = Math.floor(Math.random() * 10) + 1;
        const b = Math.floor(Math.random() * 10) + 1;
        const answer = a + b;
        this.mathAnswer = answer;
        
        const options = [answer - 1, answer, answer + 1].sort(() => Math.random() - 0.5);
        
        return `
            <div class="text-center">
                <p class="text-2xl mb-6">${a} + ${b} = ?</p>
                <div class="grid grid-cols-3 gap-2">
                    ${options.map(num => `
                        <button onclick="game.checkMathAnswer(${num})" class="bg-blue-500 hover:bg-blue-600 text-white p-3 rounded text-xl transition-colors">
                            ${num}
                        </button>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    getPuzzleGameContent() {
        this.puzzlePieces = [1, 2, 3, 4].sort(() => Math.random() - 0.5);
        
        return `
            <div class="text-center">
                <p class="mb-4">–†–∞—Å—Å—Ç–∞–≤—å —á–∏—Å–ª–∞ –ø–æ –ø–æ—Ä—è–¥–∫—É (1, 2, 3, 4):</p>
                <div class="grid grid-cols-4 gap-2 mb-4">
                    ${this.puzzlePieces.map((piece, index) => `
                        <button onclick="game.swapPuzzlePiece(${index})" class="bg-green-400 hover:bg-green-500 text-white p-4 rounded text-xl transition-colors">
                            ${piece}
                        </button>
                    `).join('')}
                </div>
                <p class="text-xs text-gray-600">–ù–∞–∂–º–∏ –Ω–∞ —á–∏—Å–ª–æ —á—Ç–æ–±—ã –ø–æ–º–µ–Ω—è—Ç—å –º–µ—Å—Ç–∞–º–∏ —Å —Å–æ—Å–µ–¥–Ω–∏–º</p>
            </div>
        `;
    }
    
    getQuizGameContent() {
        const questions = [
            { q: '–ö–∞–∫–æ–≥–æ —Ü–≤–µ—Ç–∞ —Å–æ–ª–Ω—Ü–µ?', answers: ['–ñ–µ–ª—Ç–æ–µ', '–°–∏–Ω–µ–µ', '–ö—Ä–∞—Å–Ω–æ–µ'], correct: 0 },
            { q: '–°–∫–æ–ª—å–∫–æ –Ω–æ–≥ —É –∫–æ—Ç–∞?', answers: ['2', '4', '6'], correct: 1 },
            { q: '–ß—Ç–æ –µ–¥—è—Ç –∫—Ä–æ–ª–∏–∫–∏?', answers: ['–ú—è—Å–æ', '–ú–æ—Ä–∫–æ–≤—å', '–†—ã–±—É'], correct: 1 },
            { q: '–°–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –≤ –Ω–µ–¥–µ–ª–µ?', answers: ['5', '6', '7'], correct: 2 },
            { q: '–ö–∞–∫–æ–π —Ü–≤–µ—Ç —É —Ç—Ä–∞–≤—ã?', answers: ['–ö—Ä–∞—Å–Ω—ã–π', '–ó–µ–ª–µ–Ω—ã–π', '–°–∏–Ω–∏–π'], correct: 1 }
        ];
        
        this.currentQuestion = questions[Math.floor(Math.random() * questions.length)];
        
        return `
            <div class="text-center">
                <p class="text-lg mb-4">${this.currentQuestion.q}</p>
                <div class="space-y-2">
                    ${this.currentQuestion.answers.map((answer, index) => `
                        <button onclick="game.checkQuizAnswer(${index})" class="w-full bg-purple-400 hover:bg-purple-500 text-white p-3 rounded transition-colors">
                            ${answer}
                        </button>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    getRhythmGameContent() {
        return `
            <div class="text-center">
                <p class="mb-4">–ü–æ–≤—Ç–æ—Ä–∏ —Ä–∏—Ç–º: üî¥üîµüî¥üîµ</p>
                <div class="flex justify-center space-x-4 mb-4">
                    <button onclick="game.addRhythmBeat(1)" class="w-16 h-16 bg-red-400 hover:bg-red-500 rounded-full text-2xl transition-colors">
                        üî¥
                    </button>
                    <button onclick="game.addRhythmBeat(0)" class="w-16 h-16 bg-blue-400 hover:bg-blue-500 rounded-full text-2xl transition-colors">
                        üîµ
                    </button>
                </div>
                <div id="rhythm-display" class="mb-4 text-lg">–í–∞—à —Ä–∏—Ç–º: </div>
                <button onclick="game.checkRhythm()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
                </button>
                <button onclick="game.resetRhythm()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded ml-2">
                    –°–±—Ä–æ—Å–∏—Ç—å
                </button>
            </div>
        `;
    }
    
    getTreasureGameContent() {
        this.treasurePosition = Math.floor(Math.random() * 9);
        this.treasureAttempts = 0;
        
        return `
            <div class="text-center">
                <p class="mb-4">–ù–∞–π–¥–∏ —Å–æ–∫—Ä–æ–≤–∏—â–µ! üíé</p>
                <p class="mb-2 text-sm text-gray-600">–£ –≤–∞—Å 3 –ø–æ–ø—ã—Ç–∫–∏</p>
                <div class="attempts-message text-center text-sm text-blue-600 mb-2">–ü–æ–ø—ã—Ç–æ–∫ –æ—Å—Ç–∞–ª–æ—Å—å: 3</div>
                <div class="grid grid-cols-3 gap-2">
                    ${Array.from({length: 9}, (_, index) => `
                        <button onclick="game.checkTreasure(${index})" class="treasure-btn bg-yellow-400 hover:bg-yellow-500 text-white p-4 rounded h-16 text-2xl transition-colors">
                            ‚ùì
                        </button>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    getBalanceGameContent() {
        this.balance = 50;
        this.balanceTimer = 10;
        
        return `
            <div class="text-center">
                <p class="mb-2">–£–¥–µ—Ä–∂–∏ –±–∞–ª–∞–Ω—Å –≤ –∑–µ–ª–µ–Ω–æ–π –∑–æ–Ω–µ 10 —Å–µ–∫—É–Ω–¥!</p>
                <p class="mb-4 text-lg font-bold">–í—Ä–µ–º—è: <span id="balance-timer">10</span>—Å</p>
                <div class="relative h-8 bg-gray-300 rounded mb-4">
                    <div class="absolute top-0 h-8 bg-green-400 rounded" style="left: 30%; right: 30%;"></div>
                    <div class="absolute top-0 h-8 bg-red-400 rounded-l" style="left: 0%; right: 70%;"></div>
                    <div class="absolute top-0 h-8 bg-red-400 rounded-r" style="left: 70%; right: 0%;"></div>
                    <div id="balance-marker" class="absolute top-0 w-3 h-8 bg-blue-800 rounded transition-all duration-150" style="left: 50%; transform: translateX(-50%);"></div>
                </div>
                <div class="flex justify-center space-x-4">
                    <button onclick="game.adjustBalance(-5)" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded font-bold">
                        ‚¨ÖÔ∏è –í–ª–µ–≤–æ
                    </button>
                    <button onclick="game.adjustBalance(5)" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded font-bold">
                        –í–ø—Ä–∞–≤–æ ‚û°Ô∏è
                    </button>
                </div>
                <button onclick="game.startBalanceGame()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded mt-4">
                    –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
                </button>
            </div>
        `;
    }
    
    getMatchingGameContent() {
        const symbols = ['üçé', 'üçå', 'üçá', 'üçä'];
        this.matchingCards = [...symbols, ...symbols].sort(() => Math.random() - 0.5);
        this.flippedCards = [];
        this.matchedCards = [];
        
        return `
            <div class="text-center">
                <p class="mb-4">–ù–∞–π–¥–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø–∞—Ä—ã!</p>
                <div class="grid grid-cols-4 gap-2">
                    ${this.matchingCards.map((card, index) => `
                        <button onclick="game.flipCard(${index})" id="card-${index}" class="h-16 w-16 bg-blue-400 hover:bg-blue-500 rounded text-2xl transition-colors">
                            ‚ùì
                        </button>
                    `).join('')}
                </div>
                <div class="text-xs text-gray-600 mt-2">
                    –ù–∞–π–¥–µ–Ω–æ –ø–∞—Ä: <span id="pairs-found">0</span> / 4
                </div>
            </div>
        `;
    }
    
    getSimonGameContent() {
        return `
            <div class="text-center">
                <p class="mb-4">–ü–æ–≤—Ç–æ—Ä–∏ –∫–æ–º–∞–Ω–¥—ã –°–∞–π–º–æ–Ω–∞!</p>
                <div class="grid grid-cols-2 gap-2 mb-4">
                    <button onclick="game.simonClick(0)" id="simon-0" class="h-16 bg-red-400 hover:bg-red-500 rounded transition-colors">üî¥</button>
                    <button onclick="game.simonClick(1)" id="simon-1" class="h-16 bg-blue-400 hover:bg-blue-500 rounded transition-colors">üîµ</button>
                    <button onclick="game.simonClick(2)" id="simon-2" class="h-16 bg-green-400 hover:bg-green-500 rounded transition-colors">üü¢</button>
                    <button onclick="game.simonClick(3)" id="simon-3" class="h-16 bg-yellow-400 hover:bg-yellow-500 rounded transition-colors">üü°</button>
                </div>
                <button onclick="game.startSimonGame()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded">
                    –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
                </button>
                <div id="simon-status" class="mt-2 text-sm text-gray-600"></div>
            </div>
        `;
    }
    
    getCatchGameContent() {
        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        setTimeout(() => this.startCatchGame(), 100);
        
        return `
            <div class="text-center">
                <p class="mb-2">–ü–æ–π–º–∞–π –ø–∞–¥–∞—é—â–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã!</p>
                <p id="catch-score" class="mb-4">–ü–æ–π–º–∞–Ω–æ: 0/5</p>
                <div id="catch-game-area" class="relative w-full h-40 bg-blue-100 rounded border overflow-hidden">
                    <div id="catch-bucket" class="absolute bottom-0 w-12 h-6 bg-green-500 rounded-t transition-all duration-200 flex items-center justify-center text-xs" style="left: 50%; transform: translateX(-50%); z-index: 10;">
                        ü™£
                    </div>
                </div>
                <div class="flex justify-center space-x-4 mt-2">
                    <button onclick="game.moveCatchPlayer('left')" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
                        ‚¨ÖÔ∏è –í–ª–µ–≤–æ
                    </button>
                    <button onclick="game.moveCatchPlayer('right')" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
                        –í–ø—Ä–∞–≤–æ ‚û°Ô∏è
                    </button>
                </div>
                <div class="text-xs text-gray-600 mt-2">
                    15 —Å–µ–∫—É–Ω–¥ ‚Ä¢ –ù—É–∂–Ω–æ –ø–æ–π–º–∞—Ç—å 5 –∑–≤–µ–∑–¥–æ—á–µ–∫
                </div>
            </div>
        `;
    }
    
    getTargetGameContent() {
        this.targetScore = 0;
        this.targetPos = { x: 50, y: 50 };
        
        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        this.startTargetGame();
        
        return `
            <div class="text-center">
                <p class="mb-2">–ü–æ–ø–∞–¥–∏ –≤ –¥–≤–∏–∂—É—â—É—é—Å—è –º–∏—à–µ–Ω—å!</p>
                <p id="target-score" class="mb-4">–ü–æ–ø–∞–¥–∞–Ω–∏–π: 0/3</p>
                <div id="target-game-area" class="relative w-full h-40 bg-gray-200 rounded border">
                    <button id="moving-target" onclick="game.hitTarget()" class="absolute w-8 h-8 bg-red-500 rounded-full transition-all duration-300" style="left: 50%; top: 50%; transform: translate(-50%, -50%);">
                        üéØ
                    </button>
                </div>
                <p class="text-xs text-gray-600 mt-2">–ú–∏—à–µ–Ω—å –¥–≤–∏–∂–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 1.5 —Å–µ–∫—É–Ω–¥—ã!</p>
            </div>
        `;
    }
    
    getCodeGameContent() {
        this.secretCode = Array.from({length: 4}, () => Math.floor(Math.random() * 4));
        this.codeAttempt = [];
        
        return `
            <div class="text-center">
                <p class="mb-4">–í–∑–ª–æ–º–∞–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥!</p>
                <p class="mb-2 text-xs text-gray-600">–ö–æ–¥ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 4 —Ü–∏—Ñ—Ä (0-3)</p>
                <div class="flex justify-center space-x-2 mb-4">
                    ${Array.from({length: 4}, (_, i) => `
                        <div id="code-slot-${i}" class="w-8 h-8 border-2 border-gray-400 rounded flex items-center justify-center bg-white">
                            ?
                        </div>
                    `).join('')}
                </div>
                <div class="grid grid-cols-4 gap-2 mb-3">
                    ${[0, 1, 2, 3].map(digit => `
                        <button onclick="game.enterCodeDigit(${digit})" class="bg-purple-400 hover:bg-purple-500 active:bg-purple-600 text-white p-3 rounded transition-colors font-bold text-lg">
                            ${digit}
                        </button>
                    `).join('')}
                </div>
                <button onclick="game.resetCode()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded transition-colors">
                    üîÑ –°–±—Ä–æ—Å–∏—Ç—å
                </button>
            </div>
        `;
    }
    
    getStackGameContent() {
        // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞
        setTimeout(() => this.startStackTimer(), 100);
        
        return `
            <div class="text-center">
                <p class="mb-2">–°–æ–±–µ—Ä–∏ –±–∞—à–Ω—é –∏–∑ –±–ª–æ–∫–æ–≤!</p>
                <p class="mb-2">–í—ã—Å–æ—Ç–∞: <span id="stack-height">0</span>/5</p>
                <p class="mb-4">–í—Ä–µ–º—è: <span id="stack-timer">10</span>—Å</p>
                <div id="stack-area" class="flex flex-col-reverse items-center h-32 justify-end mb-4 bg-gray-100 rounded border-2 border-dashed border-gray-300">
                </div>
                <button onclick="game.addStackBlock()" class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-3 rounded font-bold transition-colors active:scale-95">
                    üß± –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫
                </button>
                <div class="text-xs text-gray-600 mt-2">
                    –ü–æ—Å—Ç—Ä–æ–π—Ç–µ –±–∞—à–Ω—é –≤—ã—Å–æ—Ç–æ–π 5 –±–ª–æ–∫–æ–≤ –∑–∞ 10 —Å–µ–∫—É–Ω–¥!
                </div>
            </div>
        `;
    }
    
    getSpeedGameContent() {
        // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞
        setTimeout(() => this.startSpeedTimer(), 100);
        
        return `
            <div class="text-center">
                <p class="mb-2">–ù–∞–∂–º–∏ –∫–∞–∫ –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–µ–µ!</p>
                <p class="mb-2">–ù–∞–∂–∞—Ç–∏–π: <span id="click-count">0</span>/20</p>
                <p class="mb-4">–í—Ä–µ–º—è: <span id="speed-timer">5</span>—Å</p>
                <button onclick="game.speedClick()" class="w-32 h-32 bg-red-500 hover:bg-red-600 active:bg-red-700 text-white text-3xl rounded-full animate-pulse transition-all active:scale-95">
                    üí® –ö–õ–ò–ö!
                </button>
                <div class="text-xs text-gray-600 mt-2">
                    –¶–µ–ª—å: 20+ –∫–ª–∏–∫–æ–≤ –∑–∞ 5 —Å–µ–∫—É–Ω–¥
                </div>
            </div>
        `;
    }
    
    completeMiniGame(success = null) {
        if (success === null) {
            success = Math.random() > 0.3; // 70% —à–∞–Ω—Å —É—Å–ø–µ—Ö–∞
        }
        
        if (success && this.currentMiniGame) {
            const reward = this.currentMiniGame.reward;
            this.stats.happiness = Math.min(100, this.stats.happiness + (reward.happiness || 0));
            this.stats.energy = Math.max(0, this.stats.energy - 15);
            this.experience += reward.experience || 0;
            this.money += reward.money || 0;
            
            this.playHappySound();
            this.showMessage(`–û—Ç–ª–∏—á–Ω–æ! +${reward.experience} –æ–ø—ã—Ç–∞, +${reward.money} –º–æ–Ω–µ—Ç!`);
        } else {
            this.stats.energy = Math.max(0, this.stats.energy - 10);
            this.playSound(200, 300);
            this.showMessage('–ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑!');
        }
        
        this.checkLevelUp();
        this.saveData();
        this.updateDisplay();
        this.closeMiniGame();
    }
    
    // –ò–≥—Ä–∞ "–ü–∞–º—è—Ç—å"
    startMemorySequence() {
        this.memorySequence = Array.from({length: 4}, () => Math.floor(Math.random() * 4));
        this.userMemorySequence = [];
        this.currentMemoryStep = 0;
        this.showMemorySequence();
    }
    
    showMemorySequence() {
        if (this.currentMemoryStep < this.memorySequence.length) {
            const colorIndex = this.memorySequence[this.currentMemoryStep];
            const button = document.getElementById(`memory-${colorIndex}`);
            button.style.transform = 'scale(1.1)';
            button.style.boxShadow = '0 0 20px rgba(255,255,255,0.8)';
            
            setTimeout(() => {
                button.style.transform = 'scale(1)';
                button.style.boxShadow = 'none';
                this.currentMemoryStep++;
                setTimeout(() => this.showMemorySequence(), 300);
            }, 600);
        } else {
            this.showMessage('–¢–µ–ø–µ—Ä—å –ø–æ–≤—Ç–æ—Ä–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å!');
        }
    }
    
    handleMemoryClick(colorIndex) {
        if (this.currentMemoryStep >= this.memorySequence.length) {
            this.userMemorySequence.push(colorIndex);
            
            if (this.userMemorySequence[this.userMemorySequence.length - 1] !== this.memorySequence[this.userMemorySequence.length - 1]) {
                this.completeMiniGame(false);
                return;
            }
            
            if (this.userMemorySequence.length === this.memorySequence.length) {
                this.completeMiniGame(true);
            }
        }
    }
    
    generateUserId() {
        return 'user_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
    }
    
    connectTelegram() {
        const chatId = prompt(`ü§ñ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Telegram –±–æ—Ç—É:

1. –ù–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞ @LabubuCareBot –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É /start
3. –í–≤–µ–¥–∏—Ç–µ –≤–∞—à Chat ID (–æ–Ω –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –±–æ—Ç–∞):

–í–≤–µ–¥–∏—Ç–µ Chat ID:`);
        
        if (chatId && chatId.trim()) {
            this.registerTelegramUser(chatId.trim());
        }
    }
    
    async registerTelegramUser(chatId) {
        try {
            // –ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å URL –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
            const response = await fetch('https://your-bot-server.com/api/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    chatId: chatId,
                    gameUserId: this.gameUserId,
                    petName: this.petName
                })
            });
            
            if (response.ok) {
                this.telegramConnected = true;
                this.telegramChatId = chatId;
                localStorage.setItem('telegram_connected', 'true');
                localStorage.setItem('telegram_chat_id', chatId);
                
                document.getElementById('telegramBtn').classList.add('hidden');
                document.getElementById('telegramStatus').classList.remove('hidden');
                
                this.showMessage('‚úÖ Telegram —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω!');
            } else {
                this.showMessage('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Telegram');
            }
        } catch (error) {
            console.error('Telegram connection error:', error);
            this.showMessage('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
        }
    }
    
    async sendTelegramNotification(message, type) {
        if (!this.telegramConnected) return;
        
        try {
            await fetch('https://your-bot-server.com/api/notify', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    gameUserId: this.gameUserId,
                    message: message,
                    type: type,
                    petName: this.petName
                })
            });
        } catch (error) {
            console.error('Failed to send Telegram notification:', error);
        }
    }
    
    async updateTelegramStats() {
        if (!this.telegramConnected) return;
        
        try {
            await fetch('https://your-bot-server.com/api/update-stats', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    gameUserId: this.gameUserId,
                    stats: this.stats,
                    petName: this.petName,
                    level: this.level,
                    money: this.money,
                    age: this.age
                })
            });
        } catch (error) {
            console.error('Failed to update Telegram stats:', error);
        }
    }
    
    // –ò–≥—Ä–∞ "–†–µ–∞–∫—Ü–∏—è"
    startReactionTest() {
        const light = document.getElementById('reaction-light');
        const btn = document.getElementById('reaction-btn');
        light.className = 'w-20 h-20 bg-red-400 rounded-full mx-auto mb-4 transition-colors';
        btn.classList.add('hidden');
        
        const delay = 2000 + Math.random() * 3000;
        this.reactionStartTime = Date.now() + delay;
        
        setTimeout(() => {
            light.className = 'w-20 h-20 bg-green-500 rounded-full mx-auto mb-4 transition-colors animate-pulse';
            btn.classList.remove('hidden');
            this.reactionStarted = true;
        }, delay);
    }
    
    reactionClick() {
        if (this.reactionStarted) {
            const reactionTime = Date.now() - this.reactionStartTime;
            this.completeMiniGame(reactionTime < 1000);
        }
    }
    
    // –ò–≥—Ä–∞ "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞"
    checkMathAnswer(answer) {
        this.completeMiniGame(answer === this.mathAnswer);
    }
    
    // –ò–≥—Ä–∞ "–ü–∞–∑–ª"
    swapPuzzlePiece(index) {
        if (index < this.puzzlePieces.length - 1) {
            [this.puzzlePieces[index], this.puzzlePieces[index + 1]] = [this.puzzlePieces[index + 1], this.puzzlePieces[index]];
            
            // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            const content = this.getPuzzleGameContent();
            document.getElementById('gameContent').innerHTML = content;
            
            if (JSON.stringify(this.puzzlePieces) === JSON.stringify([1, 2, 3, 4])) {
                this.completeMiniGame(true);
            }
        }
    }
    
    // –ò–≥—Ä–∞ "–í–∏–∫—Ç–æ—Ä–∏–Ω–∞"
    checkQuizAnswer(answerIndex) {
        this.completeMiniGame(answerIndex === this.currentQuestion.correct);
    }
    
    // –ò–≥—Ä–∞ "–†–∏—Ç–º"
    addRhythmBeat(beat) {
        if (!this.userRhythm) this.userRhythm = [];
        this.userRhythm.push(beat);
        
        const display = document.getElementById('rhythm-display');
        display.textContent = '–í–∞—à —Ä–∏—Ç–º: ' + this.userRhythm.map(b => b === 1 ? 'üî¥' : 'üîµ').join('');
    }
    
    checkRhythm() {
        const targetRhythm = [1, 0, 1, 0]; // üî¥üîµüî¥üîµ
        this.completeMiniGame(JSON.stringify(this.userRhythm) === JSON.stringify(targetRhythm));
    }
    
    resetRhythm() {
        this.userRhythm = [];
        document.getElementById('rhythm-display').textContent = '–í–∞—à —Ä–∏—Ç–º: ';
    }
    
    // –ò–≥—Ä–∞ "–ö–ª–∞–¥" (–ò–°–ü–†–ê–í–õ–ï–ù–û)
    checkTreasure(position) {
        if (!this.treasureAttempts) this.treasureAttempts = 0;
        
        if (position === this.treasurePosition) {
            // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–∫—Ä–æ–≤–∏—â–µ
            const buttons = document.querySelectorAll('#gameContent .treasure-btn');
            if (buttons[position]) {
                buttons[position].textContent = 'üíé';
                buttons[position].className = 'treasure-btn bg-green-500 text-white p-4 rounded h-16 text-2xl animate-pulse';
            }
            setTimeout(() => this.completeMiniGame(true), 1000);
        } else {
            this.treasureAttempts++;
            const attemptsLeft = 3 - this.treasureAttempts;
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä
            const buttons = document.querySelectorAll('#gameContent .treasure-btn');
            if (buttons[position]) {
                buttons[position].textContent = '‚ùå';
                buttons[position].disabled = true;
                buttons[position].className = 'treasure-btn bg-red-400 text-white p-4 rounded h-16 text-2xl';
            }
            
            if (attemptsLeft > 0) {
                // –û–±–Ω–æ–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø–æ–ø—ã—Ç–∫–∞—Ö
                const messageEl = document.querySelector('#gameContent .attempts-message');
                if (messageEl) {
                    messageEl.textContent = `–û—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫: ${attemptsLeft}`;
                    messageEl.className = 'attempts-message text-center text-sm text-red-600 mt-2';
                }
            } else {
                // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Å–æ–∫—Ä–æ–≤–∏—â–∞
                if (buttons[this.treasurePosition]) {
                    buttons[this.treasurePosition].textContent = 'üíé';
                    buttons[this.treasurePosition].className = 'treasure-btn bg-yellow-500 text-white p-4 rounded h-16 text-2xl animate-pulse';
                }
                setTimeout(() => this.completeMiniGame(false), 1500);
            }
        }
    }
    
    // –ò–≥—Ä–∞ "–ë–∞–ª–∞–Ω—Å"
    startBalanceGame() {
        this.balance = 50;
        this.balanceTimer = 10;
        this.balanceInterval = setInterval(() => {
            this.balanceTimer--;
            document.getElementById('balance-timer').textContent = this.balanceTimer;
            
            if (this.balanceTimer <= 0) {
                clearInterval(this.balanceInterval);
                this.completeMiniGame(true);
            }
            
            // –°–ª—É—á–∞–π–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
            this.balance += (Math.random() - 0.5) * 4;
            this.balance = Math.max(0, Math.min(100, this.balance));
            
            const marker = document.getElementById('balance-marker');
            marker.style.left = this.balance + '%';
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Ä–æ–≤–∞–ª
            if (this.balance < 25 || this.balance > 75) {
                clearInterval(this.balanceInterval);
                this.completeMiniGame(false);
            }
        }, 1000);
    }
    
    adjustBalance(amount) {
        this.balance += amount;
        this.balance = Math.max(0, Math.min(100, this.balance));
        
        const marker = document.getElementById('balance-marker');
        marker.style.left = this.balance + '%';
    }
    
    // –ò–≥—Ä–∞ "–ù–∞–π–¥–∏ –ø–∞—Ä—É"
    flipCard(index) {
        if (this.flippedCards.length < 2 && !this.flippedCards.includes(index) && !this.matchedCards.includes(index)) {
            this.flippedCards.push(index);
            const card = document.getElementById(`card-${index}`);
            card.textContent = this.matchingCards[index];
            card.className = 'h-16 w-16 bg-green-200 rounded text-2xl transition-colors';
            
            if (this.flippedCards.length === 2) {
                setTimeout(() => {
                    if (this.matchingCards[this.flippedCards[0]] === this.matchingCards[this.flippedCards[1]]) {
                        this.matchedCards.push(...this.flippedCards);
                        document.getElementById('pairs-found').textContent = this.matchedCards.length / 2;
                        
                        if (this.matchedCards.length === this.matchingCards.length) {
                            this.completeMiniGame(true);
                        }
                    } else {
                        this.flippedCards.forEach(i => {
                            const card = document.getElementById(`card-${i}`);
                            card.textContent = '‚ùì';
                            card.className = 'h-16 w-16 bg-blue-400 hover:bg-blue-500 rounded text-2xl transition-colors';
                        });
                    }
                    this.flippedCards = [];
                }, 1000);
            }
        }
    }
    
    // –ò–≥—Ä–∞ "–°–∞–π–º–æ–Ω –≥–æ–≤–æ—Ä–∏—Ç"
    startSimonGame() {
        this.simonSequence = Array.from({length: 5}, () => Math.floor(Math.random() * 4));
        this.userSimonSequence = [];
        this.currentSimonStep = 0;
        this.showSimonSequence();
    }
    
    showSimonSequence() {
        if (this.currentSimonStep < this.simonSequence.length) {
            const colorIndex = this.simonSequence[this.currentSimonStep];
            const button = document.getElementById(`simon-${colorIndex}`);
            button.style.transform = 'scale(1.2)';
            button.style.filter = 'brightness(1.5)';
            
            setTimeout(() => {
                button.style.transform = 'scale(1)';
                button.style.filter = 'brightness(1)';
                this.currentSimonStep++;
                setTimeout(() => this.showSimonSequence(), 300);
            }, 600);
        } else {
            document.getElementById('simon-status').textContent = '–¢–µ–ø–µ—Ä—å –ø–æ–≤—Ç–æ—Ä–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å!';
        }
    }
    
    simonClick(colorIndex) {
        if (this.currentSimonStep >= this.simonSequence.length) {
            this.userSimonSequence.push(colorIndex);
            
            if (this.userSimonSequence[this.userSimonSequence.length - 1] !== this.simonSequence[this.userSimonSequence.length - 1]) {
                this.completeMiniGame(false);
                return;
            }
            
            if (this.userSimonSequence.length === this.simonSequence.length) {
                this.completeMiniGame(true);
            }
        }
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–ü–æ–π–º–∞–π –ø—Ä–µ–¥–º–µ—Ç" (–ò–°–ü–†–ê–í–õ–ï–ù–û)
    startCatchGame() {
        this.fallingItems = [];
        this.catchScore = 0;
        this.playerPos = 50;
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫
        this.updateCatchGameDisplay();
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∞–¥–∞—é—â–∏—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤
        this.catchSpawnInterval = setInterval(() => {
            const newItem = {
                id: Date.now() + Math.random(),
                x: Math.random() * 80 + 10,
                y: 0
            };
            this.fallingItems.push(newItem);
        }, 800);
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä—ã
        this.catchUpdateInterval = setInterval(() => {
            // –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏–∏ –≤—Å–µ—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤
            this.fallingItems = this.fallingItems.map(item => ({
                ...item,
                y: item.y + 5
            })).filter(item => {
                // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å –∫–æ—Ä–∑–∏–Ω–æ–π
                if (item.y >= 75 && item.y <= 85 && Math.abs(item.x - this.playerPos) < 15) {
                    this.catchScore++;
                    this.updateCatchGameDisplay();
                    
                    if (this.catchScore >= 5) {
                        this.endCatchGame(true);
                        return false;
                    }
                    return false; // –£–¥–∞–ª–∏—Ç—å –ø–æ–π–º–∞–Ω–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç
                }
                
                // –£–¥–∞–ª–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç—ã –∫–æ—Ç–æ—Ä—ã–µ —É–ø–∞–ª–∏
                return item.y <= 100;
            });
            
            this.renderFallingItems();
        }, 100);
        
        // –ó–∞–∫–æ–Ω—á–∏—Ç—å –∏–≥—Ä—É —á–µ—Ä–µ–∑ 15 —Å–µ–∫—É–Ω–¥
        this.catchGameTimeout = setTimeout(() => {
            this.endCatchGame(this.catchScore >= 5);
        }, 15000);
    }
    
    endCatchGame(success) {
        if (this.catchSpawnInterval) clearInterval(this.catchSpawnInterval);
        if (this.catchUpdateInterval) clearInterval(this.catchUpdateInterval);
        if (this.catchGameTimeout) clearTimeout(this.catchGameTimeout);
        
        this.completeMiniGame(success);
    }
    
    updateCatchGameDisplay() {
        const scoreElement = document.getElementById('catch-score');
        if (scoreElement) {
            scoreElement.textContent = `–ü–æ–π–º–∞–Ω–æ: ${this.catchScore}/5`;
        }
    }
    
    moveCatchPlayer(direction) {
        if (direction === 'left') {
            this.playerPos = Math.max(10, this.playerPos - 15);
        } else if (direction === 'right') {
            this.playerPos = Math.min(90, this.playerPos + 15);
        }
        
        const bucket = document.getElementById('catch-bucket');
        if (bucket) {
            bucket.style.left = this.playerPos + '%';
        }
    }
    
    renderFallingItems() {
        const gameArea = document.getElementById('catch-game-area');
        if (!gameArea) return;
        
        // –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã
        const oldItems = gameArea.querySelectorAll('.falling-item');
        oldItems.forEach(item => item.remove());
        
        // –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã
        this.fallingItems.forEach((item) => {
            const itemElement = document.createElement('div');
            itemElement.className = 'falling-item absolute w-6 h-6 bg-yellow-400 rounded-full cursor-pointer flex items-center justify-center text-xs';
            itemElement.style.left = item.x + '%';
            itemElement.style.top = item.y + '%';
            itemElement.style.transform = 'translate(-50%, -50%)';
            itemElement.innerHTML = '‚≠ê';
            itemElement.style.zIndex = '5';
            gameArea.appendChild(itemElement);
        });
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–ü–æ–ø–∞–¥–∏ –≤ —Ü–µ–ª—å" (–ò–°–ü–†–ê–í–õ–ï–ù–û)
    startTargetGame() {
        this.targetScore = 0;
        this.targetPos = { x: 50, y: 50 };
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫
        const scoreElement = document.getElementById('target-score');
        if (scoreElement) {
            scoreElement.textContent = `–ü–æ–ø–∞–¥–∞–Ω–∏–π: 0/3`;
        }
        
        // –ü–µ—Ä–≤–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –º–∏—à–µ–Ω–∏
        this.moveTarget();
        
        // –ò–Ω—Ç–µ—Ä–≤–∞–ª –¥–≤–∏–∂–µ–Ω–∏—è –º–∏—à–µ–Ω–∏
        this.targetGameInterval = setInterval(() => {
            this.moveTarget();
        }, 1500);
        
        // –ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
        this.targetGameTimeout = setTimeout(() => {
            if (this.targetGameInterval) {
                clearInterval(this.targetGameInterval);
                this.completeMiniGame(this.targetScore >= 3);
            }
        }, 10000);
    }
    
    moveTarget() {
        this.targetPos = {
            x: Math.random() * 70 + 15, // –ë–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã
            y: Math.random() * 70 + 15
        };
        
        const target = document.getElementById('moving-target');
        if (target) {
            target.style.left = this.targetPos.x + '%';
            target.style.top = this.targetPos.y + '%';
            target.style.transition = 'all 0.3s ease';
        }
    }
    
    hitTarget() {
        this.targetScore++;
        const scoreElement = document.getElementById('target-score');
        if (scoreElement) {
            scoreElement.textContent = `–ü–æ–ø–∞–¥–∞–Ω–∏–π: ${this.targetScore}/3`;
        }
        
        // –≠—Ñ—Ñ–µ–∫—Ç –ø–æ–ø–∞–¥–∞–Ω–∏—è
        const target = document.getElementById('moving-target');
        if (target) {
            target.style.transform = 'translate(-50%, -50%) scale(1.2)';
            setTimeout(() => {
                target.style.transform = 'translate(-50%, -50%) scale(1)';
            }, 200);
        }
        
        if (this.targetScore >= 3) {
            clearInterval(this.targetGameInterval);
            clearTimeout(this.targetGameTimeout);
            this.completeMiniGame(true);
        } else {
            // –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –º–∏—à–µ–Ω—å –ø–æ—Å–ª–µ –ø–æ–ø–∞–¥–∞–Ω–∏—è
            setTimeout(() => this.moveTarget(), 300);
        }
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–í–∑–ª–æ–º–∞–π –∫–æ–¥" (–ò–°–ü–†–ê–í–õ–ï–ù–û)
    enterCodeDigit(digit) {
        if (this.codeAttempt.length < 4) {
            this.codeAttempt.push(digit);
            
            const slot = document.getElementById(`code-slot-${this.codeAttempt.length - 1}`);
            if (slot) {
                slot.textContent = digit;
                slot.className = 'w-8 h-8 border-2 border-blue-400 rounded flex items-center justify-center bg-blue-50 font-bold';
            }
            
            if (this.codeAttempt.length === 4) {
                // –ü–æ–∫–∞–∑–∞—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é –ø—Ä–æ–≤–µ—Ä–∫–∏
                for (let i = 0; i < 4; i++) {
                    const slot = document.getElementById(`code-slot-${i}`);
                    if (slot) {
                        slot.className = 'w-8 h-8 border-2 border-yellow-400 rounded flex items-center justify-center bg-yellow-100 font-bold animate-pulse';
                    }
                }
                
                setTimeout(() => {
                    if (JSON.stringify(this.codeAttempt) === JSON.stringify(this.secretCode)) {
                        // –ö–æ–¥ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
                        for (let i = 0; i < 4; i++) {
                            const slot = document.getElementById(`code-slot-${i}`);
                            if (slot) {
                                slot.className = 'w-8 h-8 border-2 border-green-500 rounded flex items-center justify-center bg-green-100 font-bold';
                            }
                        }
                        setTimeout(() => this.completeMiniGame(true), 1000);
                    } else {
                        // –ö–æ–¥ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
                        for (let i = 0; i < 4; i++) {
                            const slot = document.getElementById(`code-slot-${i}`);
                            if (slot) {
                                slot.className = 'w-8 h-8 border-2 border-red-500 rounded flex items-center justify-center bg-red-100 font-bold animate-bounce';
                            }
                        }
                        
                        setTimeout(() => {
                            this.resetCode();
                            this.showMessage('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–¥! –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑.');
                        }, 1500);
                    }
                }, 1000);
            }
        }
    }
    
    resetCode() {
        this.codeAttempt = [];
        for (let i = 0; i < 4; i++) {
            const slot = document.getElementById(`code-slot-${i}`);
            if (slot) {
                slot.textContent = '?';
                slot.className = 'w-8 h-8 border-2 border-gray-400 rounded flex items-center justify-center bg-white';
            }
        }
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–°–æ–±–µ—Ä–∏ –±–∞—à–Ω—é" (–ò–°–ü–†–ê–í–õ–ï–ù–û)
    startStackTimer() {
        this.stackHeight = 0;
        this.stackTimer = 10;
        
        this.stackTimerInterval = setInterval(() => {
            this.stackTimer--;
            const timerElement = document.getElementById('stack-timer');
            if (timerElement) {
                timerElement.textContent = this.stackTimer;
            }
            
            if (this.stackTimer <= 0) {
                clearInterval(this.stackTimerInterval);
                this.completeMiniGame(this.stackHeight >= 5);
            }
        }, 1000);
    }
    
    addStackBlock() {
        if (this.stackTimer <= 0) return;
        
        this.stackHeight++;
        
        const heightElement = document.getElementById('stack-height');
        if (heightElement) {
            heightElement.textContent = this.stackHeight;
        }
        
        const stackArea = document.getElementById('stack-area');
        if (stackArea) {
            const block = document.createElement('div');
            block.className = 'w-16 h-6 bg-orange-400 border border-orange-600 mb-1 rounded';
            block.style.animation = 'fadeIn 0.2s ease-in';
            stackArea.appendChild(block);
        }
        
        if (this.stackHeight >= 5) {
            clearInterval(this.stackTimerInterval);
            this.completeMiniGame(true);
        }
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–°–∫–æ—Ä–æ—Å—Ç—å"
    startSpeedTimer() {
        this.clickCount = 0;
        this.speedTimer = 5;
        
        this.speedTimerInterval = setInterval(() => {
            this.speedTimer--;
            const timerElement = document.getElementById('speed-timer');
            if (timerElement) {
                timerElement.textContent = this.speedTimer;
            }
            
            if (this.speedTimer <= 0) {
                clearInterval(this.speedTimerInterval);
                this.completeMiniGame(this.clickCount >= 20);
            }
        }, 1000);
    }
    
    speedClick() {
        if (this.speedTimer <= 0) return;
        
        this.clickCount++;
        const countElement = document.getElementById('click-count');
        if (countElement) {
            countElement.textContent = this.clickCount;
        }
        
        if (this.clickCount >= 20) {
            clearInterval(this.speedTimerInterval);
            this.completeMiniGame(true);
        }
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–õ–∞–±–∏—Ä–∏–Ω—Ç" (–ù–û–í–û–ï)
    getMazeGameContent() {
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–æ—Å—Ç–æ–π –ª–∞–±–∏—Ä–∏–Ω—Ç 5x5
        this.mazeSize = 5;
        this.playerPos = { x: 0, y: 0 };
        this.exitPos = { x: 4, y: 4 };
        this.maze = this.generateMaze();
        
        return `
            <div class="text-center">
                <p class="mb-2">–ù–∞–π–¥–∏ –≤—ã—Ö–æ–¥ –∏–∑ –ª–∞–±–∏—Ä–∏–Ω—Ç–∞!</p>
                <p class="mb-4">üèÅ –î–æ–π–¥–∏ –¥–æ –≤—ã—Ö–æ–¥–∞ –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É</p>
                <div id="maze-grid" class="grid grid-cols-5 gap-1 mb-4 mx-auto max-w-40">
                    ${this.renderMaze()}
                </div>
                <div class="flex justify-center space-x-2">
                    <button onclick="game.moveMazePlayer('up')" class="bg-blue-500 text-white px-3 py-2 rounded">‚¨ÜÔ∏è</button>
                </div>
                <div class="flex justify-center space-x-2 mt-1">
                    <button onclick="game.moveMazePlayer('left')" class="bg-blue-500 text-white px-3 py-2 rounded">‚¨ÖÔ∏è</button>
                    <button onclick="game.moveMazePlayer('down')" class="bg-blue-500 text-white px-3 py-2 rounded">‚¨áÔ∏è</button>
                    <button onclick="game.moveMazePlayer('right')" class="bg-blue-500 text-white px-3 py-2 rounded">‚û°Ô∏è</button>
                </div>
            </div>
        `;
    }
    
    generateMaze() {
        // –ü—Ä–æ—Å—Ç–æ–π –ª–∞–±–∏—Ä–∏–Ω—Ç 5x5 –≥–¥–µ 1 = —Å—Ç–µ–Ω–∞, 0 = —Å–≤–æ–±–æ–¥–Ω–æ
        const maze = [
            [0, 1, 0, 0, 0],
            [0, 1, 0, 1, 0],
            [0, 0, 0, 1, 0],
            [1, 1, 0, 0, 0],
            [0, 0, 0, 1, 0]
        ];
        return maze;
    }
    
    renderMaze() {
        let html = '';
        for (let y = 0; y < this.mazeSize; y++) {
            for (let x = 0; x < this.mazeSize; x++) {
                const isPlayer = this.playerPos.x === x && this.playerPos.y === y;
                const isExit = this.exitPos.x === x && this.exitPos.y === y;
                const isWall = this.maze[y][x] === 1;
                
                let cellClass = 'w-8 h-8 flex items-center justify-center text-xs border ';
                let content = '';
                
                if (isPlayer) {
                    cellClass += 'bg-green-500 text-white';
                    content = 'üë§';
                } else if (isExit) {
                    cellClass += 'bg-red-500 text-white';
                    content = 'üèÅ';
                } else if (isWall) {
                    cellClass += 'bg-gray-800';
                    content = '';
                } else {
                    cellClass += 'bg-white border-gray-300';
                    content = '';
                }
                
                html += `<div class="${cellClass}">${content}</div>`;
            }
        }
        return html;
    }
    
    moveMazePlayer(direction) {
        let newX = this.playerPos.x;
        let newY = this.playerPos.y;
        
        switch (direction) {
            case 'up':
                newY = Math.max(0, newY - 1);
                break;
            case 'down':
                newY = Math.min(this.mazeSize - 1, newY + 1);
                break;
            case 'left':
                newX = Math.max(0, newX - 1);
                break;
            case 'right':
                newX = Math.min(this.mazeSize - 1, newX + 1);
                break;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å–æ —Å—Ç–µ–Ω–æ–π
        if (this.maze[newY][newX] !== 1) {
            this.playerPos = { x: newX, y: newY };
            
            // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            const mazeGrid = document.getElementById('maze-grid');
            if (mazeGrid) {
                mazeGrid.innerHTML = this.renderMaze();
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –≤—ã—Ö–æ–¥–∞
            if (newX === this.exitPos.x && newY === this.exitPos.y) {
                setTimeout(() => this.completeMiniGame(true), 500);
            }
        }
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–£–∑–æ—Ä" (–ù–û–í–û–ï)
    getPatternGameContent() {
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–∑–æ—Ä –∏–∑ —Ü–≤–µ—Ç–æ–≤
        this.pattern = this.generatePattern();
        this.userPattern = [];
        this.showingPattern = true;
        
        setTimeout(() => {
            this.showingPattern = false;
            this.updatePatternDisplay();
        }, 3000);
        
        return `
            <div class="text-center">
                <p class="mb-2">–ó–∞–ø–æ–º–Ω–∏ –∏ –ø–æ–≤—Ç–æ—Ä–∏ —É–∑–æ—Ä!</p>
                <p id="pattern-instruction" class="mb-4 text-sm text-gray-600">–ó–∞–ø–æ–º–∏–Ω–∞–π...</p>
                <div id="pattern-display" class="grid grid-cols-3 gap-2 mb-4 mx-auto max-w-32">
                    ${this.renderPattern()}
                </div>
                <div id="pattern-buttons" class="grid grid-cols-3 gap-2 mx-auto max-w-32" style="display: none;">
                    ${this.renderPatternButtons()}
                </div>
                <div class="text-xs text-gray-600 mt-2">
                    –ü—Ä–æ–≥—Ä–µ—Å—Å: <span id="pattern-progress">0</span>/${this.pattern.length}
                </div>
            </div>
        `;
    }
    
    generatePattern() {
        const colors = ['red', 'blue', 'green', 'yellow'];
        const pattern = [];
        for (let i = 0; i < 6; i++) {
            pattern.push(colors[Math.floor(Math.random() * colors.length)]);
        }
        return pattern;
    }
    
    renderPattern() {
        return this.pattern.map((color, index) => {
            const bgColor = this.getColorClass(color);
            const isVisible = this.showingPattern || this.userPattern.length > index;
            return `
                <div class="w-8 h-8 rounded border-2 ${isVisible ? bgColor : 'bg-gray-200'} ${
                    this.showingPattern && Math.floor(Date.now() / 500) % 2 === 0 ? 'animate-pulse' : ''
                }"></div>
            `;
        }).join('');
    }
    
    renderPatternButtons() {
        const colors = ['red', 'blue', 'green', 'yellow'];
        return colors.map(color => `
            <button onclick="game.addPatternColor('${color}')" class="w-8 h-8 rounded border-2 ${this.getColorClass(color)} hover:scale-110 transition-transform">
            </button>
        `).join('');
    }
    
    getColorClass(color) {
        const colorMap = {
            red: 'bg-red-500',
            blue: 'bg-blue-500',
            green: 'bg-green-500',
            yellow: 'bg-yellow-500'
        };
        return colorMap[color] || 'bg-gray-500';
    }
    
    updatePatternDisplay() {
        const instruction = document.getElementById('pattern-instruction');
        const patternDisplay = document.getElementById('pattern-display');
        const patternButtons = document.getElementById('pattern-buttons');
        
        if (instruction) instruction.textContent = '–ü–æ–≤—Ç–æ—Ä–∏ —É–∑–æ—Ä:';
        if (patternDisplay) patternDisplay.innerHTML = this.renderPattern();
        if (patternButtons) patternButtons.style.display = 'grid';
    }
    
    addPatternColor(color) {
        if (this.showingPattern) return;
        
        this.userPattern.push(color);
        
        // –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
        const progress = document.getElementById('pattern-progress');
        if (progress) progress.textContent = this.userPattern.length;
        
        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å
        const isCorrect = this.userPattern[this.userPattern.length - 1] === this.pattern[this.userPattern.length - 1];
        
        if (!isCorrect) {
            this.completeMiniGame(false);
            return;
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        this.updatePatternDisplay();
        
        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
        if (this.userPattern.length === this.pattern.length) {
            this.completeMiniGame(true);
        }
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–°–æ—Å—Ç–∞–≤—å —Å–ª–æ–≤–æ" (–ù–û–í–û–ï)
    getWordGameContent() {
        const words = ['–ö–û–¢', '–î–û–ú', '–°–ê–î', '–ú–ò–†', '–°–û–ù', '–õ–ï–°', '–ú–ê–ö', '–õ–£–ö'];
        this.targetWord = words[Math.floor(Math.random() * words.length)];
        this.availableLetters = this.shuffleWord(this.targetWord);
        this.userWord = '';
        
        return `
            <div class="text-center">
                <p class="mb-2">–°–æ—Å—Ç–∞–≤—å —Å–ª–æ–≤–æ –∏–∑ –±—É–∫–≤!</p>
                <p class="mb-4 text-lg font-bold">–¶–µ–ª—å: ${this.targetWord}</p>
                <div class="mb-4">
                    <div class="text-lg font-mono bg-gray-100 p-2 rounded min-h-8">
                        <span id="user-word">${this.userWord || '_'.repeat(this.targetWord.length)}</span>
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-2 mb-4">
                    ${this.availableLetters.map((letter, index) => `
                        <button onclick="game.addLetter('${letter}', ${index})" id="letter-${index}" class="bg-blue-500 hover:bg-blue-600 text-white p-3 rounded font-bold transition-colors">
                            ${letter}
                        </button>
                    `).join('')}
                </div>
                <div class="flex justify-center space-x-2">
                    <button onclick="game.clearWord()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                        üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å
                    </button>
                    <button onclick="game.checkWord()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                        ‚úì –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
                    </button>
                </div>
            </div>
        `;
    }
    
    shuffleWord(word) {
        return word.split('').sort(() => Math.random() - 0.5);
    }
    
    addLetter(letter, index) {
        if (this.userWord.length < this.targetWord.length) {
            this.userWord += letter;
            
            // –°–∫—Ä—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—É—é –±—É–∫–≤—É
            const letterBtn = document.getElementById(`letter-${index}`);
            if (letterBtn) {
                letterBtn.style.display = 'none';
            }
            
            // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ª–æ–≤–∞
            const userWordEl = document.getElementById('user-word');
            if (userWordEl) {
                userWordEl.textContent = this.userWord + '_'.repeat(this.targetWord.length - this.userWord.length);
            }
        }
    }
    
    clearWord() {
        this.userWord = '';
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –±—É–∫–≤—ã
        this.availableLetters.forEach((_, index) => {
            const letterBtn = document.getElementById(`letter-${index}`);
            if (letterBtn) {
                letterBtn.style.display = 'block';
            }
        });
        
        // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        const userWordEl = document.getElementById('user-word');
        if (userWordEl) {
            userWordEl.textContent = '_'.repeat(this.targetWord.length);
        }
    }
    
    checkWord() {
        this.completeMiniGame(this.userWord === this.targetWord);
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–¶–≤–µ—Ç–Ω–∞—è –∏–≥—Ä–∞" (–ù–û–í–û–ï)
    getColorGameContent() {
        const colors = [
            { name: '–ö–†–ê–°–ù–´–ô', color: 'red', textColor: 'blue' },
            { name: '–°–ò–ù–ò–ô', color: 'blue', textColor: 'green' },
            { name: '–ó–ï–õ–ï–ù–´–ô', color: 'green', textColor: 'red' },
            { name: '–ñ–ï–õ–¢–´–ô', color: 'yellow', textColor: 'purple' }
        ];
        
        this.currentColor = colors[Math.floor(Math.random() * colors.length)];
        this.colorOptions = colors.map(c => c.color).sort(() => Math.random() - 0.5);
        
        return `
            <div class="text-center">
                <p class="mb-4">–í—ã–±–µ—Ä–∏ –¶–í–ï–¢ —Ç–µ–∫—Å—Ç–∞, –∞ –Ω–µ —Ç–æ —á—Ç–æ –Ω–∞–ø–∏—Å–∞–Ω–æ!</p>
                <div class="mb-6 p-4 bg-gray-100 rounded-lg">
                    <div class="text-4xl font-bold" style="color: ${this.getActualColor(this.currentColor.textColor)}">
                        ${this.currentColor.name}
                    </div>
                </div>
                <p class="mb-4 text-sm text-gray-600">–ö–∞–∫–æ–≥–æ —Ü–≤–µ—Ç–∞ —Ç–µ–∫—Å—Ç –≤—ã—à–µ?</p>
                <div class="grid grid-cols-2 gap-3">
                    ${this.colorOptions.map(color => `
                        <button onclick="game.selectColor('${color}')" class="p-3 rounded-lg text-white font-bold transition-colors ${this.getColorButtonClass(color)}">
                            ${this.getColorName(color)}
                        </button>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    getActualColor(color) {
        const colorMap = {
            red: '#ef4444',
            blue: '#3b82f6',
            green: '#22c55e',
            yellow: '#eab308',
            purple: '#a855f7'
        };
        return colorMap[color] || '#000000';
    }
    
    getColorButtonClass(color) {
        const classMap = {
            red: 'bg-red-500 hover:bg-red-600',
            blue: 'bg-blue-500 hover:bg-blue-600',
            green: 'bg-green-500 hover:bg-green-600',
            yellow: 'bg-yellow-500 hover:bg-yellow-600'
        };
        return classMap[color] || 'bg-gray-500 hover:bg-gray-600';
    }
    
    getColorName(color) {
        const nameMap = {
            red: '–ö–†–ê–°–ù–´–ô',
            blue: '–°–ò–ù–ò–ô',
            green: '–ó–ï–õ–ï–ù–´–ô',
            yellow: '–ñ–ï–õ–¢–´–ô'
        };
        return nameMap[color] || '–¶–í–ï–¢';
    }
    
    selectColor(selectedColor) {
        this.completeMiniGame(selectedColor === this.currentColor.textColor);
    }
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–≥—Ä—ã "–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å" (–ù–û–í–û–ï)
    getSequenceGameContent() {
        const sequences = [
            { seq: [2, 4, 6, 8], next: 10, rule: '—á–µ—Ç–Ω—ã–µ —á–∏—Å–ª–∞' },
            { seq: [1, 3, 5, 7], next: 9, rule: '–Ω–µ—á–µ—Ç–Ω—ã–µ —á–∏—Å–ª–∞' },
            { seq: [1, 4, 7, 10], next: 13, rule: '+3' },
            { seq: [2, 6, 18, 54], next: 162, rule: '√ó3' },
            { seq: [1, 1, 2, 3], next: 5, rule: '–§–∏–±–æ–Ω–∞—á—á–∏' }
        ];
        
        this.currentSequence = sequences[Math.floor(Math.random() * sequences.length)];
        this.sequenceOptions = this.generateSequenceOptions(this.currentSequence.next);
        
        return `
            <div class="text-center">
                <p class="mb-4">–ù–∞–π–¥–∏ —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:</p>
                <div class="mb-6 p-4 bg-gray-100 rounded-lg">
                    <div class="text-2xl font-bold">
                        ${this.currentSequence.seq.join(', ')}, ?
                    </div>
                </div>
                <p class="mb-4 text-sm text-gray-600">–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–ª–µ–¥—É—é—â–∏–º?</p>
                <div class="grid grid-cols-2 gap-3">
                    ${this.sequenceOptions.map(option => `
                        <button onclick="game.selectSequenceNumber(${option})" class="bg-purple-500 hover:bg-purple-600 text-white p-3 rounded-lg font-bold transition-colors">
                            ${option}
                        </button>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    generateSequenceOptions(correctAnswer) {
        const options = new Set([correctAnswer]);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
        while (options.size < 4) {
            const variation = correctAnswer + (Math.random() - 0.5) * 10;
            options.add(Math.round(variation));
        }
        
        return Array.from(options).sort(() => Math.random() - 0.5);
    }
    
    selectSequenceNumber(selectedNumber) {
        this.completeMiniGame(selectedNumber === this.currentSequence.next);
    }
    
    checkLevelUp() {
        const newLevel = Math.floor(this.experience / 100) + 1;
        if (newLevel > this.level) {
            this.level = newLevel;
            this.money += 50;
            this.playHappySound();
            this.showMessage('üéâ –£—Ä–æ–≤–µ–Ω—å –ø–æ–≤—ã—à–µ–Ω! +50 –º–æ–Ω–µ—Ç!');
        }
    }
    
    checkNotifications() {
        if (this.stats.happiness < 50) {
            this.showNotification(`üò¢ ${this.petName}: –ú–Ω–µ —Å–∫—É—á–Ω–æ! –ü–æ–∏–≥—Ä–∞–π —Å–æ –º–Ω–æ–π!`, 'sad');
        }
        if (this.stats.sleep < 50) {
            this.showNotification(`üò¥ ${this.petName}: –Ø —Ö–æ—á—É —Å–ø–∞—Ç—å! –£–ª–æ–∂–∏ –º–µ–Ω—è –≤ –∫—Ä–æ–≤–∞—Ç–∫—É!`, 'sleepy');
        }
        if (this.stats.hunger < 50) {
            this.showNotification(`üçΩÔ∏è ${this.petName}: –Ø –≥–æ–ª–æ–¥–µ–Ω! –ü–æ–∫–æ—Ä–º–∏ –º–µ–Ω—è —á–µ–º-–Ω–∏–±—É–¥—å –≤–∫—É—Å–Ω—ã–º!`, 'hungry');
        }
        if (this.stats.cleanliness < 50) {
            this.showNotification(`üõÅ ${this.petName}: –Ø –≥—Ä—è–∑–Ω—ã–π! –ü–æ–º–æ–π –º–µ–Ω—è, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞!`, 'dirty');
        }
        if (this.stats.health < 50) {
            this.showNotification(`üíä ${this.petName}: –ú–Ω–µ –ø–ª–æ—Ö–æ! –í—ã–ª–µ—á–∏ –º–µ–Ω—è!`, 'sick');
        }
        if (this.stats.energy < 30) {
            this.showNotification(`‚ö° ${this.petName}: –£ –º–µ–Ω—è –º–∞–ª–æ —ç–Ω–µ—Ä–≥–∏–∏! –î–∞–π –º–Ω–µ –æ—Ç–¥–æ—Ö–Ω—É—Ç—å!`, 'tired');
        }
    }
    
    checkEvolution() {
        const currentStage = Object.entries(this.evolutionStages)
            .reverse()
            .find(([_, stage]) => this.age >= stage.minAge)?.[0] || 'baby';
        
        if (currentStage !== this.evolutionStage) {
            this.evolutionStage = currentStage;
            this.playHappySound();
            this.showMessage(`üéâ –≠–≤–æ–ª—é—Ü–∏—è! –¢–µ–ø–µ—Ä—å ${this.evolutionStages[currentStage].name}!`);
        }
    }
    
    startGameLoop() {
        setInterval(() => {
            const now = Date.now();
            const timeDiff = Math.floor((now - this.lastUpdate) / 1000);
            
            // –°—Ç–∞—Ä–µ–Ω–∏–µ: 1 —Ä–µ–∞–ª—å–Ω—ã–π –¥–µ–Ω—å = 1 –¥–µ–Ω—å –ø–∏—Ç–æ–º—Ü–∞ (86400 —Å–µ–∫—É–Ω–¥ = 1 –¥–µ–Ω—å)
            if (timeDiff >= 86400) {
                const daysToAdd = Math.floor(timeDiff / 86400);
                this.age += daysToAdd;
                this.checkEvolution();
                this.lastUpdate = now;
            }
            
            // –°–Ω–∏–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫ –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç (600 —Å–µ–∫—É–Ω–¥)
            if (timeDiff >= 600) {
                if (!this.isSleeping) {
                    this.stats.hunger = Math.max(0, this.stats.hunger - 2);
                    this.stats.happiness = Math.max(0, this.stats.happiness - 1);
                    this.stats.cleanliness = Math.max(0, this.stats.cleanliness - 1);
                    this.stats.health = Math.max(0, this.stats.health - (this.stats.hunger < 20 ? 2 : 0));
                    this.stats.energy = Math.max(0, this.stats.energy - 2);
                    this.stats.sleep = Math.max(0, this.stats.sleep - 2);
                    
                    this.checkNotifications();
                } else {
                    this.stats.energy = Math.min(100, this.stats.energy + 5);
                    this.stats.sleep = Math.min(100, this.stats.sleep + 8);
                }
                
                this.lastUpdate = now;
                this.saveData();
                this.updateDisplay();
            }
        }, 60000); // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
    }
    
    startNotificationTimer() {
        setInterval(() => {
            const now = Date.now();
            const timeSinceLastNotification = now - this.lastNotification;
            
            // 30 –º–∏–Ω—É—Ç = 1800000 –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥
            if (timeSinceLastNotification >= 1800000) {
                this.showNotification(`üí≠ ${this.petName}: –¢—ã –Ω–µ –∑–∞–±—ã–ª –æ–±–æ –º–Ω–µ? –Ø —Å–∫—É—á–∞—é!`, 'reminder');
                this.lastNotification = now;
                localStorage.setItem('shared_labubu_last_notification', now.toString());
            }
        }, 60000); // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
    }
}

// –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
let game;
document.addEventListener('DOMContentLoaded', () => {
    game = new LabubuCareGame();
});
</script>

</body>
</html>
