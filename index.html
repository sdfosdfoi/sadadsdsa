<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Labubu TBB Game - ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .notification-enter {
            animation: slideInRight 0.3s ease-out;
        }
        .notification-exit {
            animation: fadeOut 0.3s ease-out;
        }
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        .pet-bounce {
            animation: bounce 2s infinite;
        }
        .pet-sleep {
            animation: pulse 2s infinite;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-pink-100 via-purple-100 to-blue-100 min-h-screen">

<!-- Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ -->
<div id="notifications" class="fixed top-4 right-4 z-50 space-y-2"></div>

<!-- ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ Ğ¸Ğ³Ñ€Ñ‹ -->
<div class="max-w-lg mx-auto bg-gradient-to-b from-pink-100 to-purple-100 rounded-xl p-4 shadow-lg min-h-screen">
    
    <!-- Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº Ñ Ğ¿Ğ¾Ğ³Ğ¾Ğ´Ğ¾Ğ¹ Ğ¸ Ğ²Ñ€ĞµĞ¼ĞµĞ½ĞµĞ¼ -->
    <div class="text-center mb-4">
        <div class="flex justify-between items-center mb-2">
            <div class="text-sm" id="timeOfDay">â˜€ï¸</div>
            <div class="text-center">
                <h1 class="text-xl font-bold text-purple-800">ğŸ° <span id="petNameDisplay">Labubu</span> Care</h1>
                <div id="nameEditSection" class="hidden mt-2">
                    <input type="text" id="nameInput" class="text-sm px-2 py-1 border rounded" maxlength="15">
                    <div class="mt-1">
                        <button id="saveNameBtn" class="text-xs bg-blue-500 text-white px-2 py-1 rounded mr-1">âœ“</button>
                        <button id="cancelNameBtn" class="text-xs bg-gray-500 text-white px-2 py-1 rounded">âœ•</button>
                    </div>
                </div>
                <button id="editNameBtn" class="text-xs text-purple-600 hover:text-purple-800 mt-1">âœï¸ Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¸Ğ¼Ñ</button>
            </div>
            <div class="text-sm" id="weather">â˜€ï¸</div>
        </div>
        <div class="flex justify-between text-xs">
            <span id="levelDisplay">Lv.1</span>
            <span id="moneyDisplay">ğŸ’°100</span>
            <span id="expDisplay">â­0/100</span>
            <span id="ageDisplay">ğŸ‚0Ğ´</span>
            <button id="soundToggle" class="text-xs">ğŸ”Š</button>
        </div>
        <div id="collaboratorsInfo" class="text-xs text-purple-600 mt-1 hidden"></div>
    </div>

    <!-- ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ Labubu -->
    <div class="text-center mb-4 bg-white rounded-lg p-6 shadow">
        <div class="mb-4 relative inline-block">
            <img id="petImage" src="https://i.pinimg.com/474x/49/b9/bc/49b9bc9d7961d675e91a963b192c16a9.jpg" alt="Labubu" class="w-32 h-32 mx-auto object-contain">
            
            <!-- ĞĞ´ĞµĞ¶Ğ´Ğ° -->
            <div class="absolute inset-0" id="outfitContainer"></div>
            
            <!-- Ğ˜Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ñ‹ -->
            <div id="sleepIndicator" class="absolute -top-2 -right-2 text-lg animate-pulse hidden">ğŸ’¤</div>
            <div id="moodIndicator" class="absolute -top-1 -left-1 text-sm"></div>
            <div id="criticalIndicator" class="absolute inset-0 bg-red-500 bg-opacity-20 rounded-full animate-pulse hidden"></div>
        </div>
        
        <div class="text-2xl mb-2" id="moodEmoji">ğŸ˜Š</div>
        <div class="text-sm text-gray-600 font-medium" id="moodStatus">Ğ¡Ñ‡Ğ°ÑÑ‚Ğ»Ğ¸Ğ²</div>
        <div class="text-xs text-purple-600 mt-1" id="evolutionStage">ĞœĞ°Ğ»Ñ‹Ñˆ</div>
        <div id="currentOutfit" class="text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded-full mt-2 inline-block hidden"></div>
        <div class="text-xs text-gray-500 mt-1">ğŸ‚ Ğ’Ğ¾Ğ·Ñ€Ğ°ÑÑ‚: <span id="ageText">0</span> Ğ´Ğ½ĞµĞ¹</div>
    </div>

    <!-- Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ -->
    <div id="gameMessage" class="bg-yellow-100 border border-yellow-400 text-yellow-700 px-3 py-2 rounded mb-3 text-center text-xs hidden"></div>

    <!-- Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ -->
    <div class="mb-4 bg-white rounded-lg p-3 shadow">
        <div id="statsContainer"></div>
    </div>

    <!-- Ğ’ĞºĞ»Ğ°Ğ´ĞºĞ¸ -->
    <div class="flex mb-3 bg-white rounded-lg p-1 shadow text-xs">
        <button class="tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors bg-purple-500 text-white" data-tab="care">ğŸ”§ Ğ£Ñ…Ğ¾Ğ´</button>
        <button class="tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors text-purple-500 hover:bg-purple-50" data-tab="games">ğŸ® Ğ˜Ğ³Ñ€Ñ‹</button>
        <button class="tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors text-purple-500 hover:bg-purple-50" data-tab="shop">ğŸ›ï¸ ĞœĞ°Ğ³Ğ°Ğ·Ğ¸Ğ½</button>
        <button class="tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors text-purple-500 hover:bg-purple-50" data-tab="chests">ğŸ“¦ Ğ¡ÑƒĞ½Ğ´ÑƒĞºĞ¸</button>
        <button class="tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors text-purple-500 hover:bg-purple-50" data-tab="pets">ğŸ° ĞŸĞ¸Ñ‚Ğ¾Ğ¼Ñ†Ñ‹</button>
        <button class="tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors text-purple-500 hover:bg-purple-50" data-tab="info">â„¹ï¸ Ğ˜Ğ½Ñ„Ğ¾</button>
    </div>

    <!-- ĞšĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚ Ğ²ĞºĞ»Ğ°Ğ´Ğ¾Ğº -->
    <div id="tabContent"></div>
</div>

<!-- ĞœĞ¾Ğ´Ğ°Ğ» Ğ¼Ğ¸Ğ½Ğ¸-Ğ¸Ğ³Ñ€Ñ‹ -->
<div id="miniGameModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4 max-h-96 overflow-y-auto">
        <h3 id="gameTitle" class="text-lg font-bold mb-4"></h3>
        <div id="gameContent"></div>
        <button id="cancelGameBtn" class="mt-4 bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded w-full transition-colors">ĞÑ‚Ğ¼ĞµĞ½Ğ°</button>
    </div>
</div>

<script>
class LabubuCareGame {
    constructor() {
        // Ğ’ĞĞ–ĞĞ: Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° ÑƒÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ gameUserId
        this.gameUserId = this.generateUserId();
        console.log('ğŸ†” Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½ gameUserId:', this.gameUserId);
        
        // Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ² Ğ´Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
        this.stats = {
            hunger: 100, happiness: 100, cleanliness: 100,
            health: 100, energy: 100, sleep: 100
        };
        this.evolutionStages = {
            baby: { name: 'ĞœĞ°Ğ»Ñ‹Ñˆ', minAge: 0 },
            child: { name: 'Ğ ĞµĞ±ĞµĞ½Ğ¾Ğº', minAge: 3 },
            teen: { name: 'ĞŸĞ¾Ğ´Ñ€Ğ¾ÑÑ‚Ğ¾Ğº', minAge: 10 },
            adult: { name: 'Ğ’Ğ·Ñ€Ğ¾ÑĞ»Ñ‹Ğ¹', minAge: 20 },
            elder: { name: 'ĞœÑƒĞ´Ñ€ĞµÑ†', minAge: 40 }
        };
        this.skins = {
            default: { 
                name: 'Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ Ğ›Ğ°Ğ±ÑƒĞ±Ñƒ', 
                rarity: 'common', 
                chance: 50, 
                image: 'https://i.ebayimg.com/images/g/yVoAAOSwiqJnxCvP/s-l1600.jpg',
                color: '#DEB887'
            }
        };
        this.outfits = {
            default: { name: 'ĞĞ±Ñ‹Ñ‡Ğ½Ğ°Ñ Ğ¾Ğ´ĞµĞ¶Ğ´Ğ°', price: 0, emoji: 'ğŸ‘•', description: 'ĞšĞ»Ğ°ÑÑĞ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑÑ‚Ğ¸Ğ»ÑŒ' }
        };
        this.currentSkin = 'default';
        this.outfit = 'default';
        this.evolutionStage = 'baby';
        this.petName = 'Labubu';
        
        // Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¼Ğ°ÑÑĞ¸Ğ²Ğ¾Ğ² Ğ´Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
        this.food = [
            { name: 'ĞŸĞµÑ‡ĞµĞ½ÑŒĞµ', hunger: 20, price: 20, emoji: 'ğŸª', happiness: 5 },
            { name: 'Ğ¤Ñ€ÑƒĞºÑ‚Ñ‹', hunger: 30, price: 35, emoji: 'ğŸ', health: 5 },
            { name: 'Ğ¡ÑƒÑˆĞ¸', hunger: 50, price: 65, emoji: 'ğŸ£', happiness: 10 },
            { name: 'Ğ¢Ğ¾Ñ€Ñ‚', hunger: 40, happiness: 15, price: 75, emoji: 'ğŸ°' },
            { name: 'ĞœĞ¾Ñ€Ğ¾Ğ¶ĞµĞ½Ğ¾Ğµ', hunger: 25, happiness: 20, price: 45, emoji: 'ğŸ¦' },
            { name: 'ĞŸĞ¸Ñ†Ñ†Ğ°', hunger: 60, price: 80, emoji: 'ğŸ•', happiness: 10 },
            { name: 'Ğ’Ğ¸Ñ‚Ğ°Ğ¼Ğ¸Ğ½Ñ‹', health: 30, price: 95, emoji: 'ğŸ’Š' },
            { name: 'Ğ­Ğ½ĞµÑ€Ğ³ĞµÑ‚Ğ¸Ğº', energy: 40, price: 55, emoji: 'âš¡' },
            { name: 'Ğ‘ÑƒÑ€Ğ³ĞµÑ€', hunger: 45, price: 50, emoji: 'ğŸ”', happiness: 8 },
            { name: 'Ğ Ñ‹Ğ±Ğ°', hunger: 35, health: 10, price: 45, emoji: 'ğŸŸ' },
            { name: 'Ğ¡Ğ°Ğ»Ğ°Ñ‚', health: 15, cleanliness: 10, price: 40, emoji: 'ğŸ¥—' },
            { name: 'ĞœĞ¾Ğ»Ğ¾ĞºĞ¾', hunger: 15, health: 8, price: 25, emoji: 'ğŸ¥›' }
        ];
        
        this.miniGames = [
            { id: 'memory', name: 'ĞœĞµĞ¼Ğ¾Ñ€Ğ¸', emoji: 'ğŸ§ ', description: 'Ğ—Ğ°Ğ¿Ğ¾Ğ¼Ğ½Ğ¸ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ', reward: { happiness: 25, experience: 20, money: 15 } },
            { id: 'reaction', name: 'Ğ ĞµĞ°ĞºÑ†Ğ¸Ñ', emoji: 'âš¡', description: 'ĞĞ°Ğ¶Ğ¼Ğ¸ ĞºĞ¾Ğ³Ğ´Ğ° Ğ¿Ğ¾ÑĞ²Ğ¸Ñ‚ÑÑ ÑĞ¸Ğ³Ğ½Ğ°Ğ»', reward: { happiness: 20, experience: 15, money: 10 } },
            { id: 'math', name: 'ĞœĞ°Ñ‚ĞµĞ¼Ğ°Ñ‚Ğ¸ĞºĞ°', emoji: 'ğŸ”¢', description: 'Ğ ĞµÑˆĞ¸ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğ¹ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€', reward: { happiness: 30, experience: 25, money: 20 } },
            { id: 'puzzle', name: 'ĞŸĞ°Ğ·Ğ»', emoji: 'ğŸ§©', description: 'Ğ¡Ğ¾Ğ±ĞµÑ€Ğ¸ Ñ‡Ğ¸ÑĞ»Ğ° Ğ¿Ğ¾ Ğ¿Ğ¾Ñ€ÑĞ´ĞºÑƒ', reward: { happiness: 35, experience: 30, money: 25 } },
            { id: 'quiz', name: 'Ğ’Ğ¸ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ½Ğ°', emoji: 'ğŸ¤”', description: 'ĞÑ‚Ğ²ĞµÑ‚ÑŒ Ğ½Ğ° Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ', reward: { happiness: 28, experience: 22, money: 18 } },
            { id: 'rhythm', name: 'Ğ Ğ¸Ñ‚Ğ¼', emoji: 'ğŸµ', description: 'ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸ Ñ€Ğ¸Ñ‚Ğ¼', reward: { happiness: 40, experience: 25, money: 20 } },
            { id: 'treasure', name: 'ĞšĞ»Ğ°Ğ´', emoji: 'ğŸ’', description: 'ĞĞ°Ğ¹Ğ´Ğ¸ ÑĞ¾ĞºÑ€Ğ¾Ğ²Ğ¸Ñ‰Ğµ', reward: { happiness: 20, experience: 15, money: 35 } },
            { id: 'balance', name: 'Ğ‘Ğ°Ğ»Ğ°Ğ½Ñ', emoji: 'âš–ï¸', description: 'Ğ£Ğ´ĞµÑ€Ğ¶Ğ¸ Ñ€Ğ°Ğ²Ğ½Ğ¾Ğ²ĞµÑĞ¸Ğµ', reward: { happiness: 25, experience: 20, money: 15 } },
            { id: 'matching', name: 'ĞĞ°Ğ¹Ğ´Ğ¸ Ğ¿Ğ°Ñ€Ñƒ', emoji: 'ğŸƒ', description: 'ĞĞ°Ğ¹Ğ´Ğ¸ Ğ¾Ğ´Ğ¸Ğ½Ğ°ĞºĞ¾Ğ²Ñ‹Ğµ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸', reward: { happiness: 30, experience: 25, money: 22 } },
            { id: 'simon', name: 'Ğ¡Ğ°Ğ¹Ğ¼Ğ¾Ğ½ Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚', emoji: 'ğŸ¯', description: 'ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ¡Ğ°Ğ¹Ğ¼Ğ¾Ğ½Ğ°', reward: { happiness: 32, experience: 28, money: 25 } },
            { id: 'word', name: 'Ğ¡Ğ¾ÑÑ‚Ğ°Ğ²ÑŒ ÑĞ»Ğ¾Ğ²Ğ¾', emoji: 'ğŸ“', description: 'Ğ¡Ğ¾ÑÑ‚Ğ°Ğ²ÑŒ ÑĞ»Ğ¾Ğ²Ğ¾ Ğ¸Ğ· Ğ±ÑƒĞºĞ²', reward: { happiness: 35, experience: 30, money: 28 } },
            { id: 'color', name: 'Ğ¦Ğ²ĞµÑ‚Ğ½Ğ°Ñ Ğ¸Ğ³Ñ€Ğ°', emoji: 'ğŸŒˆ', description: 'Ğ£Ğ³Ğ°Ğ´Ğ°Ğ¹ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ†Ğ²ĞµÑ‚', reward: { happiness: 28, experience: 22, money: 18 } },
            { id: 'sequence', name: 'ĞŸĞ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ', emoji: 'ğŸ”¤', description: 'ĞĞ°Ğ¹Ğ´Ğ¸ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚', reward: { happiness: 33, experience: 27, money: 24 } },
            { id: 'target', name: 'ĞŸĞ¾Ğ¿Ğ°Ğ´Ğ¸ Ğ² Ñ†ĞµĞ»ÑŒ', emoji: 'ğŸ¯', description: 'ĞŸĞ¾Ğ¿Ğ°Ğ´Ğ¸ Ğ² Ğ´Ğ²Ğ¸Ğ¶ÑƒÑ‰ÑƒÑÑÑ Ğ¼Ğ¸ÑˆĞµĞ½ÑŒ', reward: { happiness: 30, experience: 25, money: 20 } },
            { id: 'catch', name: 'ĞŸĞ¾Ğ¹Ğ¼Ğ°Ğ¹ Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚', emoji: 'ğŸª£', description: 'ĞŸĞ¾Ğ¹Ğ¼Ğ°Ğ¹ Ğ¿Ğ°Ğ´Ğ°ÑÑ‰Ğ¸Ğµ Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ñ‹', reward: { happiness: 35, experience: 28, money: 26 } },
            { id: 'maze', name: 'Ğ›Ğ°Ğ±Ğ¸Ñ€Ğ¸Ğ½Ñ‚', emoji: 'ğŸŒ€', description: 'ĞĞ°Ğ¹Ğ´Ğ¸ Ğ²Ñ‹Ñ…Ğ¾Ğ´ Ğ¸Ğ· Ğ»Ğ°Ğ±Ğ¸Ñ€Ğ¸Ğ½Ñ‚Ğ°', reward: { happiness: 40, experience: 35, money: 30 } },
            { id: 'code', name: 'Ğ’Ğ·Ğ»Ğ¾Ğ¼Ğ°Ğ¹ ĞºĞ¾Ğ´', emoji: 'ğŸ”', description: 'Ğ£Ğ³Ğ°Ğ´Ğ°Ğ¹ ÑĞµĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ´', reward: { happiness: 38, experience: 32, money: 28 } },
            { id: 'stack', name: 'Ğ¡Ğ¾Ğ±ĞµÑ€Ğ¸ Ğ±Ğ°ÑˆĞ½Ñ', emoji: 'ğŸ—ï¸', description: 'ĞŸĞ¾ÑÑ‚Ñ€Ğ¾Ğ¹ Ğ²Ñ‹ÑĞ¾ĞºÑƒÑ Ğ±Ğ°ÑˆĞ½Ñ', reward: { happiness: 36, experience: 30, money: 25 } },
            { id: 'speed', name: 'Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ', emoji: 'ğŸ’¨', description: 'ĞĞ°Ğ¶Ğ¼Ğ¸ ĞºĞ°Ğº Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ±Ñ‹ÑÑ‚Ñ€ĞµĞµ', reward: { happiness: 25, experience: 20, money: 15 } },
            { id: 'pattern', name: 'Ğ£Ğ·Ğ¾Ñ€', emoji: 'ğŸ¨', description: 'ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸ ÑƒĞ·Ğ¾Ñ€', reward: { happiness: 34, experience: 28, money: 23 } }
        ];
        
        // Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
        this.initializeData();
        
        // Ğ—Ğ²ÑƒĞºĞ¾Ğ²Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°
        this.audioContext = null;
        this.soundEnabled = this.loadData('sound_enabled', true, 'boolean');
        
        // Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ¸Ğ³Ñ€Ñ‹
        this.activeTab = 'care';
        this.currentMiniGame = null;
        this.notifications = [];
        
        // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ²Ğ¾Ğ·Ñ€Ğ°ÑÑ‚ Ğ¿Ñ€Ğ¸ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
        this.checkEvolution();
        
        // ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ ÑÑ€Ğ°Ğ·Ñƒ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
        setTimeout(() => {
            this.updateDisplay();
            this.debugSaveSystem();
        }, 50);
        
        // Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
        this.init();
        this.startGameLoop();
        this.startNotificationTimer();
        
        // ĞĞ²Ñ‚Ğ¾ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 30 ÑĞµĞºÑƒĞ½Ğ´
        this.startAutoSave();
        
        // Ğ•Ñ‰Ğµ Ğ¾Ğ´Ğ½Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· ÑĞµĞºÑƒĞ½Ğ´Ñƒ Ğ´Ğ»Ñ Ğ½Ğ°Ğ´ĞµĞ¶Ğ½Ğ¾ÑÑ‚Ğ¸
        setTimeout(() => {
            this.updateDisplay();
            console.log('ğŸ”„ ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾');
        }, 1000);
    }
    
    async initializeData() {
        console.log('ğŸ”„ Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸Ğ³Ñ€Ñ‹...');
        
        try {
            // Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¸Ğ»Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°ĞµĞ¼ gameUserId
        const existingUserId = localStorage.getItem('game_user_id');
        if (existingUserId) {
            this.gameUserId = existingUserId;
        } else {
            this.gameUserId = this.generateUserId();
            localStorage.setItem('game_user_id', this.gameUserId);
        }
        console.log('ğŸ†” Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ gameUserId:', this.gameUserId);
            this.telegramConnected = this.loadData('telegram_connected', false, 'boolean');
            this.telegramChatId = this.loadData('telegram_chat_id', '', 'string');
            
            console.log('ğŸ’¾ ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ğ½Ğ°Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¸Ğ· Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…...');
            
            // Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ¿Ñ‹Ñ‚Ğ°ĞµĞ¼ÑÑ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ¸Ğ· Ğ‘Ğ”
            const loadedFromDB = await this.loadFromDatabaseSync();
            
            if (loadedFromDB) {
                console.log('âœ… Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹ Ğ¸Ğ· Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…');
            } else {
                console.log('ğŸ“± Ğ‘Ğ” Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ°, Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¸Ğ· localStorage ĞºĞ°Ğº Ñ€ĞµĞ·ĞµÑ€Ğ²...');
                
                // Ğ•ÑĞ»Ğ¸ Ğ‘Ğ” Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ°, Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¸Ğ· localStorage Ğ´Ğ»Ñ Ğ­Ğ¢ĞĞ“Ğ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
                this.stats = this.loadData('labubu_stats', {
                    hunger: 100, happiness: 100, cleanliness: 100,
                    health: 100, energy: 100, sleep: 100
                });
                
                this.money = this.loadData('labubu_money', 100, 'number');
                this.outfit = this.loadData('labubu_outfit', 'default', 'string');
                this.ownedOutfits = this.loadData('owned_outfits', ['default']);
                this.lastStatDecay = this.loadData('last_stat_decay', Date.now(), 'number');
                this.level = this.loadData('labubu_level', 1, 'number');
                this.experience = this.loadData('labubu_experience', 0, 'number');
                this.age = this.loadData('labubu_age', 0, 'number');
                this.evolutionStage = this.loadData('labubu_evolution', 'baby', 'string');
                this.lastUpdate = this.loadData('labubu_last_update', Date.now(), 'number');
                this.lastNotification = this.loadData('labubu_last_notification', Date.now(), 'number');
                this.petName = this.loadData('pet_name', 'Labubu', 'string');
                this.isSleeping = this.loadData('labubu_sleeping', false, 'boolean');
                this.currentSkin = this.loadData('current_skin', 'default', 'string');
                this.unlockedSkins = this.loadData('unlocked_skins', ['default']);
                this.chestCount = this.loadData('chest_count', 0, 'number');
                this.friendsInvited = this.loadData('friends_invited', 0, 'number');
                this.lastChestLevel = this.loadData('last_chest_level', 0, 'number');
                
                console.log('âš ï¸ Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ÑÑ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ·-Ğ·Ğ° Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ‘Ğ”');
            }
            
            // Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ğ¸Ñ‚Ğ¾Ğ¼Ñ†ĞµĞ² (Ğ¸Ğ½Ğ´Ğ¸Ğ²Ğ¸Ğ´ÑƒĞ°Ğ»ÑŒĞ½Ğ¾ Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ)
            this.pets = this.loadData('labubu_pets', [
                { 
                    id: 'pet1', 
                    name: this.petName, 
                    stats: this.stats, 
                    outfit: this.outfit, 
                    age: this.age, 
                    evolutionStage: this.evolutionStage,
                    currentSkin: this.currentSkin
                }
            ]);
            this.activePetId = this.loadData('active_pet_id', 'pet1', 'string');
            
            // Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
            this.validateGameData();
            
            console.log('âœ… Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°');
            
        } catch (error) {
            console.error('âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…:', error);
            this.resetToDefaults();
        }
        
        // Ğ¡ĞºĞ¸Ğ½Ñ‹ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ĞµĞ¹ Ñ Ñ€ĞµĞ´ĞºĞ¾ÑÑ‚ÑĞ¼Ğ¸ Ğ¸ ÑˆĞ°Ğ½ÑĞ°Ğ¼Ğ¸
        this.skins = {
            default: { 
                name: 'Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ Ğ›Ğ°Ğ±ÑƒĞ±Ñƒ', 
                rarity: 'common', 
                chance: 50, 
                image: 'https://i.ebayimg.com/images/g/yVoAAOSwiqJnxCvP/s-l1600.jpg',
                color: '#DEB887'
            },
            pink: { 
                name: 'Ğ Ğ¾Ğ·Ğ¾Ğ²Ñ‹Ğ¹ Ğ›Ğ°Ğ±ÑƒĞ±Ñƒ', 
                rarity: 'rare', 
                chance: 27, 
                image: 'https://i.postimg.cc/8s8qs9Sv/photo-2025-06-29-05-15-51.jpg',
                color: '#FFB6C1'
            },
            orange: { 
                name: 'ĞÑ€Ğ°Ğ½Ğ¶ĞµĞ²Ñ‹Ğ¹ Ğ›Ğ°Ğ±ÑƒĞ±Ñƒ', 
                rarity: 'rare', 
                chance: 26.5, 
                image: 'https://i.postimg.cc/C5n3hYWY/photo-2025-06-29-05-16-06.jpg',
                color: '#FFA500'
            },
            blue: { 
                name: 'Ğ“Ğ¾Ğ»ÑƒĞ±Ğ¾Ğ¹ Ğ›Ğ°Ğ±ÑƒĞ±Ñƒ', 
                rarity: 'rare', 
                chance: 25, 
                image: 'https://i.postimg.cc/QNBC97DN/photo-2025-06-29-05-16-17.jpg',
                color: '#87CEEB'
            },
            rainbow: { 
                name: 'Ğ Ğ°Ğ´ÑƒĞ¶Ğ½Ñ‹Ğ¹ Ğ›Ğ°Ğ±ÑƒĞ±Ñƒ', 
                rarity: 'legendary', 
                chance: 9, 
                image: 'https://i.postimg.cc/SQwsW-KQ6/photo-2025-06-29-05-16-29.jpg',
                color: '#FF69B4'
            },
            golden: { 
                name: 'Ğ—Ğ¾Ğ»Ğ¾Ñ‚Ğ¾Ğ¹ Ğ›Ğ°Ğ±ÑƒĞ±Ñƒ', 
                rarity: 'mythic', 
                chance: 1, 
                image: 'https://i.postimg.cc/wTLBFd3S/photo-2025-06-29-05-16-38.jpg',
                color: '#FFD700'
            }
        };

        // Ğ ĞµĞ´ĞºĞ¾ÑÑ‚Ğ¸
        this.rarities = {
            common: { name: 'ĞĞ±Ñ‹Ñ‡Ğ½Ğ°Ñ', color: '#888888', emoji: 'âšª' },
            rare: { name: 'Ğ ĞµĞ´ĞºĞ°Ñ', color: '#4A90E2', emoji: 'ğŸ”µ' },
            legendary: { name: 'Ğ›ĞµĞ³ĞµĞ½Ğ´Ğ°Ñ€Ğ½Ğ°Ñ', color: '#FF6B35', emoji: 'ğŸŸ ' },
            mythic: { name: 'ĞœĞ¸Ñ„Ğ¸Ñ‡ĞµÑĞºĞ°Ñ', color: '#FFD700', emoji: 'ğŸŸ¡' }
        };

        // Ğ­Ğ²Ğ¾Ğ»ÑÑ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ ÑÑ‚Ğ°Ğ´Ğ¸Ğ¸
        this.evolutionStages = {
            baby: { name: 'ĞœĞ°Ğ»Ñ‹Ñˆ', minAge: 0 },
            child: { name: 'Ğ ĞµĞ±ĞµĞ½Ğ¾Ğº', minAge: 3 },
            teen: { name: 'ĞŸĞ¾Ğ´Ñ€Ğ¾ÑÑ‚Ğ¾Ğº', minAge: 10 },
            adult: { name: 'Ğ’Ğ·Ñ€Ğ¾ÑĞ»Ñ‹Ğ¹', minAge: 20 },
            elder: { name: 'ĞœÑƒĞ´Ñ€ĞµÑ†', minAge: 40 }
        };
        
        // ĞĞ´ĞµĞ¶Ğ´Ğ° Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğ¼Ğ¸ Ñ†ĞµĞ½Ğ°Ğ¼Ğ¸ Ğ¸ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸ÑĞ¼Ğ¸ (Ğ¾Ñ‚ÑĞ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾ Ğ¿Ğ¾ Ğ²Ğ¾Ğ·Ñ€Ğ°ÑÑ‚Ğ°Ğ½Ğ¸Ñ Ñ†ĞµĞ½)
        this.outfits = {
            default: { name: 'ĞĞ±Ñ‹Ñ‡Ğ½Ğ°Ñ Ğ¾Ğ´ĞµĞ¶Ğ´Ğ°', price: 0, emoji: 'ğŸ‘•', description: 'ĞšĞ»Ğ°ÑÑĞ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑÑ‚Ğ¸Ğ»ÑŒ' },
            cool: { name: 'ĞšÑ€ÑƒÑ‚Ñ‹Ğµ Ğ¾Ñ‡ĞºĞ¸', price: 250, emoji: 'ğŸ˜', description: 'Ğ¡Ñ‚Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ ÑĞ¾Ğ»Ğ½Ñ†ĞµĞ·Ğ°Ñ‰Ğ¸Ñ‚Ğ½Ñ‹Ğµ Ğ¾Ñ‡ĞºĞ¸', image: 'https://via.placeholder.com/80x40/000000/ffffff?text=ğŸ•¶ï¸' },
            cute: { name: 'ĞœĞ¸Ğ»Ğ°Ñ ÑˆĞ°Ğ¿Ğ¾Ñ‡ĞºĞ°-Ğ·Ğ°Ğ¹Ñ‡Ğ¸Ğº', price: 300, emoji: 'ğŸ°', description: 'ĞÑ‡Ğ°Ñ€Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ±ĞµĞ»Ğ°Ñ ÑˆĞ°Ğ¿Ğ¾Ñ‡ĞºĞ° Ñ Ñ€Ğ¾Ğ·Ğ¾Ğ²Ñ‹Ğ¼Ğ¸ ÑƒÑˆĞºĞ°Ğ¼Ğ¸', image: 'https://via.placeholder.com/100x80/ffb6c1/ffffff?text=ğŸ‘’' },
            artist: { name: 'Ğ¥ÑƒĞ´Ğ¾Ğ¶Ğ½Ğ¸Ğº', price: 380, emoji: 'ğŸ¨', description: 'Ğ‘ĞµÑ€ĞµÑ‚ Ğ¸ Ğ¿Ğ°Ğ»Ğ¸Ñ‚Ñ€Ğ° Ñ…ÑƒĞ´Ğ¾Ğ¶Ğ½Ğ¸ĞºĞ°' },
            summer: { name: 'Ğ›ĞµÑ‚Ğ½ÑÑ Ğ¿Ğ°Ğ½Ğ°Ğ¼Ğ°', price: 500, emoji: 'ğŸ‘’', description: 'Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ ÑĞ¾Ğ»Ğ½Ñ†Ğ° Ğ² Ğ¶Ğ°Ñ€ĞºĞ¸Ğµ Ğ´Ğ½Ğ¸', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KQgNY3oPaKq-vJXjqtKJhwoKBgt5rHdjiTq7FSl987ybzI3bnqyqEZliWC6n1k_YWtItJfQNjLu5ZcOheY9IUSTB5eoHuGKqoBu3HtCCn0pcimU1FsxfZKjdZ6dW-gMU6qVKPPAfeTa9-dgIn97icgGJyx5N3s-FwgRq5B525IWj_oNWw=s1024' },
            pirate: { name: 'ĞŸĞ¸Ñ€Ğ°Ñ‚ÑĞºĞ¸Ğ¹ ĞºĞ¾ÑÑ‚ÑĞ¼', price: 500, emoji: 'ğŸ´â€â˜ ï¸', description: 'Ğ¤Ğ»Ğ°Ğ³ Ğ¸ Ğ¿Ğ¾Ğ²ÑĞ·ĞºĞ° Ğ½Ğ°ÑÑ‚Ğ¾ÑÑ‰ĞµĞ³Ğ¾ Ğ¼Ğ¾Ñ€ÑĞºĞ¾Ğ³Ğ¾ Ñ€Ğ°Ğ·Ğ±Ğ¾Ğ¹Ğ½Ğ¸ĞºĞ°', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KTqA1YhFzadswfIqFeTFATGNWcVmql50yfSGR14sxF3P_7fA51t61z9O_ElOyuBffWnyEP4uFz70PvgU0UFiXiYv83KqIeQr45k0r4FdFhb0yqWCa2ULVO0DPUanQNk8B4ROzTQGmHwO6-p5dkt8uD0yfrk6P7_DOd7jvVYx27V56CjLg=s1024' },
            formal: { name: 'Ğ”ĞµĞ»Ğ¾Ğ²Ğ¾Ğ¹ ĞºĞ¾ÑÑ‚ÑĞ¼', price: 1500, emoji: 'ğŸ¤µ', description: 'Ğ­Ğ»ĞµĞ³Ğ°Ğ½Ñ‚Ğ½Ñ‹Ğ¹ Ñ‡ĞµÑ€Ğ½Ñ‹Ğ¹ ĞºĞ¾ÑÑ‚ÑĞ¼ Ñ Ğ³Ğ°Ğ»ÑÑ‚ÑƒĞºĞ¾Ğ¼', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KSeqdykkIdnGZHfOH14tCALa06aMF9P6d9Sw0rm7WeTi1NR-nW-0C4x231qu8Zts6k-Jnxg16chpirg1zJFbt7wjgHf3Wo6DQYdth3uXsQeeM8B0bdfsfoxXMLCwUHjQ4JgzFxFqRApcbPf5MYgsGj5pORBo_pAj1K0LHVhXMX6xMSEQQ=s1024' },
            winter: { name: 'Ğ—Ğ¸Ğ¼Ğ½ÑÑ ĞºÑƒÑ€Ñ‚ĞºĞ°', price: 2000, emoji: 'ğŸ§¥', description: 'Ğ¢ĞµĞ¿Ğ»Ğ°Ñ ĞºÑƒÑ€Ñ‚ĞºĞ° Ğ´Ğ»Ñ Ñ…Ğ¾Ğ»Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ¿Ğ¾Ğ³Ğ¾Ğ´Ñ‹', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KTxCEBZrsAcaOt8mt4LjcLthFQZ2lhlrIZTcwekzMR3ODS-7V-y_m7c-_yFdPd-hCb9i08p3fW0vCajAEdJkip67TQJw0rsP09l5c49ZyG_rBEsv2io9mW2msQJsli2hr7kv2kRopjHwdbN8hVyDVCoX7yBTzkkXxygobNfvPx1uqTp=s1024' },
            school: { name: 'Ğ¨ĞºĞ¾Ğ»ÑŒĞ½Ğ°Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ°', price: 3000, emoji: 'ğŸ’', description: 'ĞĞºĞºÑƒÑ€Ğ°Ñ‚Ğ½Ğ°Ñ ÑˆĞºĞ¾Ğ»ÑŒĞ½Ğ°Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ° Ñ Ñ€ÑĞºĞ·Ğ°Ñ‡ĞºĞ¾Ğ¼', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KSzueH3-hMtM7lA2WveRFgZV9iCXa0D5N9Z8Vw9AAR_mLgCyE6zTrqu6BABMCTH80UkFmp-vmBh0Cr7ZlDw7Lq-UttAyk21eli4s9rRagGFYjxeQESpOyAQXL9CSCPtGawNsaBfta6Wa_g7pku3LgMzEv6SzWSYs1UzxoJ9tJcQV2pr=s1024' },
            knight: { name: 'Ğ Ñ‹Ñ†Ğ°Ñ€ÑŒ', price: 3000, emoji: 'âš”ï¸', description: 'Ğ”Ğ¾ÑĞ¿ĞµÑ…Ğ¸ Ğ¸ Ğ¼ĞµÑ‡ Ñ…Ñ€Ğ°Ğ±Ñ€Ğ¾Ğ³Ğ¾ Ñ€Ñ‹Ñ†Ğ°Ñ€Ñ', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KQEyf89ZUfFdb4fEyslGacR2ovpuyvcMZ-2bBZNsjz6M3GboPgvXfVYSnJAarf5-kmyKBphmBLdZL63T4JlUTb1-IdxnLTjNTC-vMkNoj4heCd7LVeQWQ-47m5g-cOgDo75-3eLrKC9roxWbeHbtAgRJl3tRgA2jd0FBOXi-GqZqV3J3w=s1024' },
            chef: { name: 'ĞšĞ¾ÑÑ‚ÑĞ¼ Ğ¿Ğ¾Ğ²Ğ°Ñ€Ğ°', price: 4000, emoji: 'ğŸ‘¨â€ğŸ³', description: 'Ğ‘ĞµĞ»Ñ‹Ğ¹ ĞºĞ¾Ğ»Ğ¿Ğ°Ğº Ğ¸ Ñ„Ğ°Ñ€Ñ‚ÑƒĞº ÑˆĞµÑ„-Ğ¿Ğ¾Ğ²Ğ°Ñ€Ğ°', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KRAnLRL68CsnxJmlEhhul-fAzzg0wyNCnUd_IYARXgWj1m9mDqKeOVJy4e59Fwpz86mPm43o5IjyKxS7wEXPHVh626clvIWqEVAtrmmm7dgL-XopAKZ1YRujxo4ZBJbMjiSJ_sD2FwU1_nthVxma-b1Uut01G8839lnChFiagdPIsqjkQ=s1024' },
            superhero: { name: 'Ğ¡ÑƒĞ¿ĞµÑ€Ğ³ĞµÑ€Ğ¾Ğ¹', price: 4500, emoji: 'ğŸ¦¸', description: 'ĞŸĞ»Ğ°Ñ‰ Ğ¸ Ğ¼Ğ°ÑĞºĞ° Ğ½Ğ°ÑÑ‚Ğ¾ÑÑ‰ĞµĞ³Ğ¾ Ğ³ĞµÑ€Ğ¾Ñ', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KT-a_UoSupy-qHI_hWHRFiSG1i_9VeWgkZDicgclAVN_VHcGZy0oMTtQYzI_LivmJS7w_MM0PIslsYPPhSgwIZhQwdIq3eYkAhKxtNxtx0NKEjmucGdKxLetlYZZC6sZwoJxMBOhGyL49rjiF4ZKnSGBqavOq6EaxZUhYYBekqKFgZu=s1024' },
            doctor: { name: 'Ğ”Ğ¾ĞºÑ‚Ğ¾Ñ€', price: 4800, emoji: 'ğŸ‘¨â€âš•ï¸', description: 'Ğ‘ĞµĞ»Ñ‹Ğ¹ Ñ…Ğ°Ğ»Ğ°Ñ‚ Ğ¸ ÑÑ‚ĞµÑ‚Ğ¾ÑĞºĞ¾Ğ¿', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KSVy9I1VlEurY9loVBGFCv5A7ydPo1u5iMtuyVSql4t4SATcmjUsn8deyd1wVd7B_Eb1RXkb0ig_Wok-qf6tE3RFjxrfzOSB8wYvL03UOJ4A6By6BQv0M6IEWZ0XOX9vL0VP_1kgkxg5iZhnR_GIxm38rrIJPTUHFnhrPrU-njScGl1dg=s1024' },
            ninja: { name: 'ĞšĞ¾ÑÑ‚ÑĞ¼ Ğ½Ğ¸Ğ½Ğ´Ğ·Ñ', price: 5000, emoji: 'ğŸ¥·', description: 'Ğ¡ĞµĞºÑ€ĞµÑ‚Ğ½Ğ°Ñ Ğ¼Ğ°ÑĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ´Ğ»Ñ ÑĞºÑ€Ñ‹Ñ‚Ğ½Ğ¾ÑÑ‚Ğ¸', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KRshrrG8dFl75oR5qhzwIbpryxVJm5O8JyV17jwiybRyM2y5uotp52ANgD0AdevW_ZcWb1LrrMsdUeTHBUJ-tn8UZgA4BsRc7AI5CLstqTPYm9Ndb0eJRZhN1hfeUhRms8DP6LO2kKSPkZHSwEPYOFK2kBWm7-mmKALA7w8iWua8rTh=s1024' },
            detective: { name: 'Ğ”ĞµÑ‚ĞµĞºÑ‚Ğ¸Ğ²', price: 5000, emoji: 'ğŸ•µï¸', description: 'ĞŸĞ»Ğ°Ñ‰ Ğ¸ ÑˆĞ»ÑĞ¿Ğ° ÑÑ‹Ñ‰Ğ¸ĞºĞ°', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KTue-dtDhus0c5YaMD8XV9cM5RoZE_vv8hpx0XE6td8Rnf2S-XcR8I2O3gX_I-cknpK80NXU6vJ14RUY-j9w6-w4o4OfGXKaALMV-YEKugOVlyi5nNrPTQB-YKgkzS2Rxv2P-Hqui9vuXZmQVxP9Qf2tlEbKI8Va7-B_bsRbJ11XcBBhw=s1024' },
            wizard: { name: 'ĞšĞ¾ÑÑ‚ÑĞ¼ Ğ²Ğ¾Ğ»ÑˆĞµĞ±Ğ½Ğ¸ĞºĞ°', price: 5500, emoji: 'ğŸ§™', description: 'ĞœĞ°Ğ³Ğ¸Ñ‡ĞµÑĞºĞ°Ñ ÑˆĞ»ÑĞ¿Ğ° ÑĞ¾ Ğ·Ğ²ĞµĞ·Ğ´Ğ°Ğ¼Ğ¸', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KQPxv5r4tIYWRApKphxhkgxvnGKQM3xsq4M3aXc0geAPt-2vndpdQsdIj8NRVBWgKdMidAYute_I8JJm0ODHTBNQaJiocoUFom3YDGKQ8OVooO5DRr6FnrnXGQNeKxte5OkiBp0oSLIJJj5gLx4FSnqzIrX2gWgFz-4trg_FY9wwko_=s1024' },
            astronaut: { name: 'ĞšĞ¾ÑĞ¼Ğ¾Ğ½Ğ°Ğ²Ñ‚', price: 6000, emoji: 'ğŸ‘¨â€ğŸš€', description: 'Ğ¡ĞºĞ°Ñ„Ğ°Ğ½Ğ´Ñ€ Ğ´Ğ»Ñ ĞºĞ¾ÑĞ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ¿ÑƒÑ‚ĞµÑˆĞµÑÑ‚Ğ²Ğ¸Ğ¹', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KT324-72aIqf_NQFi9Tnsm9RzZ1AMnpOiazs-OFBLsEscgjEI9veiZtGCKxmQk3colgJi1PMqB_eMay5IMKIz6PNNMi7EQ0TBZpBo7wL8txaVuxYXUhXtKUsrw7tmyT_aO5RFDQJWqxCihIvzMxa64kcSOD6zzyFXFbZLZGCIvnRkggxQ=s1024' },
            dancer: { name: 'Ğ¢Ğ°Ğ½Ñ†Ğ¾Ñ€', price: 9000, emoji: 'ğŸ’ƒ', description: 'Ğ¯Ñ€ĞºĞ¸Ğ¹ ĞºĞ¾ÑÑ‚ÑĞ¼ Ğ´Ğ»Ñ Ñ‚Ğ°Ğ½Ñ†ĞµĞ²', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KQ1bWEIPopeYlRuCPeUOosampl8EutcqIbnPK8lFvkeqjxJW3_WJnqNouxj_V8rT8CpbIL1qquBwojfG7jXpGnpK6_gN881tPaFJVTaEeTbumY1RQI25STXm7xOo7aX_GplQe8czmFNvmmoyTIdUo8728z2C0fn09vYSiZnah0Z2zJb=s1024' },
            vampire: { name: 'Ğ’Ğ°Ğ¼Ğ¿Ğ¸Ñ€', price: 9999, emoji: 'ğŸ§›', description: 'Ğ§ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ¿Ğ»Ğ°Ñ‰ Ñ ĞºÑ€Ğ°ÑĞ½Ğ¾Ğ¹ Ğ¿Ğ¾Ğ´ĞºĞ»Ğ°Ğ´ĞºĞ¾Ğ¹', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KSuo6SXblej9rDGQ8LILADG9BLIwAjJ4E2YLtjshoZUuodp0PuVPENbbyrkcpbzkZv3d7hvN1h8FBnqxoo1L-3X3ehM1TNmCv6REelZ5qgFQgwCczuogCjCvrO1RhZEY_QTA44gBkzOuU0DsRgsWALWmatt0SEkQSlW-gX1pCE28q7eTw=s1024' },
            princess: { name: 'ĞŸÑ€Ğ¸Ğ½Ñ†ĞµÑÑĞ°', price: 10000, emoji: 'ğŸ‘¸', description: 'Ğ Ğ¾ÑĞºĞ¾ÑˆĞ½Ğ¾Ğµ Ğ¿Ğ»Ğ°Ñ‚ÑŒĞµ Ñ Ñ‚Ğ¸Ğ°Ñ€Ğ¾Ğ¹', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KT4Tt1J4Ad-O_QldsJl73yIYw2kiZytty5vsBTyRFyvDwq97eF62z6tZX4btNnDdy7vC1OiD-yz6hyGf_D4zzkFUZIx8ztfjmAALzJwveorga1bVO2z6awSb7B6bHBcjA3ElV1VqtYwbH8XGP39uVttD2NGXRxmCAKbxNyqhwmGBttx=s1024' },
            angel: { name: 'ĞĞ½Ğ³ĞµĞ»', price: 14000, emoji: 'ğŸ‘¼', description: 'Ğ‘ĞµĞ»Ñ‹Ğµ ĞºÑ€Ñ‹Ğ»ÑŒÑ Ğ¸ Ğ½Ğ¸Ğ¼Ğ±', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KSVmpstfVgB8mEks0YIUTCbhnziSNQu2lnWaN_czBj4obZG1n1OcLstyYdCGRYIRqkZ73KQb780aNr-E-Ntn-QC-AD0wGE-q1nl-Qn2r59f4YmPNf6L-GqacgaCRLB-Y9rXuFfJaFIVRsKPYV2UW4zfDfAGzhwp9Vc59TukY2RF7If-_A=s1024' },
            robot: { name: 'Ğ Ğ¾Ğ±Ğ¾Ñ‚', price: 20000, emoji: 'ğŸ¤–', description: 'ĞœĞµÑ‚Ğ°Ğ»Ğ»Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ĞºĞ¾ÑÑ‚ÑĞ¼ Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞ³Ğ¾', image: 'https://lh3.googleusercontent.com/gg-dl/AJfQ9KRydl7aa74Zq_cG1QWNF0soJHjskQIeTDTjzGT-Bktd9uAxlZmiQy-xEn2DmyeC_YdApcJhIhvq6-z4Mx6P-7if4kAjiMIn6kvNao3Yt59wCR6jjeZy4tnFTT2_GpJhhdNlG6GwlS9g1pn0_mrCs42iLOXH3GXHiH0BjFnlrvki7QZ_QA=s1024' }
        };
        

    }
    
    loadData(key, defaultValue, type = 'auto') {
        try {
            // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ gameUserId
            if (!this.gameUserId) {
                console.warn('âš ï¸ gameUserId Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡');
                const saved = localStorage.getItem(key);
                return saved ? this.parseValue(saved, type, defaultValue) : defaultValue;
            }
            
            // Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡ Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
            const userKey = `${this.gameUserId}_${key}`;
            const saved = localStorage.getItem(userKey);
            
            if (saved === null || saved === undefined) {
                return defaultValue;
            }
            
            return this.parseValue(saved, type, defaultValue);
        } catch (error) {
            console.error(`ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ»Ñ ĞºĞ»ÑÑ‡Ğ° ${key}:`, error);
            return defaultValue;
        }
    }
    
    parseValue(saved, type, defaultValue) {
        try {
            // ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ñ‚Ğ¸Ğ¿Ğ¾Ğ² Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
            switch (type) {
                case 'string':
                    return saved;
                    
                case 'number':
                    const num = parseFloat(saved);
                    return isNaN(num) ? defaultValue : num;
                    
                case 'boolean':
                    return saved === 'true';
                    
                case 'auto':
                default:
                    try {
                        return JSON.parse(saved);
                    } catch (parseError) {
                        console.warn(`ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³Ğ° Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ:`, parseError);
                        return defaultValue;
                    }
            }
        } catch (error) {
            return defaultValue;
        }
    }
    
    saveData() {
        try {
            console.log('ğŸ’¾ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸Ğ³Ñ€Ñ‹...');
            console.log('ğŸ†” gameUserId Ğ´Ğ»Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ:', this.gameUserId);
            
            // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ²Ñ€ĞµĞ¼Ñ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ³Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ
            this.lastUpdate = Date.now();
            
            // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¸Ñ‚Ğ¾Ğ¼Ñ†Ğ°
            this.updateActivePet();
            
            // ĞŸĞ Ğ˜ĞĞ Ğ˜Ğ¢Ğ•Ğ¢: Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² Ğ±Ğ°Ğ·Ñƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
            this.saveToDatabaseAsync().then(success => {
                if (success) {
                    console.log('âœ… Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ñ‹ Ğ² Ğ‘Ğ” (Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚)');
                } else {
                    console.log('âš ï¸ Ğ‘Ğ” Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ°, ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² localStorage');
                }
            });
            
            // Ğ”ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² localStorage ĞºĞ°Ğº ĞºÑÑˆ
            this.saveToLocalStorage();
            
            // Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¿Ğ¸Ğ¸
            this.createBackup();
            
            console.log('âœ… Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾');
            
        } catch (error) {
            console.error('âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…:', error);
            this.showMessage('âš ï¸ ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ! ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ.');
        }
    }
    
    saveValue(key, value) {
        try {
            // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ gameUserId
            if (!this.gameUserId) {
                console.warn('âš ï¸ gameUserId Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡');
                if (typeof value === 'object') {
                    localStorage.setItem(key, JSON.stringify(value));
                } else {
                    localStorage.setItem(key, value.toString());
                }
                return;
            }
            
            // Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡ Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
            const userKey = `${this.gameUserId}_${key}`;
            if (typeof value === 'object') {
                localStorage.setItem(userKey, JSON.stringify(value));
            } else {
                localStorage.setItem(userKey, value.toString());
            }
            
            console.log(`ğŸ’¾ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¾: ${userKey} = ${typeof value === 'object' ? JSON.stringify(value) : value}`);
        } catch (error) {
            console.error(`ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ ${key}:`, error);
        }
    }
    
    validateGameData() {
        console.log('ğŸ” Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸Ğ³Ñ€Ñ‹...');
        
        // Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸Ğº
        if (!this.stats || typeof this.stats !== 'object') {
            this.stats = {
                hunger: 100, happiness: 100, cleanliness: 100,
                health: 100, energy: 100, sleep: 100
            };
        }
        
        // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ‡Ğ¸ÑĞ»Ğ¾Ğ²Ñ‹Ñ… Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğ¹
        this.money = Math.max(0, this.money || 0);
        this.level = Math.max(1, this.level || 1);
        this.experience = Math.max(0, this.experience || 0);
        this.age = Math.max(0, this.age || 0);
        this.chestCount = Math.max(0, this.chestCount || 0);
        this.friendsInvited = Math.max(0, this.friendsInvited || 0);
        this.lastChestLevel = Math.max(0, this.lastChestLevel || 0);
        
        // Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸Ğº Ğ¿Ğ¸Ñ‚Ğ¾Ğ¼Ñ†Ğ° (0-100)
        Object.keys(this.stats).forEach(stat => {
            this.stats[stat] = Math.max(0, Math.min(100, this.stats[stat] || 100));
        });
        
        // Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ ÑÑ‚Ñ€Ğ¾ĞºĞ¾Ğ²Ñ‹Ñ… Ğ¿Ğ¾Ğ»ĞµĞ¹
        this.petName = this.petName || 'Labubu';
        this.outfit = this.outfit || 'default';
        this.currentSkin = this.currentSkin || 'default';
        this.evolutionStage = this.evolutionStage || 'baby';
        this.gameUserId = this.gameUserId || this.generateUserId();
        
        // Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ¼Ğ°ÑÑĞ¸Ğ²Ğ¾Ğ²
        if (!Array.isArray(this.unlockedSkins)) {
            this.unlockedSkins = ['default'];
        }
        
        if (!Array.isArray(this.pets)) {
            this.pets = [{
                id: 'pet1',
                name: this.petName,
                stats: this.stats,
                outfit: this.outfit,
                age: this.age,
                evolutionStage: this.evolutionStage,
                currentSkin: this.currentSkin
            }];
        }
        
        // Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ¼ĞµÑ‚Ğ¾Ğº
        if (!this.lastUpdate || this.lastUpdate > Date.now()) {
            this.lastUpdate = Date.now();
        }
        
        if (!this.lastNotification || this.lastNotification > Date.now()) {
            this.lastNotification = Date.now();
        }
        
        console.log('âœ… Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°');
        console.log('ğŸ“Š Ğ¤Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾ÑĞ»Ğµ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸:', {
            petName: this.petName,
            level: this.level,
            money: this.money,
            experience: this.experience,
            age: this.age,
            stats: this.stats
        });
    }
    
    updateActivePet() {
        const activePet = this.pets.find(pet => pet.id === this.activePetId);
        if (activePet) {
            activePet.name = this.petName;
            activePet.stats = { ...this.stats };
            activePet.outfit = this.outfit;
            activePet.age = this.age;
            activePet.evolutionStage = this.evolutionStage;
            activePet.currentSkin = this.currentSkin;
            activePet.level = this.level;
            activePet.experience = this.experience;
            activePet.money = this.money;
        }
    }
    
    createBackup() {
        try {
            const backupData = {
                timestamp: Date.now(),
                version: '4.0',
                gameUserId: this.gameUserId,
                data: {
                    stats: this.stats,
                    money: this.money,
                    outfit: this.outfit,
                    level: this.level,
                    experience: this.experience,
                    age: this.age,
                    evolutionStage: this.evolutionStage,
                    petName: this.petName,
                    isSleeping: this.isSleeping,
                    currentSkin: this.currentSkin,
                    unlockedSkins: this.unlockedSkins,
                    chestCount: this.chestCount,
                    friendsInvited: this.friendsInvited,
                    pets: this.pets,
                    ownedOutfits: this.ownedOutfits
                }
            };
            
            // Ğ˜Ğ½Ğ´Ğ¸Ğ²Ğ¸Ğ´ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ±ÑĞºĞ°Ğ¿ Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
            const backupKey = `${this.gameUserId}_labubu_backup`;
            const historyKey = `${this.gameUserId}_labubu_backup_history`;
            
            localStorage.setItem(backupKey, JSON.stringify(backupData));
            
            // Ğ¥Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ 3 Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¿Ğ¸Ğ¸
            const backupHistory = JSON.parse(localStorage.getItem(historyKey) || '[]');
            backupHistory.push(backupData);
            
            if (backupHistory.length > 3) {
                backupHistory.shift();
            }
            
            localStorage.setItem(historyKey, JSON.stringify(backupHistory));
            
        } catch (error) {
            console.error('ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¿Ğ¸Ğ¸:', error);
        }
    }
    
    restoreFromBackup() {
        try {
            const backupKey = `${this.gameUserId}_labubu_backup`;
            const backup = JSON.parse(localStorage.getItem(backupKey) || '{}');
            
            if (backup.data && backup.timestamp && backup.gameUserId === this.gameUserId) {
                const data = backup.data;
                
                this.stats = data.stats || this.stats;
                this.money = data.money || this.money;
                this.outfit = data.outfit || this.outfit;
                this.level = data.level || this.level;
                this.experience = data.experience || this.experience;
                this.age = data.age || this.age;
                this.evolutionStage = data.evolutionStage || this.evolutionStage;
                this.petName = data.petName || this.petName;
                this.isSleeping = data.isSleeping || this.isSleeping;
                this.currentSkin = data.currentSkin || this.currentSkin;
                this.unlockedSkins = data.unlockedSkins || this.unlockedSkins;
                this.chestCount = data.chestCount || this.chestCount;
                this.friendsInvited = data.friendsInvited || this.friendsInvited;
                this.pets = data.pets || this.pets;
                this.ownedOutfits = data.ownedOutfits || this.ownedOutfits;
                
                this.saveData();
                this.updateDisplay();
                
                return true;
            }
            
            return false;
            
        } catch (error) {
            console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¸Ğ· Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¿Ğ¸Ğ¸:', error);
            return false;
        }
    }
    
    resetToDefaults() {
        console.log('ğŸ”„ Ğ¡Ğ±Ñ€Ğ¾Ñ Ğº Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸ÑĞ¼ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ...');
        
        this.stats = {
            hunger: 100, happiness: 100, cleanliness: 100,
            health: 100, energy: 100, sleep: 100
        };
        
        this.money = 100;
        this.outfit = 'default';
        this.level = 1;
        this.experience = 0;
        this.age = 0;
        this.evolutionStage = 'baby';
        this.lastUpdate = Date.now();
        this.lastNotification = Date.now();
        this.petName = 'Labubu';
        this.isSleeping = false;
        this.telegramConnected = false;
        this.telegramChatId = '';
        this.gameUserId = this.generateUserId();
        this.currentSkin = 'default';
        this.unlockedSkins = ['default'];
        this.chestCount = 0;
        this.friendsInvited = 0;
        this.lastChestLevel = 0;
        
        this.pets = [{
            id: 'pet1',
            name: this.petName,
            stats: this.stats,
            outfit: this.outfit,
            age: this.age,
            evolutionStage: this.evolutionStage,
            currentSkin: this.currentSkin
        }];
        this.activePetId = 'pet1';
        
        this.saveData();
    }
    
    startAutoSave() {
        // ĞĞ²Ñ‚Ğ¾ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 30 ÑĞµĞºÑƒĞ½Ğ´
        setInterval(() => {
            this.saveData();
        }, 30000);
        
        // Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ Ğ‘Ğ” ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 2 Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñ‹
        setInterval(() => {
            this.loadFromDatabaseAsync();
        }, 120000);
        
        // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¸ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹
        window.addEventListener('beforeunload', () => {
            this.saveData();
        });
        
        // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ñ‚ĞµÑ€Ğµ Ñ„Ğ¾ĞºÑƒÑĞ°
        window.addEventListener('blur', () => {
            this.saveData();
        });
        
        // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹ Ğ¿Ñ€Ğ¸ Ñ„Ğ¾ĞºÑƒÑĞµ
        window.addEventListener('focus', () => {
            this.loadFromDatabaseAsync();
        });
    }
    
    exportGameData() {
        try {
            const exportData = {
                version: '4.0',
                timestamp: Date.now(),
                playerName: this.petName,
                data: {
                    stats: this.stats,
                    money: this.money,
                    outfit: this.outfit,
                    level: this.level,
                    experience: this.experience,
                    age: this.age,
                    evolutionStage: this.evolutionStage,
                    petName: this.petName,
                    isSleeping: this.isSleeping,
                    currentSkin: this.currentSkin,
                    unlockedSkins: this.unlockedSkins,
                    chestCount: this.chestCount,
                    friendsInvited: this.friendsInvited,
                    pets: this.pets,
                    gameUserId: this.gameUserId
                }
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `labubu_save_${new Date().toISOString().slice(0, 10)}.json`;
            link.click();
            
            this.showMessage('ğŸ“ Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹!');
            
        } catch (error) {
            console.error('ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ°:', error);
            this.showMessage('âŒ ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…!');
        }
    }
    
    importGameData(fileContent) {
        try {
            const importData = JSON.parse(fileContent);
            
            if (!importData.data || !importData.version) {
                throw new Error('ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ñ„Ğ°Ğ¹Ğ»Ğ°');
            }
            
            const data = importData.data;
            
            // Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ñ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸ĞµĞ¹
            this.stats = data.stats || this.stats;
            this.money = Math.max(0, data.money || 0);
            this.outfit = data.outfit || 'default';
            this.level = Math.max(1, data.level || 1);
            this.experience = Math.max(0, data.experience || 0);
            this.age = Math.max(0, data.age || 0);
            this.evolutionStage = data.evolutionStage || 'baby';
            this.petName = data.petName || 'Labubu';
            this.isSleeping = data.isSleeping || false;
            this.currentSkin = data.currentSkin || 'default';
            this.unlockedSkins = Array.isArray(data.unlockedSkins) ? data.unlockedSkins : ['default'];
            this.chestCount = Math.max(0, data.chestCount || 0);
            this.friendsInvited = Math.max(0, data.friendsInvited || 0);
            this.pets = Array.isArray(data.pets) ? data.pets : this.pets;
            
            if (data.gameUserId) {
                this.gameUserId = data.gameUserId;
            }
            
            // Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ
            this.validateGameData();
            this.saveData();
            this.updateDisplay();
            
            this.showMessage('âœ… Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹!');
            
        } catch (error) {
            console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ°:', error);
            this.showMessage('âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…!');
        }
    }
    
    init() {
        // ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ ÑÑƒÑ‚Ğ¾Ğº
        this.updateTimeAndWeather();
        
        // Ğ’ĞĞ–ĞĞ: ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ¿ÑƒÑĞºĞµ
        this.updateDisplay();
        
        // ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
        this.initEventListeners();
        
        // ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½ÑƒÑ Ğ²ĞºĞ»Ğ°Ğ´ĞºÑƒ
        this.switchTab('care');
        
        // ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ ĞµÑ‰Ğµ Ñ€Ğ°Ğ· Ğ¿Ğ¾ÑĞ»Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ²ĞºĞ»Ğ°Ğ´ĞºĞ¸
        setTimeout(() => {
            this.updateDisplay();
        }, 100);
    }
    
    initEventListeners() {
        // Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ´ĞµĞ»ĞµĞ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ Ğ´Ğ»Ñ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾Ğ¹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸
        document.addEventListener('click', (e) => {
            // Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸Ğ¼ĞµĞ½Ğ¸
            if (e.target.id === 'editNameBtn') {
                this.showNameEdit();
            } else if (e.target.id === 'saveNameBtn') {
                this.saveNameEdit();
            } else if (e.target.id === 'cancelNameBtn') {
                this.cancelNameEdit();
            }
            // Ğ—Ğ²ÑƒĞº
            else if (e.target.id === 'soundToggle') {
                this.toggleSound();
            }
            // Ğ’ĞºĞ»Ğ°Ğ´ĞºĞ¸
            else if (e.target.classList.contains('tab-btn')) {
                this.switchTab(e.target.dataset.tab);
            }
            // ĞœĞ¸Ğ½Ğ¸-Ğ¸Ğ³Ñ€Ñ‹
            else if (e.target.id === 'cancelGameBtn') {
                this.closeMiniGame();
            }
        });
        
        // ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Enter Ğ´Ğ»Ñ Ğ²Ğ²Ğ¾Ğ´Ğ° Ğ¸Ğ¼ĞµĞ½Ğ¸
        document.addEventListener('keypress', (e) => {
            if (e.target.id === 'nameInput' && e.key === 'Enter') {
                this.saveNameEdit();
            }
        });
    }
    
    updateTimeAndWeather() {
        const hour = new Date().getHours();
        const timeElement = document.getElementById('timeOfDay');
        const weatherElement = document.getElementById('weather');
        
        if (hour >= 6 && hour < 12) timeElement.textContent = 'ğŸŒ…';
        else if (hour >= 12 && hour < 18) timeElement.textContent = 'â˜€ï¸';
        else if (hour >= 18 && hour < 22) timeElement.textContent = 'ğŸŒ†';
        else timeElement.textContent = 'ğŸŒ™';
        
        const weathers = ['â˜€ï¸', 'â˜ï¸', 'ğŸŒ§ï¸', 'â„ï¸'];
        weatherElement.textContent = weathers[Math.floor(Math.random() * weathers.length)];
    }
    
    updateDisplay() {
        console.log('ğŸ”„ ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ...', {
            petName: this.petName,
            level: this.level,
            money: this.money,
            experience: this.experience,
            age: this.age
        });
        
        // ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ
        const petNameDisplay = document.getElementById('petNameDisplay');
        const levelDisplay = document.getElementById('levelDisplay');
        const moneyDisplay = document.getElementById('moneyDisplay');
        const expDisplay = document.getElementById('expDisplay');
        const ageDisplay = document.getElementById('ageDisplay');
        const ageText = document.getElementById('ageText');
        const soundToggle = document.getElementById('soundToggle');
        
        if (petNameDisplay) {
            petNameDisplay.textContent = this.petName;
            console.log('âœ… Ğ˜Ğ¼Ñ Ğ¿Ğ¸Ñ‚Ğ¾Ğ¼Ñ†Ğ° Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾:', this.petName);
        }
        if (levelDisplay) {
            levelDisplay.textContent = `Lv.${this.level}`;
            console.log('âœ… Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½:', this.level);
        }
        if (moneyDisplay) {
            moneyDisplay.textContent = `ğŸ’°${this.money}`;
            console.log('âœ… Ğ”ĞµĞ½ÑŒĞ³Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹:', this.money);
        }
        if (expDisplay) {
            expDisplay.textContent = `â­${this.experience}/100`;
            console.log('âœ… ĞĞ¿Ñ‹Ñ‚ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½:', this.experience);
        }
        if (ageDisplay) ageDisplay.textContent = `ğŸ‚${this.age}Ğ´`;
        if (ageText) ageText.textContent = this.age;
        
        // Ğ—Ğ²ÑƒĞº
        if (soundToggle) soundToggle.textContent = this.soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
        
        // Telegram ÑÑ‚Ğ°Ñ‚ÑƒÑ (optional elements)
        const telegramBtn = document.getElementById('telegramBtn');
        const telegramStatus = document.getElementById('telegramStatus');
        
        if (telegramBtn && telegramStatus) {
            if (this.telegramConnected) {
                telegramBtn.classList.add('hidden');
                telegramStatus.classList.remove('hidden');
            } else {
                telegramBtn.classList.remove('hidden');
                telegramStatus.classList.add('hidden');
            }
        }
        
        // ĞĞ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ
        const mood = this.getMood();
        const moodEmoji = document.getElementById('moodEmoji');
        const moodStatus = document.getElementById('moodStatus');
        const evolutionStage = document.getElementById('evolutionStage');
        const petImage = document.getElementById('petImage');
        
        if (moodEmoji && mood) moodEmoji.textContent = mood.emoji;
        if (moodStatus && mood) moodStatus.textContent = mood.status;
        if (evolutionStage && this.evolutionStages && this.evolutionStages[this.evolutionStage]) {
            evolutionStage.textContent = this.evolutionStages[this.evolutionStage].name;
        }
        
        // Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¸Ñ‚Ğ¾Ğ¼Ñ†Ğ°
        if (petImage && this.skins && this.skins[this.currentSkin] && this.skins[this.currentSkin].image) {
            petImage.src = this.skins[this.currentSkin].image;
        }
        
        // Ğ¡Ğ¾Ğ½ Ğ¸ Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ñ‹
        const sleepIndicator = document.getElementById('sleepIndicator');
        const criticalIndicator = document.getElementById('criticalIndicator');
        const moodIndicator = document.getElementById('moodIndicator');
        
        if (sleepIndicator) sleepIndicator.classList.toggle('hidden', !this.isSleeping);
        
        // Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° stats Ğ´Ğ»Ñ Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ğ¾Ğ²
        if (this.stats && typeof this.stats === 'object') {
            const avgStats = Object.values(this.stats).reduce((a, b) => a + b, 0) / 6;
            if (criticalIndicator) criticalIndicator.classList.toggle('hidden', avgStats > 10);
        }
        
        if (moodIndicator && mood) {
            if (mood.emoji === 'ğŸ¥°') moodIndicator.textContent = 'â¤ï¸';
            else moodIndicator.textContent = '';
        }
        
        // ĞĞ´ĞµĞ¶Ğ´Ğ°
        this.updateOutfit();
        
        // Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸
        this.updateStatsDisplay();
    }
    
    updateOutfit() {
        const outfitContainer = document.getElementById('outfitContainer');
        const currentOutfitEl = document.getElementById('currentOutfit');
        
        if (!outfitContainer || !currentOutfitEl) return;
        
        outfitContainer.innerHTML = '';
        
        if (this.outfit !== 'default' && this.outfits && this.outfits[this.outfit]) {
            const outfitData = this.outfits[this.outfit];
            currentOutfitEl.textContent = `${outfitData.emoji} ${outfitData.name}`;
            currentOutfitEl.classList.remove('hidden');
            
            if (outfitData.image) {
                const outfitImg = document.createElement('img');
                outfitImg.src = outfitData.image;
                outfitImg.className = 'absolute object-contain';
                
                if (this.outfit === 'cute') {
                    outfitImg.className += ' top-2 left-1/2 transform -translate-x-1/2 w-28 h-28';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'cool') {
                    outfitImg.className += ' top-8 left-1/2 transform -translate-x-1/2 w-16 h-8';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'formal') {
                    outfitImg.className += ' top-8 left-1/2 transform -translate-x-1/2 w-28 h-32';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'winter') {
                    outfitImg.className += ' top-6 left-1/2 transform -translate-x-1/2 w-30 h-34';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'summer') {
                    outfitImg.className += ' top-2 left-1/2 transform -translate-x-1/2 w-28 h-28';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'ninja') {
                    outfitImg.className += ' top-4 left-1/2 transform -translate-x-1/2 w-32 h-36';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'pirate') {
                    outfitImg.className += ' top-6 left-1/2 transform -translate-x-1/2 w-30 h-34';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'wizard') {
                    outfitImg.className += ' top-0 left-1/2 transform -translate-x-1/2 w-32 h-40';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'school') {
                    outfitImg.className += ' top-8 left-1/2 transform -translate-x-1/2 w-28 h-32';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'chef') {
                    outfitImg.className += ' top-2 left-1/2 transform -translate-x-1/2 w-30 h-34';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'superhero') {
                    outfitImg.className += ' top-4 left-1/2 transform -translate-x-1/2 w-32 h-36';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'princess') {
                    outfitImg.className += ' top-6 left-1/2 transform -translate-x-1/2 w-32 h-36';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'astronaut') {
                    outfitImg.className += ' top-2 left-1/2 transform -translate-x-1/2 w-32 h-38';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'detective') {
                    outfitImg.className += ' top-4 left-1/2 transform -translate-x-1/2 w-30 h-34';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'doctor') {
                    outfitImg.className += ' top-6 left-1/2 transform -translate-x-1/2 w-28 h-32';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'dancer') {
                    outfitImg.className += ' top-8 left-1/2 transform -translate-x-1/2 w-30 h-32';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'knight') {
                    outfitImg.className += ' top-4 left-1/2 transform -translate-x-1/2 w-32 h-36';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'vampire') {
                    outfitImg.className += ' top-2 left-1/2 transform -translate-x-1/2 w-34 h-38';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'angel') {
                    outfitImg.className += ' top-0 left-1/2 transform -translate-x-1/2 w-36 h-40';
                    outfitImg.style.zIndex = '10';
                } else if (this.outfit === 'robot') {
                    outfitImg.className += ' top-2 left-1/2 transform -translate-x-1/2 w-34 h-38';
                    outfitImg.style.zIndex = '10';
                }
                
                outfitContainer.appendChild(outfitImg);
            }
        } else {
            currentOutfitEl.classList.add('hidden');
        }
    }
    
    updateStatsDisplay() {
        const container = document.getElementById('statsContainer');
        if (!container) return;
        
        const stats = [
            { label: 'ğŸ½ï¸ Ğ“Ğ¾Ğ»Ğ¾Ğ´', value: this.stats.hunger, color: 'bg-orange-500' },
            { label: 'ğŸ˜Š Ğ¡Ñ‡Ğ°ÑÑ‚ÑŒĞµ', value: this.stats.happiness, color: 'bg-yellow-500' },
            { label: 'ğŸ› Ğ§Ğ¸ÑÑ‚Ğ¾Ñ‚Ğ°', value: this.stats.cleanliness, color: 'bg-blue-500' },
            { label: 'â¤ï¸ Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ', value: this.stats.health, color: 'bg-red-500' },
            { label: 'âš¡ Ğ­Ğ½ĞµÑ€Ğ³Ğ¸Ñ', value: this.stats.energy, color: 'bg-green-500' },
            { label: 'ğŸ˜´ Ğ¡Ğ¾Ğ½', value: this.stats.sleep, color: 'bg-purple-500' }
        ];
        
        container.innerHTML = stats.map(stat => `
            <div class="mb-2">
                <div class="flex justify-between mb-1">
                    <span class="text-xs font-medium">${stat.label}</span>
                    <span class="text-xs">${stat.value}%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-1.5">
                    <div class="h-1.5 rounded-full transition-all duration-300 ${stat.color}" style="width: ${stat.value}%"></div>
                </div>
            </div>
        `).join('');
    }
    
    getMood() {
        if (this.isSleeping) return { emoji: 'ğŸ˜´', status: 'Ğ¡Ğ¿Ğ¸Ñ‚' };
        
        // Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° stats
        if (!this.stats || typeof this.stats !== 'object') {
            return { emoji: 'ğŸ˜', status: 'Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...' };
        }
        
        const avg = Object.values(this.stats).reduce((a, b) => a + b, 0) / 6;
        if (avg > 90) return { emoji: 'ğŸ¥°', status: 'Ğ’Ğ¾ÑÑ…Ğ¸Ñ‚Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾' };
        if (avg > 80) return { emoji: 'ğŸ˜Š', status: 'ĞÑ‡ĞµĞ½ÑŒ ÑÑ‡Ğ°ÑÑ‚Ğ»Ğ¸Ğ²' };
        if (avg > 60) return { emoji: 'ğŸ™‚', status: 'Ğ¡Ñ‡Ğ°ÑÑ‚Ğ»Ğ¸Ğ²' };
        if (avg > 40) return { emoji: 'ğŸ˜', status: 'ĞĞ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾' };
        if (avg > 20) return { emoji: 'ğŸ˜Ÿ', status: 'Ğ“Ñ€ÑƒÑÑ‚Ğ½Ğ¾' };
        if (avg > 10) return { emoji: 'ğŸ˜¢', status: 'ĞÑ‡ĞµĞ½ÑŒ Ğ³Ñ€ÑƒÑÑ‚Ğ½Ğ¾' };
        return { emoji: 'ğŸ’€', status: 'ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ' };
    }
    
    showMessage(msg) {
        const messageEl = document.getElementById('gameMessage');
        messageEl.textContent = msg;
        messageEl.classList.remove('hidden');
        setTimeout(() => messageEl.classList.add('hidden'), 3000);
    }
    
    showNotification(message, type) {
        const notification = {
            id: Date.now(),
            message,
            type,
            timestamp: Date.now()
        };
        
        this.notifications.push(notification);
        
        const notificationEl = document.createElement('div');
        notificationEl.className = `p-3 rounded-lg shadow-lg text-white text-sm max-w-xs notification-enter ${this.getNotificationColor(type)}`;
        notificationEl.textContent = message;
        
        document.getElementById('notifications').appendChild(notificationEl);
        
        // ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² Telegram
        this.sendTelegramNotification(message, type);
        
        setTimeout(() => {
            notificationEl.classList.add('notification-exit');
            setTimeout(() => {
                if (notificationEl.parentNode) {
                    notificationEl.parentNode.removeChild(notificationEl);
                }
            }, 300);
            this.notifications = this.notifications.filter(n => n.id !== notification.id);
        }, 5000);
    }
    
    getNotificationColor(type) {
        const colors = {
            reminder: 'bg-blue-500',
            sad: 'bg-red-500',
            sleepy: 'bg-purple-500',
            hungry: 'bg-orange-500',
            dirty: 'bg-blue-600',
            sick: 'bg-red-600',
            tired: 'bg-yellow-500'
        };
        return colors[type] || 'bg-gray-500';
    }
    
    showNameEdit() {
        document.getElementById('nameEditSection').classList.remove('hidden');
        document.getElementById('editNameBtn').classList.add('hidden');
        document.getElementById('nameInput').value = this.petName;
        document.getElementById('nameInput').focus();
    }
    
    saveNameEdit() {
        const newName = document.getElementById('nameInput').value.trim();
        if (newName && newName.length <= 15) {
            this.petName = newName;
            this.showMessage(`Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ·Ğ¾Ğ²ÑƒÑ‚ ${this.petName}!`);
            this.saveData();
            this.updateDisplay();
        }
        this.cancelNameEdit();
    }
    
    cancelNameEdit() {
        document.getElementById('nameEditSection').classList.add('hidden');
        document.getElementById('editNameBtn').classList.remove('hidden');
    }
    
    toggleSound() {
        this.soundEnabled = !this.soundEnabled;
        this.updateDisplay();
        this.saveData();
    }
    
    playSound(frequency, duration = 200, type = 'sine') {
        if (!this.soundEnabled) return;
        
        try {
            if (!this.audioContext) {
                this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            
            const oscillator = this.audioContext.createOscillator();
            const gainNode = this.audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(this.audioContext.destination);
            
            oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
            oscillator.type = type;
            
            gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration / 1000);
            
            oscillator.start();
            oscillator.stop(this.audioContext.currentTime + duration / 1000);
        } catch (error) {
            console.log('Sound not available');
        }
    }
    
    playHappySound() {
        this.playSound(523, 100);
        setTimeout(() => this.playSound(659, 100), 100);
        setTimeout(() => this.playSound(784, 150), 200);
    }
    
    switchTab(tab) {
        this.activeTab = tab;
        
        // ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸
        document.querySelectorAll('.tab-btn').forEach(btn => {
            if (btn.dataset.tab === tab) {
                btn.className = 'tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors bg-purple-500 text-white';
            } else {
                btn.className = 'tab-btn flex-1 py-2 px-1 rounded-md font-medium transition-colors text-purple-500 hover:bg-purple-50';
            }
        });
        
        // ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚
        const content = document.getElementById('tabContent');
        content.innerHTML = this.getTabContent(tab);
    }
    
    getTabContent(tab) {
        switch (tab) {
            case 'care':
                return this.getCareTabContent();
            case 'games':
                return this.getGamesTabContent();
            case 'shop':
                return this.getShopTabContent();
            case 'chests':
                return this.getChestsTabContent();
            case 'pets':
                return this.getPetsTabContent();
            case 'info':
                return this.getInfoTabContent();
            default:
                return '';
        }
    }
    
    getCareTabContent() {
        const foodGrid = this.food.map((item, index) => `
            <button onclick="game.feedPet(${index})" class="bg-orange-100 hover:bg-orange-200 p-2 rounded text-xs transition-colors" ${this.isSleeping ? 'disabled' : ''}>
                <div class="text-sm">${item.emoji}</div>
                <div class="font-medium text-xs">${item.name}</div>
                <div class="text-xs text-gray-600">${item.price}ğŸ’°</div>
            </button>
        `).join('');
        
        return `
            <div class="space-y-3">
                <div class="bg-white rounded-lg p-3 shadow">
                    <h3 class="font-bold mb-2 text-purple-800 text-sm">ğŸ½ï¸ ĞšĞ¾Ñ€Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ</h3>
                    <div class="grid grid-cols-4 gap-1">${foodGrid}</div>
                </div>
                <div class="bg-white rounded-lg p-3 shadow">
                    <h3 class="font-bold mb-2 text-purple-800 text-sm">âš¡ Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ</h3>
                    <div class="grid grid-cols-3 gap-1">
                        <button onclick="game.washPet()" class="bg-blue-100 hover:bg-blue-200 p-2 rounded text-xs transition-colors" ${this.isSleeping ? 'disabled' : ''}>
                            <div class="text-sm">ğŸ›</div>
                            <div class="font-medium">ĞœÑ‹Ñ‚ÑŒ</div>
                        </button>
                        <button onclick="game.healPet()" class="bg-red-100 hover:bg-red-200 p-2 rounded text-xs transition-colors">
                            <div class="text-sm">ğŸ’Š</div>
                            <div class="font-medium">Ğ›ĞµÑ‡Ğ¸Ñ‚ÑŒ</div>
                            <div class="text-xs">30ğŸ’°</div>
                        </button>
                        <button onclick="game.toggleSleep()" class="bg-purple-100 hover:bg-purple-200 p-2 rounded text-xs transition-colors">
                            <div class="text-sm">${this.isSleeping ? 'â˜€ï¸' : 'ğŸ˜´'}</div>
                            <div class="font-medium">${this.isSleeping ? 'Ğ‘ÑƒĞ´Ğ¸Ñ‚ÑŒ' : 'Ğ¡Ğ¿Ğ°Ñ‚ÑŒ'}</div>
                        </button>
                    </div>
                </div>
            </div>
        `;
    }
    
    getGamesTabContent() {
        const gamesGrid = this.miniGames.map((game, index) => `
            <button onclick="game.startMiniGame(${index})" class="p-2 rounded-lg text-xs transition-colors bg-yellow-100 hover:bg-yellow-200 flex flex-col items-center" ${this.isSleeping || this.stats.energy < 15 ? 'disabled' : ''}>
                <span class="text-lg mb-1">${game.emoji}</span>
                <div class="font-medium text-center">${game.name}</div>
                <div class="text-xs text-gray-600 text-center">${game.description}</div>
                <div class="text-xs text-red-600 mt-1">-15 ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸</div>
            </button>
        `).join('');
        
        return `
            <div class="bg-white rounded-lg p-3 shadow">
                <h3 class="font-bold mb-2 text-purple-800 text-sm">ğŸ® ĞœĞ¸Ğ½Ğ¸-Ğ¸Ğ³Ñ€Ñ‹</h3>
                <div class="grid grid-cols-2 gap-2">${gamesGrid}</div>
            </div>
        `;
    }
    
    getShopTabContent() {
        const outfitsList = Object.entries(this.outfits).map(([key, item]) => {
            const isOwned = this.ownedOutfits.includes(key);
            const isWearing = this.outfit === key;
            
            return `
            <button onclick="game.buyOutfit('${key}')" class="w-full p-2 rounded-lg text-xs transition-colors flex items-center justify-between ${
                isWearing ? 'bg-green-100 border-2 border-green-500' : 
                isOwned ? 'bg-blue-50 border-2 border-blue-300' :
                'bg-gray-100 hover:bg-gray-200'
            }">
                <div class="flex items-center space-x-2">
                    <span class="text-lg">${item.emoji}</span>
                    <div class="text-left">
                        <div class="font-medium">${item.name}</div>
                        <div class="text-xs text-gray-500">${item.description}</div>
                        <div class="text-xs text-gray-600 font-bold">
                            ${isOwned ? 'ĞšÑƒĞ¿Ğ»ĞµĞ½Ğ¾' : item.price === 0 ? 'Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾' : `${item.price}ğŸ’°`}
                        </div>
                    </div>
                </div>
                ${isWearing ? '<span class="text-green-600 font-bold">âœ“ ĞĞ°Ğ´ĞµÑ‚Ğ¾</span>' : 
                  isOwned ? '<span class="text-blue-600 font-bold">ğŸ‘ ĞĞ°Ğ´ĞµÑ‚ÑŒ</span>' : 
                  ''}
            </button>
        `
        }).join('');
        
        return `
            <div class="bg-white rounded-lg p-3 shadow">
                <h3 class="font-bold mb-2 text-purple-800 text-sm">ğŸ‘— ĞœĞ°Ğ³Ğ°Ğ·Ğ¸Ğ½ Ğ¾Ğ´ĞµĞ¶Ğ´Ñ‹</h3>
                <div class="grid grid-cols-1 gap-1 max-h-64 overflow-y-auto">
                    ${Object.entries(this.outfits).map(([key, item]) => {
                        const isOwned = this.ownedOutfits.includes(key);
                        const isWearing = this.outfit === key;
                        
                        return `
                        <button onclick="game.buyOutfit('${key}')" class="w-full p-2 rounded-lg text-xs transition-colors flex items-center justify-between ${
                            isWearing ? 'bg-green-100 border-2 border-green-500' : 
                            isOwned ? 'bg-blue-50 border-2 border-blue-300' :
                            'bg-gray-100 hover:bg-gray-200'
                        }">
                            <div class="flex items-center space-x-2">
                                <span class="text-lg">${item.emoji}</span>
                                <div class="text-left">
                                    <div class="font-medium">${item.name}</div>
                                    <div class="text-xs text-gray-500">${item.description}</div>
                                    <div class="text-xs text-gray-600 font-bold">
                                        ${isOwned ? 'ĞšÑƒĞ¿Ğ»ĞµĞ½Ğ¾' : item.price === 0 ? 'Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾' : `${item.price}ğŸ’°`}
                                    </div>
                                </div>
                            </div>
                            ${isWearing ? '<span class="text-green-600 font-bold">âœ“ ĞĞ°Ğ´ĞµÑ‚Ğ¾</span>' : 
                              isOwned ? '<span class="text-blue-600 font-bold">ğŸ‘ ĞĞ°Ğ´ĞµÑ‚ÑŒ</span>' : 
                              ''}
                        </button>
                        `;
                    }).join('')}
                </div>
            </div>
        `;
    }
    
    getPetsTabContent() {
        return `
            <div class="bg-white rounded-lg p-3 shadow">
                <h3 class="font-bold mb-2 text-purple-800 text-sm">ğŸ° Ğ’Ğ°Ñˆ Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ¿Ğ¸Ñ‚Ğ¾Ğ¼ĞµÑ†</h3>
                <div class="text-center mb-4">
                    <div class="text-4xl mb-2">ğŸ°</div>
                    <h4 class="font-bold text-lg text-purple-800">${this.petName}</h4>
                    <p class="text-sm text-gray-600">Ğ’Ğ°Ñˆ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ğ¸Ñ‚Ğ¾Ğ¼ĞµÑ†</p>
                    <div class="bg-green-50 p-2 rounded-lg mt-3">
                        <p class="text-xs text-green-800">ğŸ”’ Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ²Ñ‹ Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ ÑƒÑ…Ğ°Ğ¶Ğ¸Ğ²Ğ°Ñ‚ÑŒ Ğ·Ğ° ${this.petName}</p>
                        <p class="text-xs text-green-600">ğŸ’¾ Ğ’ÑĞµ Ğ²Ğ°ÑˆĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑÑÑ‚ÑÑ Ğ¸Ğ½Ğ´Ğ¸Ğ²Ğ¸Ğ´ÑƒĞ°Ğ»ÑŒĞ½Ğ¾</p>
                    </div>
                </div>
                <div class="bg-blue-50 p-3 rounded-lg">
                    <h4 class="font-bold text-sm text-blue-800 mb-2">ğŸ†” Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾Ğ± Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğµ</h4>
                    <div class="text-xs text-blue-700 space-y-1">
                        <p><strong>ID Ğ¸Ğ³Ñ€Ğ¾ĞºĞ°:</strong> ${this.gameUserId.slice(-8)}</p>
                        <p><strong>Ğ˜Ğ¼Ñ Ğ¿Ğ¸Ñ‚Ğ¾Ğ¼Ñ†Ğ°:</strong> ${this.petName}</p>
                        <p><strong>Ğ’Ğ¾Ğ·Ñ€Ğ°ÑÑ‚:</strong> ${this.age} Ğ´Ğ½ĞµĞ¹</p>
                        <p><strong>Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ:</strong> ${this.level}</p>
                    </div>
                </div>
            </div>
        `;
    }
    
    getInfoTabContent() {
        return `
            <div class="space-y-3">

                
                <div class="bg-white rounded-lg p-3 shadow">
                    <h3 class="font-bold mb-3 text-purple-800 text-sm">â„¹ï¸ Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾Ğ± Ğ¸Ğ³Ñ€Ğµ</h3>
                    <div class="space-y-3 text-xs">
                        <div class="bg-blue-50 p-2 rounded">
                            <h4 class="font-bold text-blue-800 mb-1">ğŸš€ Ğ‘ÑƒĞ´ÑƒÑ‰Ğ¸Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ</h4>
                            <p class="text-blue-700">Ğ‘Ğ¾Ñ‚ Ğ±ÑƒĞ´ĞµÑ‚ Ñ€ĞµĞ³ÑƒĞ»ÑÑ€Ğ½Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑÑ‚ÑŒÑÑ! ĞĞ¶Ğ¸Ğ´Ğ°Ğ¹Ñ‚Ğµ:</p>
                            <ul class="list-disc list-inside text-blue-700 mt-1">
                                <li>ĞĞ¾Ğ²Ñ‹Ğµ Ğ¼Ğ¸Ğ½Ğ¸-Ğ¸Ğ³Ñ€Ñ‹ Ğ¸ Ñ€Ğ°Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ñ</li>
                                <li>Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ ÑĞºĞ¸Ğ½Ñ‹ Ğ¸ Ğ¾Ğ´ĞµĞ¶Ğ´Ğ°</li>
                                <li>ĞÑĞ¾Ğ±Ñ‹Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ¸ Ğ¿Ñ€Ğ°Ğ·Ğ´Ğ½Ğ¸ĞºĞ¸</li>
                                <li>Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° ÑĞ²Ğ¾Ğ»ÑÑ†Ğ¸Ğ¸</li>
                                <li>ĞœĞ½Ğ¾Ğ³Ğ¾ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑĞ½Ñ‹Ñ… Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹!</li>
                            </ul>
                        </div>
                        <div class="bg-green-50 p-2 rounded">
                            <h4 class="font-bold text-green-800 mb-1">ğŸ® ĞšĞ°Ğº Ğ¸Ğ³Ñ€Ğ°Ñ‚ÑŒ</h4>
                            <ul class="list-disc list-inside text-green-700">
                                <li>ĞšĞ¾Ñ€Ğ¼Ğ¸Ñ‚Ğµ ${this.petName} ĞºĞ¾Ğ³Ğ´Ğ° Ğ³Ğ¾Ğ»Ğ¾Ğ´ĞµĞ½</li>
                                <li>Ğ˜Ğ³Ñ€Ğ°Ğ¹Ñ‚Ğµ Ğ² Ğ¼Ğ¸Ğ½Ğ¸-Ğ¸Ğ³Ñ€Ñ‹ Ğ´Ğ»Ñ Ğ¾Ğ¿Ñ‹Ñ‚Ğ°</li>
                                <li>ĞŸĞ¾ĞºÑƒĞ¿Ğ°Ğ¹Ñ‚Ğµ Ğ¾Ğ´ĞµĞ¶Ğ´Ñƒ Ğ·Ğ° Ğ¼Ğ¾Ğ½ĞµÑ‚Ñ‹</li>
                                <li>Ğ¡Ğ»ĞµĞ´Ğ¸Ñ‚Ğµ Ğ·Ğ° Ğ²ÑĞµĞ¼Ğ¸ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°Ğ¼Ğ¸</li>
                                <li>Ğ’Ğ°Ñˆ Ğ¿Ğ¸Ñ‚Ğ¾Ğ¼ĞµÑ† ÑĞ²Ğ¾Ğ»ÑÑ†Ğ¸Ğ¾Ğ½Ğ¸Ñ€ÑƒĞµÑ‚ Ñ Ğ²Ğ¾Ğ·Ñ€Ğ°ÑÑ‚Ğ¾Ğ¼!</li>
                            </ul>
                        </div>
                        <div class="bg-purple-50 p-2 rounded">
                            <h4 class="font-bold text-purple-800 mb-1">âœ¨ ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸</h4>
                            <ul class="list-disc list-inside text-purple-700">
                                <li>20 ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¼Ğ¸Ğ½Ğ¸-Ğ¸Ğ³Ñ€</li>
                                <li>22 Ğ²Ğ¸Ğ´Ğ° Ğ¾Ğ´ĞµĞ¶Ğ´Ñ‹</li>
                                <li>6 Ñ€ĞµĞ´ĞºĞ¸Ñ… ÑĞºĞ¸Ğ½Ğ¾Ğ² Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ĞµĞ¹</li>
                                <li>5 ÑÑ‚Ğ°Ğ´Ğ¸Ğ¹ ÑĞ²Ğ¾Ğ»ÑÑ†Ğ¸Ğ¸</li>
                                <li>Ğ ĞµĞ°Ğ»Ğ¸ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾Ğµ ÑÑ‚Ğ°Ñ€ĞµĞ½Ğ¸Ğµ (1 Ğ´ĞµĞ½ÑŒ = 1 Ğ´ĞµĞ½ÑŒ)</li>
                                <li>ğŸ”’ Ğ˜Ğ½Ğ´Ğ¸Ğ²Ğ¸Ğ´ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ğ¸Ñ‚Ğ¾Ğ¼ĞµÑ† Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ°</li>
                                <li>ğŸ’¾ ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ¸ Ğ±ÑĞºĞ°Ğ¿Ñ‹</li>
                                <li>ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ</li>
                                <li>Ğ—Ğ²ÑƒĞºĞ¾Ğ²Ñ‹Ğµ ÑÑ„Ñ„ĞµĞºÑ‚Ñ‹</li>
                            </ul>
                        </div>
                        <div class="bg-orange-50 p-2 rounded">
                            <h4 class="font-bold text-orange-800 mb-1">â° Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹</h4>
                            <ul class="list-disc list-inside text-orange-700">
                                <li>ĞšĞ°Ğ¶Ğ´Ñ‹Ğµ 30 Ğ¼Ğ¸Ğ½ÑƒÑ‚: "Ğ¢Ñ‹ Ğ½Ğµ Ğ·Ğ°Ğ±Ñ‹Ğ» Ğ¼ĞµĞ½Ñ?"</li>
                                <li>ĞŸÑ€Ğ¸ Ğ³Ğ¾Ğ»Ğ¾Ğ´Ğµ < 50%: "Ğ¯ Ğ³Ğ¾Ğ»Ğ¾Ğ´ĞµĞ½!"</li>
                                <li>ĞŸÑ€Ğ¸ ÑÑ‡Ğ°ÑÑ‚ÑŒĞµ < 50%: "ĞœĞ½Ğµ ÑĞºÑƒÑ‡Ğ½Ğ¾!"</li>
                                <li>ĞŸÑ€Ğ¸ ÑĞ½Ğµ < 50%: "Ğ¯ Ñ…Ğ¾Ñ‡Ñƒ ÑĞ¿Ğ°Ñ‚ÑŒ!"</li>
                                <li>ĞŸÑ€Ğ¸ Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ < 50%: "ĞœĞ½Ğµ Ğ¿Ğ»Ğ¾Ñ…Ğ¾!"</li>
                                <li>ĞŸÑ€Ğ¸ Ñ‡Ğ¸ÑÑ‚Ğ¾Ñ‚Ğµ < 50%: "Ğ¯ Ğ³Ñ€ÑĞ·Ğ½Ñ‹Ğ¹!"</li>
                            </ul>
                        </div>
                        <div class="bg-yellow-50 p-2 rounded">
                            <h4 class="font-bold text-yellow-800 mb-1">ğŸ”§ Ğ¢ĞµÑÑ‚ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ</h4>
                            <div class="grid grid-cols-2 gap-1">
                                <button onclick="game.testSave()" class="bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded text-xs">
                                    ğŸ’¾ Ğ¢ĞµÑÑ‚ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ
                                </button>
                                <button onclick="game.testLoad()" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs">
                                    ğŸ“‚ Ğ¢ĞµÑÑ‚ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸
                                </button>
                                <button onclick="game.debugSaveSystem()" class="bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded text-xs">
                                    ğŸ” Debug
                                </button>
                                <button onclick="game.clearSave()" class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs">
                                    ğŸ—‘ï¸ ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ
                                </button>
                            </div>
                            <div class="grid grid-cols-2 gap-1 mt-2">
                                <button onclick="game.forceSave()" class="bg-orange-500 hover:bg-orange-600 text-white px-2 py-1 rounded text-xs">
                                    ğŸ’¾ ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ
                                </button>
                                <button onclick="game.checkSaveIntegrity()" class="bg-cyan-500 hover:bg-cyan-600 text-white px-2 py-1 rounded text-xs">
                                    ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ†ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ
                                </button>
                            </div>
                        </div>
                        
                        <div class="text-center text-gray-500">
                            <p>ğŸ° Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¾ Ñ Ğ»ÑĞ±Ğ¾Ğ²ÑŒÑ Ğ´Ğ»Ñ ${this.petName}! ğŸ’•</p>
                            <p class="text-xs mt-1">Ğ’ĞµÑ€ÑĞ¸Ñ 4.2 - Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ</p>
                            <div class="bg-green-50 p-2 rounded mt-2">
                                <p class="text-xs text-green-700">ğŸ¯ Ğ£ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ° Ñ‚ĞµĞ¿ĞµÑ€ÑŒ ÑĞ²Ğ¾Ğ¹ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ğ¸Ñ‚Ğ¾Ğ¼ĞµÑ†!</p>
                                <p class="text-xs text-green-600">ID: ${this.gameUserId.slice(-8)}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }
    
    // Ğ˜Ğ³Ñ€Ğ¾Ğ²Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°
    feedPet(foodIndex) {
        if (this.isSleeping) {
            this.showMessage(`${this.petName} ÑĞ¿Ğ¸Ñ‚! ğŸ˜´`);
            return;
        }
        
        const food = this.food[foodIndex];
        if (this.money >= food.price) {
            this.money -= food.price;
            this.stats.hunger = Math.min(100, this.stats.hunger + (food.hunger || 0));
            this.stats.happiness = Math.min(100, this.stats.happiness + (food.happiness || 0));
            this.stats.health = Math.min(100, this.stats.health + (food.health || 0));
            this.stats.energy = Math.min(100, this.stats.energy + (food.energy || 0));
            this.stats.cleanliness = Math.min(100, this.stats.cleanliness + (food.cleanliness || 0));
            
            // Ğ‘Ğ¾Ğ»ÑŒÑˆĞ¸Ğ¹ Ğ±Ğ¾Ğ½ÑƒÑ ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸ Ğ¾Ñ‚ ĞµĞ´Ñ‹
            if (!food.energy) {
                this.stats.energy = Math.min(100, this.stats.energy + 10); // Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡ĞµĞ½ Ğ±Ğ¾Ğ½ÑƒÑ ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸
            }
            
            this.experience += 10;
            
            this.playSound(800, 150);
            this.showMessage(`${this.petName} ÑÑŠĞµĞ» ${food.name}! ${food.emoji}`);
            this.checkLevelUp();
            this.saveData();
            this.updateDisplay();
        } else {
            this.showMessage('ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ¼Ğ¾Ğ½ĞµÑ‚!');
        }
    }
    
    washPet() {
        if (this.isSleeping) {
            this.showMessage(`ĞĞµ Ğ±ÑƒĞ´Ğ¸ ÑĞ¿ÑÑ‰ĞµĞ³Ğ¾ ${this.petName}! ğŸ˜´`);
            return;
        }
        
        this.stats.cleanliness = 100;
        this.stats.happiness = Math.min(100, this.stats.happiness + 10);
        this.experience += 8;
        
        this.playSound(400, 200);
        this.showMessage(`${this.petName} Ñ‡Ğ¸ÑÑ‚Ñ‹Ğ¹ Ğ¸ ÑÑ‡Ğ°ÑÑ‚Ğ»Ğ¸Ğ²Ñ‹Ğ¹! ğŸ›`);
        this.checkLevelUp();
        this.saveData();
        this.updateDisplay();
    }
    
    healPet() {
        if (this.money >= 30) {
            this.money -= 30;
            this.stats.health = 100;
            this.stats.happiness = Math.min(100, this.stats.happiness + 5);
            this.experience += 12;
            
            this.showMessage(`${this.petName} Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²! ğŸ’Š`);
            this.checkLevelUp();
            this.saveData();
            this.updateDisplay();
        } else {
            this.showMessage('ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ¼Ğ¾Ğ½ĞµÑ‚ Ğ´Ğ»Ñ Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ñ!');
        }
    }
    
    toggleSleep() {
        this.isSleeping = !this.isSleeping;
        
        if (this.isSleeping) {
            this.playSound(300, 500);
            this.showMessage(`${this.petName} Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ÑÑ ÑĞ¿Ğ°Ñ‚ÑŒ... ğŸ˜´`);
        } else {
            this.playHappySound();
            this.showMessage(`${this.petName} Ğ¿Ñ€Ğ¾ÑĞ½ÑƒĞ»ÑÑ! ğŸ˜Š`);
        }
        
        this.saveData();
        this.updateDisplay();
        this.switchTab('care');
    }
    
    buyOutfit(outfitKey) {
        const outfit = this.outfits[outfitKey];
        
        if (this.ownedOutfits.includes(outfitKey)) {
            // Ğ£Ğ¶Ğµ ĞºÑƒĞ¿Ğ»ĞµĞ½ - Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ½Ğ°Ğ´ĞµĞ²Ğ°ĞµĞ¼
            this.outfit = outfitKey;
            this.stats.happiness = Math.min(100, this.stats.happiness + 10);
            this.showMessage(`ĞĞ°Ğ´ĞµÑ‚Ğ¾: ${outfit.name}! ${outfit.emoji}`);
            this.saveData();
            this.updateDisplay();
            this.switchTab('shop');
            return;
        }
        
        if (this.money >= outfit.price) {
            this.money -= outfit.price;
            this.ownedOutfits.push(outfitKey);
            this.outfit = outfitKey;
            this.stats.happiness = Math.min(100, this.stats.happiness + 20);
            
            this.playHappySound();
            this.showMessage(`ĞšÑƒĞ¿Ğ»ĞµĞ½Ğ¾ Ğ¸ Ğ½Ğ°Ğ´ĞµÑ‚Ğ¾: ${outfit.name}! ${outfit.emoji}`);
            this.saveData();
            this.updateDisplay();
            this.switchTab('shop');
        } else {
            this.showMessage('ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ¼Ğ¾Ğ½ĞµÑ‚!');
        }
    }
    
    createNewPet() {
        const newPetId = `pet${this.pets.length + 1}`;
        const newPet = {
            id: newPetId,
            name: `${this.petName} ${this.pets.length + 1}`,
            stats: { hunger: 100, happiness: 100, cleanliness: 100, health: 100, energy: 100, sleep: 100 },
            outfit: 'default',
            age: 0,
            evolutionStage: 'baby'
        };
        
        this.pets.push(newPet);
        this.activePetId = newPetId;
        this.showMessage(`ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ¸Ñ‚Ğ¾Ğ¼ĞµÑ† ${newPet.name} ÑĞ¾Ğ·Ğ´Ğ°Ğ½! ğŸ‰`);
        this.saveData();
    }
    
    startMiniGame(gameIndex) {
        if (this.isSleeping) {
            this.showMessage(`${this.petName} ÑĞ¿Ğ¸Ñ‚! Ğ Ğ°Ğ·Ğ±ÑƒĞ´Ğ¸ ĞµĞ³Ğ¾ ÑĞ½Ğ°Ñ‡Ğ°Ğ»Ğ°! ğŸ˜´`);
            return;
        }
        if (this.stats.energy < 15) {
            this.showMessage('ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸! ĞÑƒĞ¶Ğ½Ğ¾ Ğ¾Ñ‚Ğ´Ğ¾Ñ…Ğ½ÑƒÑ‚ÑŒ.');
            return;
        }
        
        this.currentMiniGame = this.miniGames[gameIndex];
        this.showMiniGameModal();
    }
    
    showMiniGameModal() {
        document.getElementById('gameTitle').textContent = `${this.currentMiniGame.name} ${this.currentMiniGame.emoji}`;
        document.getElementById('gameContent').innerHTML = this.getMiniGameContent();
        document.getElementById('miniGameModal').classList.remove('hidden');
    }
    
    closeMiniGame() {
        document.getElementById('miniGameModal').classList.add('hidden');
        this.currentMiniGame = null;
    }
    
    getMiniGameContent() {
        const gameId = this.currentMiniGame.id;
        
        if (gameId === 'memory') {
            return this.getMemoryGameContent();
        } else if (gameId === 'reaction') {
            return this.getReactionGameContent();
        } else if (gameId === 'math') {
            return this.getMathGameContent();
        } else if (gameId === 'puzzle') {
            return this.getPuzzleGameContent();
        } else if (gameId === 'quiz') {
            return this.getQuizGameContent();
        } else if (gameId === 'rhythm') {
            return this.getRhythmGameContent();
        } else if (gameId === 'treasure') {
            return this.getTreasureGameContent();
        } else if (gameId === 'balance') {
            return this.getBalanceGameContent();
        } else if (gameId === 'matching') {
            return this.getMatchingGameContent();
        } else if (gameId === 'simon') {
            return this.getSimonGameContent();
        } else if (gameId === 'catch') {
            return this.getCatchGameContent();
        } else if (gameId === 'target') {
            return this.getTargetGameContent();
        } else if (gameId === 'code') {
            return this.getCodeGameContent();
        } else if (gameId === 'stack') {
            return this.getStackGameContent();
        } else if (gameId === 'speed') {
            return this.getSpeedGameContent();
        } else if (gameId === 'maze') {
            return this.getMazeGameContent();
        } else if (gameId === 'pattern') {
            return this.getPatternGameContent();
        } else if (gameId === 'word') {
            return this.getWordGameContent();
        } else if (gameId === 'color') {
            return this.getColorGameContent();
        } else if (gameId === 'sequence') {
            return this.getSequenceGameContent();
        } else {
            // Ğ£Ğ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ Ğ´Ğ»Ñ Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¸Ğ³Ñ€
            return `
                <div class="text-center">
                    <p class="mb-4">${this.currentMiniGame.description}</p>
                    <p class="text-sm text-gray-600 mb-4">ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Ğ½Ğ° ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾Ğ±Ğ¾Ğ²Ğ°Ñ‚ÑŒ!</p>
                    <button onclick="game.completeMiniGame(${Math.random() > 0.3})" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-bold transition-colors">
                        Ğ˜Ğ³Ñ€Ğ°Ñ‚ÑŒ!
                    </button>
                </div>
            `;
        }
    }
    
    getMemoryGameContent() {
        if (!this.gameState) this.gameState = 'waiting';
        
        return `
            <div class="text-center">
                <p class="mb-4">Ğ—Ğ°Ğ¿Ğ¾Ğ¼Ğ½Ğ¸ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ñ†Ğ²ĞµÑ‚Ğ¾Ğ²!</p>
                <div class="grid grid-cols-2 gap-2 mb-4">
                    <button onclick="game.handleMemoryClick(0)" class="h-16 bg-red-400 hover:bg-red-500 rounded transition-colors" id="memory-0">ğŸ”´</button>
                    <button onclick="game.handleMemoryClick(1)" class="h-16 bg-blue-400 hover:bg-blue-500 rounded transition-colors" id="memory-1">ğŸ”µ</button>
                    <button onclick="game.handleMemoryClick(2)" class="h-16 bg-green-400 hover:bg-green-500 rounded transition-colors" id="memory-2">ğŸŸ¢</button>
                    <button onclick="game.handleMemoryClick(3)" class="h-16 bg-yellow-400 hover:bg-yellow-500 rounded transition-colors" id="memory-3">ğŸŸ¡</button>
                </div>
                <button onclick="game.startMemorySequence()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded">
                    ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ¸Ğ³Ñ€Ñƒ
                </button>
            </div>
        `;
    }
    
    getReactionGameContent() {
        return `
            <div class="text-center">
                <p class="mb-4">ĞĞ°Ğ¶Ğ¼Ğ¸ Ğ½Ğ° Ğ·ĞµĞ»ĞµĞ½Ñ‹Ğ¹ ÑĞ¸Ğ³Ğ½Ğ°Ğ» ĞºĞ°Ğº Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ±Ñ‹ÑÑ‚Ñ€ĞµĞµ!</p>
                <div id="reaction-light" class="w-20 h-20 bg-red-400 rounded-full mx-auto mb-4 transition-colors"></div>
                <button onclick="game.startReactionTest()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg">
                    ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ñ‚ĞµÑÑ‚
                </button>
                <button onclick="game.reactionClick()" id="reaction-btn" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg hidden">
                    ĞĞĞ–ĞœĞ˜!
                </button>
            </div>
        `;
    }
    
    getMathGameContent() {
        const a = Math.floor(Math.random() * 10) + 1;
        const b = Math.floor(Math.random() * 10) + 1;
        const answer = a + b;
        this.mathAnswer = answer;
        
        const options = [answer - 1, answer, answer + 1].sort(() => Math.random() - 0.5);
        
        return `
            <div class="text-center">
                <p class="text-2xl mb-6">${a} + ${b} = ?</p>
                <div class="grid grid-cols-3 gap-2">
                    ${options.map(num => `
                        <button onclick="game.checkMathAnswer(${num})" class="bg-blue-500 hover:bg-blue-600 text-white p-3 rounded text-xl transition-colors">
                            ${num}
                        </button>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    getPuzzleGameContent() {
        this.puzzlePieces = [1, 2, 3, 4].sort(() => Math.random() - 0.5);
        
        return `
            <div class="text-center">
                <p class="mb-4">Ğ Ğ°ÑÑÑ‚Ğ°Ğ²ÑŒ Ñ‡Ğ¸ÑĞ»Ğ° Ğ¿Ğ¾ Ğ¿Ğ¾Ñ€ÑĞ´ĞºÑƒ (1, 2, 3, 4):</p>
                <div class="grid grid-cols-4 gap-2 mb-4">
                    ${this.puzzlePieces.map((piece, index) => `
                        <button onclick="game.swapPuzzlePiece(${index})" class="bg-green-400 hover:bg-green-500 text-white p-4 rounded text-xl transition-colors">
                            ${piece}
                        </button>
                    `).join('')}
                </div>
                <p class="text-xs text-gray-600">ĞĞ°Ğ¶Ğ¼Ğ¸ Ğ½Ğ° Ñ‡Ğ¸ÑĞ»Ğ¾ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ğ¾Ğ¼ĞµĞ½ÑÑ‚ÑŒ Ğ¼ĞµÑÑ‚Ğ°Ğ¼Ğ¸ Ñ ÑĞ¾ÑĞµĞ´Ğ½Ğ¸Ğ¼</p>
            </div>
        `;
    }
    
    getQuizGameContent() {
        const questions = [
            { q: 'ĞšĞ°ĞºĞ¾Ğ³Ğ¾ Ñ†Ğ²ĞµÑ‚Ğ° ÑĞ¾Ğ»Ğ½Ñ†Ğµ?', answers: ['Ğ–ĞµĞ»Ñ‚Ğ¾Ğµ', 'Ğ¡Ğ¸Ğ½ĞµĞµ', 'ĞšÑ€Ğ°ÑĞ½Ğ¾Ğµ'], correct: 0 },
            { q: 'Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ½Ğ¾Ğ³ Ñƒ ĞºĞ¾Ñ‚Ğ°?', answers: ['2', '4', '6'], correct: 1 },
            { q: 'Ğ§Ñ‚Ğ¾ ĞµĞ´ÑÑ‚ ĞºÑ€Ğ¾Ğ»Ğ¸ĞºĞ¸?', answers: ['ĞœÑÑĞ¾', 'ĞœĞ¾Ñ€ĞºĞ¾Ğ²ÑŒ', 'Ğ Ñ‹Ğ±Ñƒ'], correct: 1 },
            { q: 'Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ½ĞµĞ¹ Ğ² Ğ½ĞµĞ´ĞµĞ»Ğµ?', answers: ['5', '6', '7'], correct: 2 },
            { q: 'ĞšĞ°ĞºĞ¾Ğ¹ Ñ†Ğ²ĞµÑ‚ Ñƒ Ñ‚Ñ€Ğ°Ğ²Ñ‹?', answers: ['ĞšÑ€Ğ°ÑĞ½Ñ‹Ğ¹', 'Ğ—ĞµĞ»ĞµĞ½Ñ‹Ğ¹', 'Ğ¡Ğ¸Ğ½Ğ¸Ğ¹'], correct: 1 }
        ];
        
        this.currentQuestion = questions[Math.floor(Math.random() * questions.length)];
        
        return `
            <div class="text-center">
                <p class="text-lg mb-4">${this.currentQuestion.q}</p>
                <div class="space-y-2">
                    ${this.currentQuestion.answers.map((answer, index) => `
                        <button onclick="game.checkQuizAnswer(${index})" class="w-full bg-purple-400 hover:bg-purple-500 text-white p-3 rounded transition-colors">
                            ${answer}
                        </button>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    getRhythmGameContent() {
        return `
            <div class="text-center">
                <p class="mb-4">ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸ Ñ€Ğ¸Ñ‚Ğ¼: ğŸ”´ğŸ”µğŸ”´ğŸ”µ</p>
                <div class="flex justify-center space-x-4 mb-4">
                    <button onclick="game.addRhythmBeat(1)" class="w-16 h-16 bg-red-400 hover:bg-red-500 rounded-full text-2xl transition-colors">
                        ğŸ”´
                    </button>
                    <button onclick="game.addRhythmBeat(0)" class="w-16 h-16 bg-blue-400 hover:bg-blue-500 rounded-full text-2xl transition-colors">
                        ğŸ”µ
                    </button>
                </div>
                <div id="rhythm-display" class="mb-4 text-lg">Ğ’Ğ°Ñˆ Ñ€Ğ¸Ñ‚Ğ¼: </div>
                <button onclick="game.checkRhythm()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                    ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ
                </button>
                <button onclick="game.resetRhythm()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded ml-2">
                    Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ
                </button>
            </div>
        `;
    }
    
    getTreasureGameContent() {
        this.treasurePosition = Math.floor(Math.random() * 9);
        this.treasureAttempts = 0;
        
        return `
            <div class="text-center">
                <p class="mb-4">ĞĞ°Ğ¹Ğ´Ğ¸ ÑĞ¾ĞºÑ€Ğ¾Ğ²Ğ¸Ñ‰Ğµ! ğŸ’</p>
                <p class="mb-2 text-sm text-gray-600">Ğ£ Ğ²Ğ°Ñ 3 Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ¸</p>
                <div class="attempts-message text-center text-sm text-blue-600 mb-2">ĞŸĞ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº Ğ¾ÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ: 3</div>
                <div class="grid grid-cols-3 gap-2">
                    ${Array.from({length: 9}, (_, index) => `
                        <button onclick="game.checkTreasure(${index})" class="treasure-btn bg-yellow-400 hover:bg-yellow-500 text-white p-4 rounded h-16 text-2xl transition-colors">
                            â“
                        </button>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    getBalanceGameContent() {
        this.balance = 50;
        this.balanceTimer = 10;
        
        return `
            <div class="text-center">
                <p class="mb-2">Ğ£Ğ´ĞµÑ€Ğ¶Ğ¸ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ Ğ² Ğ·ĞµĞ»ĞµĞ½Ğ¾Ğ¹ Ğ·Ğ¾Ğ½Ğµ 10 ÑĞµĞºÑƒĞ½Ğ´!</p>
                <p class="mb-4 text-lg font-bold">Ğ’Ñ€ĞµĞ¼Ñ: <span id="balance-timer">10</span>Ñ</p>
                <div class="relative h-8 bg-gray-300 rounded mb-4">
                    <div class="absolute top-0 h-8 bg-green-400 rounded" style="left: 30%; right: 30%;"></div>
                    <div class="absolute top-0 h-8 bg-red-400 rounded-l" style="left: 0%; right: 70%;"></div>
                    <div class="absolute top-0 h-8 bg-red-400 rounded-r" style="left: 70%; right: 0%;"></div>
                    <div id="balance-marker" class="absolute top-0 w-3 h-8 bg-blue-800 rounded transition-all duration-150" style="left: 50%; transform: translateX(-50%);"></div>
                </div>
                <div class="flex justify-center space-x-4">
                    <button onclick="game.adjustBalance(-5)" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded font-bold">
                        â¬…ï¸ Ğ’Ğ»ĞµĞ²Ğ¾
                    </button>
                    <button onclick="game.adjustBalance(5)" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded font-bold">
                        Ğ’Ğ¿Ñ€Ğ°Ğ²Ğ¾ â¡ï¸
                    </button>
                </div>
                <button onclick="game.startBalanceGame()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded mt-4">
                    ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ¸Ğ³Ñ€Ñƒ
                </button>
            </div>
        `;
    }
    
    getMatchingGameContent() {
        const symbols = ['ğŸ', 'ğŸŒ', 'ğŸ‡', 'ğŸŠ'];
        this.matchingCards = [...symbols, ...symbols].sort(() => Math.random() - 0.5);
        this.flippedCards = [];
        this.matchedCards = [];
        
        return `
            <div class="text-center">
                <p class="mb-4">ĞĞ°Ğ¹Ğ´Ğ¸ Ğ¾Ğ´Ğ¸Ğ½Ğ°ĞºĞ¾Ğ²Ñ‹Ğµ Ğ¿Ğ°Ñ€Ñ‹!</p>
                <div class="grid grid-cols-4 gap-2">
                    ${this.matchingCards.map((card, index) => `
                        <button onclick="game.flipCard(${index})" id="card-${index}" class="h-16 w-16 bg-blue-400 hover:bg-blue-500 rounded text-2xl transition-colors">
                            â“
                        </button>
                    `).join('')}
                </div>
                <div class="text-xs text-gray-600 mt-2">
                    ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ¾ Ğ¿Ğ°Ñ€: <span id="pairs-found">0</span> / 4
                </div>
            </div>
        `;
    }
    
    getSimonGameContent() {
        return `
            <div class="text-center">
                <p class="mb-4">ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ¡Ğ°Ğ¹Ğ¼Ğ¾Ğ½Ğ°!</p>
                <div class="grid grid-cols-2 gap-2 mb-4">
                    <button onclick="game.simonClick(0)" id="simon-0" class="h-16 bg-red-400 hover:bg-red-500 rounded transition-colors">ğŸ”´</button>
                    <button onclick="game.simonClick(1)" id="simon-1" class="h-16 bg-blue-400 hover:bg-blue-500 rounded transition-colors">ğŸ”µ</button>
                    <button onclick="game.simonClick(2)" id="simon-2" class="h-16 bg-green-400 hover:bg-green-500 rounded transition-colors">ğŸŸ¢</button>
                    <button onclick="game.simonClick(3)" id="simon-3" class="h-16 bg-yellow-400 hover:bg-yellow-500 rounded transition-colors">ğŸŸ¡</button>
                </div>
                <button onclick="game.startSimonGame()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded">
                    ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ¸Ğ³Ñ€Ñƒ
                </button>
                <div id="simon-status" class="mt-2 text-sm text-gray-600"></div>
            </div>
        `;
    }
    
    getCatchGameContent() {
        // Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¸Ğ³Ñ€Ñ‹
        setTimeout(() => this.startCatchGame(), 100);
        
        return `
            <div class="text-center">
                <p class="mb-2">ĞŸĞ¾Ğ¹Ğ¼Ğ°Ğ¹ Ğ¿Ğ°Ğ´Ğ°ÑÑ‰Ğ¸Ğµ Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ñ‹!</p>
                <p id="catch-score" class="mb-4">ĞŸĞ¾Ğ¹Ğ¼Ğ°Ğ½Ğ¾: 0/5</p>
                <div id="catch-game-area" class="relative w-full h-40 bg-blue-100 rounded border overflow-hidden">
                    <div id="catch-bucket" class="absolute bottom-0 w-12 h-6 bg-green-500 rounded-t transition-all duration-200 flex items-center justify-center text-xs" style="left: 50%; transform: translateX(-50%); z-index: 10;">
                        ğŸª£
                    </div>
                </div>
                <div class="flex justify-center space-x-4 mt-2">
                    <button onclick="game.moveCatchPlayer('left')" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
                        â¬…ï¸ Ğ’Ğ»ĞµĞ²Ğ¾
                    </button>
                    <button onclick="game.moveCatchPlayer('right')" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
                        Ğ’Ğ¿Ñ€Ğ°Ğ²Ğ¾ â¡ï¸
                    </button>
                </div>
                <div class="text-xs text-gray-600 mt-2">
                    15 ÑĞµĞºÑƒĞ½Ğ´ â€¢ ĞÑƒĞ¶Ğ½Ğ¾ Ğ¿Ğ¾Ğ¹Ğ¼Ğ°Ñ‚ÑŒ 5 Ğ·Ğ²ĞµĞ·Ğ´Ğ¾Ñ‡ĞµĞº
                </div>
            </div>
        `;
    }
    
    getTargetGameContent() {
        this.targetScore = 0;
        this.targetPos = { x: 50, y: 50 };
        
        // Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¸Ğ³Ñ€Ñ‹
        this.startTargetGame();
        
        return `
            <div class="text-center">
                <p class="mb-2">ĞŸĞ¾Ğ¿Ğ°Ğ´Ğ¸ Ğ² Ğ´Ğ²Ğ¸Ğ¶ÑƒÑ‰ÑƒÑÑÑ Ğ¼Ğ¸ÑˆĞµĞ½ÑŒ!</p>
                <p id="target-score" class="mb-4">ĞŸĞ¾Ğ¿Ğ°Ğ´Ğ°Ğ½Ğ¸Ğ¹: 0/3</p>
                <div id="target-game-area" class="relative w-full h-40 bg-gray-200 rounded border">
                    <button id="moving-target" onclick="game.hitTarget()" class="absolute w-8 h-8 bg-red-500 rounded-full transition-all duration-300" style="left: 50%; top: 50%; transform: translate(-50%, -50%);">
                        ğŸ¯
                    </button>
                </div>
                <p class="text-xs text-gray-600 mt-2">ĞœĞ¸ÑˆĞµĞ½ÑŒ Ğ´Ğ²Ğ¸Ğ¶ĞµÑ‚ÑÑ ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 1.5 ÑĞµĞºÑƒĞ½Ğ´Ñ‹!</p>
            </div>
        `;
    }
    
    getCodeGameContent() {
        this.secretCode = Array.from({length: 4}, () => Math.floor(Math.random() * 4));
        this.codeAttempt = [];
        
        return `
            <div class="text-center">
                <p class="mb-4">Ğ’Ğ·Ğ»Ğ¾Ğ¼Ğ°Ğ¹ ÑĞµĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ´!</p>
                <p class="mb-2 text-xs text-gray-600">ĞšĞ¾Ğ´ ÑĞ¾ÑÑ‚Ğ¾Ğ¸Ñ‚ Ğ¸Ğ· 4 Ñ†Ğ¸Ñ„Ñ€ (0-3)</p>
                <div class="flex justify-center space-x-2 mb-4">
                    ${Array.from({length: 4}, (_, i) => `
                        <div id="code-slot-${i}" class="w-8 h-8 border-2 border-gray-400 rounded flex items-center justify-center bg-white">
                            ?
                        </div>
                    `).join('')}
                </div>
                <div class="grid grid-cols-4 gap-2 mb-3">
                    ${[0, 1, 2, 3].map(digit => `
                        <button onclick="game.enterCodeDigit(${digit})" class="bg-purple-400 hover:bg-purple-500 active:bg-purple-600 text-white p-3 rounded transition-colors font-bold text-lg">
                            ${digit}
                        </button>
                    `).join('')}
                </div>
                <button onclick="game.resetCode()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded transition-colors">
                    ğŸ”„ Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ
                </button>
            </div>
        `;
    }
    
    getStackGameContent() {
        // Ğ—Ğ°Ğ¿ÑƒÑĞº Ñ‚Ğ°Ğ¹Ğ¼ĞµÑ€Ğ°
        setTimeout(() => this.startStackTimer(), 100);
        
        return `
            <div class="text-center">
                <p class="mb-2">Ğ¡Ğ¾Ğ±ĞµÑ€Ğ¸ Ğ±Ğ°ÑˆĞ½Ñ Ğ¸Ğ· Ğ±Ğ»Ğ¾ĞºĞ¾Ğ²!</p>
                <p class="mb-2">Ğ’Ñ‹ÑĞ¾Ñ‚Ğ°: <span id="stack-height">0</span>/5</p>
                <p class="mb-4">Ğ’Ñ€ĞµĞ¼Ñ: <span id="stack-timer">10</span>Ñ</p>
                <div id="stack-area" class="flex flex-col-reverse items-center h-32 justify-end mb-4 bg-gray-100 rounded border-2 border-dashed border-gray-300">
                </div>
                <button onclick="game.addStackBlock()" class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-3 rounded font-bold transition-colors active:scale-95">
                    ğŸ§± Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ±Ğ»Ğ¾Ğº
                </button>
                <div class="text-xs text-gray-600 mt-2">
                    ĞŸĞ¾ÑÑ‚Ñ€Ğ¾Ğ¹Ñ‚Ğµ Ğ±Ğ°ÑˆĞ½Ñ Ğ²Ñ‹ÑĞ¾Ñ‚Ğ¾Ğ¹ 5 Ğ±Ğ»Ğ¾ĞºĞ¾Ğ² Ğ·Ğ° 10 ÑĞµĞºÑƒĞ½Ğ´!
                </div>
            </div>
        `;
    }
    
    getSpeedGameContent() {
        // Ğ—Ğ°Ğ¿ÑƒÑĞº Ñ‚Ğ°Ğ¹Ğ¼ĞµÑ€Ğ°
        setTimeout(() => this.startSpeedTimer(), 100);
        
        return `
            <div class="text-center">
                <p class="mb-2">ĞĞ°Ğ¶Ğ¼Ğ¸ ĞºĞ°Ğº Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ±Ñ‹ÑÑ‚Ñ€ĞµĞµ!</p>
                <p class="mb-2">ĞĞ°Ğ¶Ğ°Ñ‚Ğ¸Ğ¹: <span id="click-count">0</span>/20</p>
                <p class="mb-4">Ğ’Ñ€ĞµĞ¼Ñ: <span id="speed-timer">5</span>Ñ</p>
                <button onclick="game.speedClick()" class="w-32 h-32 bg-red-500 hover:bg-red-600 active:bg-red-700 text-white text-3xl rounded-full animate-pulse transition-all active:scale-95">
                    ğŸ’¨ ĞšĞ›Ğ˜Ğš!
                </button>
                <div class="text-xs text-gray-600 mt-2">
                    Ğ¦ĞµĞ»ÑŒ: 20+ ĞºĞ»Ğ¸ĞºĞ¾Ğ² Ğ·Ğ° 5 ÑĞµĞºÑƒĞ½Ğ´
                </div>
            </div>
        `;
    }
    
    completeMiniGame(success = null) {
        if (success === null) {
            success = Math.random() > 0.3; // 70% ÑˆĞ°Ğ½Ñ ÑƒÑĞ¿ĞµÑ…Ğ°
        }
        
        if (success && this.currentMiniGame) {
            const reward = this.currentMiniGame.reward;
            this.stats.happiness = Math.min(100, this.stats.happiness + (reward.happiness || 0));
            this.stats.energy = Math.max(0, this.stats.energy - 15);
            this.experience += reward.experience || 0;
            this.money += reward.money || 0;
            
            this.playHappySound();
            this.showMessage(`ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾! +${reward.experience} Ğ¾Ğ¿Ñ‹Ñ‚Ğ°, +${reward.money} Ğ¼Ğ¾Ğ½ĞµÑ‚!`);
        } else {
            this.stats.energy = Math.max(0, this.stats.energy - 10);
            this.playSound(200, 300);
            this.showMessage('ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ ĞµÑ‰Ğµ Ñ€Ğ°Ğ·!');
        }
        
        this.checkLevelUp();
        this.saveData();
        this.updateDisplay();
        this.closeMiniGame();
    }
    
    // Ğ˜Ğ³Ñ€Ğ° "ĞŸĞ°Ğ¼ÑÑ‚ÑŒ"
    startMemorySequence() {
        this.memorySequence = Array.from({length: 4}, () => Math.floor(Math.random() * 4));
        this.userMemorySequence = [];
        this.currentMemoryStep = 0;
        this.showMemorySequence();
    }
    
    showMemorySequence() {
        if (this.currentMemoryStep < this.memorySequence.length) {
            const colorIndex = this.memorySequence[this.currentMemoryStep];
            const button = document.getElementById(`memory-${colorIndex}`);
            button.style.transform = 'scale(1.1)';
            button.style.boxShadow = '0 0 20px rgba(255,255,255,0.8)';
            
            setTimeout(() => {
                button.style.transform = 'scale(1)';
                button.style.boxShadow = 'none';
                this.currentMemoryStep++;
                setTimeout(() => this.showMemorySequence(), 300);
            }, 600);
        } else {
            this.showMessage('Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ!');
        }
    }
    
    handleMemoryClick(colorIndex) {
        if (this.currentMemoryStep >= this.memorySequence.length) {
            this.userMemorySequence.push(colorIndex);
            
            if (this.userMemorySequence[this.userMemorySequence.length - 1] !== this.memorySequence[this.userMemorySequence.length - 1]) {
                this.completeMiniGame(false);
                return;
            }
            
            if (this.userMemorySequence.length === this.memorySequence.length) {
                this.completeMiniGame(true);
            }
        }
    }
    
    generateUserId() {
        return 'user_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
    }
    
    debugSaveSystem() {
        console.log('ğŸ” ĞĞ¢Ğ›ĞĞ”ĞšĞ Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ« Ğ¡ĞĞ¥Ğ ĞĞĞ•ĞĞ˜Ğ¯:');
        console.log('gameUserId:', this.gameUserId);
        console.log('petName:', this.petName);
        console.log('money:', this.money);
        console.log('level:', this.level);
        console.log('stats:', this.stats);
        
        // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ‡Ñ‚Ğ¾ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¾ Ğ² localStorage
        console.log('ğŸ’¾ Ğ’ localStorage:');
        console.log(`${this.gameUserId}_pet_name:`, localStorage.getItem(`${this.gameUserId}_pet_name`));
        console.log(`${this.gameUserId}_labubu_money:`, localStorage.getItem(`${this.gameUserId}_labubu_money`));
        console.log(`${this.gameUserId}_labubu_level:`, localStorage.getItem(`${this.gameUserId}_labubu_level`));
    }
    
    handleFileImport(event) {
        const file = event.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                this.importGameData(e.target.result);
            } catch (error) {
                console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ Ñ„Ğ°Ğ¹Ğ»Ğ°:', error);
                this.showMessage('âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ Ñ„Ğ°Ğ¹Ğ»Ğ°!');
            }
        };
        reader.readAsText(file);
    }
    
    restoreFromBackupPrompt() {
        if (confirm('ğŸ”„ Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¿Ğ¸Ğ¸?\n\nĞ­Ñ‚Ğ¾ Ğ·Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ½Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ.')) {
            if (this.restoreFromBackup()) {
                this.showMessage('âœ… Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹ Ğ¸Ğ· Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¿Ğ¸Ğ¸!');
                this.updateDisplay();
                this.switchTab('care');
            } else {
                this.showMessage('âŒ Ğ ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ°Ñ ĞºĞ¾Ğ¿Ğ¸Ñ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ° Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾Ğ²Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ°!');
            }
        }
    }
    
    resetGamePrompt() {
        const confirmation = prompt(`ğŸ—‘ï¸ Ğ’ĞĞ˜ĞœĞĞĞ˜Ğ•! Ğ­Ñ‚Ğ¾ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ ÑĞ±Ñ€Ğ¾ÑĞ¸Ñ‚ Ğ’ĞĞ¨Ğ£ Ğ¸Ğ³Ñ€Ñƒ!\n\nĞ’ÑĞµ Ğ²Ğ°ÑˆĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ, Ğ²ĞºĞ»ÑÑ‡Ğ°Ñ:\nâ€¢ Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ ${this.level} Ğ¸ ${this.experience} Ğ¾Ğ¿Ñ‹Ñ‚Ğ°\nâ€¢ ${this.money} Ğ¼Ğ¾Ğ½ĞµÑ‚\nâ€¢ ${this.unlockedSkins.length} Ñ€Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… ÑĞºĞ¸Ğ½Ğ¾Ğ²\nâ€¢ ${this.chestCount} ÑÑƒĞ½Ğ´ÑƒĞºĞ¾Ğ²\nâ€¢ Ğ’Ğ¾Ğ·Ñ€Ğ°ÑÑ‚ ${this.age} Ğ´Ğ½ĞµĞ¹\n\nĞ­Ñ‚Ğ¾ Ğ·Ğ°Ñ‚Ñ€Ğ¾Ğ½ĞµÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ’ĞĞ¨Ğ•Ğ“Ğ Ğ¿Ğ¸Ñ‚Ğ¾Ğ¼Ñ†Ğ°!\n\nĞĞ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ "Ğ¡Ğ‘Ğ ĞĞ¡" Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚ÑŒ:`);
        
        if (confirmation === 'Ğ¡Ğ‘Ğ ĞĞ¡') {
            // ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¡Ğ’ĞĞ˜ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· localStorage
            const keysToRemove = [
                'labubu_stats', 'labubu_money', 'labubu_outfit',
                'labubu_level', 'labubu_experience', 'labubu_age',
                'labubu_evolution', 'labubu_last_update', 'pet_name',
                'labubu_sleeping', 'labubu_pets', 'active_pet_id',
                'current_skin', 'unlocked_skins', 'chest_count',
                'friends_invited', 'last_chest_level', 'labubu_last_notification',
                'owned_outfits', 'last_stat_decay'
            ];
            
            keysToRemove.forEach(key => {
                const userKey = `${this.gameUserId}_${key}`;
                localStorage.removeItem(userKey);
            });
            
            // Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ±ÑĞºĞ°Ğ¿Ñ‹
            const backupKey = `${this.gameUserId}_labubu_backup`;
            const historyKey = `${this.gameUserId}_labubu_backup_history`;
            localStorage.removeItem(backupKey);
            localStorage.removeItem(historyKey);
            
            this.resetToDefaults();
            this.updateDisplay();
            this.switchTab('care');
            
            this.showMessage('ğŸ—‘ï¸ Ğ’Ğ°ÑˆĞ° Ğ¸Ğ³Ñ€Ğ° Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ ÑĞ±Ñ€Ğ¾ÑˆĞµĞ½Ğ°! Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ, Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ²Ğ»Ğ°Ğ´ĞµĞ»ĞµÑ† Ğ›Ğ°Ğ±ÑƒĞ±Ñƒ!');
        } else {
            this.showMessage('âŒ Ğ¡Ğ±Ñ€Ğ¾Ñ Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½.');
        }
    }
    

    
    async registerTelegramUser(chatId) {
        try {
            // URL Ğ²Ğ°ÑˆĞµĞ³Ğ¾ ÑĞµÑ€Ğ²ĞµÑ€Ğ°
            const response = await fetch('https://labubu-server.onrender.com/api/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    chatId: chatId,
                    gameUserId: this.gameUserId,
                    petName: this.petName
                })
            });
            
            if (response.ok) {
                this.telegramConnected = true;
                this.telegramChatId = chatId;
                localStorage.setItem('telegram_connected', 'true');
                localStorage.setItem('telegram_chat_id', chatId);
                
                document.getElementById('telegramBtn').classList.add('hidden');
                document.getElementById('telegramStatus').classList.remove('hidden');
                
                this.showMessage('âœ… Telegram ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½!');
            } else {
                this.showMessage('âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğº Telegram');
            }
        } catch (error) {
            console.error('Telegram connection error:', error);
            this.showMessage('âŒ ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ Ñ ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ¼');
        }
    }
    
    async sendTelegramNotification(message, type) {
        if (!this.telegramConnected) return;
        
        try {
            await fetch('https://labubu-server.onrender.com/api/notify', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    gameUserId: this.gameUserId,
                    message: message,
                    type: type,
                    petName: this.petName
                })
            });
        } catch (error) {
            console.error('Failed to send Telegram notification:', error);
        }
    }
    
    async saveToDatabaseAsync() {
        // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² Ğ±Ğ°Ğ·Ñƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ğ½Ğ¾Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ)
        try {
            if (!this.gameUserId) {
                console.log('âš ï¸ gameUserId Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½, Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² Ğ‘Ğ”');
                return false;
            }

            console.log('ğŸŒ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² Ğ±Ğ°Ğ·Ñƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…...');

            const gameData = {
                gameUserId: this.gameUserId,
                petName: this.petName,
                stats: this.stats,
                level: this.level,
                experience: this.experience,
                money: this.money,
                age: this.age,
                outfit: this.outfit,
                currentSkin: this.currentSkin,
                unlockedSkins: this.unlockedSkins,
                evolutionStage: this.evolutionStage,
                chestCount: this.chestCount,
                friendsInvited: this.friendsInvited,
                lastChestLevel: this.lastChestLevel,
                isSleeping: this.isSleeping,
                lastUpdate: this.lastUpdate
            };

            const response = await fetch('https://labubu-server.onrender.com/api/save-game', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(gameData),
                signal: AbortSignal.timeout(8000) // 8 ÑĞµĞºÑƒĞ½Ğ´ Ñ‚Ğ°Ğ¹Ğ¼Ğ°ÑƒÑ‚ Ğ´Ğ»Ñ Ğ½Ğ°Ğ´ĞµĞ¶Ğ½Ğ¾ÑÑ‚Ğ¸
            });

            if (response.ok) {
                console.log('âœ… Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ñ‹ Ğ² Ğ±Ğ°Ğ·Ñƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…');
                return true;
            } else {
                console.warn('âš ï¸ ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ² Ğ‘Ğ”:', response.status);
                return false;
            }

        } catch (error) {
            console.warn('âš ï¸ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² Ğ‘Ğ” Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾:', error.message);
            return false;
        }
    }

    async loadFromDatabaseSync() {
        // Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¸Ğ· Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ¿ÑƒÑĞºĞµ (Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚ Ğ´Ğ¾ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)
        try {
            if (!this.gameUserId) {
                console.log('âš ï¸ gameUserId Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½, Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºÑƒ Ğ¸Ğ· Ğ‘Ğ”');
                return false;
            }

            console.log('ğŸŒ Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸Ğ· Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…...');

            const response = await fetch(`https://labubu-server.onrender.com/api/load-game/${this.gameUserId}`, {
                method: 'GET',
                signal: AbortSignal.timeout(8000) // 8 ÑĞµĞºÑƒĞ½Ğ´ Ñ‚Ğ°Ğ¹Ğ¼Ğ°ÑƒÑ‚ Ğ´Ğ»Ñ Ğ¿ĞµÑ€Ğ²Ğ¸Ñ‡Ğ½Ğ¾Ğ¹ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸
            });

            if (response.ok) {
                const data = await response.json();
                
                if (data.success && data.gameData) {
                    const gameData = data.gameData;
                    
                    console.log('âœ… Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ñ‹ Ğ¸Ğ· Ğ‘Ğ”, Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ÑĞµĞ¼...');
                    
                    // Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· Ğ‘Ğ”
                    this.stats = gameData.stats || {
                        hunger: 100, happiness: 100, cleanliness: 100,
                        health: 100, energy: 100, sleep: 100
                    };
                    this.money = gameData.money || 100;
                    this.level = gameData.level || 1;
                    this.experience = gameData.experience || 0;
                    this.age = gameData.age || 0;
                    this.outfit = gameData.outfit || 'default';
                    this.currentSkin = gameData.currentSkin || 'default';
                    this.unlockedSkins = gameData.unlockedSkins || ['default'];
                    this.evolutionStage = gameData.evolutionStage || 'baby';
                    this.chestCount = gameData.chestCount || 0;
                    this.friendsInvited = gameData.friendsInvited || 0;
                    this.lastChestLevel = gameData.lastChestLevel || 0;
                    this.isSleeping = gameData.isSleeping || false;
                    this.petName = gameData.petName || 'Labubu';
                    this.lastUpdate = gameData.lastUpdate || Date.now();
                    this.lastNotification = this.loadData('shared_labubu_last_notification', Date.now(), 'number');
                    
                    // Ğ¡Ñ€Ğ°Ğ·Ñƒ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ² localStorage ĞºĞ°Ğº ĞºÑÑˆ
                    this.saveToLocalStorage();
                    
                    console.log('âœ… Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· Ğ‘Ğ” Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ñ‹ Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ñ‹ Ğ² localStorage ĞºĞ°Ğº ĞºÑÑˆ');
                    return true;
                } else {
                    console.log('âš ï¸ ĞĞµĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚ Ğ¾Ñ‚ Ğ‘Ğ”');
                    return false;
                }
            } else {
                console.log('âš ï¸ Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹ Ğ² Ğ‘Ğ” Ğ¸Ğ»Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° ÑĞµÑ€Ğ²ĞµÑ€Ğ°');
                return false;
            }

        } catch (error) {
            console.warn('âš ï¸ Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¸Ğ· Ğ‘Ğ” Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ°:', error.message);
            return false;
        }
    }

    async loadFromDatabaseAsync() {
        // ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¸Ğ· Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ² Ñ„Ğ¾Ğ½Ğµ)
        try {
            if (!this.gameUserId) {
                console.log('âš ï¸ gameUserId Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½, Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºÑƒ Ğ¸Ğ· Ğ‘Ğ”');
                return;
            }

            console.log('ğŸ”„ Ğ¤Ğ¾Ğ½Ğ¾Ğ²Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹ Ğ² Ğ‘Ğ”...');

            const response = await fetch(`https://labubu-server.onrender.com/api/load-game/${this.gameUserId}`, {
                method: 'GET',
                signal: AbortSignal.timeout(5000) // 5 ÑĞµĞºÑƒĞ½Ğ´ Ñ‚Ğ°Ğ¹Ğ¼Ğ°ÑƒÑ‚
            });

            if (response.ok) {
                const data = await response.json();
                
                if (data.success && data.gameData) {
                    const gameData = data.gameData;
                    
                    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ñ‡Ñ‚Ğ¾ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· Ğ‘Ğ” Ğ½Ğ¾Ğ²ĞµĞµ localStorage
                    const localLastUpdate = this.lastUpdate;
                    
                    if (gameData.lastUpdate > localLastUpdate) {
                        console.log('ğŸ”„ ĞĞ°Ğ¹Ğ´ĞµĞ½Ñ‹ Ğ±Ğ¾Ğ»ĞµĞµ ÑĞ²ĞµĞ¶Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ² Ğ‘Ğ”, Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼...');
                        
                        // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· Ğ‘Ğ”
                        this.stats = gameData.stats || this.stats;
                        this.money = gameData.money || this.money;
                        this.level = gameData.level || this.level;
                        this.experience = gameData.experience || this.experience;
                        this.age = gameData.age || this.age;
                        this.outfit = gameData.outfit || this.outfit;
                        this.currentSkin = gameData.currentSkin || this.currentSkin;
                        this.unlockedSkins = gameData.unlockedSkins || this.unlockedSkins;
                        this.evolutionStage = gameData.evolutionStage || this.evolutionStage;
                        this.chestCount = gameData.chestCount || this.chestCount;
                        this.friendsInvited = gameData.friendsInvited || this.friendsInvited;
                        this.lastChestLevel = gameData.lastChestLevel || this.lastChestLevel;
                        this.isSleeping = gameData.isSleeping || this.isSleeping;
                        this.petName = gameData.petName || this.petName;
                        this.lastUpdate = gameData.lastUpdate || this.lastUpdate;
                        
                        // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ² localStorage ĞºĞ°Ğº ĞºÑÑˆ
                        this.saveToLocalStorage();
                        
                        // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ñ Ğ½Ğ¾Ğ²Ñ‹Ğ¼Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸
                        this.updateDisplay();
                        
                        console.log('âœ… Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· Ğ‘Ğ” ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹');
                        this.showMessage('ğŸ“± Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹ Ñ ÑĞµÑ€Ğ²ĞµÑ€Ğ°!');
                    } else {
                        console.log('ğŸ“± Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹');
                    }
                }
            }

        } catch (error) {
            console.warn('âš ï¸ Ğ¤Ğ¾Ğ½Ğ¾Ğ²Ğ°Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¸Ğ· Ğ‘Ğ” Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ°:', error.message);
        }
    }

    saveToLocalStorage() {
        // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² localStorage (Ğ¸Ğ½Ğ´Ğ¸Ğ²Ğ¸Ğ´ÑƒĞ°Ğ»ÑŒĞ½Ğ¾ Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ)
        this.saveValue('labubu_stats', this.stats);
        this.saveValue('labubu_money', this.money);
        this.saveValue('labubu_outfit', this.outfit);
        this.saveValue('labubu_level', this.level);
        this.saveValue('labubu_experience', this.experience);
        this.saveValue('labubu_age', this.age);
        this.saveValue('labubu_evolution', this.evolutionStage);
        this.saveValue('labubu_last_update', Date.now());
        this.saveValue('pet_name', this.petName);
        this.saveValue('labubu_sleeping', this.isSleeping);
        this.saveValue('current_skin', this.currentSkin);
        this.saveValue('unlocked_skins', this.unlockedSkins);
        this.saveValue('chest_count', this.chestCount);
        this.saveValue('friends_invited', this.friendsInvited);
        this.saveValue('last_chest_level', this.lastChestLevel);
        this.saveValue('labubu_last_notification', this.lastNotification);
        this.saveValue('owned_outfits', this.ownedOutfits);
        this.saveValue('last_stat_decay', this.lastStatDecay);
        this.saveValue('labubu_pets', this.pets);
        this.saveValue('active_pet_id', this.activePetId);
    }
    
    // Ğ˜Ğ³Ñ€Ğ° "Ğ ĞµĞ°ĞºÑ†Ğ¸Ñ"
    startReactionTest() {
        const light = document.getElementById('reaction-light');
        const btn = document.getElementById('reaction-btn');
        light.className = 'w-20 h-20 bg-red-400 rounded-full mx-auto mb-4 transition-colors';
        btn.classList.add('hidden');
        
        const delay = 2000 + Math.random() * 3000;
        this.reactionStartTime = Date.now() + delay;
        
        setTimeout(() => {
            light.className = 'w-20 h-20 bg-green-500 rounded-full mx-auto mb-4 transition-colors animate-pulse';
            btn.classList.remove('hidden');
            this.reactionStarted = true;
        }, delay);
    }
    
    reactionClick() {
        if (this.reactionStarted) {
            const reactionTime = Date.now() - this.reactionStartTime;
            this.completeMiniGame(reactionTime < 1000);
        }
    }
    
    // Ğ˜Ğ³Ñ€Ğ° "ĞœĞ°Ñ‚ĞµĞ¼Ğ°Ñ‚Ğ¸ĞºĞ°"
    checkMathAnswer(answer) {
        this.completeMiniGame(answer === this.mathAnswer);
    }
    
    // Ğ˜Ğ³Ñ€Ğ° "ĞŸĞ°Ğ·Ğ»"
    swapPuzzlePiece(index) {
        if (index < this.puzzlePieces.length - 1) {
            [this.puzzlePieces[index], this.puzzlePieces[index + 1]] = [this.puzzlePieces[index + 1], this.puzzlePieces[index]];
            
            // ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ
            const content = this.getPuzzleGameContent();
            document.getElementById('gameContent').innerHTML = content;
            
            if (JSON.stringify(this.puzzlePieces) === JSON.stringify([1, 2, 3, 4])) {
                this.completeMiniGame(true);
            }
        }
    }
    
    // Ğ˜Ğ³Ñ€Ğ° "Ğ’Ğ¸ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ½Ğ°"
    checkQuizAnswer(answerIndex) {
        this.completeMiniGame(answerIndex === this.currentQuestion.correct);
    }
    
    // Ğ˜Ğ³Ñ€Ğ° "Ğ Ğ¸Ñ‚Ğ¼"
    addRhythmBeat(beat) {
        if (!this.userRhythm) this.userRhythm = [];
        this.userRhythm.push(beat);
        
        const display = document.getElementById('rhythm-display');
        display.textContent = 'Ğ’Ğ°Ñˆ Ñ€Ğ¸Ñ‚Ğ¼: ' + this.userRhythm.map(b => b === 1 ? 'ğŸ”´' : 'ğŸ”µ').join('');
    }
    
    checkRhythm() {
        const targetRhythm = [1, 0, 1, 0]; // ğŸ”´ğŸ”µğŸ”´ğŸ”µ
        this.completeMiniGame(JSON.stringify(this.userRhythm) === JSON.stringify(targetRhythm));
    }
    
    resetRhythm() {
        this.userRhythm = [];
        document.getElementById('rhythm-display').textContent = 'Ğ’Ğ°Ñˆ Ñ€Ğ¸Ñ‚Ğ¼: ';
    }
    
    // Ğ˜Ğ³Ñ€Ğ° "ĞšĞ»Ğ°Ğ´" (Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ)
    checkTreasure(position) {
        if (!this.treasureAttempts) this.treasureAttempts = 0;
        
        if (position === this.treasurePosition) {
            // ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞ¾ĞºÑ€Ğ¾Ğ²Ğ¸Ñ‰Ğµ
            const buttons = document.querySelectorAll('#gameContent .treasure-btn');
            if (buttons[position]) {
                buttons[position].textContent = 'ğŸ’';
                buttons[position].className = 'treasure-btn bg-green-500 text-white p-4 rounded h-16 text-2xl animate-pulse';
            }
            setTimeout(() => this.completeMiniGame(true), 1000);
        } else {
            this.treasureAttempts++;
            const attemptsLeft = 3 - this.treasureAttempts;
            
            // ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ½ĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€
            const buttons = document.querySelectorAll('#gameContent .treasure-btn');
            if (buttons[position]) {
                buttons[position].textContent = 'âŒ';
                buttons[position].disabled = true;
                buttons[position].className = 'treasure-btn bg-red-400 text-white p-4 rounded h-16 text-2xl';
            }
            
            if (attemptsLeft > 0) {
                // ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ°Ñ…
                const messageEl = document.querySelector('#gameContent .attempts-message');
                if (messageEl) {
                    messageEl.textContent = `ĞÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº: ${attemptsLeft}`;
                    messageEl.className = 'attempts-message text-center text-sm text-red-600 mt-2';
                }
            } else {
                // ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¼ĞµÑÑ‚Ğ¾Ğ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ ÑĞ¾ĞºÑ€Ğ¾Ğ²Ğ¸Ñ‰Ğ°
                if (buttons[this.treasurePosition]) {
                    buttons[this.treasurePosition].textContent = 'ğŸ’';
                    buttons[this.treasurePosition].className = 'treasure-btn bg-yellow-500 text-white p-4 rounded h-16 text-2xl animate-pulse';
                }
                setTimeout(() => this.completeMiniGame(false), 1500);
            }
        }
    }
    
    // Ğ˜Ğ³Ñ€Ğ° "Ğ‘Ğ°Ğ»Ğ°Ğ½Ñ"
    startBalanceGame() {
        this.balance = 50;
        this.balanceTimer = 10;
        this.balanceInterval = setInterval(() => {
            this.balanceTimer--;
            document.getElementById('balance-timer').textContent = this.balanceTimer;
            
            if (this.balanceTimer <= 0) {
                clearInterval(this.balanceInterval);
                this.completeMiniGame(true);
            }
            
            // Ğ¡Ğ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ğ¾Ğµ ÑĞ¼ĞµÑ‰ĞµĞ½Ğ¸Ğµ Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ°
            this.balance += (Math.random() - 0.5) * 4;
            this.balance = Math.max(0, Math.min(100, this.balance));
            
            const marker = document.getElementById('balance-marker');
            marker.style.left = this.balance + '%';
            
            // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ° Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ»
            if (this.balance < 25 || this.balance > 75) {
                clearInterval(this.balanceInterval);
                this.completeMiniGame(false);
            }
        }, 1000);
    }
    
    adjustBalance(amount) {
        this.balance += amount;
        this.balance = Math.max(0, Math.min(100, this.balance));
        
        const marker = document.getElementById('balance-marker');
        marker.style.left = this.balance + '%';
    }
    
    // Ğ˜Ğ³Ñ€Ğ° "ĞĞ°Ğ¹Ğ´Ğ¸ Ğ¿Ğ°Ñ€Ñƒ"
    flipCard(index) {
        if (this.flippedCards.length < 2 && !this.flippedCards.includes(index) && !this.matchedCards.includes(index)) {
            this.flippedCards.push(index);
            const card = document.getElementById(`card-${index}`);
            card.textContent = this.matchingCards[index];
            card.className = 'h-16 w-16 bg-green-200 rounded text-2xl transition-colors';
            
            if (this.flippedCards.length === 2) {
                setTimeout(() => {
                    if (this.matchingCards[this.flippedCards[0]] === this.matchingCards[this.flippedCards[1]]) {
                        this.matchedCards.push(...this.flippedCards);
                        document.getElementById('pairs-found').textContent = this.matchedCards.length / 2;
                        
                        if (this.matchedCards.length === this.matchingCards.length) {
                            this.completeMiniGame(true);
                        }
                    } else {
                        this.flippedCards.forEach(i => {
                            const card = document.getElementById(`card-${i}`);
                            card.textContent = 'â“';
                            card.className = 'h-16 w-16 bg-blue-400 hover:bg-blue-500 rounded text-2xl transition-colors';
                        });
                    }
                    this.flippedCards = [];
                }, 1000);
            }
        }
    }
    
    // Ğ˜Ğ³Ñ€Ğ° "Ğ¡Ğ°Ğ¹Ğ¼Ğ¾Ğ½ Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚"
    startSimonGame() {
        this.simonSequence = Array.from({length: 5}, () => Math.floor(Math.random() * 4));
        this.userSimonSequence = [];
        this.currentSimonStep = 0;
        this.showSimonSequence();
    }
    
    showSimonSequence() {
        if (this.currentSimonStep < this.simonSequence.length) {
            const colorIndex = this.simonSequence[this.currentSimonStep];
            const button = document.getElementById(`simon-${colorIndex}`);
            button.style.transform = 'scale(1.2)';
            button.style.filter = 'brightness(1.5)';
            
            setTimeout(() => {
                button.style.transform = 'scale(1)';
                button.style.filter = 'brightness(1)';
                this.currentSimonStep++;
                setTimeout(() => this.showSimonSequence(), 300);
            }, 600);
        } else {
            document.getElementById('simon-status').textContent = 'Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ!';
        }
    }
    
    simonClick(colorIndex) {
        if (this.currentSimonStep >= this.simonSequence.length) {
            this.userSimonSequence.push(colorIndex);
            
            if (this.userSimonSequence[this.userSimonSequence.length - 1] !== this.simonSequence[this.userSimonSequence.length - 1]) {
                this.completeMiniGame(false);
                return;
            }
            
            if (this.userSimonSequence.length === this.simonSequence.length) {
                this.completeMiniGame(true);
            }
        }
    }
    
    // ĞœĞµÑ‚Ğ¾Ğ´Ñ‹ Ğ´Ğ»Ñ Ğ¸Ğ³Ñ€Ñ‹ "ĞŸĞ¾Ğ¹Ğ¼Ğ°Ğ¹ Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚" (Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ)
    startCatchGame() {
        this.fallingItems = [];
        this.catchScore = 0;
        this.playerPos = 50;
        
        // ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑÑ‡ĞµÑ‚Ñ‡Ğ¸Ğº
        this.updateCatchGameDisplay();
        
        // Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ°Ğ´Ğ°ÑÑ‰Ğ¸Ñ… Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ğ¾Ğ²
        this.catchSpawnInterval = setInterval(() => {
            const newItem = {
                id: Date.now() + Math.random(),
                x: Math.random() * 80 + 10,
                y: 0
            };
            this.fallingItems.push(newItem);
        }, 800);
        
        // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ³Ñ€Ñ‹
        this.catchUpdateInterval = setInterval(() => {
            // ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸ Ğ²ÑĞµÑ… Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ğ¾Ğ²
            this.fallingItems = this.fallingItems.map(item => ({
                ...item,
                y: item.y + 5
            })).filter(item => {
                // ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ¾Ğ»ĞºĞ½Ğ¾Ğ²ĞµĞ½Ğ¸Ğµ Ñ ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ¾Ğ¹
                if (item.y >= 75 && item.y <= 85 && Math.abs(item.x - this.playerPos) < 15) {
                    this.catchScore++;
                    this.updateCatchGameDisplay();
                    
                    if (this.catchScore >= 5) {
                        this.endCatchGame(true);
                        return false;
                    }
                    return false; // Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ¹Ğ¼Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚
                }
                
                // Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ñ‹ ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ ÑƒĞ¿Ğ°Ğ»Ğ¸
                return item.y <= 100;
            });
            
            this.renderFallingItems();
        }, 100);
        
        // Ğ—Ğ°ĞºĞ¾Ğ½Ñ‡Ğ¸Ñ‚ÑŒ Ğ¸Ğ³Ñ€Ñƒ Ñ‡ĞµÑ€ĞµĞ· 15 ÑĞµĞºÑƒĞ½Ğ´
        this.catchGameTimeout = setTimeout(() => {
            this.endCatchGame(this.catchScore >= 5);
        }, 15000);
    }
    
    endCatchGame(success) {
        if (this.catchSpawnInterval) clearInterval(this.catchSpawnInterval);
        if (this.catchUpdateInterval) clearInterval(this.catchUpdateInterval);
        if (this.catchGameTimeout) clearTimeout(this.catchGameTimeout);
        
        this.completeMiniGame(success);
    }
    
    updateCatchGameDisplay() {
        const scoreElement = document.getElementById('catch-score');
        if (scoreElement) {
            scoreElement.textContent = `ĞŸĞ¾Ğ¹Ğ¼Ğ°Ğ½Ğ¾: ${this.catchScore}/5`;
        }
    }
    
    moveCatchPlayer(direction) {
        if (direction === 'left') {
            this.playerPos = Math.max(10, this.playerPos - 15);
        } else if (direction === 'right') {
            this.playerPos = Math.min(90, this.playerPos + 15);
        }
        
        const bucket = document.getElementById('catch-bucket');
        if (bucket) {
            bucket.style.left = this.playerPos + '%';
        }
    }
    
    renderFallingItems() {
        const gameArea = document.getElementById('catch-game-area');
        if (!gameArea) return;
        
        // Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ñ‹
        const oldItems = gameArea.querySelectorAll('.falling-item');
        oldItems.forEach(item => item.remove());
        
        // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğµ Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ñ‹
        this.fallingItems.forEach((item) => {
            const itemElement = document.createElement('div');
            itemElement.className = 'falling-item absolute w-6 h-6 bg-yellow-400 rounded-full cursor-pointer flex items-center justify-center text-xs';
            itemElement.style.left = item.x + '%';
            itemElement.style.top = item.y + '%';
            itemElement.style.transform = 'translate(-50%, -50%)';
            itemElement.innerHTML = 'â­';
            itemElement.style.zIndex = '5';
            gameArea.appendChild(itemElement);
        });
    }
    
    // ĞœĞµÑ‚Ğ¾Ğ´Ñ‹ Ğ´Ğ»Ñ Ğ¸Ğ³Ñ€Ñ‹ "ĞŸĞ¾Ğ¿Ğ°Ğ´Ğ¸ Ğ² Ñ†ĞµĞ»ÑŒ" (Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ)
    startTargetGame() {
        this.targetScore = 0;
        this.targetPos = { x: 50, y: 50 };
        
        // ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑÑ‡ĞµÑ‚Ñ‡Ğ¸Ğº
        const scoreElement = document.getElementById('target-score');
        if (scoreElement) {
            scoreElement.textContent = `ĞŸĞ¾Ğ¿Ğ°Ğ´Ğ°Ğ½Ğ¸Ğ¹: 0/3`;
        }
        
        // ĞŸĞµÑ€Ğ²Ğ¾Ğµ Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¸ÑˆĞµĞ½Ğ¸
        this.moveTarget();
        
        // Ğ˜Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ» Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ Ğ¼Ğ¸ÑˆĞµĞ½Ğ¸
        this.targetGameInterval = setInterval(() => {
            this.moveTarget();
        }, 1500);
        
        // Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ñ‚ÑŒ Ğ¸Ğ³Ñ€Ñƒ Ñ‡ĞµÑ€ĞµĞ· 10 ÑĞµĞºÑƒĞ½Ğ´
        this.targetGameTimeout = setTimeout(() => {
            if (this.targetGameInterval) {
                clearInterval(this.targetGameInterval);
                this.completeMiniGame(this.targetScore >= 3);
            }
        }, 10000);
    }
    
    moveTarget() {
        this.targetPos = {
            x: Math.random() * 70 + 15, // Ğ‘Ğ¾Ğ»ĞµĞµ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğµ Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹
            y: Math.random() * 70 + 15
        };
        
        const target = document.getElementById('moving-target');
        if (target) {
            target.style.left = this.targetPos.x + '%';
            target.style.top = this.targetPos.y + '%';
            target.style.transition = 'all 0.3s ease';
        }
    }
    
    hitTarget() {
        this.targetScore++;
        const scoreElement = document.getElementById('target-score');
        if (scoreElement) {
            scoreElement.textContent = `ĞŸĞ¾Ğ¿Ğ°Ğ´Ğ°Ğ½Ğ¸Ğ¹: ${this.targetScore}/3`;
        }
        
        // Ğ­Ñ„Ñ„ĞµĞºÑ‚ Ğ¿Ğ¾Ğ¿Ğ°Ğ´Ğ°Ğ½Ğ¸Ñ
        const target = document.getElementById('moving-target');
        if (target) {
            target.style.transform = 'translate(-50%, -50%) scale(1.2)';
            setTimeout(() => {
                target.style.transform = 'translate(-50%, -50%) scale(1)';
            }, 200);
        }
        
        if (this.targetScore >= 3) {
            clearInterval(this.targetGameInterval);
            clearTimeout(this.targetGameTimeout);
            this.completeMiniGame(true);
        } else {
            // ĞĞµĞ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾ Ğ¿ĞµÑ€ĞµĞ¼ĞµÑÑ‚Ğ¸Ñ‚ÑŒ Ğ¼Ğ¸ÑˆĞµĞ½ÑŒ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿Ğ¾Ğ¿Ğ°Ğ´Ğ°Ğ½Ğ¸Ñ
            setTimeout(() => this.moveTarget(), 300);
        }
    }
    
    // ĞœĞµÑ‚Ğ¾Ğ´Ñ‹ Ğ´Ğ»Ñ Ğ¸Ğ³Ñ€Ñ‹ "Ğ’Ğ·Ğ»Ğ¾Ğ¼Ğ°Ğ¹ ĞºĞ¾Ğ´" (Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ)
    enterCodeDigit(digit) {
        if (this.codeAttempt.length < 4) {
            this.codeAttempt.push(digit);
            
            const slot = document.getElementById(`code-slot-${this.codeAttempt.length - 1}`);
            if (slot) {
                slot.textContent = digit;
                slot.className = 'w-8 h-8 border-2 border-blue-400 rounded flex items-center justify-center bg-blue-50 font-bold';
            }
            
            if (this.codeAttempt.length === 4) {
                // ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸
                for (let i = 0; i < 4; i++) {
                    const slot = document.getElementById(`code-slot-${i}`);
                    if (slot) {
                        slot.className = 'w-8 h-8 border-2 border-yellow-400 rounded flex items-center justify-center bg-yellow-100 font-bold animate-pulse';
                    }
                }
                
                setTimeout(() => {
                    if (JSON.stringify(this.codeAttempt) === JSON.stringify(this.secretCode)) {
                        // ĞšĞ¾Ğ´ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹
                        for (let i = 0; i < 4; i++) {
                            const slot = document.getElementById(`code-slot-${i}`);
                            if (slot) {
                                slot.className = 'w-8 h-8 border-2 border-green-500 rounded flex items-center justify-center bg-green-100 font-bold';
                            }
                        }
                        setTimeout(() => this.completeMiniGame(true), 1000);
                    } else {
                        // ĞšĞ¾Ğ´ Ğ½ĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹
                        for (let i = 0; i < 4; i++) {
                            const slot = document.getElementById(`code-slot-${i}`);
                            if (slot) {
                                slot.className = 'w-8 h-8 border-2 border-red-500 rounded flex items-center justify-center bg-red-100 font-bold animate-bounce';
                            }
                        }
                        
                        setTimeout(() => {
                            this.resetCode();
                            this.showMessage('ĞĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ¾Ğ´! ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ ĞµÑ‰Ğµ Ñ€Ğ°Ğ·.');
                        }, 1500);
                    }
                }, 1000);
            }
        }
    }
    
    resetCode() {
        this.codeAttempt = [];
        for (let i = 0; i < 4; i++) {
            const slot = document.getElementById(`code-slot-${i}`);
            if (slot) {
                slot.textContent = '?';
                slot.className = 'w-8 h-8 border-2 border-gray-400 rounded flex items-center justify-center bg-white';
            }
        }
    }
    
    // ĞœĞµÑ‚Ğ¾Ğ´Ñ‹ Ğ´Ğ»Ñ Ğ¸Ğ³Ñ€Ñ‹ "Ğ¡Ğ¾Ğ±ĞµÑ€Ğ¸ Ğ±Ğ°ÑˆĞ½Ñ" (Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ)
    startStackTimer() {
        this.stackHeight = 0;
        this.stackTimer = 10;
        
        this.stackTimerInterval = setInterval(() => {
            this.stackTimer--;
            const timerElement = document.getElementById('stack-timer');
            if (timerElement) {
                timerElement.textContent = this.stackTimer;
            }
            
            if (this.stackTimer <= 0) {
                clearInterval(this.stackTimerInterval);
                this.completeMiniGame(this.stackHeight >= 5);
            }
        }, 1000);
    }
    
    addStackBlock() {
        if (this.stackTimer <= 0) return;
        
        this.stackHeight++;
        
        const heightElement = document.getElementById('stack-height');
        if (heightElement) {
            heightElement.textContent = this.stackHeight;
        }
        
        const stackArea = document.getElementById('stack-area');
        if (stackArea) {
            const block = document.createElement('div');
            block.className = 'w-16 h-6 bg-orange-400 border border-orange-600 mb-1 rounded';
            block.style.animation = 'fadeIn 0.2s ease-in';
            stackArea.appendChild(block);
        }
        
        if (this.stackHeight >= 5) {
            clearInterval(this.stackTimerInterval);
            this.completeMiniGame(true);
        }
    }
    
    // ĞœĞµÑ‚Ğ¾Ğ´Ñ‹ Ğ´Ğ»Ñ Ğ¸Ğ³Ñ€Ñ‹ "Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ"
    startSpeedTimer() {
        this.clickCount = 0;
        this.speedTimer = 5;
        
        this.speedTimerInterval = setInterval(() => {
            this.speedTimer--;
            const timerElement = document.getElementById('speed-timer');
            if (timerElement) {
                timerElement.textContent = this.speedTimer;
            }
            
            if (this.speedTimer <= 0) {
                clearInterval(this.speedTimerInterval);
                this.completeMiniGame(this.clickCount >= 20);
            }
        }, 1000);
    }
    
    speedClick() {
        if (this.speedTimer <= 0) return;
        
        this.clickCount++;
        const countElement = document.getElementById('click-count');
        if (countElement) {
            countElement.textContent = this.clickCount;
        }
        
        if (this.clickCount >= 20) {
            clearInterval(this.speedTimerInterval);
            this.completeMiniGame(true);
        }
    }
    
    // ĞœĞµÑ‚Ğ¾Ğ´Ñ‹ Ğ´Ğ»Ñ Ğ¸Ğ³Ñ€Ñ‹ "Ğ›Ğ°Ğ±Ğ¸Ñ€Ğ¸Ğ½Ñ‚" (ĞĞĞ’ĞĞ•)
    getMazeGameContent() {
        // Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğ¹ Ğ»Ğ°Ğ±Ğ¸Ñ€Ğ¸Ğ½Ñ‚ 5x5
        this.mazeSize = 5;
        this.playerPos = { x: 0, y: 0 };
        this.exitPos = { x: 4, y: 4 };
        this.maze = this.generateMaze();
        
        return `
            <div class="text-center">
                <p class="mb-2">ĞĞ°Ğ¹Ğ´Ğ¸ Ğ²Ñ‹Ñ…Ğ¾Ğ´ Ğ¸Ğ· Ğ»Ğ°Ğ±Ğ¸Ñ€Ğ¸Ğ½Ñ‚Ğ°!</p>
                <p class="mb-4">ğŸ Ğ”Ğ¾Ğ¹Ğ´Ğ¸ Ğ´Ğ¾ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ° Ğ² Ğ¿Ñ€Ğ°Ğ²Ğ¾Ğ¼ Ğ½Ğ¸Ğ¶Ğ½ĞµĞ¼ ÑƒĞ³Ğ»Ñƒ</p>
                <div id="maze-grid" class="grid grid-cols-5 gap-1 mb-4 mx-auto max-w-40">
                    ${this.renderMaze()}
                </div>
                <div class="flex justify-center space-x-2">
                    <button onclick="game.moveMazePlayer('up')" class="bg-blue-500 text-white px-3 py-2 rounded">â¬†ï¸</button>
                </div>
                <div class="flex justify-center space-x-2 mt-1">
                    <button onclick="game.moveMazePlayer('left')" class="bg-blue-500 text-white px-3 py-2 rounded">â¬…ï¸</button>
                    <button onclick="game.moveMazePlayer('down')" class="bg-blue-500 text-white px-3 py-2 rounded">â¬‡ï¸</button>
                    <button onclick="game.moveMazePlayer('right')" class="bg-blue-500 text-white px-3 py-2 rounded">â¡ï¸</button>
                </div>
            </div>
        `;
    }
    
    generateMaze() {
        // ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ğ¹ Ğ»Ğ°Ğ±Ğ¸Ñ€Ğ¸Ğ½Ñ‚ 5x5 Ğ³Ğ´Ğµ 1 = ÑÑ‚ĞµĞ½Ğ°, 0 = ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ğ¾
        const maze = [
            [0, 1, 0, 0, 0],
            [0, 1, 0, 1, 0],
            [0, 0, 0, 1, 0],
            [1, 1, 0, 0, 0],
            [0, 0, 0, 1, 0]
        ];
        return maze;
    }
    
    renderMaze() {
        let html = '';
        for (let y = 0; y < this.mazeSize; y++) {
            for (let x = 0; x < this.mazeSize; x++) {
                const isPlayer = this.playerPos.x === x && this.playerPos.y === y;
                const isExit = this.exitPos.x === x && this.exitPos.y === y;
                const isWall = this.maze[y][x] === 1;
                
                let cellClass = 'w-8 h-8 flex items-center justify-center text-xs border ';
                let content = '';
                
                if (isPlayer) {
                    cellClass += 'bg-green-500 text-white';
                    content = 'ğŸ‘¤';
                } else if (isExit) {
                    cellClass += 'bg-red-500 text-white';
                    content = 'ğŸ';
                } else if (isWall) {
                    cellClass += 'bg-gray-800';
                    content = '';
                } else {
                    cellClass += 'bg-white border-gray-300';
                    content = '';
                }
                
                html += `<div class="${cellClass}">${content}</div>`;
            }
        }
        return html;
    }
    
    moveMazePlayer(direction) {
        let newX = this.playerPos.x;
        let newY = this.playerPos.y;
        
        switch (direction) {
            case 'up':
                newY = Math.max(0, newY - 1);
                break;
            case 'down':
                newY = Math.min(this.mazeSize - 1, newY + 1);
                break;
            case 'left':
                newX = Math.max(0, newX - 1);
                break;
            case 'right':
                newX = Math.min(this.mazeSize - 1, newX + 1);
                break;
        }
        
        // ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ¾Ğ»ĞºĞ½Ğ¾Ğ²ĞµĞ½Ğ¸Ğµ ÑĞ¾ ÑÑ‚ĞµĞ½Ğ¾Ğ¹
        if (this.maze[newY][newX] !== 1) {
            this.playerPos = { x: newX, y: newY };
            
            // ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ
            const mazeGrid = document.getElementById('maze-grid');
            if (mazeGrid) {
                mazeGrid.innerHTML = this.renderMaze();
            }
            
            // ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ°
            if (newX === this.exitPos.x && newY === this.exitPos.y) {
                setTimeout(() => this.completeMiniGame(true), 500);
            }
        }
    }
    
    // ĞœĞµÑ‚Ğ¾Ğ´Ñ‹ Ğ´Ğ»Ñ Ğ¸Ğ³Ñ€Ñ‹ "Ğ£Ğ·Ğ¾Ñ€" (ĞĞĞ’ĞĞ•)
    getPatternGameContent() {
        // Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµĞ¼ ÑƒĞ·Ğ¾Ñ€ Ğ¸Ğ· Ñ†Ğ²ĞµÑ‚Ğ¾Ğ²
        this.pattern = this.generatePattern();
        this.userPattern = [];
        this.showingPattern = true;
        
        setTimeout(() => {
            this.showingPattern = false;
            this.updatePatternDisplay();
        }, 3000);
        
        return `
            <div class="text-center">
                <p class="mb-2">Ğ—Ğ°Ğ¿Ğ¾Ğ¼Ğ½Ğ¸ Ğ¸ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸ ÑƒĞ·Ğ¾Ñ€!</p>
                <p id="pattern-instruction" class="mb-4 text-sm text-gray-600">Ğ—Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ¹...</p>
                <div id="pattern-display" class="grid grid-cols-3 gap-2 mb-4 mx-auto max-w-32">
                    ${this.renderPattern()}
                </div>
                <div id="pattern-buttons" class="grid grid-cols-3 gap-2 mx-auto max-w-32" style="display: none;">
                    ${this.renderPatternButtons()}
                </div>
                <div class="text-xs text-gray-600 mt-2">
                    ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ: <span id="pattern-progress">0</span>/${this.pattern.length}
                </div>
            </div>
        `;
    }
    
    generatePattern() {
        const colors = ['red', 'blue', 'green', 'yellow'];
        const pattern = [];
        for (let i = 0; i < 6; i++) {
            pattern.push(colors[Math.floor(Math.random() * colors.length)]);
        }
        return pattern;
    }
    
    renderPattern() {
        return this.pattern.map((color, index) => {
            const bgColor = this.getColorClass(color);
            const isVisible = this.showingPattern || this.userPattern.length > index;
            return `
                <div class="w-8 h-8 rounded border-2 ${isVisible ? bgColor : 'bg-gray-200'} ${
                    this.showingPattern && Math.floor(Date.now() / 500) % 2 === 0 ? 'animate-pulse' : ''
                }"></div>
            `;
        }).join('');
    }
    
    renderPatternButtons() {
        const colors = ['red', 'blue', 'green', 'yellow'];
        return colors.map(color => `
            <button onclick="game.addPatternColor('${color}')" class="w-8 h-8 rounded border-2 ${this.getColorClass(color)} hover:scale-110 transition-transform">
            </button>
        `).join('');
    }
    
    getColorClass(color) {
        const colorMap = {
            red: 'bg-red-500',
            blue: 'bg-blue-500',
            green: 'bg-green-500',
            yellow: 'bg-yellow-500'
        };
        return colorMap[color] || 'bg-gray-500';
    }
    
    updatePatternDisplay() {
        const instruction = document.getElementById('pattern-instruction');
        const patternDisplay = document.getElementById('pattern-display');
        const patternButtons = document.getElementById('pattern-buttons');
        
        if (instruction) instruction.textContent = 'ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸ ÑƒĞ·Ğ¾Ñ€:';
        if (patternDisplay) patternDisplay.innerHTML = this.renderPattern();
        if (patternButtons) patternButtons.style.display = 'grid';
    }
    
    addPatternColor(color) {
        if (this.showingPattern) return;
        
        this.userPattern.push(color);
        
        // ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ
        const progress = document.getElementById('pattern-progress');
        if (progress) progress.textContent = this.userPattern.length;
        
        // ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ
        const isCorrect = this.userPattern[this.userPattern.length - 1] === this.pattern[this.userPattern.length - 1];
        
        if (!isCorrect) {
            this.completeMiniGame(false);
            return;
        }
        
        // ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ
        this.updatePatternDisplay();
        
        // ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ğµ
        if (this.userPattern.length === this.pattern.length) {
            this.completeMiniGame(true);
        }
    }
    
    // ĞœĞµÑ‚Ğ¾Ğ´Ñ‹ Ğ´Ğ»Ñ Ğ¸Ğ³Ñ€Ñ‹ "Ğ¡Ğ¾ÑÑ‚Ğ°Ğ²ÑŒ ÑĞ»Ğ¾Ğ²Ğ¾" (ĞĞĞ’ĞĞ•)
    getWordGameContent() {
        const words = ['ĞšĞĞ¢', 'Ğ”ĞĞœ', 'Ğ¡ĞĞ”', 'ĞœĞ˜Ğ ', 'Ğ¡ĞĞ', 'Ğ›Ğ•Ğ¡', 'ĞœĞĞš', 'Ğ›Ğ£Ğš'];
        this.targetWord = words[Math.floor(Math.random() * words.length)];
        this.availableLetters = this.shuffleWord(this.targetWord);
        this.userWord = '';
        
        return `
            <div class="text-center">
                <p class="mb-2">Ğ¡Ğ¾ÑÑ‚Ğ°Ğ²ÑŒ ÑĞ»Ğ¾Ğ²Ğ¾ Ğ¸Ğ· Ğ±ÑƒĞºĞ²!</p>
                <p class="mb-4 text-lg font-bold">Ğ¦ĞµĞ»ÑŒ: ${this.targetWord}</p>
                <div class="mb-4">
                    <div class="text-lg font-mono bg-gray-100 p-2 rounded min-h-8">
                        <span id="user-word">${this.userWord || '_'.repeat(this.targetWord.length)}</span>
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-2 mb-4">
                    ${this.availableLetters.map((letter, index) => `
                        <button onclick="game.addLetter('${letter}', ${index})" id="letter-${index}" class="bg-blue-500 hover:bg-blue-600 text-white p-3 rounded font-bold transition-colors">
                            ${letter}
                        </button>
                    `).join('')}
                </div>
                <div class="flex justify-center space-x-2">
                    <button onclick="game.clearWord()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                        ğŸ—‘ï¸ ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ
                    </button>
                    <button onclick="game.checkWord()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                        âœ“ ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ
                    </button>
                </div>
            </div>
        `;
    }
    
    shuffleWord(word) {
        return word.split('').sort(() => Math.random() - 0.5);
    }
    
    addLetter(letter, index) {
        if (this.userWord.length < this.targetWord.length) {
            this.userWord += letter;
            
            // Ğ¡ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ½ÑƒÑ Ğ±ÑƒĞºĞ²Ñƒ
            const letterBtn = document.getElementById(`letter-${index}`);
            if (letterBtn) {
                letterBtn.style.display = 'none';
            }
            
            // ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ ÑĞ»Ğ¾Ğ²Ğ°
            const userWordEl = document.getElementById('user-word');
            if (userWordEl) {
                userWordEl.textContent = this.userWord + '_'.repeat(this.targetWord.length - this.userWord.length);
            }
        }
    }
    
    clearWord() {
        this.userWord = '';
        
        // ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ²ÑĞµ Ğ±ÑƒĞºĞ²Ñ‹
        this.availableLetters.forEach((_, index) => {
            const letterBtn = document.getElementById(`letter-${index}`);
            if (letterBtn) {
                letterBtn.style.display = 'block';
            }
        });
        
        // ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ
        const userWordEl = document.getElementById('user-word');
        if (userWordEl) {
            userWordEl.textContent = '_'.repeat(this.targetWord.length);
        }
    }
    
    checkWord() {
        this.completeMiniGame(this.userWord === this.targetWord);
    }
    
    // ĞœĞµÑ‚Ğ¾Ğ´Ñ‹ Ğ´Ğ»Ñ Ğ¸Ğ³Ñ€Ñ‹ "Ğ¦Ğ²ĞµÑ‚Ğ½Ğ°Ñ Ğ¸Ğ³Ñ€Ğ°" (ĞĞĞ’ĞĞ•)
    getColorGameContent() {
        const colors = [
            { name: 'ĞšĞ ĞĞ¡ĞĞ«Ğ™', color: 'red', textColor: 'blue' },
            { name: 'Ğ¡Ğ˜ĞĞ˜Ğ™', color: 'blue', textColor: 'green' },
            { name: 'Ğ—Ğ•Ğ›Ğ•ĞĞ«Ğ™', color: 'green', textColor: 'red' },
            { name: 'Ğ–Ğ•Ğ›Ğ¢Ğ«Ğ™', color: 'yellow', textColor: 'purple' }
        ];
        
        this.currentColor = colors[Math.floor(Math.random() * colors.length)];
        this.colorOptions = colors.map(c => c.color).sort(() => Math.random() - 0.5);
        
        return `
            <div class="text-center">
                <p class="mb-4">Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ Ğ¦Ğ’Ğ•Ğ¢ Ñ‚ĞµĞºÑÑ‚Ğ°, Ğ° Ğ½Ğµ Ñ‚Ğ¾ Ñ‡Ñ‚Ğ¾ Ğ½Ğ°Ğ¿Ğ¸ÑĞ°Ğ½Ğ¾!</p>
                <div class="mb-6 p-4 bg-gray-100 rounded-lg">
                    <div class="text-4xl font-bold" style="color: ${this.getActualColor(this.currentColor.textColor)}">
                        ${this.currentColor.name}
                    </div>
                </div>
                <p class="mb-4 text-sm text-gray-600">ĞšĞ°ĞºĞ¾Ğ³Ğ¾ Ñ†Ğ²ĞµÑ‚Ğ° Ñ‚ĞµĞºÑÑ‚ Ğ²Ñ‹ÑˆĞµ?</p>
                <div class="grid grid-cols-2 gap-3">
                    ${this.colorOptions.map(color => `
                        <button onclick="game.selectColor('${color}')" class="p-3 rounded-lg text-white font-bold transition-colors ${this.getColorButtonClass(color)}">
                            ${this.getColorName(color)}
                        </button>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    getActualColor(color) {
        const colorMap = {
            red: '#ef4444',
            blue: '#3b82f6',
            green: '#22c55e',
            yellow: '#eab308',
            purple: '#a855f7'
        };
        return colorMap[color] || '#000000';
    }
    
    getColorButtonClass(color) {
        const classMap = {
            red: 'bg-red-500 hover:bg-red-600',
            blue: 'bg-blue-500 hover:bg-blue-600',
            green: 'bg-green-500 hover:bg-green-600',
            yellow: 'bg-yellow-500 hover:bg-yellow-600'
        };
        return classMap[color] || 'bg-gray-500 hover:bg-gray-600';
    }
    
    getColorName(color) {
        const nameMap = {
            red: 'ĞšĞ ĞĞ¡ĞĞ«Ğ™',
            blue: 'Ğ¡Ğ˜ĞĞ˜Ğ™',
            green: 'Ğ—Ğ•Ğ›Ğ•ĞĞ«Ğ™',
            yellow: 'Ğ–Ğ•Ğ›Ğ¢Ğ«Ğ™'
        };
        return nameMap[color] || 'Ğ¦Ğ’Ğ•Ğ¢';
    }
    
    selectColor(selectedColor) {
        this.completeMiniGame(selectedColor === this.currentColor.textColor);
    }
    
    // ĞœĞµÑ‚Ğ¾Ğ´Ñ‹ Ğ´Ğ»Ñ Ğ¸Ğ³Ñ€Ñ‹ "ĞŸĞ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ" (ĞĞĞ’ĞĞ•)
    getSequenceGameContent() {
        const sequences = [
            { seq: [2, 4, 6, 8], next: 10, rule: 'Ñ‡ĞµÑ‚Ğ½Ñ‹Ğµ Ñ‡Ğ¸ÑĞ»Ğ°' },
            { seq: [1, 3, 5, 7], next: 9, rule: 'Ğ½ĞµÑ‡ĞµÑ‚Ğ½Ñ‹Ğµ Ñ‡Ğ¸ÑĞ»Ğ°' },
            { seq: [1, 4, 7, 10], next: 13, rule: '+3' },
            { seq: [2, 6, 18, 54], next: 162, rule: 'Ã—3' },
            { seq: [1, 1, 2, 3], next: 5, rule: 'Ğ¤Ğ¸Ğ±Ğ¾Ğ½Ğ°Ñ‡Ñ‡Ğ¸' }
        ];
        
        this.currentSequence = sequences[Math.floor(Math.random() * sequences.length)];
        this.sequenceOptions = this.generateSequenceOptions(this.currentSequence.next);
        
        return `
            <div class="text-center">
                <p class="mb-4">ĞĞ°Ğ¹Ğ´Ğ¸ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚ Ğ² Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸:</p>
                <div class="mb-6 p-4 bg-gray-100 rounded-lg">
                    <div class="text-2xl font-bold">
                        ${this.currentSequence.seq.join(', ')}, ?
                    </div>
                </div>
                <p class="mb-4 text-sm text-gray-600">Ğ§Ñ‚Ğ¾ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¼?</p>
                <div class="grid grid-cols-2 gap-3">
                    ${this.sequenceOptions.map(option => `
                        <button onclick="game.selectSequenceNumber(${option})" class="bg-purple-500 hover:bg-purple-600 text-white p-3 rounded-lg font-bold transition-colors">
                            ${option}
                        </button>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    generateSequenceOptions(correctAnswer) {
        const options = new Set([correctAnswer]);
        
        // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ½ĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ñ‹
        while (options.size < 4) {
            const variation = correctAnswer + (Math.random() - 0.5) * 10;
            options.add(Math.round(variation));
        }
        
        return Array.from(options).sort(() => Math.random() - 0.5);
    }
    
    selectSequenceNumber(selectedNumber) {
        this.completeMiniGame(selectedNumber === this.currentSequence.next);
    }
    
    // Ğ¢Ğ•Ğ¡Ğ¢ĞĞ’Ğ«Ğ• Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ˜ Ğ”Ğ›Ğ¯ ĞĞ¢Ğ›ĞĞ”ĞšĞ˜ Ğ¡ĞĞ¥Ğ ĞĞĞ•ĞĞ˜Ğ¯
    testSave() {
        console.log('ğŸ§ª Ğ¢Ğ•Ğ¡Ğ¢ Ğ¡ĞĞ¥Ğ ĞĞĞ•ĞĞ˜Ğ¯');
        const oldMoney = this.money;
        const oldLevel = this.level;
        
        this.money += 100;
        this.level += 1;
        this.petName = 'Test Pet ' + Math.floor(Math.random() * 100);
        this.saveData();
        this.updateDisplay();
        
        console.log(`âœ… Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ: Ğ”ĞµĞ½ÑŒĞ³Ğ¸ ${oldMoney} â†’ ${this.money}, Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ ${oldLevel} â†’ ${this.level}`);
        this.showMessage('ğŸ’¾ Ğ¢ĞµÑÑ‚ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ - Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ 100 Ğ¼Ğ¾Ğ½ĞµÑ‚ Ğ¸ 1 ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ!');
    }
    
    testLoad() {
        console.log('ğŸ§ª Ğ¢Ğ•Ğ¡Ğ¢ Ğ—ĞĞ“Ğ Ğ£Ğ—ĞšĞ˜');
        // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ‡Ñ‚Ğ¾ Ğ¸Ğ¼ĞµĞ½Ğ½Ğ¾ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¾ Ğ² localStorage
        const userKeys = Object.keys(localStorage).filter(key => key.startsWith(this.gameUserId));
        console.log('ğŸ” ĞĞ°Ğ¹Ğ´ĞµĞ½Ñ‹ ĞºĞ»ÑÑ‡Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ:', userKeys);
        
        const savedMoney = this.loadData('labubu_money', 100, 'number');
        const savedLevel = this.loadData('labubu_level', 1, 'number'); 
        const savedPetName = this.loadData('pet_name', 'Labubu', 'string');
        
        console.log('ğŸ“‚ Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ:', { savedMoney, savedLevel, savedPetName });
        console.log('ğŸ’¾ ĞšĞ»ÑÑ‡Ğ¸ Ğ² localStorage:', userKeys.length);
        this.showMessage(`ğŸ“‚ Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ: ${savedMoney} Ğ¼Ğ¾Ğ½ĞµÑ‚, ${savedLevel} ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ, ${savedPetName} (${userKeys.length} ĞºĞ»ÑÑ‡ĞµĞ¹)`);
    }
    
    clearSave() {
        console.log('ğŸ—‘ï¸ ĞĞ§Ğ˜Ğ¡Ğ¢ĞšĞ Ğ¡ĞĞ¥Ğ ĞĞĞ•ĞĞ˜Ğ¯');
        const keys = [
            'labubu_stats', 'labubu_money', 'labubu_outfit',
            'labubu_level', 'labubu_experience', 'labubu_age',
            'labubu_evolution', 'labubu_last_update', 'pet_name',
            'labubu_sleeping', 'current_skin', 'unlocked_skins',
            'owned_outfits', 'last_stat_decay', 'labubu_pets', 'active_pet_id'
        ];
        
        let deletedCount = 0;
        keys.forEach(key => {
            const userKey = `${this.gameUserId}_${key}`;
            if (localStorage.getItem(userKey)) {
                localStorage.removeItem(userKey);
                deletedCount++;
                console.log('âœ… Ğ£Ğ´Ğ°Ğ»ĞµĞ½ ĞºĞ»ÑÑ‡:', userKey);
            }
        });
        
        console.log(`ğŸ—‘ï¸ Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¾ ${deletedCount} ĞºĞ»ÑÑ‡ĞµĞ¹ Ğ¸Ğ· ${keys.length}`);
        this.showMessage(`ğŸ—‘ï¸ ĞÑ‡Ğ¸Ñ‰ĞµĞ½Ğ¾ ${deletedCount} ĞºĞ»ÑÑ‡ĞµĞ¹! ĞŸĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚Ğµ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ Ğ´Ğ»Ñ ÑĞ±Ñ€Ğ¾ÑĞ°.`);
    }
    
    forceSave() {
        console.log('ğŸ’¾ ĞŸĞ Ğ˜ĞĞ£Ğ”Ğ˜Ğ¢Ğ•Ğ›Ğ¬ĞĞĞ• Ğ¡ĞĞ¥Ğ ĞĞĞ•ĞĞ˜Ğ•');
        console.log('ğŸ“Š Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ¸Ğ³Ñ€Ñ‹:');
        console.log('- petName:', this.petName);
        console.log('- money:', this.money);
        console.log('- level:', this.level);
        console.log('- experience:', this.experience);
        console.log('- stats:', this.stats);
        
        // ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ²ÑĞµ ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
        this.saveValue('pet_name', this.petName);
        this.saveValue('labubu_money', this.money);
        this.saveValue('labubu_level', this.level);
        this.saveValue('labubu_experience', this.experience);
        this.saveValue('labubu_stats', this.stats);
        this.saveValue('labubu_age', this.age);
        this.saveValue('owned_outfits', this.ownedOutfits);
        this.saveValue('last_stat_decay', this.lastStatDecay);
        
        console.log('âœ… ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾');
        this.showMessage('ğŸ’¾ Ğ’ÑĞµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ñ‹!');
    }
    
    checkSaveIntegrity() {
        console.log('ğŸ” ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ Ğ¦Ğ•Ğ›ĞĞ¡Ğ¢ĞĞĞ¡Ğ¢Ğ˜ Ğ”ĞĞĞĞ«Ğ¥');
        
        const currentData = {
            petName: this.petName,
            money: this.money,
            level: this.level,
            experience: this.experience
        };
        
        const savedData = {
            petName: this.loadData('pet_name', 'DEFAULT'),
            money: this.loadData('labubu_money', -1, 'number'),
            level: this.loadData('labubu_level', -1, 'number'),
            experience: this.loadData('labubu_experience', -1, 'number')
        };
        
        console.log('ğŸ“Š Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ:', currentData);
        console.log('ğŸ’¾ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ:', savedData);
        
        let issuesFound = 0;
        Object.keys(currentData).forEach(key => {
            if (currentData[key] !== savedData[key]) {
                console.warn(`âš ï¸ ĞĞµÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ ${key}: Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ=${currentData[key]}, ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ½Ğ¾Ğµ=${savedData[key]}`);
                issuesFound++;
            }
        });
        
        const message = issuesFound === 0 
            ? 'âœ… Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹!'
            : `âš ï¸ ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ¾ ${issuesFound} Ğ½ĞµÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğ¹ (ÑĞ¼. ĞºĞ¾Ğ½ÑĞ¾Ğ»ÑŒ)`;
            
        this.showMessage(message);
        console.log(`ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°: ${issuesFound} Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼`);
    }
    
    checkLevelUp() {
        const newLevel = Math.floor(this.experience / 100) + 1;
        if (newLevel > this.level) {
            this.level = newLevel;
            this.money += 50;
            this.playHappySound();
            this.showMessage('ğŸ‰ Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞµĞ½! +50 Ğ¼Ğ¾Ğ½ĞµÑ‚!');
            
            // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑƒĞ½Ğ´ÑƒĞºĞ¾Ğ² Ğ·Ğ° ÑƒÑ€Ğ¾Ğ²Ğ½Ğ¸
            this.checkChestReward();
        }
    }
    
    checkChestReward() {
        const chestsEarned = Math.floor(this.level / 10);
        const chestsToAdd = chestsEarned - Math.floor(this.lastChestLevel / 10);
        
        if (chestsToAdd > 0) {
            this.chestCount += chestsToAdd;
            this.lastChestLevel = this.level;
            this.showMessage(`ğŸ ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½${chestsToAdd > 1 ? 'Ğ¾' : ''} ${chestsToAdd} ÑÑƒĞ½Ğ´ÑƒĞº${chestsToAdd > 1 ? 'Ğ°' : ''}!`);
            this.saveData();
        }
    }
    
    getChestsTabContent() {
        const availableChests = this.chestCount;
        const chestsFromFriends = Math.floor(this.friendsInvited / 5);
        const totalChests = availableChests + chestsFromFriends;
        
        return `
            <div class="space-y-3">
                <div class="bg-white rounded-lg p-3 shadow">
                    <h3 class="font-bold mb-2 text-purple-800 text-sm">ğŸ“¦ Ğ¡ÑƒĞ½Ğ´ÑƒĞºĞ¸</h3>
                    <div class="text-center mb-4">
                        <div class="text-3xl mb-2">ğŸ“¦</div>
                        <p class="text-lg font-bold">Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ ÑÑƒĞ½Ğ´ÑƒĞºĞ¾Ğ²: ${totalChests}</p>
                        <p class="text-xs text-gray-600">Ğ—Ğ° ÑƒÑ€Ğ¾Ğ²Ğ½Ğ¸: ${availableChests} â€¢ Ğ—Ğ° Ğ´Ñ€ÑƒĞ·ĞµĞ¹: ${chestsFromFriends}</p>
                    </div>
                    
                    ${totalChests > 0 ? `
                        <button onclick="game.openChest()" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white py-3 px-4 rounded-lg font-bold transition-colors animate-pulse">
                            ğŸ ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ ÑÑƒĞ½Ğ´ÑƒĞº
                        </button>
                    ` : `
                        <div class="text-center text-gray-500 py-4">
                            <p class="mb-2">ğŸ”’ ĞĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… ÑÑƒĞ½Ğ´ÑƒĞºĞ¾Ğ²</p>
                            <p class="text-xs">ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°Ğ¹Ñ‚Ğµ ÑƒÑ€Ğ¾Ğ²Ğ½Ğ¸ Ğ¸Ğ»Ğ¸ Ğ¿Ñ€Ğ¸Ğ³Ğ»Ğ°ÑˆĞ°Ğ¹Ñ‚Ğµ Ğ´Ñ€ÑƒĞ·ĞµĞ¹!</p>
                        </div>
                    `}
                </div>
                
                <div class="bg-white rounded-lg p-3 shadow">
                    <h3 class="font-bold mb-2 text-purple-800 text-sm">ğŸ¯ ĞšĞ°Ğº Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑÑƒĞ½Ğ´ÑƒĞºĞ¸</h3>
                    <div class="space-y-2 text-xs">
                        <div class="flex justify-between items-center p-2 bg-blue-50 rounded">
                            <span>ğŸ“ˆ ĞšĞ°Ğ¶Ğ´Ñ‹Ğµ 10 ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ¹</span>
                            <span class="font-bold text-blue-600">+1 ÑÑƒĞ½Ğ´ÑƒĞº</span>
                        </div>
                        <div class="flex justify-between items-center p-2 bg-green-50 rounded">
                            <span>ğŸ‘¥ ĞšĞ°Ğ¶Ğ´Ñ‹Ğµ 5 Ğ´Ñ€ÑƒĞ·ĞµĞ¹</span>
                            <span class="font-bold text-green-600">+1 ÑÑƒĞ½Ğ´ÑƒĞº</span>
                        </div>
                    </div>
                    <div class="mt-3 text-xs text-gray-600">
                        <p>Ğ”Ğ¾ ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ³Ğ¾ ÑÑƒĞ½Ğ´ÑƒĞºĞ°: ${10 - (this.level % 10)} ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ¹</p>
                        <p>ĞŸÑ€Ğ¸Ğ³Ğ»Ğ°ÑˆĞµĞ½Ğ¾ Ğ´Ñ€ÑƒĞ·ĞµĞ¹: ${this.friendsInvited}/5</p>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg p-3 shadow">
                    <h3 class="font-bold mb-2 text-purple-800 text-sm">ğŸ’ Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ñ‹Ğµ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñ‹</h3>
                    <div class="grid grid-cols-1 gap-1 text-xs">
                        ${Object.entries(this.skins).map(([key, skin]) => `
                            <div class="flex items-center justify-between p-2 rounded" style="background-color: ${skin.color}22;">
                                <div class="flex items-center space-x-2">
                                    <span>${this.rarities[skin.rarity].emoji}</span>
                                    <span class="font-medium">${skin.name}</span>
                                    <span class="text-xs" style="color: ${this.rarities[skin.rarity].color};">${this.rarities[skin.rarity].name}</span>
                                </div>
                                <span class="font-bold">${skin.chance}%</span>
                            </div>
                        `).join('')}
                        <div class="flex items-center justify-between p-2 bg-yellow-50 rounded">
                            <div class="flex items-center space-x-2">
                                <span>ğŸ’°</span>
                                <span class="font-medium">100 Ğ¼Ğ¾Ğ½ĞµÑ‚</span>
                            </div>
                            <span class="font-bold">90%</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg p-3 shadow">
                    <h3 class="font-bold mb-2 text-purple-800 text-sm">ğŸ‘— Ğ˜Ğ½Ğ²ĞµĞ½Ñ‚Ğ°Ñ€ÑŒ ÑĞºĞ¸Ğ½Ğ¾Ğ²</h3>
                    <div class="grid grid-cols-2 gap-2 max-h-40 overflow-y-auto">
                        ${this.unlockedSkins.map(skinKey => {
                            const skin = this.skins[skinKey];
                            const isActive = this.currentSkin === skinKey;
                            return `
                                <button onclick="game.selectSkin('${skinKey}')" class="p-2 rounded-lg text-xs transition-colors ${
                                    isActive ? 'bg-green-100 border-2 border-green-500' : 'bg-gray-100 hover:bg-gray-200'
                                }">
                                    <div class="text-center">
                                        <div class="w-12 h-12 mx-auto mb-1 rounded-full flex items-center justify-center text-lg" style="background-color: ${skin.color};">
                                            ğŸ°
                                        </div>
                                        <div class="font-medium">${skin.name}</div>
                                        <div class="text-xs" style="color: ${this.rarities[skin.rarity].color};">
                                            ${this.rarities[skin.rarity].emoji} ${this.rarities[skin.rarity].name}
                                        </div>
                                        ${isActive ? '<div class="text-green-600 font-bold mt-1">âœ“ ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½</div>' : ''}
                                    </div>
                                </button>
                            `;
                        }).join('')}
                    </div>
                </div>
            </div>
        `;
    }
    
    openChest() {
        if (this.chestCount <= 0) {
            this.showMessage('âŒ ĞĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… ÑÑƒĞ½Ğ´ÑƒĞºĞ¾Ğ²!');
            return;
        }
        
        this.chestCount--;
        
        // ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñƒ
        const random = Math.random() * 100;
        let reward = null;
        
        // 90% ÑˆĞ°Ğ½Ñ Ğ½Ğ° Ğ¼Ğ¾Ğ½ĞµÑ‚Ñ‹ (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞµÑĞ»Ğ¸ Ğ½Ğµ Ğ²Ñ‹Ğ¿Ğ°Ğ»Ğ¸ ÑĞºĞ¸Ğ½Ñ‹)
        if (random <= 90) {
            // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ğ²Ñ‹Ğ¿Ğ°Ğ» Ğ»Ğ¸ ÑĞºĞ¸Ğ½
            let skinChance = 0;
            let foundSkin = null;
            
            for (const [key, skin] of Object.entries(this.skins)) {
                skinChance += skin.chance;
                if (random <= skinChance) {
                    foundSkin = key;
                    break;
                }
            }
            
            if (foundSkin && !this.unlockedSkins.includes(foundSkin)) {
                // Ğ’Ñ‹Ğ¿Ğ°Ğ» Ğ½Ğ¾Ğ²Ñ‹Ğ¹ ÑĞºĞ¸Ğ½
                reward = { type: 'skin', key: foundSkin, skin: this.skins[foundSkin] };
                this.unlockedSkins.push(foundSkin);
            } else {
                // Ğ’Ñ‹Ğ¿Ğ°Ğ»Ğ¸ Ğ¼Ğ¾Ğ½ĞµÑ‚Ñ‹
                reward = { type: 'money', amount: 100 };
                this.money += 100;
            }
        } else {
            // ĞŸÑ‹Ñ‚Ğ°ĞµĞ¼ÑÑ Ğ´Ğ°Ñ‚ÑŒ ÑĞºĞ¸Ğ½
            let cumulativeChance = 0;
            for (const [key, skin] of Object.entries(this.skins)) {
                cumulativeChance += skin.chance;
                if (random <= cumulativeChance) {
                    if (!this.unlockedSkins.includes(key)) {
                        reward = { type: 'skin', key: key, skin: skin };
                        this.unlockedSkins.push(key);
                    } else {
                        reward = { type: 'money', amount: 100 };
                        this.money += 100;
                    }
                    break;
                }
            }
        }
        
        this.playHappySound();
        this.saveData();
        this.updateDisplay();
        
        // ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
        this.showChestResult(reward);
    }
    
    showChestResult(reward) {
        let message = '';
        let className = '';
        
        if (reward.type === 'skin') {
            message = `ğŸ‰ ĞĞ¾Ğ²Ñ‹Ğ¹ ÑĞºĞ¸Ğ½: ${reward.skin.name}!`;
            className = 'bg-purple-100 border-purple-500 text-purple-700';
        } else {
            message = `ğŸ’° ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¾ ${reward.amount} Ğ¼Ğ¾Ğ½ĞµÑ‚!`;
            className = 'bg-yellow-100 border-yellow-500 text-yellow-700';
        }
        
        // Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¼Ğ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºĞ½Ğ¾ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
        modal.innerHTML = `
            <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4">
                <div class="text-center">
                    <div class="text-4xl mb-4">ğŸ</div>
                    <h3 class="text-lg font-bold mb-2">Ğ¡ÑƒĞ½Ğ´ÑƒĞº Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚!</h3>
                    <div class="p-4 rounded-lg mb-4 ${className}">
                        ${message}
                    </div>
                    ${reward.type === 'skin' ? `
                        <div class="mb-4">
                            <div class="w-16 h-16 mx-auto rounded-full flex items-center justify-center text-2xl" style="background-color: ${reward.skin.color};">
                                ğŸ°
                            </div>
                            <p class="text-sm mt-2" style="color: ${this.rarities[reward.skin.rarity].color};">
                                ${this.rarities[reward.skin.rarity].emoji} ${this.rarities[reward.skin.rarity].name}
                            </p>
                        </div>
                    ` : ''}
                    <button onclick="this.parentElement.parentElement.parentElement.remove()" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-2 rounded-lg font-bold">
                        ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾!
                    </button>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        // ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· Ğ½ĞµĞ±Ğ¾Ğ»ÑŒÑˆÑƒÑ Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºÑƒ
        setTimeout(() => {
            this.switchTab('chests');
        }, 100);
    }
    
    selectSkin(skinKey) {
        if (this.unlockedSkins.includes(skinKey)) {
            this.currentSkin = skinKey;
            this.saveData();
            this.updateDisplay();
            this.showMessage(`âœ¨ Ğ’Ñ‹Ğ±Ñ€Ğ°Ğ½ ÑĞºĞ¸Ğ½: ${this.skins[skinKey].name}!`);
            this.switchTab('chests');
        } else {
            this.showMessage('âŒ Ğ¡ĞºĞ¸Ğ½ Ğ½Ğµ Ñ€Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½!');
        }
    }
    
    checkNotifications() {
        // Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° stats
        if (!this.stats || typeof this.stats !== 'object') {
            return;
        }
        
        if (this.stats.happiness < 50) {
            this.showNotification(`ğŸ˜¢ ${this.petName}: ĞœĞ½Ğµ ÑĞºÑƒÑ‡Ğ½Ğ¾! ĞŸĞ¾Ğ¸Ğ³Ñ€Ğ°Ğ¹ ÑĞ¾ Ğ¼Ğ½Ğ¾Ğ¹!`, 'sad');
        }
        if (this.stats.sleep < 50) {
            this.showNotification(`ğŸ˜´ ${this.petName}: Ğ¯ Ñ…Ğ¾Ñ‡Ñƒ ÑĞ¿Ğ°Ñ‚ÑŒ! Ğ£Ğ»Ğ¾Ğ¶Ğ¸ Ğ¼ĞµĞ½Ñ Ğ² ĞºÑ€Ğ¾Ğ²Ğ°Ñ‚ĞºÑƒ!`, 'sleepy');
        }
        if (this.stats.hunger < 50) {
            this.showNotification(`ğŸ½ï¸ ${this.petName}: Ğ¯ Ğ³Ğ¾Ğ»Ğ¾Ğ´ĞµĞ½! ĞŸĞ¾ĞºĞ¾Ñ€Ğ¼Ğ¸ Ğ¼ĞµĞ½Ñ Ñ‡ĞµĞ¼-Ğ½Ğ¸Ğ±ÑƒĞ´ÑŒ Ğ²ĞºÑƒÑĞ½Ñ‹Ğ¼!`, 'hungry');
        }
        if (this.stats.cleanliness < 50) {
            this.showNotification(`ğŸ› ${this.petName}: Ğ¯ Ğ³Ñ€ÑĞ·Ğ½Ñ‹Ğ¹! ĞŸĞ¾Ğ¼Ğ¾Ğ¹ Ğ¼ĞµĞ½Ñ, Ğ¿Ğ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°!`, 'dirty');
        }
        if (this.stats.health < 50) {
            this.showNotification(`ğŸ’Š ${this.petName}: ĞœĞ½Ğµ Ğ¿Ğ»Ğ¾Ñ…Ğ¾! Ğ’Ñ‹Ğ»ĞµÑ‡Ğ¸ Ğ¼ĞµĞ½Ñ!`, 'sick');
        }
        if (this.stats.energy < 30) {
            this.showNotification(`âš¡ ${this.petName}: Ğ£ Ğ¼ĞµĞ½Ñ Ğ¼Ğ°Ğ»Ğ¾ ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸! Ğ”Ğ°Ğ¹ Ğ¼Ğ½Ğµ Ğ¾Ñ‚Ğ´Ğ¾Ñ…Ğ½ÑƒÑ‚ÑŒ!`, 'tired');
        }
    }
    
    checkEvolution() {
        const currentStage = Object.entries(this.evolutionStages)
            .reverse()
            .find(([_, stage]) => this.age >= stage.minAge)?.[0] || 'baby';
        
        if (currentStage !== this.evolutionStage) {
            const oldStage = this.evolutionStages[this.evolutionStage].name;
            const newStage = this.evolutionStages[currentStage].name;
            
            this.evolutionStage = currentStage;
            this.playHappySound();
            this.showMessage(`ğŸ‰ Ğ­Ğ²Ğ¾Ğ»ÑÑ†Ğ¸Ñ! ${this.petName} Ğ¿Ñ€ĞµĞ²Ñ€Ğ°Ñ‚Ğ¸Ğ»ÑÑ Ğ¸Ğ· ${oldStage} Ğ² ${newStage}!`);
            
            // Ğ‘Ğ¾Ğ½ÑƒÑ Ğ·Ğ° ÑĞ²Ğ¾Ğ»ÑÑ†Ğ¸Ñ
            this.money += 100;
            this.stats.happiness = Math.min(100, this.stats.happiness + 20);
            
            console.log(`âœ¨ ${this.petName} ÑĞ²Ğ¾Ğ»ÑÑ†Ğ¸Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ»: ${oldStage} â†’ ${newStage} (Ğ²Ğ¾Ğ·Ñ€Ğ°ÑÑ‚: ${this.age} Ğ´Ğ½ĞµĞ¹)`);
        }
    }
    
    startGameLoop() {
        setInterval(() => {
            const now = Date.now();
            const timeDiff = Math.floor((now - this.lastStatDecay) / 1000);
            
            // Ğ¡Ñ‚Ğ°Ñ€ĞµĞ½Ğ¸Ğµ: 1 Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ = 1 Ğ´ĞµĞ½ÑŒ Ğ¿Ğ¸Ñ‚Ğ¾Ğ¼Ñ†Ğ° (86400 ÑĞµĞºÑƒĞ½Ğ´ = 1 Ğ´ĞµĞ½ÑŒ)
            const agingTimeDiff = Math.floor((now - this.lastUpdate) / 1000);
            if (agingTimeDiff >= 86400) {
                const daysToAdd = Math.floor(agingTimeDiff / 86400);
                this.age += daysToAdd;
                this.lastUpdate = now - (agingTimeDiff % 86400) * 1000; // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ğº Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸
                this.checkEvolution();
                this.saveData();
                console.log(`ğŸ‚ ${this.petName} ÑĞ¾ÑÑ‚Ğ°Ñ€Ğ¸Ğ»ÑÑ Ğ½Ğ° ${daysToAdd} Ğ´Ğ½ĞµĞ¹! ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ²Ğ¾Ğ·Ñ€Ğ°ÑÑ‚: ${this.age}`);
            }
            
            // Ğ¡Ğ½Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸Ğº ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚ (300 ÑĞµĞºÑƒĞ½Ğ´)
            if (timeDiff >= 300) {
                const intervalsPassed = Math.floor(timeDiff / 300);
                
                if (!this.isSleeping) {
                    this.stats.hunger = Math.max(0, this.stats.hunger - (3 * intervalsPassed));
                    this.stats.happiness = Math.max(0, this.stats.happiness - (2 * intervalsPassed));
                    this.stats.cleanliness = Math.max(0, this.stats.cleanliness - (2 * intervalsPassed));
                    this.stats.health = Math.max(0, this.stats.health - (1 * intervalsPassed));
                    this.stats.energy = Math.min(100, this.stats.energy + (1 * intervalsPassed)); // ĞœĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾Ğµ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ
                    this.stats.sleep = Math.max(0, this.stats.sleep - (3 * intervalsPassed));
                    
                    this.checkNotifications();
                } else {
                    // Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ ÑĞ½Ğ°
                    this.stats.energy = Math.min(100, this.stats.energy + (8 * intervalsPassed)); // Ğ‘Ñ‹ÑÑ‚Ñ€Ğ¾Ğµ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ
                    this.stats.sleep = Math.min(100, this.stats.sleep + (12 * intervalsPassed));
                    this.stats.hunger = Math.max(0, this.stats.hunger - (1 * intervalsPassed)); // ĞœĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾Ğµ ÑĞ½Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ
                    this.stats.happiness = Math.max(0, this.stats.happiness - (1 * intervalsPassed));
                    this.stats.cleanliness = Math.max(0, this.stats.cleanliness - (1 * intervalsPassed));
                    this.stats.health = Math.max(0, this.stats.health - (0.5 * intervalsPassed));
                }
                
                this.lastStatDecay = now;
                this.saveData();
                this.updateDisplay();
            }
        }, 60000); // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ°Ğ¶Ğ´ÑƒÑ Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ
    }
    
    startNotificationTimer() {
        setInterval(() => {
            const now = Date.now();
            const timeSinceLastNotification = now - this.lastNotification;
            
            // 30 Ğ¼Ğ¸Ğ½ÑƒÑ‚ = 1800000 Ğ¼Ğ¸Ğ»Ğ»Ğ¸ÑĞµĞºÑƒĞ½Ğ´
            if (timeSinceLastNotification >= 1800000) {
                this.showNotification(`ğŸ’­ ${this.petName}: Ğ¢Ñ‹ Ğ½Ğµ Ğ·Ğ°Ğ±Ñ‹Ğ» Ğ¾Ğ±Ğ¾ Ğ¼Ğ½Ğµ? Ğ¯ ÑĞºÑƒÑ‡Ğ°Ñ!`, 'reminder');
                this.lastNotification = now;
                localStorage.setItem('shared_labubu_last_notification', now.toString());
            }
        }, 60000); // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ°Ğ¶Ğ´ÑƒÑ Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ
    }
}

// Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¸Ğ³Ñ€Ñ‹
let game;
document.addEventListener('DOMContentLoaded', () => {
    console.log('ğŸš€ DOM Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½, Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¸Ğ³Ñ€Ñ‹...');
    game = new LabubuCareGame();
    
    // Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ‡ĞµÑ€ĞµĞ· 2 ÑĞµĞºÑƒĞ½Ğ´Ñ‹
    setTimeout(() => {
        if (game) {
            console.log('ğŸ”„ Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ...');
            game.updateDisplay();
        }
    }, 2000);
});
</script>

</body>
</html>
